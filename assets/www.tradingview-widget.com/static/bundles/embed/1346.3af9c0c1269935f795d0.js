"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[1346],{474513:(e,t,o)=>{function r(e,t){const o=e.backgroundTopColor().value(),r=e.backgroundColor().value(),n=t.model().panes().indexOf(t),i=t.model().mainPane();return n>(i?t.model().panes().indexOf(i):0)?r:o}o.d(t,{getPaneWidgetSideAreaBgColor:()=>r})},866249:(e,t,o)=>{o.d(t,{calculateFontSize:()=>h,getPreparedTextMeasurements:()=>l});var r=o(650151),n=o(837462),i=o(960433),a=o(910282),s=o(660439);function l(e,t,o,r){if(e.size)return e;for(let n=r.minAllowedFontSize;n<=r.maxAllowedFontSize;n++){const a=o.get(n)??new i.TextWidthCache;o.set(n,a),e.set(n,d(t,n,a,r.maxSymbols))}return e}function d(e,t,o,r){e.font=(0,n.makeFont)(t,a.CHART_FONT_FAMILY);const i=new Map;for(let t=1;t<=r;t++)i.set(t,o.measureText(e,new Array(t+1).join("0")));const s=o.yMidCorrection(e,"0"),l=o.getMetrics(e,"0");return{widths:i,actualFontHeight:l.fontBoundingBoxDescent+l.fontBoundingBoxAscent,yCorrection:s}}function h(e,t,o,n,i,a){const d=l(i,o,n,a),{maxAllowedFontSize:h,minAllowedFontSize:c,fontSizeCoeff:u,horzCellMinMargin:m,horzCellMarginsCoeff:C}=a;let f=h;const _=e=>c+e;for(const o of e){if(!f)break;const{box:e,label:n}=o,i=Math.floor(e.max.x-e.min.x)/t.horizontalPixelRatio,a=(e.max.y-e.min.y)/t.verticalPixelRatio,l=Math.round(a*u);if(l<c){f=0;break}f>l&&(f=l);const h=_((0,s.lowerboundExt)(_,n,((e,t)=>{var o,n;return(o=e,n=t,(0,r.ensureDefined)(d.get(o)?.widths.get(n.length)))<i-Math.max(m,2*C*_(e))}),0,f-c+1));if(h<f+1&&(f=h-1),f<c){f=0;break}}return f?{fontSize:f,yMidCorrection:(g=f,(0,r.ensureDefined)(d.get(g)?.yCorrection))}:null;var g}},203177:(e,t,o)=>{o.d(t,{rowBoxGenerator:()=>a});var r=o(610555),n=o(112787);const{cellHeight:i}=n.constants;function*a(e,{bitmapSize:{width:t}}){for(let o=0;o<e.length;++o)yield[o,(0,r.box)((0,r.point)(0,o*i),(0,r.point)(t,(o+1)*i))]}},414986:(e,t,o)=>{o.d(t,{SummaryPaneView:()=>z});var r=o(650151),n=o(610555),i=o(910282),a=o(474513),s=o(423783),l=o(837462),d=o(708162),h=o(866249),c=o(112787),u=o(444372),m=o(820807);const C=u.t(null,{context:"chart with summary table"},o(454602));class f extends m.MediaCoordinatesPaneRenderer{constructor(e){super(),this._data=null,this._data=e}setData(e){this._data=e}hitTest(){return null}_drawImpl(e){const t=this._data;if(!t)return;const o=t.isDark?c.darkColors:c.lightColors,r=e.context;r.fillStyle=o.textColor,r.textBaseline="middle",r.font=t.font,r.fillText(C,c.constants.legendLeftPadding,e.mediaSize.height/2+t.yMidCorrection)}}var _=o(906453),g=o(731974),x=o(765935),w=o(320994),v=o(338242),p=o(688857),M=o(203177),S=o(960433);class T extends w.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=null,this._widthCache=new S.TextWidthCache(1e3),this._data=e??null}setData(e){this._data=e}hitTest(e,t){const o=this._data;if(!o?.columns.length)return null;for(const[r,n]of(0,M.rowBoxGenerator)(o.columns[0].rows,t))if((0,_.pointInBox)(e,n))return new g.HitTestResult(g.HitTarget.Regular,{activeItem:r,cursorType:x.PaneCursorType.Default});return null}_drawImpl(e){
const t=this._data;if(!t?.columns.length)return;const{context:o,bitmapSize:r,verticalPixelRatio:n,horizontalPixelRatio:a}=e,s=t.isDark?c.darkColors:c.lightColors,d=c.constants.cellHeight,h=Math.round(d*n);o.fillStyle=s.textColor,o.textBaseline="middle",o.font=(0,l.makeFont)(t.fontSize,i.CHART_FONT_FAMILY);const u=t.columns.length-1;if((0,p.drawScaled)(o,a,n,(()=>{t.columns.forEach(((e,r)=>{const[n,i]=[e.left,e.right].map((e=>Math.round(e/a))),s=i-n,l=r===u;e.rows.forEach(((e,r)=>{const a=e.text,h=e.backgroundColor;h&&(o.save(),o.fillStyle=h,o.fillRect(n,r*d,s,d),o.restore());this._widthCache.measureText(o,a)>s-2*c.constants.horzCellMinMargin?l&&!t.cutOffLastColumn?(o.textAlign="left",o.fillText(a,n+c.constants.horzCellMinMargin,r*d+d/2)):(o.save(),o.textAlign="left",o.beginPath(),o.rect(n+c.constants.horzCellMinMargin,r*d,s-2*c.constants.horzCellMinMargin,d),o.clip(),o.fillText(a,n+c.constants.horzCellMinMargin,r*d+d/2),o.restore()):(o.textAlign="center",o.fillText(a,(n+i)/2,r*d+d/2+t.yMidCorrection))}))}))})),o.lineWidth=Math.max(1,Math.floor(a)),void 0!==t.hoveredRow&&(o.fillStyle=s.hoveredRowColor,o.fillRect(0,t.hoveredRow*h,r.width,h)),o.strokeStyle=t.vertBordersColor,t.columns.forEach((e=>{(0,v.drawVerticalLine)(o,e.left,0,r.height)})),t.cutOffLastColumn){const e=t.columns[t.columns.length-1];(0,v.drawVerticalLine)(o,e.right,0,r.height)}{const[{rows:{length:e}}]=t.columns;o.strokeStyle=t.horzBordersColor;for(let t=1;t<=e;++t)(0,v.drawHorizontalLine)(o,t*h,0,r.width)}}}const R=new Map;class z{constructor(e,t){this._renderer=new d.CompositeRenderer,this._legendRenderer=null,this._summaryRenderer=new T,this._invalidated=!0,this._textWidthCachesMap=new Map,this._study=e,this._model=t,this._textWidthCacheCanvas=(0,r.ensureNotNull)(document.createElement("canvas")),this._textWidthCacheCanvasCtx=(0,r.ensureNotNull)(this._textWidthCacheCanvas.getContext("2d"))}update(){this._invalidated=!0}renderer(e){return this._invalidated&&(this._updateRenderer(e),this._invalidated=!1),this._renderer}makeSureIsUpdated(e){this._invalidated&&(this._updateRenderer(e),this._invalidated=!1)}_updateRenderer(e){this._renderer.clear();const t=this._getDataSourceForSummary();if(!t)return;const o=(0,r.ensureNotNull)(this._model.paneForSource(t)),d=(0,a.getPaneWidgetSideAreaBgColor)(this._model,o),u=o.collapsed().value()&&!o.maximized().value(),m=(0,s.isColorDark)(d);if(u){const e=(0,h.getPreparedTextMeasurements)(R,this._textWidthCacheCanvasCtx,this._textWidthCachesMap,c.constants),t={isDark:m,font:(0,l.makeFont)(c.constants.legendFontSize,i.CHART_FONT_FAMILY),yMidCorrection:e.get(c.constants.legendFontSize)?.yCorrection??0};return this._legendRenderer||(this._legendRenderer=new f(t)),this._legendRenderer.setData(t),void this._renderer.append(this._legendRenderer)}const C=this._model.timeScale().logicalRange();if(!C)return;const _=this._getSummaryColumnRendererData(e,C);if(null===_)return;const g=this._model.properties().childs().paneProperties.childs(),x={
hoveredRow:this._model.hoveredSource()===t?this._model.lastHittestData()?.activeItem:void 0,columns:_,cutOffLastColumn:this._cutOffLastColumn(),isDark:m,vertBordersColor:g.vertGridProperties.childs().color.value(),horzBordersColor:g.horzGridProperties.childs().color.value()},w=(0,h.calculateFontSize)(function*(e,t){for(let o=0;o<e.columns.length-1;o++){const r=e.columns[o];for(let e=0;e<r.rows.length;e++){const o=r.rows[e],i=e*t,a=(e+1)*t;yield{label:o.text,box:(0,n.box)((0,n.point)(r.left,i),(0,n.point)(r.right,a))}}}}(x,c.constants.cellHeight*e.verticalPixelRatio),e,this._textWidthCacheCanvasCtx,this._textWidthCachesMap,R,c.constants)||{fontSize:c.constants.minAllowedFontSize,yMidCorrection:0};this._summaryRenderer.setData({...x,...w}),this._renderer.append(this._summaryRenderer)}}},304550:(e,t,o)=>{o.d(t,{SummaryWidgetSideAreaView:()=>x});var r=o(650151),n=o(960433),i=o(906453),a=o(837462),s=o(731974),l=o(320994),d=o(338242),h=o(910282),c=o(688857),u=o(112787),m=o(203177),C=o(765935);class f extends l.BitmapCoordinatesPaneRenderer{constructor(){super(...arguments),this._data=null,this._widthCache=new n.TextWidthCache(1e3)}setData(e){this._data=e}hitTest(e,t){const o=this._data;if(!o?.rowTitles.length)return null;for(const[r,n]of(0,m.rowBoxGenerator)(o.rowTitles,t))if((0,i.pointInBox)(e,n))return new s.HitTestResult(s.HitTarget.Regular,{activeItem:r,cursorType:C.PaneCursorType.Default});return null}_drawImpl(e){const t=this._data;if(null===t)return;const{context:o,bitmapSize:r,verticalPixelRatio:n,horizontalPixelRatio:i,mediaSize:s}=e,l=t.isDark?u.darkColors:u.lightColors,m=u.constants.cellHeight,C=Math.round(m*n);void 0!==t.hoveredRow&&(o.fillStyle=l.hoveredRowColor,o.fillRect(0,t.hoveredRow*C,r.width,C)),o.strokeStyle=t.borderColor,t.rowTitles.forEach(((e,t)=>{const n=(t+1)*C;(0,d.drawHorizontalLine)(o,n,0,r.width)})),o.fillStyle=l.textColor,o.textBaseline="middle",o.font=(0,a.makeFont)(t.fontSize,h.CHART_FONT_FAMILY),(0,c.drawScaled)(o,i,n,(()=>{t.rowTitles.forEach(((e,r)=>{let n;if("right"===t.align)n=u.constants.horzCellMinMargin;else{const t=this._widthCache.measureText(o,e);n=s.width-t-u.constants.horzCellMinMargin}o.fillText(e,n,r*m+m/2+t.yMidCorrection)}))}))}}var _=o(423783),g=o(474513);class x{constructor(e){this._renderer=new f,this._widthsCache=new n.TextWidthCache,this._model=e,this._textMeasureCanvas=document.createElement("canvas")}destroy(){this._textMeasureCanvas.remove()}renderer(){return this._renderer}update(){const e=this._model.mainSeries().priceScale(),t=this._model.properties().childs().paneProperties.childs(),o=this._model.mainPane(),n=this._getDataSourceForSummary();if(e&&o&&n){const i=(0,r.ensureNotNull)(this._model.paneForSource(n)),s=(0,g.getPaneWidgetSideAreaBgColor)(this._model,i),l=(0,_.isColorDark)(s),d=o.priceScalePosition(e);if("overlay"!==d){const e=(0,r.ensureNotNull)(this._textMeasureCanvas.getContext("2d"));e.font=(0,a.makeFont)(u.constants.maxAllowedFontSize,h.CHART_FONT_FAMILY),this._renderer.setData({
hoveredRow:this._model.hoveredSource()===n?this._model.lastHittestData()?.activeItem:void 0,rowTitles:this._visibleTitles(),align:d,isDark:l,fontSize:u.constants.maxAllowedFontSize,borderColor:t.horzGridProperties.childs().color.value(),yMidCorrection:this._widthsCache.yMidCorrection(e,"ABC")})}}}optimalWidth(){const e=(0,r.ensureNotNull)(this._textMeasureCanvas.getContext("2d"));return e.font=(0,a.makeFont)(u.constants.maxAllowedFontSize,h.CHART_FONT_FAMILY),this._visibleTitles().reduce(((t,o)=>Math.max(t,this._widthsCache.measureText(e,o))),0)+2*u.constants.horzCellMinMargin}}}}]);