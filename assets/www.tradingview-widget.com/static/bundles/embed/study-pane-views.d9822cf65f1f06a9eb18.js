"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[20507],{700571:(e,t,i)=>{function r(e,t,i){const r=e.get(t);return void 0!==r?r:(e.set(t,i),i)}function n(e,t,i){const r=e.get(t);if(void 0!==r)return r;const n=i();return e.set(t,n),n}function o(e,t,i,n){const o=r(e,t,new Map);return r(o,i,n)}function s(e,t,i,o){return n(r(e,t,new Map),i,o)}function a(e,t,i,n,o){const s=r(e,t,new Map),a=r(s,i,new Map);return r(a,n,o)}i.d(t,{AbstractMapContainer:()=>l,getDefault2:()=>o,getDefault2Lazy:()=>s,getDefault3:()=>a});class l{constructor(){this._map=new Map,this._size=0}size(){return this._size}clear(){this._map.clear(),this._size=0}}},730487:(e,t,i)=>{i.d(t,{LocationToYMixin:()=>s});var r=i(650151),n=i(770885),o=i(462140);class s{_locationToY(e,t,i=0){let s;switch(e){case n.MarkLocation.AboveBar:s=2;break;case n.MarkLocation.BelowBar:s=3}const a=this._provider.firstValue();if(null===a)return 0;i>=1&&(i-=1);const l=(0,r.ensureNotNull)(this._provider.priceScale()),d=[];for(let e=-i;e<=i;e++){const i=this._provider.series().bars().valueAt(t+e);if(null!==i){const e=i[s];if(null==e)continue;d.push(l.priceToCoordinate(e,a))}}switch(e){case n.MarkLocation.AboveBar:return(0,o.min)(d)-15;case n.MarkLocation.BelowBar:return(0,o.max)(d)+15}}}},692789:(e,t,i)=>{i.d(t,{TrendLineRenderer:()=>f,drawArrow:()=>u});var r=i(650151),n=i(2624),o=i(346272),s=i(731974),a=i(338242),l=i(65840),d=i(688857),h=i(257145);function c(e,t,i,r,n){t.save(),t.fillStyle="#000000",t.beginPath(),t.arc(e.x*n,e.y*n,i*n,0,2*Math.PI,!1),t.fill(),r.strokeWidth&&(t.lineWidth=r.strokeWidth,t.stroke()),t.restore()}function u(e,t,i,r,n,o=!1){if(t.subtract(e).length()<1)return;const s=(0,l.getArrowPoints)(e,t,r,o,!0).slice(0,2);let a=null;const{horizontalPixelRatio:d,verticalPixelRatio:h}=n;for(let e=0;e<s.length;++e){const t=s[e][0],r=s[e][1];(null===a||a.subtract(t).length()>1)&&i.moveTo(t.x*d,t.y*h),i.lineTo(r.x*d,r.y*h),a=r}}class f{constructor(){this._data=null,this._hittest=new s.HitTestResult(s.HitTarget.MovePoint)}setData(e){this._data=e}setHitTest(e){this._hittest=e}draw(e,t){const i=this._data;if(null===i)return;if("points"in i&&i.points.length<2)return;const{horizontalPixelRatio:r}=t;if(void 0!==i.excludeBoundaries){e.save();for(const r of i.excludeBoundaries)(0,d.addExclusionArea)(e,t,r)}const{linestyle:n,lineCap:o=(n===h.LINESTYLE_SOLID?"round":"butt")}=i;e.lineCap=o,e.lineJoin="round",e.strokeStyle=i.color,e.lineWidth=Math.max(1,Math.floor(i.linewidth*r)),(0,a.setLineStyle)(e,n);const s=i.points[0],l=i.points[1];let c=[];e.beginPath(),i.overlayLineEndings?c=[s.clone(),l.clone()]:this._drawEnds(e,[s,l],i.linewidth,t);const u=this._extendAndClipLineSegment(s,l,t);null!==u&&i.linewidth>0&&(0,a.addPixelPerfectLineToPath)(e,u[0].x,u[0].y,u[1].x,u[1].y,t),i.overlayLineEndings&&this._drawEnds(e,c,i.linewidth,t),e.stroke(),void 0!==i.excludeBoundaries&&e.restore()}hitTest(e,t){const i=this._data;if(null===i)return null;if("points"in i&&i.points.length<2)return null;const r=(i.hitTestTolerance??(0,
l.interactionTolerance)().line)+i.linewidth/2,o=i.points[0],s=i.points[1],a=this._extendAndClipLineSegment(o,s,t);if(null!==a){if((0,n.distanceToSegment)(a[0],a[1],e).distance<=r)return this._hittest}return null}_extendAndClipLineSegment(e,t,i){const n=(0,r.ensureNotNull)(this._data);return(0,l.extendAndClipLineSegment)(e,t,i.mediaSize.width,i.mediaSize.height,n.extendleft,n.extendright)}_drawEnds(e,t,i,n){const s=t[0],a=t[1],l=(0,r.ensureNotNull)(this._data);switch(l.leftend){case o.LineEnd.Arrow:u(a,s,e,i,n);break;case o.LineEnd.Circle:c(s,e,i,(0,r.ensureDefined)(l.endstyle),n.horizontalPixelRatio)}switch(l.rightend){case o.LineEnd.Arrow:u(s,a,e,i,n);break;case o.LineEnd.Circle:c(a,e,i,(0,r.ensureDefined)(l.endstyle),n.horizontalPixelRatio)}}}},758989:(e,t,i)=>{i.r(t),i.d(t,{BackgroundPaneView:()=>l});var r=i(650151),n=i(708162),o=i(688857),s=i(534328);class a{constructor(e){this._data=e}hitTest(e){return null}draw(e,t){}drawBackground(e,t){const i=this._data,r=(0,s.generateColor)(this._data.color,this._data.transparency),n=Math.round(i.x1*t.horizontalPixelRatio),a=Math.round(i.x2*t.verticalPixelRatio);(0,o.fillRect)(e,n,0,a-n,t.bitmapSize.height,r)}}class l{constructor(e,t,i){this._data=[],this._invalidated=!0,this._provider=e,this._model=t,this._data=[]}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new n.CompositeRenderer;for(const t of this._data)e.append(new a(t));return e}_updateViewInternal(){this._data=[];const e=this._provider.priceScale(),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._provider.graphics().backgrounds();if(0===i.size)return;const n=this._model.timeScale().visibleBarsStrictRange();if(null===n)return;const o=n.firstBar(),s=n.lastBar(),a=(0,r.ensureDefined)(this._provider.properties().childs().graphics.childs().backgrounds);i.forEach(((e,i)=>{const n=(0,r.ensureDefined)(a.childs()[i]).childs();if(!n.visible.value())return;let l,d;e.forEach((e=>{const i=null!==e.start?e.start:(0,r.ensureNotNull)(t.points().range().value()).firstIndex,a=e.stop;if(a<o||s<i)return;let h=t.barBorders(i).left;const c=t.barBorders(a).right;d===i-1&&(h=l||h),l=c,d=a,h<0&&c<0||h>t.width()&&c>t.width()||this._data.push({x1:h,x2:c,color:n.color.value(),transparency:n.transparency.value()})}))}))}}},973151:(e,t,i)=>{i.r(t),i.d(t,{DwgBoxPaneView:()=>S,getDwgBoxDrawPattern:()=>C});var r=i(650151),n=i(610555),o=i(762003),s=i(960433),a=i(402443),l=i(70907),d=i(514777),h=i(906453),c=i(731974),u=i(338242),f=i(315167),p=i(291171);function g(e,t){const i=e.style.extendLeft?0:e.leftTop.x,r=e.style.extendRight?t:e.rightBottom.x;return(0,n.box)((0,n.point)(i,e.leftTop.y),(0,n.point)(r,e.rightBottom.y))}class _{constructor(e){this._locs=null,this._textRenderer=new f.TextRenderer,this._locs=e??null}setData(e){this._locs=e}draw(e,t){if(null===this._locs)return;const{horizontalPixelRatio:i,verticalPixelRatio:n,bitmapSize:o}=t;e.lineCap="butt";const s=Math.max(1,Math.floor(i));this._locs.forEach((a=>{
const{backgroundColor:l,borderColor:d,extendLeft:h,extendRight:c,borderWidth:f,dashPattern:g,text:_}=a.style,x=Math.round(f*i),w=h?-x:Math.round(a.leftTop.x*i),v=Math.round(a.leftTop.y*n),m=c?o.width+x:Math.round(a.rightBottom.x*i),y=Math.round(a.rightBottom.y*n);if((0,u.fillRectWithBorder)({context:e,...t},w,v,m,y,s,void 0===l?void 0:{color:l},void 0===d||0===f?void 0:{color:d,borderWidth:x,borderMode:"inner",dashPattern:g}),_){let o=!1;const s=Math.abs(a.rightBottom.x-a.leftTop.x),l=Math.abs(a.rightBottom.y-a.leftTop.y),d=Math.min(a.rightBottom.x,a.leftTop.x),h=Math.min(a.rightBottom.y,a.leftTop.y);"auto"!==_.fontSizeMode&&"auto"!==_.wordWrap||(e.save(),e.beginPath(),e.rect(d*i,h*n,s*i,l*n),e.clip(),o=!0);const c={textSizeMode:_.fontSizeMode,fontSize:_.fontSize},u={horizontalTextAlignment:_.horizontalTextAlignment,verticalTextAlignment:_.verticalTextAlignment,text:_.text,textColor:_.textColor,sizeOptions:c,fontType:a.style.fontType,textFormatting:_.textFormatting},f=(0,p.textBoxData)(d,h,s,l,u);f.wordWrapWidth="auto"===_.wordWrap?Math.max(1,s-(0,r.ensureDefined)(f.fontSize)/6):void 0,this._textRenderer.setData(f),this._textRenderer.draw(e,t),o&&e.restore()}}))}hitTest(e,t){if(null===this._locs)return null;for(const i of this._locs)if((0,h.pointInBox)(e,g(i,t.mediaSize.width)))return new c.HitTestResult(c.HitTarget.Regular);return null}}var x=i(974145),w=i(700571);class v extends w.AbstractMapContainer{constructor(e){super(),this._maxSize=e,this._keysQueue=[]}get(e){const t=this._keysForData(e);if(null===t)return null;const[i,r,n]=t,o=(0,w.getDefault2)(this._map,i,r,new Map);let s=o.get(n);return void 0!==s||(this._size>=this._maxSize?this._deleteFirstKey():++this._size,this._keysQueue.push(t),s=this._createValueItem(e),o.set(n,s)),s}_deleteFirstKey(){const e=(0,r.ensureDefined)(this._keysQueue.shift()),[t,i,n]=e,o=(0,r.ensureDefined)(this._map.get(t)),s=(0,r.ensureDefined)(o.get(i));s.delete(n),0===s.size&&o.delete(i),0===o.size&&this._map.delete(t)}}var m=i(910282);const y={bold:!1,italic:!1,font:m.CHART_FONT_FAMILY};class b extends v{constructor(e,t=y){super(e),this._fontOptions=t,this._measureCanvas=document.createElement("canvas"),this._measureContext=(0,r.ensureNotNull)(this._measureCanvas.getContext("2d"))}_keysForData(e){return[e.lines.join("\n"),e.boxWidth,e.boxHeight]}_createValueItem(e){return(0,p.calculateFontSizeForBox)(this._measureContext,this._fontOptions,e.lines,e.boxWidth,e.boxHeight)}}const T=new Map([[a.DwgBoxStyle.Solid,[]],[a.DwgBoxStyle.Dashed,[5,6]],[a.DwgBoxStyle.Dotted,[1,2]]]);function C(e){const t=T.get(e);if(void 0===t)throw new Error(`Unsupported box style: ${e}`);return t}class S{constructor(e,t,i,r){this._invalidated=!0,this._renderer=new _,this._rgbaFromInteger=(0,o.rgbaFromIntegerCached)(),this._textWidthCache=new s.TextWidthCache,this._cache=new Map,this._graphicsProvider=e,this._model=t,this._forceOverlay=i}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(e){return this._invalidated&&(this._invalidated=!1,this._updateRenderer(e)),this._renderer}
_updateRenderer(e){this._renderer.setData(null);const t=this._graphicsProvider.priceScale(this._forceOverlay),i=this._model.timeScale();if(!t||t.isEmpty()||i.isEmpty())return;const o=this._graphicsProvider.graphics().dwgboxes();if(0===o.size)return;if(null===this._model.timeScale().visibleBarsStrictRange())return;const s=this._graphicsProvider.properties().childs().palettes.childs(),a=this._graphicsProvider.metaInfo().isRGB;if(!a&&(void 0===s||void 0===s.palette_common))return;const d=a?void 0:(0,r.ensureDefined)(s.palette_common).childs().colors.childs(),h=this._graphicsProvider.firstValue(void 0,this._forceOverlay);if(null===h)return;const c={x1:0,y1:0,x2:0,y2:0,extend:l.DwgExtend.None},u=[],f=(0,r.ensureDefined)(this._graphicsProvider.properties().childs().graphics.childs().dwgboxes),{mediaSize:{width:p,height:g}}=e;o.forEach(((e,o)=>{if(!(0,r.ensureDefined)(f.childs()[o]).childs().visible.value())return;const s=e.get(this._forceOverlay);s?.forEach((e=>{if(null===e.backgroundColorIndex&&null===e.borderColorIndex)return;let o,s,f;if(a?(o=null===e.backgroundColorIndex?void 0:this._rgbaFromInteger(e.backgroundColorIndex),s=null===e.borderColorIndex?void 0:this._rgbaFromInteger(e.borderColorIndex),f=null===e.textColorIndex?void 0:this._rgbaFromInteger(e.textColorIndex)):(o=null!==e.backgroundColorIndex?(0,r.ensureDefined)(d)[e.backgroundColorIndex].childs().color.value():void 0,s=null!==e.borderColorIndex?(0,r.ensureDefined)(d)[e.borderColorIndex].childs().color.value():void 0,f=null!==e.textColorIndex?(0,r.ensureDefined)(d)[e.textColorIndex].childs().color.value():void 0),void 0===o&&void 0===s)return;const _=(0,l.convertPointsToScreenDimension)(e.left,e.top,e.right,e.bottom,e.extend,t,i,p,h,c);if(null===_)return;const{x1:x,x2:w,y1:v,y2:m,extend:y}=_,b=Math.min(x,w),T=Math.max(x,w),S=Math.min(v,m),P=Math.max(v,m),D={borderWidth:e.borderWidth,borderColor:s,backgroundColor:o,dashPattern:C(e.borderStyle),extendLeft:(0,l.isExtendInSameDirection)(y,l.DwgExtend.Left),extendRight:(0,l.isExtendInSameDirection)(y,l.DwgExtend.Right),text:this._getTextStyleData(e,f,T-b,P-S),fontType:e.fontType},R={leftTop:new n.Point(Math.min(b,T),S),rightBottom:new n.Point(Math.max(b,T),P),style:D},L=R.rightBottom.x<-R.style.borderWidth&&!R.style.extendRight,M=R.leftTop.x>p+R.style.borderWidth&&!R.style.extendLeft,z=R.rightBottom.y<-R.style.borderWidth,I=R.leftTop.y>g+R.style.borderWidth;L||M||z||I||u.push(R)}))})),this._renderer.setData(u)}_getTextStyleData(e,t,i,n){const o=e.fontSize,s=e.text&&t?{text:e.text,wordWrap:e.wordWrap,textColor:t,horizontalTextAlignment:e.horizontalTextAlignment,verticalTextAlignment:e.verticalTextAlignment,textFormatting:e.textFormatting}:void 0;if(s&&void 0!==o){const t=s;if(o===x.PlotSymbolSize.Auto||0===o){const o={lines:(0,f.wordWrap)((0,r.ensureDefined)(e.text),"",this._textWidthCache,!0,void 0).map((e=>e.text)),boxWidth:i,boxHeight:n};t.fontSizeMode="auto";const s=`${e.fontType??"default"}-${e.textFormatting}`;let a;if(this._cache.has(s))a=(0,r.ensureDefined)(this._cache.get(s));else{
const{bold:t,italic:i}=(0,d.convertDwgTextFormattingToObject)(e.textFormatting),r=e.fontType?m.CHART_MONOSPACE_FONT_FAMILY:y.font;a=new b(5e3,{bold:t,italic:i,font:r}),this._cache.set(s,a)}t.fontSize=(0,r.ensureNotNull)(a.get(o))}else t.fontSizeMode="fixed",t.fontSize=o;return t}}}},183941:(e,t,i)=>{i.r(t),i.d(t,{DwgLabelPaneView:()=>B});var r=i(650151),n=i(762003),o=i(708162),s=i(880664),a=i(985142),l=i(826790),d=i(569429),h=i(945751),c=i(978705),u=i(45233),f=i(610555),p=i(527439);class g extends p.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.center,i=e.center+e.shapeWidth,r=e.y-e.shapeHeight+e.vertOffset,n=e.y+e.vertOffset,o=new f.Point(t,r),s=new f.Point(i,n);return(0,f.box)(o,s)}_drawItemShape(e,t){const{context:i,horizontalPixelRatio:r,verticalPixelRatio:n}=e,o=this._lineWidth(e)%2?.5:0,s=this._getArrowSize(t),a=Math.round(t.center*r)+o,l=Math.round((t.y+t.vertOffset)*n)+o,d=Math.round((t.center+s)*r)+o,h=Math.round((t.y+t.vertOffset-s)*n)+o,c=Math.round((t.y+t.vertOffset-2*s)*n)+o;i.moveTo(d,h),i.lineTo(a,l),i.lineTo(d,c);const u=Math.round((t.y+t.vertOffset-t.shapeHeight-s)*n)+o,f=Math.round((t.center+t.shapeWidth+s)*r)+o;this._drawCorner(e,d,u,p.CornerVectorsClockwise.leftUp),this._drawCorner(e,f,u,p.CornerVectorsClockwise.rightUp),this._drawCorner(e,f,h,p.CornerVectorsClockwise.rightDown),i.lineTo(d,h)}_getArrowSize(e){return e.stepX/Math.sqrt(2)}_getHorizontalTextOffset(e){return e.shapeWidth/2+this._getArrowSize(e)}_getVerticalTextOffset(e){return-e.shapeHeight/2-this._getArrowSize(e)}}class _ extends p.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.center,i=e.center+e.shapeWidth,r=e.y+e.vertOffset,n=e.y+e.shapeHeight+e.vertOffset,o=new f.Point(t,r),s=new f.Point(i,n);return(0,f.box)(o,s)}_drawItemShape(e,t){const{context:i,horizontalPixelRatio:r,verticalPixelRatio:n}=e,o=this._lineWidth(e)%2?.5:0,s=this._getArrowSize(t),a=Math.round(t.center*r)+o,l=Math.round((t.y+t.vertOffset)*n)+o,d=Math.round((t.center+s)*r)+o,h=Math.round((t.y+t.vertOffset+2*s)*n)+o,c=Math.round((t.y+t.vertOffset+s)*n)+o,u=Math.round((t.center+t.shapeWidth+s)*r)+o,f=Math.round((t.y+t.vertOffset+t.shapeHeight+s)*n)+o;i.moveTo(d,h),i.lineTo(a,l),i.lineTo(d,c),this._drawCorner(e,u,c,p.CornerVectorsClockwise.rightUp),this._drawCorner(e,u,f,p.CornerVectorsClockwise.rightDown),this._drawCorner(e,d,f,p.CornerVectorsClockwise.leftDown),i.lineTo(d,h)}_getArrowSize(e){return e.stepX/Math.sqrt(2)}_getHorizontalTextOffset(e){return e.shapeWidth/2+this._getArrowSize(e)}_getVerticalTextOffset(e){return e.shapeHeight/2+this._getArrowSize(e)}}class x extends p.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.center-e.shapeWidth,i=e.center,r=e.y-e.shapeHeight+e.vertOffset,n=e.y+e.vertOffset,o=new f.Point(t,r),s=new f.Point(i,n);return(0,f.box)(o,s)}_drawItemShape(e,t){
const{context:i,horizontalPixelRatio:r,verticalPixelRatio:n}=e,o=this._lineWidth(e)%2?.5:0,s=this._getArrowSize(t),a=Math.round(t.center*r)+o,l=Math.round((t.y+t.vertOffset)*n)+o,d=Math.round((t.center-s)*r)+o,h=Math.round((t.y+t.vertOffset-2*s)*n)+o,c=Math.round((t.y+t.vertOffset-s)*n)+o,u=Math.round((t.center-t.shapeWidth-s)*r)+o,f=Math.round((t.y+t.vertOffset-t.shapeHeight-s)*n)+o;i.moveTo(d,h),i.lineTo(a,l),i.lineTo(d,c),this._drawCorner(e,u,c,p.CornerVectorsClockwise.leftDown),this._drawCorner(e,u,f,p.CornerVectorsClockwise.leftUp),this._drawCorner(e,d,f,p.CornerVectorsClockwise.rightUp),i.lineTo(d,h)}_getArrowSize(e){return e.stepX/Math.sqrt(2)}_getVerticalTextOffset(e){return-e.shapeHeight/2-this._getArrowSize(e)}_getHorizontalTextOffset(e){return-e.shapeWidth/2-this._getArrowSize(e)}}class w extends p.PaneRendererLabelBase{_calcBoundingBox(e){const t=e.center-e.shapeWidth,i=e.center,r=e.y+e.vertOffset,n=e.y+e.shapeHeight+e.vertOffset,o=new f.Point(t,r),s=new f.Point(i,n);return(0,f.box)(o,s)}_drawItemShape(e,t){const{context:i,horizontalPixelRatio:r,verticalPixelRatio:n}=e,o=this._lineWidth(e)%2?.5:0,s=this._getArrowSize(t),a=Math.round(t.center*r)+o,l=Math.round((t.y+t.vertOffset)*n)+o,d=Math.round((t.center-s)*r)+o,h=Math.round((t.y+t.vertOffset+s)*n)+o,c=Math.round((t.y+t.vertOffset+2*s)*n)+o,u=Math.round((t.center-t.shapeWidth-s)*r)+o,f=Math.round((t.y+t.vertOffset+t.shapeHeight+s)*n)+o;i.moveTo(d,h),i.lineTo(a,l),i.lineTo(d,c),this._drawCorner(e,d,f,p.CornerVectorsClockwise.rightDown),this._drawCorner(e,u,f,p.CornerVectorsClockwise.leftDown),this._drawCorner(e,u,h,p.CornerVectorsClockwise.leftUp),i.lineTo(d,h)}_getArrowSize(e){return e.stepX/Math.sqrt(2)}_getHorizontalTextOffset(e){return-e.shapeWidth/2-this._getArrowSize(e)}_getVerticalTextOffset(e){return e.shapeHeight/2+this._getArrowSize(e)}}var v=i(184375),m=i(58850),y=i(560770),b=i(876172);class T extends b.PaneRendererAbstractFillStrokeShape{setItems(e,t){this._setBaseData(e,t);for(const e of this._items)0===e.vertOffset&&(e.textVertOffset=0)}_drawItemText(e,t){const i=this._getTextCache(t);if(null===i)return;const r=t.center,n=t.y+t.textVertOffset,o=t.style?.textColor||this._textColor,s=t.vertOffset,a={style:{fillStyle:o},location:{x:r,y:n,horzAlign:y.HorizontalAlign.Center,vertAlign:s>0?y.VerticalAlign.Top:y.VerticalAlign.Bottom}};i.paintTo(e,a)}_calcBoundingBox(e){const t=e.vertOffset,i=this._getTextCache(e);if(!i)return;const r=i.textImageWidth,n=i.textImageHeight,o=r/2,s=e.y+e.textVertOffset,a=t>0?0:-n,l=t>0?n:0,d=new f.Point(e.center-o,s+a),h=new f.Point(e.center+o,s+l);return(0,f.box)(d,h)}}class C extends u.PaneRendererLabelCenter{_drawItemText(e,t){const i=this._getTextCache(t);if(null===i)return;const n=t.textHorizOffset||0,o=t.center+n,s=t.vertOffset,a=t.y+s+t.textVertOffset,l=t.style?.textColor||this._textColor,d=t.style?.borderColor||this._borderColor,h={style:{fillStyle:(0,r.ensureDefined)(l),strokeStyle:(0,r.ensureDefined)(d),lineWidth:4},location:{x:o,y:a,horzAlign:y.HorizontalAlign.Center,vertAlign:y.VerticalAlign.Middle}}
;i.paintTo(e,h)}_drawItemShape(e,t){}}var S=i(367221),P=i(974145),D=i(771419),R=i(329879),L=i(910282),M=i(79428),z=i(514777);const I={[S.DwgLabelTextAlign.Left]:"left",[S.DwgLabelTextAlign.Center]:"center",[S.DwgLabelTextAlign.Right]:"right"};function A(e,t,i){switch(function(e){if(e.length<2)return 0;let t=Math.abs(e[0].center-e[1].center);for(let i=2;i<Math.min(5,e.length);++i)t=Math.max(t,Math.abs(e[i-1].center-e[i].center));return t<30?2:t<60?1:0}(e)){case 0:return e;case 1:const r=e.length;return e.filter(((e,n)=>(t-i+(r-n))%2==0));case 2:return[]}}class B{constructor(e,t,i,r){this._rendererTypeByStyle=new Map([[S.DwgLabelStyle.Arrowdown,a.PaneRendererArrowDown],[S.DwgLabelStyle.Arrowup,a.PaneRendererArrowUp],[S.DwgLabelStyle.Circle,l.PaneRendererCircleShape],[S.DwgLabelStyle.Cross,d.PaneRendererCrossShape],[S.DwgLabelStyle.Diamond,h.PaneRendererDiamond],[S.DwgLabelStyle.Flag,c.PaneRendererFlagShape],[S.DwgLabelStyle.LabelDown,u.PaneRendererLabelDown],[S.DwgLabelStyle.LabelUp,u.PaneRendererLabelUp],[S.DwgLabelStyle.LabelLeft,u.PaneRendererLabelLeft],[S.DwgLabelStyle.LabelRight,u.PaneRendererLabelRight],[S.DwgLabelStyle.LabelCenter,u.PaneRendererLabelCenter],[S.DwgLabelStyle.LabelLeftUp,_],[S.DwgLabelStyle.LabelLeftDown,g],[S.DwgLabelStyle.LabelRightUp,w],[S.DwgLabelStyle.LabelRightDown,x],[S.DwgLabelStyle.Square,v.PaneRendererSquare],[S.DwgLabelStyle.Triangleup,s.PaneRendererTriangleApexUp],[S.DwgLabelStyle.Triangledown,s.PaneRendererTriangleApexDown],[S.DwgLabelStyle.Xcross,m.PaneRendererXCross],[S.DwgLabelStyle.None,T],[S.DwgLabelStyle.TextOutline,C]]),this._invalidated=!0,this._rgbaFromInteger=(0,n.rgbaFromIntegerCached)(),this._graphicsProvider=e,this._model=t,this._renderer=new o.CompositeRenderer,this._textCache=new D.TextImageCachesContainer(5e3),this._isFundamental=(0,M.isFundamentalStudyMetaInfo)(e.metaInfo()),this._forceOverlay=i}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){return this._invalidated&&(this._invalidated=!1,this._updateViewInternal(this._model.timeScale().barSpacing())),this._renderer}_shiftLabels(){if(!this._isFundamental)return!1;const e=this._graphicsProvider.metaInfo();if(1!==e.plots.length)return!1;const t=this._graphicsProvider.properties().childs().styles.childs()[e.plots[0].id].childs().plottype.value();return t===P.LineStudyPlotStyle.StepLine||t===P.LineStudyPlotStyle.StepLineWithDiamonds}_updateViewInternal(e){this._renderer.clear();const t=this._graphicsProvider.priceScale(this._forceOverlay),i=this._model.timeScale();if(!t||t.isEmpty()||i.isEmpty())return;const n=this._graphicsProvider.graphics().dwglabels(),o=i.visibleBarsStrictRange(),s=this._graphicsProvider.firstValue(void 0,this._forceOverlay);if(0===n.size||null===o||null===s)return;const a=o.firstBar(),l=o.lastBar(),d=Math.round(e*R.DwgLabelPaneViewConstants.AUTO_SIZE_MULT);let h=null;const c=[],u=(0,r.ensureDefined)(this._graphicsProvider.properties().childs().graphics.childs().dwglabels);n.forEach(((e,i)=>{if(!(0,r.ensureDefined)(u.childs()[i]).childs().visible.value())return
;const n=e.get(this._forceOverlay);if(!n)return;const o=n.size;let f=-1;n.forEach((e=>{f+=1;const i=e.x;if(i<a||l<i)return;let n,u;if(this._graphicsProvider.metaInfo().isRGB)n=null===e.colorIndex?void 0:this._rgbaFromInteger(e.colorIndex),u=null===e.textColorIndex?void 0:this._rgbaFromInteger(e.textColorIndex);else{const t=this._graphicsProvider.properties().childs().palettes.childs();if(void 0===t||void 0===t.palette_common)return;const i=t.palette_common.childs(),r=null===e.colorIndex?null:i.colors.childs()[e.colorIndex],o=null===e.textColorIndex?null:i.colors.childs()[e.textColorIndex];if(void 0===r||void 0===o)return;n=null===r?void 0:r.childs().color.value(),u=null===o?void 0:o.childs().color.value()}if(void 0===n&&void 0===u)return;const p=e.size,g=e.style,_=(0,R.calculateLabelHeight)(R.DwgLabelPaneViewConstants.NORMAL_SIZE,p,d),x=this._getInvertedYloc(e.yloc,t.isInverted()),w=void 0===u?"":e.text,v=I[e.textAlign],m=e.tooltip,y="monospace"===e.fontType?L.CHART_MONOSPACE_FONT_FAMILY:L.CHART_FONT_FAMILY,{bold:b,italic:T}=(0,z.convertDwgTextFormattingToObject)(e.textFormatting),C=_*R.DwgLabelPaneViewConstants.FONT_SIZE_MULT,S=Math.round(.16666666666666666*C),P=w.length?(0,r.ensureNotNull)(this._textCache.get({text:w,bold:b,italic:T,font:y,fontSize:C,lineSpacing:S,align:v})).textImageHeight:0,D=this._getLocationData({index:i,price:e.y,yloc:x,size:_,style:g,firstValue:s,hideShape:void 0===n||"n"===g,textHeight:P}),M={center:this._shiftLabels()?D.right:D.center,left:NaN,right:NaN,timePointIndex:NaN,y:D.y0,width:D.shapeWidth,height:D.shapeHeight,vertOffset:D.vertOffset,text:w,fontSize:D.fontSize,font:y,bold:b,italic:T,style:{color:n,borderColor:n,textColor:u},textAlign:v,lineSpacing:S,tooltip:m};let A;D.style!==h?(A={items:[],allItemsIncludingInvisibleSize:o,endVisibleItemIndex:f,style:D.style},c.push(A),h=D.style):A=c[c.length-1],A.items.push(M),A.endVisibleItemIndex=f}))})),c.forEach((t=>{let i=t.items;if(this._isFundamental)switch(t.style){case S.DwgLabelStyle.LabelUp:case S.DwgLabelStyle.LabelDown:case S.DwgLabelStyle.LabelLeft:case S.DwgLabelStyle.LabelRight:case S.DwgLabelStyle.LabelCenter:case S.DwgLabelStyle.LabelLeftUp:case S.DwgLabelStyle.LabelLeftDown:case S.DwgLabelStyle.LabelRightUp:case S.DwgLabelStyle.LabelRightDown:case S.DwgLabelStyle.TextOutline:i=A(i,t.allItemsIncludingInvisibleSize,t.endVisibleItemIndex)}const n=new((0,r.ensureDefined)(this._rendererTypeByStyle.get(t.style)))({items:i,barSpacing:e},{textCache:this._textCache,skipRenderingOptimizations:!0});this._renderer.append(n)}))}_getLocationData(e){const t=R.DwgLabelPaneViewConstants,i=e.size*t.FONT_SIZE_MULT,r=this._model.timeScale(),n=this._graphicsProvider.priceScale(this._forceOverlay);let o=NaN;if(e.yloc===S.DwgLabelYloc.Price||e.yloc===S.DwgLabelYloc.Auto)o=n.priceToCoordinate(e.price,e.firstValue);else{const t=e.yloc===S.DwgLabelYloc.AboveBar?2:3,i=this._graphicsProvider.series().bars().valueAt(e.index);if(null!==i){const r=i[t];null!=r&&(o=n.priceToCoordinate(r,e.firstValue))}}
const s=e.size*t.SHAPE_WIDTH_MULT,a=e.size*t.SHAPE_HEIGHT_MULT,l=e.hideShape?.5*a:(e.style===S.DwgLabelStyle.TextOutline?1.1:1.2)*a,d=l*this._getYLocSign(e.yloc,o,n.height(),l,e.textHeight),h=e.hideShape?S.DwgLabelStyle.None:e.style;return{...r.barBorders(e.index),y0:o,shapeWidth:s,shapeHeight:a,vertOffset:d,fontSize:i,style:h}}_getYLocSign(e,t,i,r,n){switch(e){case S.DwgLabelYloc.Price:return 0;case S.DwgLabelYloc.AboveBar:return-1;case S.DwgLabelYloc.BelowBar:return 1;case S.DwgLabelYloc.Auto:return i<130?t>.5*i?-1:1:-Math.sign(t-i+r+2*n)}}_getInvertedYloc(e,t){if(t){if(e===S.DwgLabelYloc.AboveBar)return S.DwgLabelYloc.BelowBar;if(e===S.DwgLabelYloc.BelowBar)return S.DwgLabelYloc.AboveBar}return e}}},592739:(e,t,i)=>{i.r(t),i.d(t,{DwgLineFillPaneView:()=>f});var r=i(650151),n=i(610555),o=i(762003),s=i(70907),a=i(708162),l=i(642806),d=i(731974);const h={x1:0,y1:0,x2:0,y2:0,extend:s.DwgExtend.None},c={x1:0,y1:0,x2:0,y2:0,extend:s.DwgExtend.None};function u(e,t,i,r){const o=t.subtract(e).normalized();if(Math.abs(o.x)>Math.abs(o.y)){const t=(i-e.x)/o.x;return new n.Point(e.addScaled(o,t).x,e.addScaled(o,t).y)}{const t=(r-e.y)/o.y;return new n.Point(e.addScaled(o,t).x,e.addScaled(o,t).y)}}class f{constructor(e,t,i,r){this._data=[],this._invalidated=!0,this._rgbaFromInteger=(0,o.rgbaFromIntegerCached)(),this._provider=e,this._model=t,this._forceOverlay=i,this._hitTestResult=void 0!==r?new d.HitTestResult(d.HitTarget.Custom,r):new d.HitTestResult(d.HitTarget.Regular)}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new a.CompositeRenderer;for(const t of this._data){const i=new l.PolygonRenderer(this._hitTestResult);i.setData(t),e.append(i)}return e}_updateViewInternal(){this._data=[];const e=this._provider.properties().childs().palettes,t=this._provider.metaInfo().isRGB;if((void 0===e||void 0===e.childs().palette_common)&&!t)return;const i=t?void 0:(0,r.ensureDefined)(e.childs().palette_common).childs(),o=this._provider.priceScale(this._forceOverlay),a=this._model.timeScale();if(!o||o.isEmpty()||a.isEmpty())return;if(null===a.visibleBarsStrictRange())return;const l=this._provider.firstValue(void 0,this._forceOverlay);if(null===l)return;const d=this._provider.graphics().dwglines(),f=this._provider.graphics().dwglinefills();if(0===f.size||0===d.size)return;const p=new Map;d.forEach((e=>{const t=e.get(this._forceOverlay);t?.forEach((e=>{p.set(e.id,e)}))}));const g=(0,r.ensureDefined)(this._provider.properties().childs().graphics.childs().dwglinefills);f.forEach(((e,d)=>{(0,r.ensureDefined)(g.childs()[d]).childs().visible.value()&&e.forEach((e=>{const d=p.get(e.line1),f=p.get(e.line2);if(d&&f){const p=function(e,t,i,r,o){const a=r.width(),l=(0,s.convertPointsToScreenDimension)(e.x1,e.y1,e.x2,e.y2,e.extend,i,r,a,o,h),d=(0,s.convertPointsToScreenDimension)(t.x1,t.y1,t.x2,t.y2,t.extend,i,r,a,o,c);if(null===l||null===d)return null;let f=new n.Point(l.x1,l.y1),p=new n.Point(l.x2,l.y2),g=new n.Point(d.x1,d.y1),_=new n.Point(d.x2,d.y2)
;if((0,n.equalPoints)(f,p)||(0,n.equalPoints)(g,_))return[f,p,_,g];const x=(0,s.isExtendInSameDirection)(l.extend,s.DwgExtend.Left),w=(0,s.isExtendInSameDirection)(l.extend,s.DwgExtend.Right),v=(0,s.isExtendInSameDirection)(d.extend,s.DwgExtend.Left),m=(0,s.isExtendInSameDirection)(d.extend,s.DwgExtend.Right),y=x&&v,b=w&&m,T=i.height(),C=-a,S=2*a,P=-T,D=2*T;let R=C,L=S;f.x>p.x&&(R=S,L=C);let M=P,z=D;f.y>p.y&&(M=D,z=P);let I=C,A=S;g.x>_.x&&(I=S,A=C);let B=P,E=D;return g.y>_.y&&(B=D,E=P),(y||null===e.x1&&x)&&(f=u(p,f,R,M)),(y||null===t.x1&&v)&&(g=u(_,g,I,B)),(b||null===e.x2&&w)&&(p=u(f,p,L,z)),(b||null===t.x2&&m)&&(_=u(g,_,A,E)),[f,p,_,g]}(d,f,o,a,l);if(null!==p){let n;if(t)n=this._rgbaFromInteger(e.colorIndex);else{const t=(0,r.ensureDefined)(i).colors.childs()[e.colorIndex];n=t?t.childs().color.value():"transparent"}this._data.push({points:p,fillBackground:!0,filled:!0,backcolor:n,color:n,linewidth:0,linestyle:0})}}}))}))}}},77148:(e,t,i)=>{i.r(t),i.d(t,{DwgLinePaneView:()=>w});var r=i(650151),n=i(610555),o=i(762003),s=i(70907),a=i(2624),l=i(731974),d=i(320994),h=i(65840),c=i(633545);const u={[c.DwgLineStyle.Solid]:{dashPattern:[],dashPatternSize:0,drawLeftArrow:!1,drawRightArrow:!1},[c.DwgLineStyle.Dashed]:{dashPattern:[5,6],dashPatternSize:11,drawLeftArrow:!1,drawRightArrow:!1},[c.DwgLineStyle.Dotted]:{dashPattern:[1,2],dashPatternSize:3,drawLeftArrow:!1,drawRightArrow:!1},[c.DwgLineStyle.LeftArrow]:{dashPattern:[],dashPatternSize:0,drawLeftArrow:!0,drawRightArrow:!1},[c.DwgLineStyle.RightArrow]:{dashPattern:[],dashPatternSize:0,drawLeftArrow:!1,drawRightArrow:!0},[c.DwgLineStyle.BothArrow]:{dashPattern:[],dashPatternSize:0,drawLeftArrow:!0,drawRightArrow:!0}},f=new Map;function p(e,t){let i=f.get(e);void 0===i&&(i=new Map,f.set(e,i));let r=i.get(t);return void 0===r&&(r=e.map((e=>e*t)),i.set(t,r)),r}function g(e,t,i,r){if(i.subtract(t).length()<1)return;const n=(0,h.getArrowPoints)(t,i,r,!0);for(const t of n){const i=t[0].x,r=t[0].y,n=t[1].x,o=t[1].y;e.moveTo(i,r),e.lineTo(n,o)}}class _ extends d.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e??null}setData(e){this._data=e}hitTest(e){if(null===this._data)return null;const t=(0,h.interactionTolerance)().line,{items:i,itemCount:r}=this._data;let n=0;for(const o of i){if(n===r)break;const i=Math.max(t,o.width/2);if((0,a.distanceToSegment)(o.extP1,o.extP2,e).distance<=i)return new l.HitTestResult(l.HitTarget.Regular);n+=1}return null}_drawImpl(e){if(null===this._data)return;const t=e.context;t.lineCap="butt";const{horizontalPixelRatio:i,verticalPixelRatio:r}=e;for(const[e,o]of this._data.itemsByColor){let s;t.strokeStyle=e;for(const e of o){const o=u[e.style],a=p(o.dashPattern,e.width*i),l=Math.floor(e.width*i);void 0!==s&&s.lineWidth===e.width&&s.pattern===a||(void 0!==s?(t.stroke(),s.lineWidth=e.width,s.pattern=a):s={lineWidth:e.width,pattern:a},t.beginPath(),t.lineWidth=l,t.setLineDash(a));const d=l%2&&Math.abs(e.extP1.y-e.extP2.y)>1e-8?.5:0,h=l%2&&Math.abs(e.extP1.x-e.extP2.x)>1e-8?.5:0,c=(0,
n.point)(Math.round(e.p1.x*i)+d,Math.round(e.p1.y*r)+h),f=(0,n.point)(Math.round(e.p2.x*i)+d,Math.round(e.p2.y*r)+h),_=Math.round(e.extP1.x*i)+d,x=Math.round(e.extP1.y*r)+h,w=Math.round(e.extP2.x*i)+d,v=Math.round(e.extP2.y*r)+h;t.moveTo(_,x),t.lineTo(w,v);const m=e.width*i;o.drawLeftArrow&&g(t,f,c,m),o.drawRightArrow&&g(t,c,f,m)}void 0!==s&&t.stroke()}}}var x=i(568498);class w{constructor(e,t,i,r){this._locationDataCache=[],this._invalidated=!0,this._renderer=new _,this._rgbaFromInteger=(0,o.rgbaFromIntegerCached)(),this._graphicsProvider=e,this._model=t,this._forceOverlay=i}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(e){return this._invalidated&&(this._invalidated=!1,this._updateRenderer(e)),this._renderer}_updateRenderer(e){this._renderer.setData(null);const t=this._graphicsProvider.priceScale(this._forceOverlay),i=this._model.timeScale();if(!t||t.isEmpty()||i.isEmpty())return;const o=this._graphicsProvider.graphics().dwglines();if(0===o.size)return;if(null===this._model.timeScale().visibleBarsStrictRange())return;const a=this._graphicsProvider.firstValue(void 0,this._forceOverlay);if(null===a)return;const l={x1:0,y1:0,x2:0,y2:0,extend:s.DwgExtend.None},d=new Map;let h=0;const c=(0,r.ensureDefined)(this._graphicsProvider.properties().childs().graphics.childs().dwglines),{mediaSize:{width:f,height:p}}=e;for(const[e,g]of o){if(!(0,r.ensureDefined)(c.childs()[e]).childs().visible.value())continue;const o=g.get(this._forceOverlay);if(o)for(const e of o){if(null===e.colorIndex)continue;let r;if(this._graphicsProvider.metaInfo().isRGB)r=this._rgbaFromInteger(e.colorIndex);else{const t=this._graphicsProvider.properties().childs().palettes;if(void 0===t||void 0===t.childs().palette_common)continue;r=t.childs().palette_common.childs().colors.childs()[e.colorIndex].childs().color.value()}if(void 0===r)continue;const o=(0,s.convertPointsToScreenDimension)(e.x1,e.y1,e.x2,e.y2,e.extend,t,i,f,a,l);if(null===o)continue;const{x1:c,x2:g,y1:_,y2:w,extend:v}=o,m=v===s.DwgExtend.Both||v===s.DwgExtend.Left,y=v===s.DwgExtend.Both||v===s.DwgExtend.Right,b=new n.Point(c,_),T=new n.Point(g,w),C=(0,x.intersectLineWithViewport)(b,T,m,y,f,p,u[e.style].dashPatternSize*e.width);if(null===C)continue;let S;this._locationDataCache.length>h?(S=this._locationDataCache[h],S.p1=b,S.p2=T,S.extP1=C[0],S.extP2=C[1],S.width=e.width>0?e.width:1,S.style=e.style):(S={p1:b,p2:T,extP1:C[0],extP2:C[1],width:e.width>0?e.width:1,style:e.style},this._locationDataCache.push(S));let P=d.get(r);void 0===P&&(P=[],d.set(r,P)),P.push(S),h+=1}}this._renderer.setData({items:this._locationDataCache,itemCount:h,itemsByColor:d})}}},380729:(e,t,i)=>{i.r(t),i.d(t,{DwgPolylinePaneView:()=>S});var r=i(650151),n=i(610555),o=i(762003),s=i(26384),a=i(259332),l=i(2624),d=i(820807),h=i(731974),c=i(65840),u=i(384688);const f={[u.DwgPolylineStyle.Solid]:[],[u.DwgPolylineStyle.Dashed]:[5,6],[u.DwgPolylineStyle.Dotted]:[1,2],[u.DwgPolylineStyle.ArrowLeft]:[],[u.DwgPolylineStyle.ArrowRight]:[],[u.DwgPolylineStyle.ArrowBoth]:[]},p=(0,
a.default)(((e,t)=>f[e].map((e=>e*t))),((e,t)=>`${e}_${t}`));function g(e,t){let i=!0;for(const r of t.points)i?(e.moveTo(r.x,r.y),i=!1):e.lineTo(r.x,r.y)}function _(e,t){for(const i of t.bezierCurves){const[t,r,n,o]=i;e.lineTo(t.x,t.y),e.bezierCurveTo(r.x,r.y,n.x,n.y,o.x,o.y)}}function x(e,t,i,r){if(i.subtract(t).length()<1)return;const n=(0,c.getArrowPoints)(t,i,r,!0);for(const t of n)e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y)}class w extends d.MediaCoordinatesPaneRenderer{constructor(e){super(),this._data=e??null}setData(e){this._data=e}hitTest(e){if(null===this._data)return null;const t=(0,c.interactionTolerance)().line;for(const i of this._data.items){const r=Math.max(t,i.width/2);if(i.curved)for(const t of i.bezierCurves){const[i,n,o,a]=t;if((0,s.cubicBezierHitTest)(i,n,o,a,e,r))return new h.HitTestResult(h.HitTarget.Regular)}else for(let t=1;t<i.points.length;t+=1){const n=i.points[t],o=i.points[t-1];if((0,l.distanceToSegment)(o,n,e).distance<=r)return new h.HitTestResult(h.HitTarget.Regular)}}return null}_drawImpl(e){if(null===this._data)return;const t=e.context;t.lineCap="butt";for(const e of this._data.items){t.strokeStyle=e.color;const i=Math.max(1,e.width),r=p(e.style,i);t.lineWidth=i,t.setLineDash(r),t.beginPath(),e.curved?_(t,e):g(t,e),e.closed&&t.closePath(),e.fillColor&&(t.fillStyle=e.fillColor,t.fill()),e.leftArrowPoints&&x(t,e.leftArrowPoints[0],e.leftArrowPoints[1],i),e.rightArrowPoints&&x(t,e.rightArrowPoints[0],e.rightArrowPoints[1],i),t.stroke()}}}function v(e){return e===u.DwgPolylineStyle.ArrowLeft||e===u.DwgPolylineStyle.ArrowBoth}function m(e){return e===u.DwgPolylineStyle.ArrowRight||e===u.DwgPolylineStyle.ArrowBoth}function y(e){return(0,n.point)(e.x,e.y)}function b(e){return{x:e.x,y:e.y}}function T(e){return e.map(y)}function C(e){const t=[],i=e.points,r=e.closed,n=i.length,o=r?n-1:n-2;let a=i[n-1];for(let e=0;e<=o;e+=1){const s=i[e],l=i[(e+1)%n],d=i[(e+2)%n],h=(l.x-a.x)/3,c=(l.y-a.y)/3,u=(d.x-s.x)/3,f=(d.y-s.y)/3,p=[s,{x:s.x+h,y:s.y+c},{x:l.x-u,y:l.y-f},l];r||(0===e?(p[1].x=(s.x+p[2].x)/2,p[1].y=(s.y+p[2].y)/2):e===o&&(p[2].x=(l.x+p[1].x)/2,p[2].y=(l.y+p[1].y)/2)),t.push(p),a=s}const l=e.style;let d,h;if(v(l)){const[e,i,r,n]=T(t[0]);d=[b((0,s.cubicBezierPoint)(e,i,r,n,.1)),b(e)]}if(m(l)){const[e,i,n,o]=T(t[t.length-(r?2:1)]);h=[b((0,s.cubicBezierPoint)(e,i,n,o,.9)),b(o)]}return{bezierCurvePoints:t,leftArrowPoints:d,rightArrowPoints:h}}class S{constructor(e,t,i,r){this._invalidated=!0,this._renderer=new w,this._curvedLinesDataCache=new WeakMap,this._rgbaFromInteger=(0,o.rgbaFromIntegerCached)(),this._graphicsProvider=e,this._model=t,this._forceOverlay=i}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){return this._invalidated&&(this._invalidated=!1,this._updateRenderer()),this._renderer}_updateRenderer(){this._renderer.setData(null);const e=this._graphicsProvider.priceScale(this._forceOverlay),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._graphicsProvider.graphics().dwgpolylines();if(0===i.size)return
;const o=this._model.timeScale().visibleBarsStrictRange();if(null===o)return;const s=this._graphicsProvider.firstValue(void 0,this._forceOverlay);if(null===s)return;const a=i=>(0,n.point)(t.indexToCoordinate(i.x),e.priceToCoordinate(i.y,s)),l=e=>e.map(a),d=(0,r.ensureDefined)(this._graphicsProvider.properties().childs().graphics.childs().dwgpolylines),h=[],c=this._graphicsProvider.metaInfo().isRGB;let f;if(!c){const e=this._graphicsProvider.properties().childs().palettes;if(void 0===e||void 0===e.childs().palette_common)return;f=e.childs().palette_common.childs().colors.childs()}for(const[e,t]of i){if(!(0,r.ensureDefined)(d.childs()[e]).childs().visible.value())continue;const i=t.get(this._forceOverlay);if(i)for(const e of i){if(!(0,u.isDwgPolylineInBarsRange)(e,o))continue;let t,i;if(c?(t=this._rgbaFromInteger(e.color),null!==e.fillColor&&(i=this._rgbaFromInteger(e.fillColor))):(t=(0,r.ensureDefined)(f)[e.color].childs().color.value(),null!==e.fillColor&&(i=(0,r.ensureDefined)(f)[e.fillColor].childs().color.value())),void 0!==t)if(!e.curved||e.points.length<3){const r=e.points.map(a),n=v(e.style)&&r.length>1?[r[1],r[0]]:void 0,o=m(e.style)&&r.length>1?[r[r.length-2],r[r.length-1]]:void 0;h.push({...e,curved:!1,points:r,color:t,fillColor:i,leftArrowPoints:n,rightArrowPoints:o})}else{let r=this._curvedLinesDataCache.get(e);void 0===r&&(r=C(e),this._curvedLinesDataCache.set(e,r));const n=r.bezierCurvePoints.map(l);let o,s;if(r.leftArrowPoints){const e=a(r.leftArrowPoints[0]),t=a(r.leftArrowPoints[1]);o=[t.add(e.subtract(t).normalized().scaled(10)),t]}if(r.rightArrowPoints){const e=a(r.rightArrowPoints[0]),t=a(r.rightArrowPoints[1]);s=[t.add(e.subtract(t).normalized().scaled(10)),t]}h.push({...e,curved:!0,bezierCurves:n,leftArrowPoints:o,rightArrowPoints:s,color:t,fillColor:i})}}}this._renderer.setData({items:h})}}},35404:(e,t,i)=>{i.r(t),i.d(t,{DwgTablePaneView:()=>v});var r=i(650151),n=i(762003),o=i(708162),s=i(610555),a=i(910282),l=i(731974),d=i(315167),h=i(960433),c=i(837462),u=i(291171),f=i(4454),p=i(514777);const g=new d.TextRenderer;function _(e,t,i,r){const{horizontalPixelRatio:n,verticalPixelRatio:o}=r;t.cells.forEach((t=>{if(t.merged)return;const s=i.cells[t.cell.row][t.cell.column],a=i.position.x+s.offsetX,l=i.position.y+s.offsetY,d=function(e,t,i,r,n){return(0,u.textBoxData)(e,t,i,r,{horizontalTextAlignment:n.cell.horizontalTextAlignment,verticalTextAlignment:n.cell.verticalTextAlignment,text:n.cell.text,textColor:n.style.textColor,sizeOptions:{textSizeMode:"fixed",fontSize:n.cell.fontSize},fontType:n.cell.fontType,textFormatting:n.cell.textFormatting})}(a/n,l/o,s.width/n,s.height/o,t);e.save();const h=new Path2D;h.rect(a,l,s.width,s.height),e.clip(h,"evenodd"),g.setData(d),g.draw(e,r),e.restore()}))}class x{constructor(e){this._data=null,this._widthsCaches=new Map,this._precalculated=null,this.setData(e),this._measureCanvas=document.createElement("canvas"),this._measureCtx=(0,r.ensureNotNull)(this._measureCanvas.getContext("2d"))}setData(e){this._data=e,this._precalculated=null}draw(e,t){
if(null===this._data)return;const i=this._precalculateData(t),r=this._data;!function(e,t,i){e.fillStyle=t.style.backgroundColor,e.fillRect(i.position.x,i.position.y,i.totalWidth,i.totalHeight)}(e,r,i),function(e,t,i){t.cells.forEach((t=>{if(t.merged)return;const r=i.cells[t.cell.row][t.cell.column],n=i.position.x+r.offsetX,o=i.position.y+r.offsetY,s=r.width,a=r.height;e.fillStyle=t.style.backgroundColor,e.fillRect(n,o,s,a)}))}(e,r,i),_(e,r,i,t),function(e,t,i,r){if(t.table.borderWidth>0){const n=Math.max(1,Math.round(t.table.borderWidth*r.horizontalPixelRatio)),o=Math.max(1,Math.round(t.table.borderWidth*r.verticalPixelRatio));e.fillStyle=t.style.borderColor;for(let r=0;r<t.table.columns;r++)for(let s=0;s<t.table.rows;s++){const t=i.cells[s][r];null===t.mergedMainCell&&(t.height>0&&t.endRow<i.lastNonEmptyRowEnd&&e.fillRect(i.position.x+t.offsetX,i.position.y+t.offsetY+t.height,t.width+(t.endColumn<i.lastNonEmptyColumnEnd?n:0),o),t.width>0&&t.endColumn<i.lastNonEmptyColumnEnd&&e.fillRect(i.position.x+t.offsetX+t.width,i.position.y+t.offsetY,n,t.height))}}}(e,r,i,t),function(e,t,i,r){if(t.table.frameWidth>0){const n=Math.max(1,Math.round(t.table.frameWidth*r.horizontalPixelRatio)),o=Math.max(1,Math.round(t.table.frameWidth*r.verticalPixelRatio));e.fillStyle=t.style.frameColor,e.fillRect(i.position.x-n,i.position.y-o,i.totalWidth+2*n,o),e.fillRect(i.position.x-n,i.position.y+i.totalHeight,i.totalWidth+2*n,o),e.fillRect(i.position.x-n,i.position.y,n,i.totalHeight),e.fillRect(i.position.x+i.totalWidth,i.position.y,n,i.totalHeight)}}(e,r,i,t)}hitTest(e,t){if(null===this._data)return null;const i=this._precalculateData(t),r=this._data,{horizontalPixelRatio:n,verticalPixelRatio:o}=t,s=e.x*n,a=e.y*o,d=Math.max(1,r.table.frameWidth*n),h=Math.max(1,r.table.frameWidth*o);if(!(s>=i.position.x-d&&s<=i.position.x+i.totalWidth+2*d&&a>=i.position.y-h&&a<=i.position.y+i.totalHeight+2*h))return null;const c=i.cellsWithTooltip.find((e=>{const t=i.position.x+e.offsetX,r=i.position.y+e.offsetY;return s>=t&&s<=t+e.width&&a>=r&&a<=r+e.height})),u=void 0===c?void 0:{tooltip:{...c.tooltip,rect:{x:(i.position.x+c.offsetX)/n,y:(i.position.y+c.offsetY)/o,w:c.width/n,h:c.height/o}}};return new l.HitTestResult(l.HitTarget.Regular,u)}_precalculateData(e){if(null!==this._precalculated)return this._precalculated;const t=(0,r.ensureNotNull)(this._data);let i=-1,n=-1;const o=Array.from({length:t.table.rows},((e,i)=>Array.from({length:t.table.columns},((e,t)=>({mergedMainCell:null,nextColumnCell:null,nextRowCell:null,startColumn:t,endColumn:t,startRow:i,endRow:i,width:0,height:0,offsetX:0,offsetY:0,colSpan:-1,rowSpan:-1,merged:!1,empty:!0}))))),a=[],{horizontalPixelRatio:l,verticalPixelRatio:d}=e;t.cells.forEach((i=>{if(i.merged){return void(o[i.cell.row][i.cell.column].empty=!1)}const r=Math.ceil(this._cellWidth(e,i,t)*l),n=Math.ceil(this._cellHeight(e,i,t)*d),s=i.cell.row,h=i.cell.row+i.cell.rowSpan-1,c=i.cell.column,u=i.cell.column+i.cell.colSpan-1,f=i.cell.colSpan,p=i.cell.rowSpan;let g=null
;for(let e=i.cell.row;e<Math.min(i.cell.row+i.cell.rowSpan,t.table.rows);++e)for(let l=i.cell.column;l<Math.min(i.cell.column+i.cell.colSpan,t.table.columns);++l){const t=o[e][l],d=e!==s||l!==c;d||(g=t,void 0!==i.cell.tooltip&&""!==i.cell.tooltip&&(t.tooltip={content:{type:"text",data:i.cell.tooltip}},a.push(t))),t.mergedMainCell=d?g:null,t.startRow=s,t.endRow=h,t.startColumn=c,t.endColumn=u,t.width=r,t.height=n,t.colSpan=f,t.rowSpan=p,t.empty=!1}}));const h=0===t.table.borderWidth?0:Math.max(1,Math.round(t.table.borderWidth*l)),c=0===t.table.borderWidth?0:Math.max(1,Math.round(t.table.borderWidth*d)),u=Math.max(1,Math.round(20*l)),f=Math.max(1,Math.round(5*d));for(let e=0;e<t.table.columns;++e){let r=[],n=!1,s=!1;for(let a=0;a<t.table.rows;++a){const t=o[a][e];t.empty?s=!0:(n=!0,i=e),null===t.mergedMainCell?(r.forEach((e=>e.nextRowCell=t)),r=[t]):r.push(t)}if(n&&s)for(let i=0;i<t.table.rows;++i){const t=o[i][e];t.empty&&(t.width=u)}}for(let e=0;e<t.table.rows;++e){let i=[],r=!1,s=!1;for(let a=0;a<t.table.columns;++a){const t=o[e][a];t.empty?s=!0:(r=!0,n=e),null===t.mergedMainCell?(i.forEach((e=>e.nextColumnCell=t)),i=[t]):i.push(t)}if(r&&s)for(let i=0;i<t.table.columns;++i){const t=o[e][i];t.empty&&(t.height=f)}}let p=0,g=0,_=0;for(let e=0;e<t.table.columns;++e){const r=[];let n=!1;for(let i=0;i<t.table.rows;++i){const t=o[i][e];if(t.endColumn===e){const e=t.mergedMainCell??t;_=Math.max(_,e.offsetX+e.width),r.push(e),n=n||!e.empty}}for(const e of r)e.width+=_-(e.offsetX+e.width),p=Math.max(p,e.offsetX+e.width);if(r.length>0){const r=n&&i>e?h:0;for(let i=0;i<t.table.rows;++i){const t=o[i][e];null!==t.nextColumnCell&&(t.nextColumnCell.offsetX=Math.max(t.nextColumnCell.offsetX,_+r))}}}let x=0;for(let e=0;e<t.table.rows;++e){const i=[];let r=!1;for(let n=0;n<t.table.columns;++n){const t=o[e][n];if(t.endRow===e){const e=t.mergedMainCell??t;x=Math.max(x,e.offsetY+e.height),i.push(e),r=r||!e.empty}}for(const e of i)e.height+=x-(e.offsetY+e.height),g=Math.max(g,e.offsetY+e.height);if(i.length>0){const i=r&&n>e?c:0;for(let r=0;r<t.table.columns;++r){const t=o[e][r];null!==t.nextRowCell&&(t.nextRowCell.offsetY=Math.max(t.nextRowCell.offsetY,x+i))}}}const w=function(e,t,i,r){const{horizontalPixelRatio:n,verticalPixelRatio:o,bitmapSize:a}=t,l=Math.round(10*o),d=Math.round(10*n);let h=0;e.table.position.startsWith("top_")?h=l:e.table.position.startsWith("middle_")?h=Math.round((a.height-r)/2):e.table.position.startsWith("bottom_")&&(h=a.height-l-r);let c=0;return e.table.position.endsWith("left")?c=d:e.table.position.endsWith("center")?c=Math.round((a.width-i)/2):e.table.position.endsWith("right")&&(c=a.width-i-d),new s.Point(c,h)}(t,e,p,g);return this._precalculated={position:w,totalWidth:p,totalHeight:g,cells:o,cellsWithTooltip:a,lastNonEmptyColumnEnd:i,lastNonEmptyRowEnd:n},this._precalculated}_cellWidth(e,t,i){const n=t.cell.widthInPercentsOfPaneWidth;if(t.merged||""===t.cell.text&&0===n)return 0;if(n){return(e.mediaSize.width-20)*n/100}const o=t.cell.text.split("\n"),{bold:s,italic:l}=(0,
p.convertDwgTextFormattingToObject)(t.cell.textFormatting),d=t.cell.fontType===f.DwgTableCellFontType.Monospace?a.CHART_MONOSPACE_FONT_FAMILY:a.CHART_FONT_FAMILY,g=(0,r.ensureDefined)((0,u.getFontSize)(t.cell.fontSize)),_=`${t.cell.fontType??"default"}-${g}-${t.cell.textFormatting}`;let x;this._widthsCaches.has(_)?x=(0,r.ensureDefined)(this._widthsCaches.get(_)):(x=new h.TextWidthCache,this._widthsCaches.set(_,x)),this._measureCtx.font=(0,c.makeFont)(g,d,l?"italic":void 0,s?"bold":void 0);const w=o.map((e=>x.measureText(this._measureCtx,e)));return Math.max(...w)+2*i.table.borderWidth+2*g/3}_cellHeight(e,t,i){const n=t.cell.heightInPercentOfPaneHeight;if(t.merged||""===t.cell.text&&0===n)return 0;if(n){return(e.mediaSize.height-20)*n/100}const o=t.cell.text.split("\n").length,s=(0,r.ensureDefined)((0,u.getFontSize)(t.cell.fontSize));return s*o+s*(2/3)+2*i.table.borderWidth}}function w(e){e.allCells.forEach((t=>{if(t.cell.rowSpan>1||t.cell.colSpan>1)for(let i=t.cell.row;i<t.cell.row+t.cell.rowSpan;++i)for(let r=t.cell.column;r<t.cell.column+t.cell.colSpan;++r){const n=e.cellsByRowAndColumn.get(i)?.get(r);void 0!==n&&n!==t&&(n.merged=!0)}}))}class v{constructor(e,t,i,r){this._invalidated=!0,this._data=[],this._renderers=[],this._rgbaFromInteger=(0,n.rgbaFromIntegerCached)(),this._source=e,this._forceOverlay=i}renderer(){this._invalidated&&(this._invalidated=!1,this._updateViewInternal());const e=new o.CompositeRenderer;return this._data.forEach(((t,i)=>{this._renderers.length<=i?this._renderers.push(new x(t)):this._renderers[i].setData(t),e.append(this._renderers[i])})),this._renderers.splice(this._data.length),e}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}_updateViewInternal(){this._data=[];const e=this._source.properties().childs().palettes.childs(),t=this._source.metaInfo().isRGB;if((void 0===e||void 0===e.palette_common)&&!t)return;const i=t?void 0:(0,r.ensureDefined)(e.palette_common).childs(),n=this._source.graphics().dwgtables(),o=this._source.graphics().dwgtablecells(),s=new Map;o.forEach(((e,n)=>{e.forEach((e=>{let n,o,a=s.get(e.tableId);if(void 0===a&&(a={allCells:[],cellsByRowAndColumn:new Map},s.set(e.tableId,a)),t)n=this._rgbaFromInteger(e.backgroundColorIndex),o=this._rgbaFromInteger(e.textColorIndex);else{const t=(0,r.ensureDefined)(i).colors.childs()[e.backgroundColorIndex],s=(0,r.ensureDefined)(i).colors.childs()[e.textColorIndex];if(!s)return;n=t?t.childs().color.value():"transparent",o=s.childs().color.value()}const l={cell:e,merged:!1,style:{backgroundColor:n,textColor:o}};a.allCells.push(l);let d=a.cellsByRowAndColumn.get(e.row);void 0===d&&(d=new Map,a.cellsByRowAndColumn.set(e.row,d)),d.set(e.column,l)}))})),s.forEach(w);const a=(0,r.ensureDefined)(this._source.properties().childs().graphics.childs().dwgtables);n.forEach(((e,n)=>{if((0,r.ensureDefined)(a.childs()[n]).childs().visible.value()){const n=e.get(this._forceOverlay);n?.forEach((e=>{let n,o,a;if(t)n=this._rgbaFromInteger(e.backgroundColorIndex),o=this._rgbaFromInteger(e.borderColorIndex),
a=this._rgbaFromInteger(e.frameColorIndex);else{const t=(0,r.ensureDefined)(i).colors.childs()[e.backgroundColorIndex],s=(0,r.ensureDefined)(i).colors.childs()[e.borderColorIndex],l=(0,r.ensureDefined)(i).colors.childs()[e.frameColorIndex];n=t?t.childs().color.value():"transparent",o=s?s.childs().color.value():"transparent",a=l?l.childs().color.value():"transparent"}this._data.push({table:e,style:{backgroundColor:n,borderColor:o,frameColor:a},cells:s.get(e.id)?.allCells??[]})}))}}))}}},514777:(e,t,i)=>{function r(e){return{bold:!(1&~e),italic:!(2&~e)}}i.d(t,{convertDwgTextFormattingToObject:()=>r})},910529:(e,t,i)=>{i.r(t),i.d(t,{HHistPaneView:()=>d});var r=i(724377),n=i(650151),o=i(60266),s=i(708162),a=i(687080),l=i(534328);class d{constructor(e,t,i,r,n=!1,o=()=>null,s=!1){this._invalidated=!0,this._histBoxBgStyle=null,this._provider=e,this._model=t,this._histBoxBgStyle=r??null,this._alternateLeftIndex=o,this._extendToBarsEndings=n,this._alwaysVisible=s,this._rendererData={histograms:[],styles:{}},this._hhistRenderer=new a.HHistRenderer(this._rendererData)}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new s.CompositeRenderer;return e.append(this._hhistRenderer),e}_resetRenderersData(){this._rendererData.histograms=[],this._rendererData.styles={},this._rendererData.histBoxBgColor=void 0}_prepareStyles(){const e=(0,n.ensureDefined)(this._provider.graphicsInfo().hhists),t=Object.keys(e),i=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().hhists),r=this._provider.properties().child("inputs")?.child("volume")?.value()===o.HHistVolumeMode.Delta;for(const o of t){const t=(0,n.ensureDefined)(i.childs()[o]).childs(),s=(0,n.ensureDefined)(e[o]);if(r)this._rendererData.styles[o+"UpDominate"]={colors:h(t.colors[0].value(),t.transparencies[0].value()),visible:t.visible.value(),percentWidth:t.percentWidth.value(),location:s.location,direction:t.direction.value(),showValues:t.showValues.value(),addToTotalValue:!1,valuesColor:t.valuesColor.value()},this._rendererData.styles[o+"DownDominate"]={colors:h(t.colors[1].value(),t.transparencies[1].value()),visible:t.visible.value(),percentWidth:t.percentWidth.value(),location:s.location,direction:t.direction.value(),showValues:t.showValues.value(),addToTotalValue:!1,valuesColor:t.valuesColor.value()};else{const e=(0,l.generateColor)(t.colors[0].value(),t.transparencies[0].value()),i=t.colors[1]?(0,l.generateColor)(t.colors[1].value(),t.transparencies[1].value()):e;this._rendererData.styles[o]={colors:[e,i],visible:t.visible.value(),percentWidth:t.percentWidth.value(),location:s.location,direction:t.direction.value(),showValues:t.showValues.value(),addToTotalValue:!0,valuesColor:t.valuesColor.value()}}}if(this._histBoxBgStyle){const e=this._histBoxBgStyle.childs();this._rendererData.histBoxBgColor=(0,l.generateColor)(e.color.value(),e.transparency.value())}}_updateViewInternal(){this._resetRenderersData();const e=this._provider.priceScale(),t=this._model.timeScale()
;if(!e||e.isEmpty()||t.isEmpty())return;if(null===this._provider.firstValue())return;const i=this._provider.graphics().hhistsByTimePointIndex();if(0===i.size)return;const r=t.visibleBarsStrictRange();if(null===r)return;const o=r.firstBar(),s=r.lastBar();this._prepareStyles(),(0,n.ensureDefined)(i).forEach((i=>{let r=1/0,n=-1/0;for(const e of i){const t=this._hhistFirstBarTime(e);if(null===t)return;r=Math.min(r,t),n=Math.max(n,e.lastBarTime)}!this._alwaysVisible&&(n<o||r>s)||this._updateDataForRenderers(i,e,t)}))}_updateDataForRenderers(e,t,i){if(e.size<=0)return;let r=null;if(e.forEach((e=>{r=r||e})),null===r)return;let s=r;e.forEach((e=>{e.priceLow<s.priceLow&&(s=e)}));const l=this._provider.properties().child("inputs")?.child("volume")?.value()===o.HHistVolumeMode.Delta,d=function(e,t,i,r){const n=t.barBorders(e.firstBarTime??r),o=t.barBorders(e.lastBarTime);return i?(0,a.range)(n.left,o.right):(0,a.range)(n.center,o.center)}(r,i,this._extendToBarsEndings,(0,n.ensureNotNull)(this._hhistFirstBarTime(r))),h=(0,n.ensureNotNull)(this._provider.firstValue()),c=[];e.forEach((e=>{null==e.rate[e.rate.length-1]&&e.rate.splice(-1,1);let i=[],r=[],n=e.styleId;if(l){const[t,o,s]=e.rate[0]>e.rate[1]?[e.rate[1],e.rate[0],"UpDominate"]:[e.rate[0],e.rate[1],"DownDominate"];i=[o-t,t,t],r=[o-t],n+=s}else i=e.rate,r=e.rate;const o=function(e,t,i){return(0,a.range)(t.priceToCoordinate(e.priceHigh,i),t.priceToCoordinate(e.priceLow,i))}(e,t,h);c.push({height:o.max-o.min,y:o.min,subBarValues:i,displayedValues:r,styleId:n})})),c.sort(((e,t)=>e.y-t.y)),this._rendererData.histograms.push({xRange:d,yRange:(0,a.range)(c[0].y,c[c.length-1].y+c[c.length-1].height),bars:c})}_hhistFirstBarTime(e){return e.firstBarTime??this._alternateLeftIndex()}}function h(e,t){let i;if((0,l.isHexColor)(e))i=100-t;else{const n=(0,r.tryParseRgba)(e);i=100-(null!==n?(0,l.alphaToTransparency)(n[3]):t)}return[(0,l.generateColor)(e,100-i,!0),(0,l.generateColor)(e,100-i/2,!0),(0,l.generateColor)(e,100-i/4,!0)]}},614478:(e,t,i)=>{i.r(t),i.d(t,{HorizLinePaneView:()=>a});var r=i(650151),n=i(731974),o=i(708162),s=i(654397);class a{constructor(e,t,i,r=!1,o=()=>null){this._data=[],this._invalidated=!0,this._provider=e,this._model=t,this._extendToBarsEndings=r,this._alternateStartIndex=o,this._hitTestResult=void 0!==i?new n.HitTestResult(n.HitTarget.Custom,i):new n.HitTestResult(n.HitTarget.Regular)}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new o.CompositeRenderer;for(const t of this._data){const i=new s.HorizontalLineRenderer;i.setData(t),i.setHitTest(this._hitTestResult),e.append(i)}return e}_updateViewInternal(){this._data=[];const e=this._provider.priceScale(),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._provider.graphics().horizlines();if(0===i.size)return;const n=this._model.timeScale().visibleBarsStrictRange();if(null===n)return;const o=this._provider.firstValue();if(null===o)return;const s=n.firstBar(),a=n.lastBar(),l=(0,
r.ensureDefined)(this._provider.properties().childs().graphics.childs().horizlines);i.forEach(((i,n)=>{const d=(0,r.ensureDefined)(l.childs()[n]).childs();d.visible.value()&&i.forEach((i=>{const n=i.startIndex??this._alternateStartIndex(),l=i.endIndex;if(null===n)return;if(!i.extendRight&&Math.max(n,l)<s||!i.extendLeft&&Math.min(n,l)>a)return;let h,c;if(!i.extendLeft){const e=t.barBorders(n);h=this._extendToBarsEndings?e.left:e.center}if(!i.extendRight){const e=t.barBorders(l);c=this._extendToBarsEndings?e.right:e.center}this._data.push({y:e.priceToCoordinate((0,r.ensureDefined)(i.level),o),left:h,right:c,color:d.color.value(),linewidth:d.width.value(),linestyle:d.style.value()})}))}))}}},350355:(e,t,i)=>{i.r(t),i.d(t,{LevelPaneView:()=>c});var r=i(650151),n=i(610555),o=i(560770),s=i(529777),a=i(708162),l=i(654397),d=i(315167),h=i(910282);class c{constructor(e,t){this._lineRenderers=[],this._textRenderers=[],this._renderer=new a.CompositeRenderer,this._invalidated=!0,this._provider=e,this._model=t}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){return this._invalidated&&(this._updateViewInternal(),this._invalidated=!1),this._renderer}_updateViewInternal(){this._renderer.clear();const e=this._provider.priceScale(),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._provider.graphics().hlines();if(0===i.size)return;const a=this._provider.firstValue();if(null===a)return;const c=this._provider.properties().childs().graphics,u=(0,r.ensureDefined)(c.childs().hlines),f=(0,r.ensureDefined)(this._provider.graphicsInfo().hlines);let p=0,g=0;for(i.forEach(((i,c)=>{const _=(0,r.ensureDefined)(u.childs()[c]).childs(),x=(0,r.ensureDefined)(f[c]).enableText&&(0,r.ensureDefined)(_.showText).value(),w=_.visible.value();(x||w)&&i.forEach((i=>{const c=e.priceToCoordinate((0,r.ensureDefined)(i.level),a);if(x){const e=(0,r.ensureDefined)(_.textPos).value(),[a,l]=function(e,t){if(e===s.TextPos.TopLeft||e===s.TextPos.MiddleLeft||e===s.TextPos.BottomLeft)return[o.HorizontalAlign.Left,4];if(e===s.TextPos.TopCenter||e===s.TextPos.MiddleCenter||e===s.TextPos.BottomCenter)return[o.HorizontalAlign.Center,t/2];if(e===s.TextPos.TopRight||e===s.TextPos.MiddleRight||e===s.TextPos.BottomRight)return[o.HorizontalAlign.Right,t];throw new Error("Unsupported TextPos value")}(e,t.width()),[u,f]=function(e,t){if(e===s.TextPos.TopLeft||e===s.TextPos.TopCenter||e===s.TextPos.TopRight)return[o.VerticalAlign.Bottom,t-4];if(e===s.TextPos.MiddleLeft||e===s.TextPos.MiddleCenter||e===s.TextPos.MiddleRight)return[o.VerticalAlign.Middle,t-2];if(e===s.TextPos.BottomLeft||e===s.TextPos.BottomCenter||e===s.TextPos.BottomRight)return[o.VerticalAlign.Top,t];throw new Error("Unsupported TextPos value")}(e,c),g={points:[new n.Point(l,f)],offsetX:0,offsetY:0,text:i.text||"",color:_.color.value(),font:h.CHART_FONT_FAMILY,fontsize:(0,r.ensureDefined)(_.fontSize).value(),horzAlign:a,vertAlign:u};let x;void 0===this._textRenderers[p]?(x=new d.TextRenderer,this._textRenderers[p]=x):x=this._textRenderers[p],x.setData(g),p++}if(w){
const e={visible:!0,y:c,color:_.color.value(),linewidth:_.width.value(),linestyle:_.style.value()};let t;void 0===this._lineRenderers[g]?(t=new l.HorizontalLineRenderer,this._lineRenderers[g]=t):t=this._lineRenderers[g],t.setData(e),g++}}))}));this._textRenderers.length>p;)this._textRenderers.pop();for(;this._lineRenderers.length>g;)this._lineRenderers.pop();for(const e of this._lineRenderers)this._renderer.append(e);for(const e of this._textRenderers)this._renderer.append(e)}}},822305:(e,t,i)=>{i.r(t),i.d(t,{LinePaneView:()=>d});var r=i(650151),n=i(610555),o=i(731974),s=i(708162),a=i(346272),l=i(692789);class d{constructor(e,t,i){this._data=[],this._invalidated=!0,this._provider=e,this._model=t,this._hitTestResult=void 0!==i?new o.HitTestResult(o.HitTarget.Custom,i):new o.HitTestResult(o.HitTarget.Regular)}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new s.CompositeRenderer;for(const t of this._data){const i=new l.TrendLineRenderer;i.setData(t),i.setHitTest(this._hitTestResult),e.append(i)}return e}_updateViewInternal(){this._data=[];const e=this._provider.priceScale(),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._provider.graphics().lines();if(0===i.size)return;const o=this._model.timeScale().visibleBarsStrictRange();if(null===o)return;const s=this._provider.firstValue();if(null===s)return;const l=o.firstBar(),d=o.lastBar(),h=(0,r.ensureDefined)(this._provider.properties().childs().graphics.childs().lines);i.forEach(((i,o)=>{const c=(0,r.ensureDefined)(h.childs()[o]).childs();c.visible.value()&&i.forEach((i=>{const o=i.startIndex+(i.startOffset||0),h=i.endIndex+(i.endOffset||0);if(Math.max(o,h)<l||Math.min(o,h)>d)return;const u=t.indexToCoordinate(o),f=t.indexToCoordinate(h),p=e.priceToCoordinate((0,r.ensureDefined)(i.startPrice),s),g=e.priceToCoordinate((0,r.ensureDefined)(i.endPrice),s),_=new n.Point(u,p),x=new n.Point(f,g);this._data.push({points:[_,x],extendleft:!1,extendright:!1,leftend:a.LineEnd.Normal,rightend:a.LineEnd.Normal,color:c.color.value(),linewidth:c.width.value(),linestyle:c.style.value()})}))}))}}},588892:(e,t,i)=>{i.r(t),i.d(t,{PolygonPaneView:()=>d});var r=i(650151),n=i(610555),o=i(731974),s=i(708162),a=i(257145),l=i(642806);class d{constructor(e,t,i){this._data=[],this._invalidated=!0,this._provider=e,this._model=t,this._hitTestResult=void 0!==i?new o.HitTestResult(o.HitTarget.Custom,i):new o.HitTestResult(o.HitTarget.Regular)}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new s.CompositeRenderer;for(const t of this._data){const i=new l.PolygonRenderer(this._hitTestResult);i.setData(t),e.append(i)}return e}_updateViewInternal(){this._data=[];const e=this._provider.priceScale(),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._provider.graphics().polygons();if(0===i.size)return;const o=this._model.timeScale().visibleBarsStrictRange()
;if(null===o)return;const s=this._provider.firstValue();if(null===s)return;const l=o.firstBar(),d=o.lastBar(),h=(0,r.ensureDefined)(this._provider.properties().childs().graphics.childs().polygons),c=(0,r.ensureDefined)(this._provider.graphicsInfo().polygons);i.forEach(((i,o)=>{const u=(0,r.ensureDefined)(h.childs()[o]).childs(),f=(0,r.ensureDefined)(c[o]);100!==u.transparency.value()&&i.forEach((i=>{let o=1/0,h=-1/0;for(const e of i.points){const t=e.index+(e.offset||0);o=Math.min(o,t),h=Math.max(h,t)}if(h<l||d<o)return;const c=i.points.map((i=>{const o=t.indexToCoordinate(i.index+(i.offset||0)),a=e.priceToCoordinate((0,r.ensureDefined)(i.level),s);return new n.Point(o,a)}));this._data.push({points:c,color:u.color.value(),backcolor:u.color.value(),linewidth:f.showBorder?1:0,linestyle:a.LINESTYLE_SOLID,filled:!0,fillBackground:!0,transparency:u.transparency.value(),disableInteractions:!f.mouseTouchable})}))}))}}},38533:(e,t,i)=>{i.r(t),i.d(t,{ShapeMarkPaneView:()=>_});var r=i(650151),n=i(610555),o=i(770885),s=i(708162),a=i(906453),l=i(731974),d=i(688857);class h{constructor(e){this._data=e}draw(e,t){const i="down"===this._data.direction?1:"up"===this._data.direction?-1:0,r=this._data.point.x,n=this._data.point.y;(0,d.drawScaled)(e,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{e.fillStyle=this._data.color,e.beginPath(),e.arc(r+1,n+2*this._data.size*i,this._data.size,0,2*Math.PI),e.closePath(),e.fill(),e.stroke()}))}hitTest(e){const t="down"===this._data.direction?1:"up"===this._data.direction?-1:0,i=new n.Point(this._data.point.x+.5,this._data.point.y+.5+2*this._data.size*t);return(0,a.pointInCircle)(e,i,this._data.size)?new l.HitTestResult(l.HitTarget.Regular):null}}class c{constructor(e){this._data=e}draw(e,t){const i="down"===this._data.direction?1:"up"===this._data.direction?-1:0,r=this._data.size,o=new n.Point(this._data.point.x-r/2,this._data.point.y-r/2+i*r),s=new n.Point(this._data.point.x+r/2,this._data.point.y+r/2+i*r).subtract(o),{horizontalPixelRatio:a,verticalPixelRatio:l}=t,d=Math.max(1,Math.floor(a)),h=d/2,c=d%2?.5:0,u=Math.round(o.x*a)+c,f=Math.round((o.x+s.x)*a)+c,p=Math.round(o.y*l)+c,g=Math.round((o.y+s.y)*l)+c;e.beginPath(),e.fillStyle=this._data.color,e.rect(u+h,p+h,f-u-d,g-p-d),e.fill(),e.lineWidth=d,e.beginPath(),e.rect(u,p,f-u,g-p),e.stroke()}hitTest(e){const t="down"===this._data.direction?1:"up"===this._data.direction?-1:0,i=this._data.size,r=new n.Point(this._data.point.x-i/2,this._data.point.y-i/2+t*i),o=new n.Point(this._data.point.x+i/2,this._data.point.y+i/2+t*i);return(0,a.pointInBox)(e,(0,n.box)(r,o))?new l.HitTestResult(l.HitTarget.Regular):null}}class u{constructor(e,t){this._data=e,this._arrowDirection=t}draw(e,t){const i=this._arrowDirection,r=this._data.size,n=this._data.color,o=this._data.point.x+1;let s=this._data.point.y;const a=1.1*r;switch(i){case"up":s-=a;break;case"down":s+=a}const l=r/6,h=r/4,c=r/3,u=r/2,f=.6666666*r;(0,d.drawScaled)(e,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{switch(e.fillStyle=n,e.beginPath(),i){case"up":e.moveTo(o,s),e.lineTo(o-u,s+f),
e.lineTo(o-h,s+f),e.lineTo(o,s+c),e.lineTo(o+h,s+f),e.lineTo(o+u,s+f),e.lineTo(o,s);break;case"down":e.moveTo(o,s+r),e.lineTo(o-u,s+c),e.lineTo(o-h,s+c),e.lineTo(o,s+f),e.lineTo(o+h,s+c),e.lineTo(o+u,s+c),e.lineTo(o,s+r);break;case"right":e.moveTo(o+l,s),e.lineTo(o-l,s-h),e.lineTo(o-l,s+h),e.lineTo(o+l,s);break;case"left":e.moveTo(o-l,s),e.lineTo(o+l,s-h),e.lineTo(o+l,s+h),e.lineTo(o-l,s)}e.closePath(),e.fill(),e.stroke()}))}hitTest(e){const[t,i,r]=this._hitTriangle();return(0,a.pointInTriangle)(e,t,i,r)?new l.HitTestResult(l.HitTarget.Regular):null}_hitTriangle(){const e=this._data.point.x;let t=this._data.point.y;const i=this._arrowDirection,r=this._data.size,o=1.1*r;switch(i){case"up":t-=o;break;case"down":t+=o}const s=r/6,a=r/4,l=r/3,d=r/2,h=.6666666*r;switch(i){case"up":return[new n.Point(e,t),new n.Point(e+d,t+h),new n.Point(e-d,t+h)];case"down":return[new n.Point(e,t+r),new n.Point(e+d,t+l),new n.Point(e-d,t+l)];case"right":return[new n.Point(e+s,t),new n.Point(e-s,t-a),new n.Point(e-s,t+a)];case"left":return[new n.Point(e-s,t),new n.Point(e+s,t-a),new n.Point(e+s,t+a)]}}}var f=i(730487),p=i(534328);const g=(0,i(735566).getLogger)("Chart.ShapeMarkPaneView");class _ extends f.LocationToYMixin{constructor(e,t,i){super(),this._data=[],this._invalidated=!0,this._provider=e,this._model=t,this._data=[]}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new s.CompositeRenderer;for(const t of this._data)switch(t.shape){case"circle":e.append(new h(t));break;case"square":e.append(new c(t));break;case"arrowUp":e.append(new u(t,"up"));break;case"arrowDown":e.append(new u(t,"down"));break;case"arrowRight":e.append(new u(t,"right"));break;case"arrowLeft":e.append(new u(t,"left"))}return e}_updateViewInternal(){this._data=[];const e=this._provider.priceScale(),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._provider.graphics().shapemarks();if(0===i.size)return;const s=this._model.timeScale().visibleBarsStrictRange();if(null===s)return;const a=this._provider.firstValue();if(null===a)return;const l=s.firstBar(),d=s.lastBar(),h=(0,r.ensureDefined)(this._provider.properties().childs().graphics.childs().shapemarks),c=(0,r.ensureDefined)(this._provider.graphicsInfo().shapemarks);i.forEach(((i,s)=>{const u=(0,r.ensureDefined)(h.childs()[s]).childs(),f=(0,r.ensureDefined)(c[s]);u.visible.value()&&i.forEach((i=>{const r=i.time;if(r<l||d<r)return;if(null===this._provider.series().bars().valueAt(r))return;const s=f.location,h=f.shape,c=u.size.value(),g=(0,p.generateColor)(u.color.value(),u.transparency.value()),{center:_,left:x,right:w,y:v,direction:m}=this._calcCoordsForShape(s,r,c,i.price,a,e,t);let y;switch(f.halign){case o.HAlign.Left:y=x;break;case o.HAlign.Right:y=w;break;case o.HAlign.Center:y=_}switch(h){case"circle":case"square":this._data.push({shape:h,color:g,direction:m,point:new n.Point(y,v),size:c});break;case"arrowUp":case"arrowDown":case"arrowRight":case"arrowLeft":this._data.push({shape:h,
color:g,point:new n.Point(y,v),size:c})}}))}))}_calcCoordsForShape(e,t,i,n,s,a,l){const d=l.barBorders(t);switch(e){case o.MarkLocation.Absolute:return{...d,y:a.priceToCoordinate((0,r.ensureDefined)(n),s),direction:""};case o.MarkLocation.AbsoluteDown:return{...d,y:a.priceToCoordinate((0,r.ensureDefined)(n),s),direction:"down"};case o.MarkLocation.AbsoluteUp:return{...d,y:a.priceToCoordinate((0,r.ensureDefined)(n),s),direction:"up"};case o.MarkLocation.AboveBar:return{...d,y:this._locationToY(e,t,Math.floor(2*i/l.barSpacing())+1),direction:"up"};case o.MarkLocation.BelowBar:return{...d,y:this._locationToY(e,t,Math.floor(2*i/l.barSpacing())+1),direction:"down"};default:return g.logWarn("Bad location value: "+e),{...d,y:NaN,direction:"up"}}}}},461449:(e,t,i)=>{i.r(t),i.d(t,{TextMarkPaneView:()=>x});var r=i(650151),n=i(610555),o=i(770885),s=i(449895),a=i(708162),l=i(906453),d=i(731974),h=i(688857),c=i(969680);class u{constructor(e,t){this._data=e,this._textCache=t}draw(e,t){if(!this._data)return;const i=f(this._data.direction);let r=this._data.point.x;"left"===this._data.halign?r-=this._data.size:"right"===this._data.halign&&(r+=this._data.size);const n=this._data.point.y;e.font=this._fontStyle();const o=e.measureText(this._data.text).width;this._textCache.textWidth=o;const s=this._data.fontSize;e.textAlign=(0,c.isRtl)()?"right":"left";const a=(0,h.calcTextHorizontalShift)(e,o),l=.65*s,d=1*s;(0,h.drawScaled)(e,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{e.translate(r,n),e.beginPath(),e.moveTo(0,0),e.lineTo(l,d*i),e.lineTo(.5*o+l,d*i),e.lineTo(.5*o+l,(d+1.75*s)*i),e.lineTo(.5*-o-l,(d+1.75*s)*i),e.lineTo(.5*-o-l,d*i),e.lineTo(-l,d*i),e.lineTo(0,0),e.strokeStyle=this._data.borderColor,e.stroke(),e.fillStyle=this._data.color,e.fill(),e.fillStyle=this._data.fontColor,e.fillText(this._data.text,.5*-o+a,i<0?i*d-.5*s:d+1.25*s)}))}hitTest(e){const t=this._textCache.textWidth||0,i=this._data.fontSize,r=f(this._data.direction),o=.65*i,s=1*i;let a=this._data.point.x;"left"===this._data.halign?a-=this._data.size:"right"===this._data.halign&&(a+=this._data.size);const h=this._data.point.y,c=a-.5*t-o,u=a+.5*t+o;let p=h+s*r,g=h+(s+1.75*i)*r;if(g<p){const e=p;p=g,g=e}if((0,l.pointInBox)(e,(0,n.box)(new n.Point(c,p),new n.Point(u,g))))return new d.HitTestResult(d.HitTarget.Regular);const _=[new n.Point(this._data.point.x,this._data.point.y),new n.Point(this._data.point.x+.65*i,this._data.point.y+i*r),new n.Point(this._data.point.x-.65*i,this._data.point.y+i*r)],x=(e.x-_[0].x)*(_[1].y-_[0].y)-(e.y-_[0].y)*(_[1].x-_[0].x);return((e.x-_[1].x)*(_[2].y-_[1].y)-(e.y-_[1].y)*(_[2].x-_[1].x))*x>0&&((e.x-_[2].x)*(_[0].y-_[2].y)-(e.y-_[2].y)*(_[0].x-_[2].x))*x>0?new d.HitTestResult(d.HitTarget.Regular):null}_fontStyle(){return(this._data.bold?"bold ":"")+(this._data.italic?"italic ":"")+`${this._data.fontSize}px ${this._data.font}`}}function f(e){if("up"===e)return 1;if("down"===e)return-1;throw new Error(`${e} is not supported by TriangleTextMarkRenderer`)}class p{constructor(e,t){this._data=e,this._textCache=t}draw(e,t){
const i=this._data.point.x,r=this._data.point.y;e.font=this._fontStyle();const n=e.measureText(this._data.text).width;this._textCache.textWidth=n,(0,h.drawScaled)(e,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{switch(e.translate(i,r),e.beginPath(),e.moveTo(0,0),e.textAlign=this._data.halign,this._data.valign){case"middle":e.textBaseline="middle";break;case"top":e.textBaseline="bottom";break;case"bottom":e.textBaseline="hanging"}e.fillStyle=this._data.fontColor,e.fillText(this._data.text,0,0)}))}hitTest(e){let t=this._data.point.x,i=this._data.point.y;const r=this._textCache.textWidth||0,o=this._data.fontSize;switch(this._data.halign){case"right":t-=r;break;case"center":t-=r/2}switch(this._data.valign){case"middle":i-=o/2;break;case"bottom":i-=o}const s=new n.Point(t,i),a=new n.Point(t+r,i+o);return(0,l.pointInBox)(e,(0,n.box)(s,a))?new d.HitTestResult(d.HitTarget.Regular):null}_fontStyle(){return(this._data.bold?"bold ":"")+(this._data.italic?"italic ":"")+`${this._data.fontSize}px ${this._data.font}`}}var g=i(730487),_=i(534328);class x extends g.LocationToYMixin{constructor(e,t,i){super(),this._data=[],this._textCache=[],this._invalidated=!0,this._provider=e,this._model=t}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new a.CompositeRenderer;for(let t=0;t<this._data.length;t++){const i=this._data[t],r=this._textCache[t];switch(i.shape){case"triangle":e.append(new u(i,r));break;case"rectangle":e.append(new p(i,r))}}return e}_updateViewInternal(){this._data=[];const e=this._provider.priceScale(),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._provider.graphics().textmarks();if(0===i.size)return;const o=this._model.timeScale().visibleBarsStrictRange();if(null===o)return;const a=this._provider.firstValue();if(null===a)return;const l=o.firstBar(),d=o.lastBar(),h=(0,r.ensureDefined)(this._provider.properties().childs().graphics.childs().textmarks),c=(0,r.ensureDefined)(this._provider.graphicsInfo().textmarks);i.forEach(((i,o)=>{const u=(0,r.ensureDefined)(h.childs()[o]).childs(),f=(0,r.ensureDefined)(c[o]);u.visible.value()&&i.forEach((i=>{let r=i.time;if(r<l||d<r)return;if(null===this._provider.series().bars().valueAt(r))return;r=i.time+(i.offset||0);const o={text:i.text?i.text:"",bold:u.fontBold.value(),italic:u.fontItalic.value(),font:u.fontFamily.value(),fontColor:(0,_.generateColor)(u.fontColor.value(),u.transparency.value()),fontSize:u.fontSize.value()},h=f.location,c=f.shape;switch(c){case s.TextMarkType.Triangle:{const{x:s,y:l,direction:d}=this._calcCoordsForTriangleShape(h,r,50,i.price,a,e,t);this._data.push({shape:c,color:(0,_.generateColor)(u.color.value(),u.transparency.value()),borderColor:"rgb(0, 0, 0)",direction:d,point:new n.Point(s,l),halign:f.halign,size:.5*t.barSpacing(),...o})}break;case s.TextMarkType.Rectangle:{const{x:s,y:l}=this._calcCoordsForRectangleShape(h,r,i.price,a,e,t);this._data.push({shape:c,point:new n.Point(s,l),halign:f.halign,valign:f.valign??"middle",
...o})}}this._textCache.push({})}))}))}_calcCoordsForTriangleShape(e,t,i,n,s,a,l){const d=Math.round(l.indexToCoordinate(t));switch(e){case o.MarkLocation.Top:return{x:d,y:a.height()-i,direction:"down"};case o.MarkLocation.Bottom:return{x:d,y:i,direction:"up"};case o.MarkLocation.AbsoluteDown:return{x:d,y:a.priceToCoordinate((0,r.ensureDefined)(n),s),direction:"down"};case o.MarkLocation.AbsoluteUp:return{x:d,y:a.priceToCoordinate((0,r.ensureDefined)(n),s),direction:"up"};case o.MarkLocation.AboveBar:return{x:d,y:this._locationToY(e,t),direction:"down"};case o.MarkLocation.BelowBar:return{x:d,y:this._locationToY(e,t),direction:"up"};default:return{x:d,y:NaN,direction:"up"}}}_calcCoordsForRectangleShape(e,t,i,n,s,a){const l=Math.round(a.indexToCoordinate(t));switch(e){case o.MarkLocation.AbsoluteDown:case o.MarkLocation.AbsoluteUp:case o.MarkLocation.Absolute:return{x:l,y:s.priceToCoordinate((0,r.ensureDefined)(i),n)};case o.MarkLocation.AboveBar:case o.MarkLocation.BelowBar:return{x:l,y:this._locationToY(e,t)};case o.MarkLocation.Right:case o.MarkLocation.Left:return{x:a.width(),y:s.priceToCoordinate((0,r.ensureDefined)(i),n)};default:return{x:l,y:NaN}}}}},291171:(e,t,i)=>{i.d(t,{calculateFontSizeForBox:()=>p,getFontSize:()=>f,textBoxData:()=>u});var r=i(569708),n=i(610555),o=i(560770),s=i(910282),a=i(974145),l=i(660439),d=i(837462),h=i(514777);const c=new Map;function u(e,t,i,r,a){let l=e,d=o.HorizontalAlign.Left;"center"===a.horizontalTextAlignment?(d=o.HorizontalAlign.Center,l+=i/2):"right"===a.horizontalTextAlignment&&(d=o.HorizontalAlign.Right,l+=i-1);let c=t,u=o.VerticalAlign.Top;"center"===a.verticalTextAlignment?(u=o.VerticalAlign.Middle,c+=r/2):"bottom"===a.verticalTextAlignment&&(u=o.VerticalAlign.Bottom,c+=r-1);const{bold:p,italic:g}=(0,h.convertDwgTextFormattingToObject)(a.textFormatting);return{points:[new n.Point(l,c)],text:a.text,color:a.textColor,bold:p,italic:g,vertAlign:u,horzAlign:d,font:"monospace"===a.fontType?s.CHART_MONOSPACE_FONT_FAMILY:s.CHART_FONT_FAMILY,fontSize:f(a.sizeOptions.fontSize),offsetX:0,offsetY:0}}function f(e){return(0,r.default)(e)?e>0?e:c.get(a.PlotSymbolSize.Auto):c.get(e)}function p(e,t,i,r,n){const o=function(e,t){return Math.floor(.9*t/(e+.33))}(i.length,n);return(0,l.lowerboundExt)((e=>e),void 0,(n=>function(e,t,i,r){e.font=(0,d.makeFont)(r,t.font,t.italic?"italic ":void 0,t.bold?"bold ":void 0);const n=r/3;return i.reduce(((t,i)=>Math.max(t,e.measureText(i).width+n)),0)}(e,t,i,n)<=r),2,o)-1}c.set(a.PlotSymbolSize.Auto,14),c.set(a.PlotSymbolSize.Tiny,8),c.set(a.PlotSymbolSize.Small,10),c.set(a.PlotSymbolSize.Normal,14),c.set(a.PlotSymbolSize.Large,20),c.set(a.PlotSymbolSize.Huge,36)},667059:(e,t,i)=>{i.r(t),i.d(t,{TrendChannelPaneView:()=>h});var r=i(650151),n=i(610555),o=i(648892),s=i(731974),a=i(708162),l=i(257145),d=i(642806);class h{constructor(e,t,i){this._data=[],this._invalidated=!0,this._provider=e,this._model=t,this._data=[],this._hitTestResult=void 0!==i?new s.HitTestResult(s.HitTarget.Custom,i):new s.HitTestResult(s.HitTarget.Regular)}update(e){
"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new a.CompositeRenderer;for(const t of this._data){const i=new d.PolygonRenderer(this._hitTestResult);i.setData(t),e.append(i)}return e}_updateViewInternal(){this._data=[];const e=this._provider.priceScale(),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._provider.graphics().trendchannels();if(0===i.size)return;const o=this._model.timeScale().visibleBarsStrictRange();if(null===o)return;const s=this._provider.firstValue();if(null===s)return;const a=o.firstBar(),d=o.lastBar(),h=(0,r.ensureDefined)(this._provider.properties().childs().graphics.childs().trendchannels),u=(0,r.ensureDefined)(this._provider.graphicsInfo().trendchannels);i.forEach(((i,o)=>{const f=(0,r.ensureDefined)(h.childs()[o]).childs(),p=(0,r.ensureDefined)(u[o]);i.forEach((i=>{const o=i.startIndex,h=i.endIndex;if(Math.max(o,h)<a&&!i.extendRight||Math.min(o,h)>d&&!i.extendLeft)return;const u=e.priceToCoordinate((0,r.ensureDefined)(i.startHighPrice),s),g=e.priceToCoordinate((0,r.ensureDefined)(i.startLowPrice),s),_=e.priceToCoordinate((0,r.ensureDefined)(i.endHighPrice),s),x=_-(u-g),w=t.indexToCoordinate(o),v=t.indexToCoordinate(h),[m,y]=c(new n.Point(w,u),new n.Point(v,_),t.width(),e.height(),i.extendLeft,i.extendRight),[b,T]=c(new n.Point(w,g),new n.Point(v,x),t.width(),e.height(),i.extendLeft,i.extendRight);this._data.push({points:[m,b,T,y],color:f.color.value(),backcolor:f.color.value(),linewidth:p.borderWidth??0,linestyle:l.LINESTYLE_SOLID,filled:!0,fillBackground:!0,transparency:i.transparency?Math.min(i.transparency+f.transparency.value(),100):f.transparency.value()})}))}))}}function c(e,t,i,r,s,a){if((0,n.equalPoints)(e,t))return[e,t];const l=new n.Point(0,0),d=new n.Point(i,r);if(s){const r=e.subtract(t),s=(0,o.intersectRayAndBox)(e,e.add(r),(0,n.box)(l,d));s?e=s:t=new n.Point(i,t.y)}if(a){const r=t.subtract(e),s=(0,o.intersectRayAndBox)(t,t.add(r),(0,n.box)(l,d));t=s||new n.Point(i,t.y)}return[e,t]}},965690:(e,t,i)=>{i.r(t),i.d(t,{VertLinePaneView:()=>l});var r=i(650151),n=i(731974),o=i(770885),s=i(708162),a=i(183634);class l{constructor(e,t,i){this._data=[],this._invalidated=!0,this._provider=e,this._model=t,this._hitTestResult=void 0!==i?new n.HitTestResult(n.HitTarget.Custom,i):new n.HitTestResult(n.HitTarget.Regular)}update(e){"hover-change"!==e.type&&(this._invalidated=!0)}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const e=new s.CompositeRenderer;for(const t of this._data){const i=new a.VerticalLineRenderer;i.setData(t),i.setHitTest(this._hitTestResult),e.append(i)}return e}_updateViewInternal(){this._data=[];const e=this._provider.priceScale(),t=this._model.timeScale();if(!e||e.isEmpty()||t.isEmpty())return;const i=this._provider.graphicsInfo().vertlines,n=this._provider.graphics().vertlines();if(0===n.size||void 0===i)return;const s=this._model.timeScale().visibleBarsStrictRange();if(null===s)return;const a=this._provider.firstValue()
;if(null===a)return;const l=s.firstBar(),d=s.lastBar(),h=(0,r.ensureDefined)(this._provider.properties().childs().graphics.childs().vertlines);n.forEach(((n,s)=>{const c=(0,r.ensureDefined)(h.childs()[s]).childs(),u=(0,r.ensureDefined)(i[s]);c.visible.value()&&n.forEach((i=>{const n=i.index;if(n<l||d<n)return;const{left:s,center:h,right:f}=t.barBorders(n);let p;switch(u.halign){case o.HAlign.Left:p=s;break;case o.HAlign.Right:p=f;break;default:p=h}this._data.push({x:p,top:i.extendTop?void 0:e.priceToCoordinate((0,r.ensureDefined)(i.endPrice),a),bottom:i.extendBottom?void 0:e.priceToCoordinate((0,r.ensureDefined)(i.startPrice),a),color:c.color.value(),linewidth:c.width.value(),linestyle:c.style.value()})}))}))}}},950129:(e,t,i)=>{i.r(t),i.d(t,{LinearRegressionPaneView:()=>h});var r=i(731974),n=i(534328),o=i(708162),s=i(473645),a=i(692789),l=i(315167),d=i(141466);class h{constructor(e,t){this._invalidated=!0,this._lines=[],this._pearsonsTextRenderer=new l.TextRenderer,this._pearsons=null,this._model=e,this._source=t}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e=new o.CompositeRenderer,t=[this._lines[1],this._lines[0],this._lines[2]],i=[];for(const e of t)e&&i.push(e);for(let o=1;o<i.length;o++){const i=t[o].color,a=t[o].linewidth,l=t[o].linestyle,d=t[o].extendright,h={line1:{color:i,lineStyle:l,lineWidth:a,points:[t[o].points[0],t[o].points[1]]},line2:{color:i,lineStyle:l,lineWidth:a,points:[t[o-1].points[0],t[o-1].points[1]]},extendLeft:!1,extendRight:d,backColor:(0,n.generateColor)(t[o].color,this._source.properties().styles.transparency.value()),skipLines:!0,fillBackground:!0},c=new s.ParallelChannelRenderer(new r.HitTestResult(r.HitTarget.Regular),new r.HitTestResult(r.HitTarget.Regular));c.setData(h),e.append(c)}for(const t of function(e){return e.map((e=>{const t={...e};return t.color=(0,n.resetTransparency)(t.color),t}))}(this._lines)){const i=new a.TrendLineRenderer;i.setData(t),i.setHitTest(new r.HitTestResult(r.HitTarget.Regular)),e.append(i)}return this._pearsons&&(this._pearsons.color=(0,n.resetTransparency)(this._pearsons.color),this._pearsonsTextRenderer.setData(this._pearsons),e.append(this._pearsonsTextRenderer)),e}_updateImpl(){const e=(0,d.prepareLinearRegressionRenderersData)(this._model,this._source);this._lines=e.lines,this._pearsons=e.pearsons}}},762003:(e,t,i)=>{i.d(t,{rgbaFromIntegerCached:()=>s});var r=i(259332),n=i(534328),o=i(850117);function s(e=1e3){const t=r.default.Cache;r.default.Cache=o.CircularCacheBuffer.bind(o.CircularCacheBuffer,e);const i=(0,r.default)(n.rgbaFromInteger);return r.default.Cache=t,i}}}]);