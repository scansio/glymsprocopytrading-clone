"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[65306],{776324:(t,e,s)=>{s.d(e,{changeDescription:()=>b,create:()=>h,createCrossTabSyncMiddleware:()=>_,exact:()=>p,exclude:()=>S,getListById:()=>C,getListIds:()=>v,getListsMap:()=>E,insert:()=>m,put:()=>T,reducer:()=>I,remove:()=>y,rename:()=>g,replace:()=>u,setup:()=>d,share:()=>f,updatePersistedState:()=>L});var o=s(74293),a=s(199669),i=s(340958),r=s(559986);const n={lists:{ids:[],byId:{}},timestamp:null};function c(t,e){t.lists.ids.push(e.id),t.lists.byId[e.id]={id:e.id,name:e.name,description:e.description,symbols:[...e.symbols],shared:e.shared,timestamp:e.timestamp,collapsedSeparators:e.collapsedSeparators,persistedState:e.persistedState,lastChangeTimestamp:e.lastChangeTimestamp}}const l=(0,o.createSlice)({name:"custom-lists",initialState:n,reducers:{setup:(t,e)=>{const{lists:s,timestamp:o}=e.payload,a=new Set(s.map((t=>t.id))),i=new Set(t.lists.ids.filter((t=>!a.has(t))));for(const e of i)delete t.lists.byId[e];t.lists.ids=[...a];for(const e of s){const s=C(t,e.id);if(s){if(s.lastChangeTimestamp>=e.lastChangeTimestamp)continue;s.name=e.name,s.description=e.description,s.symbols=[...e.symbols],s.shared=e.shared,s.timestamp=e.timestamp,s.collapsedSeparators=e.collapsedSeparators,s.persistedState=e.persistedState,void 0!==e.lastChangeTimestamp&&(s.lastChangeTimestamp=e.lastChangeTimestamp)}else t.lists.byId[e.id]={id:e.id,name:e.name,description:e.description,symbols:[...e.symbols],shared:e.shared,timestamp:e.timestamp,collapsedSeparators:e.collapsedSeparators,persistedState:e.persistedState,lastChangeTimestamp:e.lastChangeTimestamp}}t.timestamp=o},insert:(t,e)=>{const{id:s,symbols:o,before:a,actionTimestamp:n}=e.payload,{lists:c}=t,l=c.byId[s];if(void 0===l)return;if(l.lastChangeTimestamp>=n)return;const d=new Set(o);let m;if(void 0!==a&&d.has(a)){m=r.LIST_START;for(let t=l.symbols.indexOf(a);t>=0;--t)if(!d.has(l.symbols[t])){m=l.symbols[t];break}}const u=l.symbols.filter((t=>!d.has(t))),p=(0,r.getTargetIndex)(u,a,m);void 0===p?u.push(...d):u.splice(p,0,...d),(0,i.equalArrays)(u,l.symbols)||(l.symbols=u,void 0!==n&&(l.lastChangeTimestamp=n))},replace:(t,e)=>{const{id:s,current:o,next:a,actionTimestamp:i}=e.payload,{lists:r}=t,n=r.byId[s];if(void 0===n)return;if(n.lastChangeTimestamp>=i)return;if(o===a)return;let c=!1,l=!1;const d=[];for(const t of n.symbols){if(t===a){l=!0;break}t===o?(d.push(a),c=!0):d.push(t)}c&&!l&&(n.symbols=d,void 0!==i&&(n.lastChangeTimestamp=i))},exact:(t,e)=>{const{id:s,symbols:o,actionTimestamp:a}=e.payload,{lists:r}=t,n=r.byId[s];if(void 0===n)return;if(n.lastChangeTimestamp>=a)return;const c=[...new Set(o)];(0,i.equalArrays)(c,n.symbols)||(n.symbols=c,void 0!==a&&(n.lastChangeTimestamp=a))},exclude:(t,e)=>{const{id:s,symbols:o,actionTimestamp:a}=e.payload,{lists:r}=t,n=r.byId[s];if(void 0===n)return;if(n.lastChangeTimestamp>=a)return;const c=new Set(o),l=n.symbols.filter((t=>!c.has(t)));(0,i.equalArrays)(l,n.symbols)||(n.symbols=l,void 0!==a&&(n.lastChangeTimestamp=a))},remove:(t,e)=>{
const{id:s}=e.payload,{lists:o}=t;if(void 0===o.byId[s])return;const a=o.ids.filter((t=>t!==s));o.ids=a,delete o.byId[s]},create:(t,e)=>{const{id:s,name:o,symbols:a,persistedState:i,actionTimestamp:r}=e.payload,{lists:n}=t;void 0===n.byId[s]&&c(t,{id:s,name:o,symbols:a,shared:!1,description:null,timestamp:null,persistedState:i,lastChangeTimestamp:r})},put:(t,e)=>{const{id:s,name:o,description:a,symbols:i,shared:r,timestamp:n,collapsedSeparators:l,persistedState:d,actionTimestamp:m}=e.payload,{lists:u}=t,p=u.byId[s];if(void 0===p)c(t,{id:s,name:o,description:a,symbols:i,shared:r,timestamp:n??null,persistedState:d,lastChangeTimestamp:m});else{if(p.lastChangeTimestamp>=m)return;u.byId[s]={id:s,name:o,description:a,shared:r,timestamp:n??null,symbols:[...i],collapsedSeparators:l,persistedState:d,lastChangeTimestamp:m??p.lastChangeTimestamp}}},rename:(t,e)=>{const{id:s,name:o,actionTimestamp:a}=e.payload,{lists:i}=t,r=i.byId[s];void 0!==r&&(r.lastChangeTimestamp>=a||r.name!==o&&(r.name=o,void 0!==a&&(r.lastChangeTimestamp=a)))},changeDescription:(t,e)=>{const{id:s,description:o,actionTimestamp:a}=e.payload,{lists:i}=t,r=i.byId[s];void 0!==r&&(r.lastChangeTimestamp>=a||r.description!==o&&(r.description=o,void 0!==a&&(r.lastChangeTimestamp=a)))},share:(t,e)=>{const{id:s,shared:o,actionTimestamp:a}=e.payload,{lists:i}=t,r=i.byId[s];void 0!==r&&(r.lastChangeTimestamp>=a||r.shared!==o&&(r.shared=o,void 0!==a&&(r.lastChangeTimestamp=a)))},updatePersistedState:(t,e)=>{const{lists:s}=t;s.ids.forEach((t=>{const o=s.byId[t],a=e.payload[t];void 0!==o&&o.persistedState&&a&&(o.persistedState={...o.persistedState,...a})}))}}}),{setup:d,insert:m,replace:u,exact:p,exclude:S,remove:y,create:h,put:T,rename:g,changeDescription:b,share:f,updatePersistedState:L}=l.actions,{reducer:I}=l;function _(t,e,s=l){return(0,a.createCrossTabSyncMiddleware)({id:t,channel:e,event:"custom-list-cross-tab-sync",filter:t=>function(t,e){return e.actions.setup.match(t)||e.actions.insert.match(t)||e.actions.exclude.match(t)||e.actions.exact.match(t)||e.actions.replace.match(t)||e.actions.remove.match(t)||e.actions.create.match(t)||e.actions.put.match(t)||e.actions.rename.match(t)||e.actions.changeDescription.match(t)||e.actions.share.match(t)||e.actions.updatePersistedState.match(t)}(t,s)})}function E(t){return t.lists.byId}function C(t,e){return E(t)[e]??null}function v(t){return t.lists.ids}},406103:(t,e,s)=>{s.d(e,{isIDCExchange:()=>a});var o=s(184026);function a(t,e=!1){if(t&&t.startsWith("exchange-"))return function(t,e=!1){const s=window.pro?.getProduct(t);return!(void 0===s||!(0,o.isProductDefined)(s)||(e?!s.idc_service_codes_delay:!s.idc_service_codes))}(t,e);const s=(t||"").toLowerCase();return window.pro?.getIDCExchanges(e)?.includes(s)??!1}},850935:(t,e,s)=>{s.r(e),s.d(e,{addOrUpdateSymbolList:()=>d,initWidget:()=>r,removeSymbolList:()=>m,selectAllSymbols:()=>l,selectHotlist:()=>p,selectNextAvailableSymbol:()=>a,setSymbolLists:()=>u,showContextMenu:()=>i,updateActiveList:()=>h,updateBulkPositions:()=>y,updatePosition:()=>S,updateWidget:()=>n,
updateWidgetOptions:()=>c});var o=s(189086);const a=(t,e,s,a)=>({type:o.SELECT_NEXT_AVAILABLE_SYMBOL,widgetId:t,currentSymbol:e,keyboardAction:s,cancelSetOnChart:a}),i=(t,e,s,a)=>({type:o.SHOW_CONTEXT_MENU,symbol:e,position:T(s),widgetId:t,size:a}),r=(t,e,s,a)=>({type:o.INIT_WIDGET,options:a,id:t,columns:s,tickerType:e}),n=(t,e)=>({type:o.UPDATE_WIDGET,widgetId:t,widget:e}),c=(t,e)=>({type:o.UPDATE_WIDGET_OPTIONS,widgetId:t,options:e}),l=t=>({type:o.SELECT_ALL_SYMBOLS,widgetId:t}),d=t=>({type:o.ADD_OR_UPDATE_SYMBOL_LIST,symbolList:t}),m=t=>({type:o.REMOVE_SYMBOL_LIST,id:t}),u=t=>({type:o.SET_SYMBOL_LISTS,symbolLists:t}),p=(t,e,s,a=!1,i=!1)=>({type:o.SELECT_HOTLIST,widgetId:t,exchange:e,group:s,skipUpdateWidget:a,skipAddOrUpdateList:i}),S=(t,e)=>({type:o.UPDATE_POSITIONS,symbol:t,position:e}),y=t=>({type:o.UPDATE_BULK_POSITIONS,map:t}),h=t=>({type:o.UPDATE_ACTIVE_LIST,token:t});function T(t){const e=t.touches?.map((t=>({clientX:t.clientX,clientY:t.clientY})));return{clientX:t.clientX,clientY:t.clientY,touches:e,attachToXBy:t.attachToXBy,attachToYBy:t.attachToYBy,box:t.box}}},217525:(t,e,s)=>{s.d(e,{SET_IS_AUTHENTICATED:()=>r,authReducer:()=>c,watchAuth:()=>l});var o=s(746212),a=s(129885),i=s(776324);const r="AUTH__SET_IS_AUTHENTICATED";function n(t){return{type:r,isAuthenticated:t}}function c(t=Boolean(window.is_authenticated),e){return e.type===r?e.isAuthenticated:t}function*l(){const t=(0,o.eventChannel)((t=>{const e={};return window.loginStateChange.subscribe(e,(()=>t(window.is_authenticated))),()=>window.loginStateChange.unsubscribeAll(e)}));try{for(;;){const e=yield(0,a.take)(t);yield(0,a.put)((0,i.setup)({lists:[],timestamp:Date.now(),silent:!0})),yield(0,a.put)(n(e))}}finally{t.close()}}},452528:(t,e,s)=>{s.d(e,{collapsedSeparatorsSelector:()=>c,displaySymbolsSelector:()=>u,displaySymbolsToActualSelector:()=>p,getCurrentViewableCollapsedSeparatorsSelector:()=>l,separatorIsCollapsedByListIdSelector:()=>m,separatorIsCollapsedSelector:()=>d,symbolsToSeparatorChildrenMap:()=>y});var o=s(377145),a=s(650151),i=s(291676),r=s(456746);const n=(t,e,s)=>s;function c(t){return t.collapsedSeparators}const l=(0,o.createSelector)([c,i.getCurrentViewableListByWidgetId],((t,e)=>e&&"hot"!==e.type?{...t[e.id]}:{})),d=(0,o.createSelector)([l,n],((t,e)=>T(t,e))),m=(0,o.createSelector)([c,(t,e)=>e,n],((t,e,s)=>T({...t[e]},s))),u=((0,o.createSelector)([c,i.getGlobalActiveSymbolList],((t,e)=>e?S(e,{...t[e.id]}):[])),(0,o.createSelector)([i.getCurrentViewableListByWidgetId,l],S)),p=(0,o.createSelector)([i.getCurrentViewableListByWidgetId,l,n],((t,e,s)=>{if(!t||"hot"===t.type)return[];const{symbols:o}=t,a=y(o),i=[];return s.forEach((t=>{i.push(t);const s=a.get(t),o=T(e,t);s&&o&&i.push(...s)})),i}));function S(t,e){if(!t)return[];const{symbols:s}=t,o=[];let a=!0;return s.forEach((t=>{const s=(0,r.isValidSeparatorItem)(t);(a||s)&&o.push(t),s&&(a=!T(e,t))})),o}function y(t){const e=new Map;let s="";return t.forEach((t=>{(0,r.isValidSeparatorItem)(t)?(s=t,e.set(s,[])):s&&(0,a.ensureDefined)(e.get(s)).push(t)})),e}const h=!1;function T(t,e){
return t.hasOwnProperty(e)?t[e]:h}},934011:(t,e,s)=>{s.d(e,{createCrossTabSyncMiddleware:()=>u,reducer:()=>m,setSeparatorsCollapse:()=>d});var o=s(74293),a=s(199669),i=s(776324),r=s(604e3);const n="collapsed-separators-state-extension",c={[n]:{}},l=(0,o.createSlice)({name:"collapsed-separators",initialState:c,reducers:{setSeparatorsCollapse:(t,e)=>{const{listId:s,values:o,actionTimestamp:a}=e.payload;g(t,s),void 0!==a&&t[n][s].lastChangeTimestamp>=a||(Object.entries(o).forEach((([e,o])=>p(t,s,e,o))),void 0!==a&&(t[n][s].lastChangeTimestamp=a))}},extraReducers:t=>{t.addCase(i.setup,S),t.addCase(r.setup,y),t.addCase(i.put,((t,e)=>{const{actionTimestamp:s,collapsedSeparators:o,id:a}=e.payload;h(t,{id:a,collapsedSeparators:o,lastChangeTimestamp:s},s)})),t.addCase(r.renameSeparator,((t,e)=>{const{color:s,separator:o,name:a}=e.payload;Boolean(t[s]?.[o])&&p(t,s,a,!0)}))}}),{setSeparatorsCollapse:d}=l.actions,{reducer:m}=l;function u(t,e,s=l){return(0,a.createCrossTabSyncMiddleware)({id:t,channel:e,event:"collapsed-separators-cross-tab-sync",filter:t=>function(t,e){return e.actions.setSeparatorsCollapse.match(t)}(t,s)})}function p(t,e,s,o){!function(t,e){t.hasOwnProperty(e)||(t[e]={})}(t,e),o?t[e][s]=o:delete t[e][s]}function S(t,e){const{lists:s}=e.payload;s.forEach((e=>h(t,e,e.lastChangeTimestamp)))}function y(t,e){const{lists:s}=e.payload;s.forEach((e=>T(t,e)))}function h(t,e,s){T(t,e,s)}function T(t,e,s){const o=function(t){return t.hasOwnProperty("color")}(e)?e.color:e.id,{collapsedSeparators:a}=e;g(t,o),void 0!==s&&t[n][o].lastChangeTimestamp>=s||(t[o]={},a?.forEach((e=>{t[o][e]=!0})),void 0!==s&&(t[n][o].lastChangeTimestamp=s))}function g(t,e){t[n].hasOwnProperty(e)||(t[n][e]={lastChangeTimestamp:0})}},189086:(t,e,s)=>{s.d(e,{ADD_OR_UPDATE_SYMBOL_LIST:()=>u,INIT_WIDGET:()=>n,REMOVE_SYMBOL_LIST:()=>S,SELECT_ALL_SYMBOLS:()=>m,SELECT_HOTLIST:()=>y,SELECT_NEXT_AVAILABLE_SYMBOL:()=>a,SET_SYMBOL_LISTS:()=>p,SHOW_CONTEXT_MENU:()=>c,UPDATE_ACTIVE_LIST:()=>h,UPDATE_BULK_POSITIONS:()=>r,UPDATE_POSITIONS:()=>i,UPDATE_WIDGET:()=>l,UPDATE_WIDGET_OPTIONS:()=>d});const o=(0,s(66889).createActionTypeFactory)("WATCHLISTS"),a=o("SELECT_NEXT_AVAILABLE_SYMBOL"),i=o("UPDATE_POSITIONS"),r=o("UPDATE_BULK_POSITIONS"),n=o("INIT_WIDGET"),c=o("SHOW_CONTEXT_MENU"),l=o("UPDATE_WIDGET"),d=o("UPDATE_WIDGET_OPTIONS"),m=o("SELECT_ALL_SYMBOLS"),u=o("ADD_OR_UPDATE_SYMBOL_LIST"),p=o("SET_SYMBOL_LISTS"),S=o("REMOVE_SYMBOL_LIST"),y=o("SELECT_HOTLIST"),h=o("UPDATE_ACTIVE_LIST")},136885:(t,e,s)=>{s.d(e,{crosstabMonotonicTimestamp:()=>n});var o=s(735566),a=s(49437);const i=(0,o.getLogger)("CrosstabMonotonicClock");let r=!1;function n(){const t=Number(a.TVLocalStorage.getItem("last-crosstab-monotonic-timestamp"))||0,e=Date.now(),s=t<e?e:t+1;return!r&&t-e>864e5&&(i.logError(`The last recorded timestamp ${t} occurred more than one day in the future.`),r=!0),a.TVLocalStorage.setItem("last-crosstab-monotonic-timestamp",String(s)),s}},958613:(t,e,s)=>{s.d(e,{createSymbolListId:()=>i,isHotListId:()=>a});const o="###HOT###";function a(t){
return"string"==typeof t&&0===t.indexOf(o)}function i(t,e){return o+`${t}.${e}`}},904582:(t,e,s)=>{s.d(e,{getHotlistById:()=>i,hotListsSelector:()=>a});var o=s(377145);const a=t=>t.hotLists?.lists??null,i=(0,o.createSelector)([a,(t,e)=>e],((t,e)=>t?t[e]:null))},38506:(t,e,s)=>{s.r(e),s.d(e,{addWatchlistSymbolsThunk:()=>Y,createWatchlistThunk:()=>M,getActiveWatchlistThunk:()=>F,getCustomWatchlistsThunk:()=>R,putCustomWatchlistsThunk:()=>k,removeWatchlistSymbolsThunk:()=>x,removeWatchlistThunk:()=>U,renameSeparatorThunk:()=>G,renameWatchlistThunk:()=>N,replaceWatchlistSymbolsThunk:()=>W,setActiveWatchlistThunk:()=>V,symbolListRepositorySaga:()=>w,validateWatchListSymbols:()=>D});var o=s(129885),a=s(776324),i=s(444372),r=s(564894),n=s(261309),c=s(850935),l=s(735566),d=s(779923),m=s(357517),u=s(291676),p=s(826939),S=s(214168);function*y(){for(yield(0,o.put)((0,S.asAction)(F(null)));;){yield(0,o.take)([a.remove,a.setup]);const t=yield(0,o.select)();null===(0,u.getCurrentViewableListByWidgetId)(t,p.WATCHLIST_WIDGET_ID)&&(yield(0,o.put)((0,S.asAction)(F(null))))}}var h=s(931924),T=s(543469),g=s(136885),b=s(217525),f=s(330074),L=s(795394),I=s(934011),_=s(778016),E=s(707934),C=s(440498),v=s(452528);const A=(0,l.getLogger)("Platform.Model.SymbolLists"),O=1e3;function*w(){yield(0,o.fork)(b.watchAuth),h.enabled("widget")||(yield(0,o.fork)(y))}function D(t){return new Promise((e=>{(0,L.resolveSymbolNameForAllDistinct)(t).then((t=>{e(t)}))}))}function P(t){const e=i.t(null,void 0,s(931425));B(i.t(null,{replace:{number:O.toString()}},s(918580)),e,t)}function B(t,e,o){(0,d.showWarning)({title:e||i.t(null,void 0,s(191056)),text:t},o)}function M(t){const e=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(s,o)=>{try{const o=(0,g.crosstabMonotonicTimestamp)(),i=await e.createWatchList(t);return null===i?null:(s((0,a.create)({id:i.id,name:i.name,symbols:i.symbols,persistedState:i.persistedState,actionTimestamp:o})),i.id)}catch(t){return B(t.message),null}}}const R=(0,m.respectLatest)((function(t){const e=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(s,o)=>{try{const o=(0,g.crosstabMonotonicTimestamp)(),i=await(0,m.respectAbort)(t,e.getCustomWatchLists()),r=Date.now();s((0,a.setup)({lists:i.map((t=>({id:t.id,name:t.name,description:t.description,symbols:t.symbols,shared:t.shared,collapsedSeparators:t.collapsedSeparators,timestamp:r,persistedState:t.persistedState,lastChangeTimestamp:o}))),timestamp:r}))}catch(t){(0,m.skipAbortError)(t)}}}));function k(t,e){const s=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(o,i)=>{try{const i=(0,g.crosstabMonotonicTimestamp)(),r=await(0,m.respectAbort)(t,s.putWatchList(e));o((0,a.put)({id:r.id,name:r.name,description:r.description,symbols:r.symbols,shared:r.shared,collapsedSeparators:r.collapsedSeparators,persistedState:r.persistedState,actionTimestamp:i}))}catch(t){(0,m.rethrowAbortError)(t),B(t.message)}}}function N(t,e,s){const o=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(i,r)=>{i((0,a.rename)({id:e.id,name:s,
actionTimestamp:(0,g.crosstabMonotonicTimestamp)()}));const n=await(0,m.respectAbort)(t,o.renameWatchList(e,s));n&&n.persistedState&&i((0,a.updatePersistedState)({[e.id]:n.persistedState}))}}function W(t,e,s,o){const i=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(r,n)=>{if("custom"!==e.type)return void A.logWarn("Trying to modify not a custom watchlist");if(s.length>O)return void P(o);{const t=(0,u.getCustomListById)(n(),e.id);if(t?.symbols.length!==s.length&&!K(s.length))return}r((0,a.exact)({id:e.id,symbols:s,actionTimestamp:(0,g.crosstabMonotonicTimestamp)()}));const c=await(0,m.respectAbort)(t,i.replaceSymbols(e,s));c&&r((0,a.updatePersistedState)({[e.id]:{symbols:c}}))}}function Y(t,e,s,o){const i=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(r,n)=>{if("custom"===e.type)if(e.symbols.length>O)P(o);else{{const t=(0,u.getCustomListById)(n(),e.id);if(!(0,C.isDeletedSymbolsList)(e.id)&&t?.symbols.length!==e.symbols.length&&!K(e.symbols.length))return}r((0,a.insert)({id:e.id,symbols:s,actionTimestamp:(0,g.crosstabMonotonicTimestamp)()}));try{const o=await(0,m.respectAbort)(t,i.addSymbols(e,s));r((0,a.updatePersistedState)({[e.id]:{symbols:o}}))}catch(t){if((0,m.isAbortError)(t))throw t;const i=e.symbols.filter((t=>!s.includes(t)));if(r((0,a.exact)({id:e.id,symbols:i,actionTimestamp:(0,g.crosstabMonotonicTimestamp)()})),"ApiError:plan_symbols_limit_reached"===t.name)return void(0,E.createGoProDialog)({feature:"watchlistSymbols"});B(t.message,void 0,o)}}else A.logWarn("Trying to modify not a custom watchlist")}}function x(t,e,s){const o=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(i,r)=>{i((0,a.exclude)({id:e.id,symbols:s,actionTimestamp:(0,g.crosstabMonotonicTimestamp)()}));const n=await(0,m.respectAbort)(t,o.removeSymbols(e,s));i((0,a.updatePersistedState)({[e.id]:{symbols:n}}))}}function U(t,e){const s=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(o,i)=>{await(0,m.respectAbort)(t,s.removeWatchList(e)),o((0,a.remove)({id:e.id}))}}function V(t,e){const s=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(o,i)=>{const{id:r}=e;o((0,c.updateActiveList)(e));const n=await(0,m.respectAbort)(t,s.setActive(e));n&&(0,T.isCustomList)(n)&&n.persistedState&&o((0,a.updatePersistedState)({[r]:n.persistedState}))}}function H(t,e,s){return async(o,i)=>{const r=(0,v.separatorIsCollapsedByListIdSelector)(i(),t,e);o((0,a.replace)({id:t,current:e,next:s,actionTimestamp:(0,g.crosstabMonotonicTimestamp)()})),r&&o((0,I.setSeparatorsCollapse)({listId:t,values:{[s]:!0,[e]:!1},actionTimestamp:(0,g.crosstabMonotonicTimestamp)()}))}}function G(t,e,s,o){const i=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(r,n)=>{"custom"===e.type?(r(H(e.id,s,o)),await(0,m.respectAbort)(t,i.renameSeparator(e.id,s,o).then((t=>{t&&r((0,a.updatePersistedState)({[e.id]:{symbols:t}}))})).catch(m.skipAbortError).catch((t=>{B(t.message),r(H(e.id,o,s))})))):A.logWarn("Trying to modify not a custom watchlist")}}const F=(0,
m.respectLatest)((function(t){const e=(0,r.service)(n.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE);return async(s,o)=>{try{const o=(0,g.crosstabMonotonicTimestamp)(),i=await(0,m.respectAbort)(t,e.getActive());if("colored"===i.type){const e=(0,f.getMarkedSymbolsListServiceInstance)();e.isInited()||await(0,m.respectAbort)(t,new Promise((t=>{e.onInit(t)}))),s((0,c.updateActiveList)({type:"color",id:i.color}))}else"custom"===i.type?("custom"===i.type&&(i.symbols=await(0,m.respectAbort)(t,D(i.symbols))),s((0,a.put)({id:i.id,name:i.name,description:i.description,symbols:i.symbols,shared:i.shared,collapsedSeparators:i.collapsedSeparators,persistedState:i.persistedState,actionTimestamp:o})),s((0,c.updateActiveList)({type:"custom",id:i.id}))):"hot"===i.type&&(s((0,c.addOrUpdateSymbolList)(i)),i.exchange&&i.group&&s((0,c.updateActiveList)({type:"hot",exchange:i.exchange,group:i.group,id:i.id})))}catch(t){(0,m.skipAbortError)(t)}}}));function K(t){const e=(0,_.getConfig)("WATCHLIST_SYMBOLS")?.limit;return!(e&&t>e)||((0,E.createGoProDialog)({feature:"watchlistSymbols"}),!1)}},214168:(t,e,s)=>{function o(t){return t}s.d(e,{asAction:()=>o})},291676:(t,e,s)=>{s.r(e),s.d(e,{columnsSelector:()=>I,currentHotListSelector:()=>M,getCurrentViewableListByWidgetId:()=>B,getCustomListById:()=>w,getCustomLists:()=>v,getCustomListsMap:()=>O,getCustomListsState:()=>u,getGlobalActiveID:()=>h,getGlobalActiveSymbolList:()=>P,getIsReadyCustomLists:()=>A,getMarkedListsMap:()=>D,highlightedSymbolsSelector:()=>L,isAuthenticatedSelector:()=>p,isLoadingSelector:()=>R,makeGetIsContainedByMultiSelection:()=>N,positionSelector:()=>k,scrollToIdSelector:()=>b,selectedSymbolsSelector:()=>g,shouldDisplayPositionsSelector:()=>C,sortingSelector:()=>f,tickerTypeSelector:()=>_,widgetOptionsSelector:()=>E,widgetSelector:()=>T});var o=s(377145),a=s(650151),i=s(776324),r=s(604e3),n=s(502885),c=s(690153),l=s(958613),d=s(904582),m=s(543469);function u(t){return t.customLists}const p=t=>t.isAuthenticated,S=t=>t.widgets,y=(t,e)=>e,h=t=>t.activeSymbolList?.id??null,T=(0,o.createSelector)([S,y],((t,e)=>t[e]||{})),g=(0,o.createSelector)(T,(t=>t.selectedSymbols||[])),b=(0,o.createSelector)(T,(t=>t.scrollToId)),f=(0,o.createSelector)(T,(t=>t.sorting||null)),L=(0,o.createSelector)(T,(t=>t.highlightedSymbols||null)),I=(0,o.createSelector)(T,(t=>t.columns)),_=(0,o.createSelector)(T,(t=>t.tickerType)),E=(0,o.createSelector)(T,(t=>t.options||{})),C=(0,o.createSelector)([E,p],((t,e)=>t.shouldDisplayPositions&&e)),v=(0,o.createSelector)(u,(t=>(0,i.getListIds)(t).map((e=>(0,m.makeCustomListFromRecord)((0,a.ensureNotNull)((0,i.getListById)(t,e))))))),A=(0,o.createSelector)([u],(t=>null!==t.timestamp)),O=(0,o.createSelector)([u],i.getListsMap),w=(0,o.createSelector)([u,(t,e)=>e],((t,e)=>{const s=(0,i.getListById)(t,e);return null===s?null:(0,m.makeCustomListFromRecord)(s)})),D=(0,o.createSelector)([n.getMarkedListsState],(t=>t?t.lists.byColor:null)),P=(0,o.createSelector)([d.hotListsSelector,u,n.getMarkedListsState,h],((t,e,s,o)=>{if(null===o)return null;if(null!==s&&(0,r.isListColor)(o)){
const t=(0,r.getListByColor)(s,o);return null===t?null:(0,c.makeMarkedListFromRecord)(t)}if((0,l.isHotListId)(o)){const e=t?.[o];return e?{id:e.id,name:e.name,type:e.type,group:e.group,exchange:e.exchange,symbols:e.symbols}:null}const a=(0,i.getListById)(e,o);return null!==a?(0,m.makeCustomListFromRecord)(a):null})),B=(0,o.createSelector)([d.hotListsSelector,u,n.getMarkedListsState,S,y],((t,e,s,o,a)=>{const n=o[a];if(void 0===n)return null;const d=n.listId;if(null===d)return null;if(null!==s&&(0,r.isListColor)(d)){const t=(0,r.getListByColor)(s,d);return null===t?null:(0,c.makeMarkedListFromRecord)(t)}if((0,l.isHotListId)(d)){const e=t?.[d];return e?{id:e.id,name:e.name,type:e.type,group:e.group,exchange:e.exchange,symbols:e.symbols}:null}const u=(0,i.getListById)(e,d);return null!==u?(0,m.makeCustomListFromRecord)(u):null}));function M(t,e){const s=B(t,e);return"hot"!==s?.type?null:s}const R=(0,o.createSelector)([T,B],((t,e)=>null===e||t.isLoading||!1)),k=(0,o.createSelector)([t=>t.positions,(t,e)=>e],((t,e)=>t[e]));function N(){const t=(0,o.createSelector)([(t,e)=>e.widgetId,t=>t.widgets],((t,e)=>e[t])),e=(0,o.createSelector)(t,(t=>t.selectedSymbols||[])),s=(0,o.createSelector)(e,(t=>new Set(t)));return(0,o.createSelector)([s,(t,e)=>e.symbol],((t,e)=>t.size>1&&t.has(e)))}},456746:(t,e,s)=>{s.d(e,{buildUniqueName:()=>b,canUseMultipleLists:()=>f,compareSymbols:()=>A,convertToSeparatorName:()=>g,createConfirmRemoveText:()=>R,createConfirmUnflagText:()=>k,createSaveRenameDialog:()=>L,findNextAvailableSymbol:()=>B,getSymbolFromList:()=>P,getTranslatedListTitle:()=>v,hasDuplicates:()=>D,isEqualRecords:()=>w,isValidSeparatorItem:()=>h,separatorValToDisplayVal:()=>T,sortSymbols:()=>_,toPositionRecord:()=>O,trackRemoveEvent:()=>M});var o=s(650151),a=s(444372),i=s(931924),r=s(779923),n=s(575816),c=s(722840),l=s(904207),d=s(837657),m=s(173777),u=s(345848),p=s(494966),S=(s(23203),s(690153)),y=s(330074);s(795394);function h(t){return(0,d.isSeparatorItem)(t)}function T(t){return t.replace(m.SEPARATOR_PREFIX,"")}function g(t){return m.SEPARATOR_PREFIX+t}function b(t,e,s=!0){const o=new Set(t),a=s?" 1":"";if(!o.has(e+a))return e+a;let i=2,r="";for(;i<=2e3&&(r=`${e} ${i}`,o.has(r));)i+=1;return r}function f(){return i.enabled("multiple_watchlists")&&window.user&&Boolean(window.user.is_pro)}function L(t,e,o,i){return()=>new Promise(((n,c)=>{(0,r.showRename)({title:t,initValue:e,text:a.t(null,void 0,s(46187))+":",maxLength:128,emojiPicker:!0,onRename:({newValue:t,dialogClose:e})=>{n(t),e(),i?.()}},o)}))}function I(t){return t.replace("âˆ’","-")}function _(t,e,s,a,i){const r=function(t){const e=[],s=[];t.forEach(((t,e)=>{(0,d.isSeparatorItem)(t)&&s.push(e)}));let o=0;s.forEach((s=>{e.push({values:t.slice(o,s),separator:t[s]}),o=s+1}));const a=s[s.length-1],i=t.slice(a+1);return i.length>0&&e.push({values:i,separator:null}),e}(e);return r.forEach((e=>{e.values.sort(((e,r)=>{if("flag"===s){const t=(0,y.getMarkedSymbolsListServiceInstance)().getSymbolColor(e),s=(0,y.getMarkedSymbolsListServiceInstance)().getSymbolColor(r);return(0,
S.getSortByColorComparator)(a)(t,s)}const d=c.quoteSessionAdapters.get(t).getLastSymbolData(e),m=c.quoteSessionAdapters.get(t).getLastSymbolData(r),u=E(d),h=E(m),T=(t,e)=>{if(!t||"flag"===s)return;var o;return"error"===t.status?void 0:i===n.TickerType.Description&&"short_name"===s?(o=t.values,(0,l.getTranslatedSymbolDescription)(o)||(0,p.safeShortName)(e)):t.values[s]},g=T(d,e),b=T(m,r);return function(t,e){const s=-1===e?-1/0:1/0;return(a,i,r,n)=>{if("rchp"!==t){if(void 0===a&&void 0===i)return 0;if(void 0===a)return-e;if(void 0===i)return e}switch(t){case"short_name":return e*(a===i?0:(0,o.ensure)(a)<(0,o.ensure)(i)?-1:1);case"rchp":return r!==n?r>n?-1:1:(r||(a=void 0),n||(i=void 0),C(a,i,e,s));case"last_price":case"change":case"change_percent":return C(a,i,e,s);case"volume":{const t=(0,o.ensure)(a)>=1e100?s:Number(a),r=(0,o.ensure)(i)>=1e100?s:Number(i);return e*(t-r)}default:return(0,o.ensure)(a)>(0,o.ensure)(i)?-1:1}}}(s,a)(g,b,u,h)}))})),function(t){const e=[];return t.forEach((({values:t,separator:s})=>{e.push(...t),null!==s&&e.push(s)})),e}(r)}function E(t){if(!t)return!1;const e="pre_market"===t.values.current_session,s="post_market"===t.values.current_session;return e||s}function C(t,e,s,o){let a=parseFloat(I(String(t))),i=parseFloat(I(String(e)));return a=isNaN(a)?o:a,i=isNaN(i)?o:i,s*(a-i)}function v(t){return"colored"===t.type?t.name||(0,S.getColoredListTitle)(t.color):t.name}function A(t,e){return t===e||(0,p.safeShortName)(t)===e}function O(t){return{symbol:t.symbol,side:t.side,qty:t.qty,avgPrice:t.avgPrice}}function w(t,e){return t===e||void 0!==t&&void 0!==e&&(t.side===e.side&&t.qty===e.qty&&t.avgPrice===e.avgPrice&&t.symbol===e.symbol)}function D(t){const e=new Map;for(let s=0;s<t.length;s++){const a=t[s].toUpperCase(),i=(0,p.safeShortName)(a);if(e.has(i)){const t=(0,o.ensureDefined)(e.get(i));if(t.has(a)||t.has(i)||a===i)return!0;t.add(a),e.set(i,t)}else e.set(i,new Set([a]))}return!1}function P(t,e){if(e.includes(t))return t}function B(t,e,s){const o="next"===s;for(let s=t;o?s<e.length:s>=0;o?s++:s--)if(!(0,d.isSeparatorItem)(e[s])&&s!==t)return e[s];for(let s=o?0:e.length-1;o?s<t:s>t;o?s++:s--)if(!(0,d.isSeparatorItem)(e[s]))return e[s]}function M(t){t?(0,u.trackEvent)("Watchlist","Multi select","Remove"):(0,u.trackEvent)("Watchlist","Remove")}function R(t){return a.t(null,{plural:"Do you really want to delete {count} selected symbols?",context:"symbols_and_drawings_count",count:t,replace:{count:t.toString()}},s(54105))}function k(t){return a.t(null,{plural:"Do you really want to unflag {count} selected symbol?",context:"symbols_and_drawings_count",count:t,replace:{count:t.toString()}},s(464788))}},66889:(t,e,s)=>{function o(t){return e=>t+"__"+e}s.d(e,{createActionTypeFactory:()=>o})}}]);