"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[81183],{312520:(e,t,s)=>{s.r(t),s.d(t,{MouseEventHandler:()=>b,defaultPreventedHandler:()=>m,getClickPosition:()=>d,ignoreClickOrTapOnDblClickOrDblTapHandlers:()=>v,isTouchMouseEvent:()=>_});var i=s(481251),n=s(650151),o=s(536794),r=s(638456),l=s(196726),u=s(822961);let a=2;const h=r.isSafari?"click":"auxclick",c={treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!1,ignoreClickAndTapOnDblClickOrDblTap:!1};function d(e){if(_(e))return{x:e.clientX,y:e.clientY};if("touches"in(t=e)&&void 0!==t.touches){if(1===e.touches.length){const t=(0,n.ensureNotNull)(e.target).getBoundingClientRect(),s=e.touches[0];return{x:s.clientX-t.left,y:s.clientY-t.top}}return null}var t;return{x:e.offsetX,y:e.offsetY}}function _(e){return"isTouch"in e&&"stylus"in e}function m(e){return t=>{t.preventDefault(),e(t)}}function v(e,t){let s=!1;return{clickOrTap:(...i)=>{t?.()?e.clickOrTap(...i):(s=!1,setTimeout((()=>!s&&e.clickOrTap(...i)),501))},doubleClickOrDoubleTap:(...t)=>{s=!0,e.doubleClickOrDoubleTap?.(...t)}}}class b{constructor(e,t,s){if(this._clickCount=0,this._clickTimeoutId=null,this._clickPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._touchMoveStartPosition=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._unsubscribePinchEvents=null,this._unsubscribeTargetElementEvents=null,this._pinchInfo=null,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!r.CheckMobile.iOS(),this._onFirefoxOutsideMouseUp=e=>{this._mouseUpHandler(e)},this._onMobileSafariDoubleClick=e=>{if(this._firesTouchEvents(e)){const t=this._makeCompatEvent(e);if(++this._tapCount,this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:s}=this._touchMouseMoveWithDownInfo(y(e),this._tapPosition);s<30&&!this._cancelTap&&this._processTouchEvent(t,this._handlers.doubleTapEvent),this._resetTapTimeout()}}else{const t=this._makeCompatEvent(e);if(++this._clickCount,this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:s}=this._touchMouseMoveWithDownInfo(y(e),this._clickPosition);s<5&&!this._cancelClick&&this._processMouseEvent(t,this._handlers.mouseDoubleClickEvent),this._resetClickTimeout()}}},this._target=e,this._options=(0,o.merge)((0,o.clone)(c),s||{}),this._options.ignoreClickAndTapOnDblClickOrDblTap){if(t.mouseClickEvent&&t.mouseDoubleClickEvent){const e=v({clickOrTap:t.mouseClickEvent.bind(t),doubleClickOrDoubleTap:t.mouseDoubleClickEvent.bind(t)})
;t.mouseClickEvent=e.clickOrTap,t.mouseDoubleClickEvent=e.doubleClickOrDoubleTap}if(t.tapEvent&&t.doubleTapEvent){const e=v({clickOrTap:t.tapEvent.bind(t),doubleClickOrDoubleTap:t.doubleTapEvent.bind(t)});t.tapEvent=e.clickOrTap,t.doubleTapEvent=e.doubleClickOrDoubleTap}}this._handlers=t,this._init()}destroy(){null!==this._unsubscribeOutsideMouseEvents&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),null!==this._unsubscribeOutsideTouchEvents&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),null!==this._unsubscribeMobileSafariEvents&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),null!==this._unsubscribePinchEvents&&(this._unsubscribePinchEvents(),this._unsubscribePinchEvents=null),null!==this._unsubscribeTargetElementEvents&&(this._unsubscribeTargetElementEvents(),this._unsubscribeTargetElementEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(e){this._unsubscribeMousemove&&this._unsubscribeMousemove();const t=this._mouseMoveHandler.bind(this);if(this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",t)},this._target.addEventListener("mousemove",t),this._firesTouchEvents(e))return;const s=this._makeCompatEvent(e);this._processMouseEvent(s,this._handlers.mouseEnterEvent),this._acceptMouseLeave=!0}_resetClickTimeout(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){null!==this._tapTimeoutId&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(e){if(this._mousePressed||null!==this._touchMoveStartPosition)return;if(this._firesTouchEvents(e))return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.mouseMoveEvent),this._acceptMouseLeave=!0}_touchMoveHandler(e){const t=g(e.changedTouches,(0,n.ensureNotNull)(this._activeTouchId));if(null===t)return;if(this._lastTouchEventTimeStamp=E(e),null!==this._pinchInfo)return;if(this._preventTouchDragProcess)return;this._pinchPrevented=!0;const s=this._touchMouseMoveWithDownInfo(y(t),(0,n.ensureNotNull)(this._touchMoveStartPosition)),{xOffset:i,yOffset:o,manhattanDistance:r}=s;if(this._touchMoveExceededManhattanDistance||!(r<5)){if(!this._touchMoveExceededManhattanDistance){const e=.5*i,t=this._options.shouldAllowTouchDrag?.()??!1,s=o>=e&&(!this._options.treatVertTouchDragAsPageScroll||t),n=e>o&&(!this._options.treatHorzTouchDragAsPageScroll||t);s||n||(this._preventTouchDragProcess=!0),
this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}if(!this._preventTouchDragProcess){const s=this._makeCompatEvent(e,t);this._processTouchEvent(s,this._handlers.touchMoveEvent),(0,l.preventDefault)(e)}}}_mouseMoveWithDownHandler(e){if(0!==e.button)return;if(this._options.isMouseMoveHandlingEnabled&&!this._options.isMouseMoveHandlingEnabled?.())return;const t=this._touchMouseMoveWithDownInfo(y(e),(0,n.ensureNotNull)(this._mouseMoveStartPosition)),{manhattanDistance:s}=t;if(s>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick){const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.pressedMouseMoveEvent)}}_touchMouseMoveWithDownInfo(e,t){const s=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);return{xOffset:s,yOffset:i,manhattanDistance:s+i}}_touchEndHandler(e){let t=g(e.changedTouches,(0,n.ensureNotNull)(this._activeTouchId));if(null===t&&0===e.touches.length&&(t=e.changedTouches[0]),null===t)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=E(e),this._clearLongTapTimeout(),this._touchMoveStartPosition=null,this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const s=this._makeCompatEvent(e,t);if(this._processTouchEvent(s,this._handlers.touchEndEvent),++this._tapCount,this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:e}=this._touchMouseMoveWithDownInfo(y(t),this._tapPosition);e<30&&!this._cancelTap&&this._processTouchEvent(s,this._handlers.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processTouchEvent(s,this._handlers.tapEvent),this._handlers.tapEvent&&(0,l.preventDefault)(e));0===this._tapCount&&(0,l.preventDefault)(e),0===e.touches.length&&this._longTapActive&&(this._longTapActive=!1,(0,l.preventDefault)(e))}_touchCancelHandler(e){this._touchEndHandler(e)}_mouseUpHandler(e){if(0!==e.button)return;const t=this._makeCompatEvent(e);if(this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),r.isFF){this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp)}if(!this._firesTouchEvents(e))if(this._processMouseEvent(t,this._handlers.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:s}=this._touchMouseMoveWithDownInfo(y(e),this._clickPosition);s<5&&!this._cancelClick&&this._processMouseEvent(t,this._handlers.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processMouseEvent(t,this._handlers.mouseClickEvent)}_clearLongTapTimeout(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(e){if(null!==this._activeTouchId)return this._clearLongTapTimeout(),void this._resetTapTimeout();const t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=E(e);const s=this._target.ownerDocument.documentElement
;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartPosition=y(t),this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const t=this._touchMoveHandler.bind(this),i=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{s.removeEventListener("touchmove",t),s.removeEventListener("touchend",i)},s.addEventListener("touchmove",t,{passive:!1}),s.addEventListener("touchend",i,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),333)}const i=this._makeCompatEvent(e,t);this._processTouchEvent(i,this._handlers.touchStartEvent),this._tapTimeoutId||(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapPosition=y(t))}_wheelClickHandler(e){if(1!==e.button)return;if(this._firesTouchEvents(e))return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.wheelClickEvent)}_mouseDownHandler(e){if(0!==e.button)return;if(this._options.isMouseMoveHandlingEnabled&&!this._options.isMouseMoveHandlingEnabled?.())return;const t=this._target.ownerDocument.documentElement;r.isFF&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartPosition=y(e),this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const e=this._mouseMoveWithDownHandler.bind(this),s=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{t.removeEventListener("mousemove",e),t.removeEventListener("mouseup",s)},t.addEventListener("mousemove",e),t.addEventListener("mouseup",s)}if(this._mousePressed=!0,this._firesTouchEvents(e))return;const s=this._makeCompatEvent(e);this._processMouseEvent(s,this._handlers.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickPosition=y(e))}_init(){const e=this._mouseEnterHandler.bind(this);this._target.addEventListener("mouseenter",e);const t=this._touchCancelHandler.bind(this);this._target.addEventListener("touchcancel",t);{const e=this._target.ownerDocument,t=e=>!e.target||!this._target.contains(e.target),s=e=>{if(!t(e))return;const s=e.changedTouches[0];this._lastTouchEventTimeStamp=E(e),this._processTouchEvent(this._makeCompatEvent(e,s),this._handlers.touchStartOutsideEvent)},i=e=>{t(e)&&!this._firesTouchEvents(e)&&this._processMouseEvent(this._makeCompatEvent(e),this._handlers.mouseDownOutsideEvent)};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",s)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",i)},e.addEventListener("mousedown",i),e.addEventListener("touchstart",s,{passive:!0})}r.CheckMobile.iOS()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick))
;const s=this._mouseLeaveHandler.bind(this);this._target.addEventListener("mouseleave",s);const i=this._contextMenuHandler.bind(this);this._target.addEventListener("contextmenu",i);const n=this._touchStartHandler.bind(this);let o;this._target.addEventListener("touchstart",n,{passive:!0}),r.isChrome&&(o=e=>{if(1===e.button)return e.preventDefault(),!1},this._target.addEventListener("mousedown",o));const l=this._mouseDownHandler.bind(this);this._target.addEventListener("mousedown",l);const u=this._wheelClickHandler.bind(this);this._target.addEventListener(h,u);const a=()=>{};this._target.addEventListener("touchmove",a,{passive:!1}),this._unsubscribeTargetElementEvents=()=>{this._target.removeEventListener("mouseleave",s),this._target.removeEventListener("contextmenu",i),this._target.removeEventListener("touchstart",n),o&&this._target.removeEventListener("mousedown",o),this._target.removeEventListener("mousedown",l),this._target.removeEventListener(h,u),this._target.removeEventListener("touchmove",a)},this._initPinch()}_initPinch(){if(void 0===this._handlers.pinchStartEvent&&void 0===this._handlers.pinchEvent&&void 0===this._handlers.pinchEndEvent)return;const e=e=>this._checkPinchState(e.touches);this._target.addEventListener("touchstart",e,{passive:!0});const t=e=>{if(null===this._pinchInfo)return;const t=g(e.touches,(0,n.ensureNotNull)(this._activeTouchId)),s=g(e.touches,this._pinchInfo.secondTouchId);if(t&&s&&void 0!==this._handlers.pinchEvent){const{startPinchDistance:i,startPinchMiddlePoint:n}=this._pinchInfo,o=T(t,s)/i,r=p(this._target);this._handlers.pinchEvent(n,{x:t.clientX-r.left,y:t.clientY-r.top},{x:s.clientX-r.left,y:s.clientY-r.top},o),(0,l.preventDefault)(e)}};this._target.addEventListener("touchmove",t,{passive:!1});const s=e=>this._checkPinchState(e.touches);this._target.addEventListener("touchend",s),this._unsubscribePinchEvents=()=>{this._target.removeEventListener("touchstart",e),this._target.removeEventListener("touchmove",t),this._target.addEventListener("touchend",s)}}_checkPinchState(e){1===e.length&&(this._pinchPrevented=!1),2!==e.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)}_startPinch(e){if(void 0!==this._handlers.pinchStartEvent&&null===this._pinchInfo){const t=p(this._target);let s,i;e[0].identifier===this._activeTouchId?(s=e[0],i=e[1]):(s=e[1],i=e[0]);const n={x:s.clientX-t.left,y:s.clientY-t.top},o={x:i.clientX-t.left,y:i.clientY-t.top},r={x:(n.x+o.x)/2,y:(n.y+o.y)/2};this._handlers.pinchStartEvent(r,n,o,{bothPointsOnTargetElement:this._target.contains(i.target)})&&(this._pinchInfo={startPinchDistance:T(s,i),startPinchMiddlePoint:r,secondTouchId:i.identifier})}this._clearLongTapTimeout()}_stopPinch(){null!==this._pinchInfo&&(this._pinchInfo=null,this._handlers.pinchEndEvent?.())}_mouseLeaveHandler(e){if(this._unsubscribeMousemove&&this._unsubscribeMousemove(),this._firesTouchEvents(e))return;if(!this._acceptMouseLeave)return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.mouseLeaveEvent),
this._acceptMouseLeave=!r.CheckMobile.iOS()}_longTapHandler(e){const t=g(e.touches,(0,n.ensureNotNull)(this._activeTouchId));if(null===t)return;const s=this._makeCompatEvent(e,t);this._processTouchEvent(s,this._handlers.longTapEvent),this._processTouchEvent(s,this._handlers.touchContextMenuEvent),this._cancelTap=!0,this._longTapActive=!0}_contextMenuHandler(e){if((0,l.preventDefault)(e),null!==this._touchMoveStartPosition)return;if(this._firesTouchEvents(e))return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.contextMenuEvent),this._cancelClick=!0}_firesTouchEvents(e){return e.sourceCapabilities&&void 0!==e.sourceCapabilities.firesTouchEvents?e.sourceCapabilities.firesTouchEvents:E(e)<this._lastTouchEventTimeStamp+500}_processTouchEvent(e,t){(0,u.setLastMouseOrTouchEventInfo)(e),t&&t.call(this._handlers,e)}_processMouseEvent(e,t){window.TVD&&("mouseenter"===e.srcType||"mousemove"===e.srcType)&&a>0?a--:("mouseleave"!==e.srcType&&(0,u.setLastMouseOrTouchEventInfo)(e),t&&t.call(this._handlers,e))}_makeCompatEvent(e,t){const s=t||e,n=(0,i.default)((()=>this._target.getBoundingClientRect()||{left:0,top:0}));return{clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY,get localX(){return s.clientX-n().left},get localY(){return s.clientY-n().top},ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,isTouch:!e.type.startsWith("mouse")&&"contextmenu"!==e.type&&"click"!==e.type,stylus:"stylus"===t?.touchType,srcType:e.type,target:s.target,view:e.view,preventDefault:()=>{"touchstart"!==e.type&&(0,l.preventDefault)(e)}}}}function p(e){return e.getBoundingClientRect()||{left:0,top:0}}function y(e){return{x:e.pageX,y:e.pageY}}function T(e,t){const s=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(s*s+i*i)}function E(e){return e.timeStamp||performance.now()}function g(e,t){for(let s=0;s<e.length;++s)if(e[s].identifier===t)return e[s];return null}},203723:(e,t,s)=>{s.d(t,{financialPeriodToShortString:()=>r,financialPeriodToString:()=>o});var i=s(650151),n=s(444372);function o(e){switch(e){case"FQ":return n.t(null,void 0,s(934673));case"FY":return n.t(null,void 0,s(984847));case"FH":return n.t(null,void 0,s(228727));case"TTM":return n.t(null,void 0,s(284634))}(0,i.ensureNever)(e)}function r(e){switch(e){case"FQ":return n.t(null,void 0,s(505581));case"FY":return n.t(null,void 0,s(560729));case"FH":return n.t(null,void 0,s(422740));case"TTM":return n.t(null,void 0,s(284634))}(0,i.ensureNever)(e)}},517241:(e,t,s)=>{function i(e,t,s){let i=e[`${t}#${s}`]||null;return null===i&&(i=e[t]||null),null===i&&Object.keys(e).forEach((s=>{null===i&&s.startsWith(`${t}#`)&&(i=e[s]||null)})),i}s.d(t,{getObsoleteIdeaSymbolInfo:()=>i})},576722:(e,t,s)=>{s.r(t),s.d(t,{StudyCompare:()=>B});var i=s(650151),n=s(597773),o=s(517241),r=s(756163),l=s(605071),u=s(388741),a=s(670770),h=s(905520),c=s(955722),d=s(931924),_=s(980057),m=s(597331),v=s(316250),b=s(534328);const p=d.enabled("force_exchange_as_title");class y extends m.PriceAxisView{constructor(e,t){
super(),this._studyCompare=e,this._data=t}_updateRendererData(e,t,s){e.visible=!1,t.visible=!1;const n=this._studyCompare.priceScale(),o=this._studyCompare.lastValueData(this._data.plotIndex,!1);if(o.noData||null===n||n.isEmpty())return;const r=this._studyCompare.model(),l=r.timeScale().visibleBarsStrictRange(),u=r.mainSeries().bars().lastIndex();if(null===l||null===u)return;if(u<=l.lastBar())s.background=(0,b.resetTransparency)(o.color),s.textColor=this.generateTextColor(s.background),s.borderColor=void 0,e.borderVisible=!1,t.borderVisible=!1;else{const n=r.backgroundColorAtYPercentFromTop(o.coordinate/(0,i.ensureNotNull)(r.paneForSource(this._studyCompare)).height());s.background=n,s.textColor=(0,b.resetTransparency)(o.color),s.borderColor=s.textColor,e.borderVisible=!0,t.borderVisible=!0}s.coordinate=o.coordinate,s.floatCoordinate=o.floatCoordinate;const a=r.properties().childs().scalesProperties.childs();a.showSeriesLastValue.value()&&(e.text=(0,v.getCurrentModePriceText)(n,o),a.seriesLastValueMode.value()!==_.PriceAxisLastValueMode.LastPriceAndPercentageValue?e.secondLine="":e.secondLine=(0,v.getOppositeModePriceText)(n,o),e.visible=!0),t.text="",a.showSymbolLabels.value()&&(t.text=this._paneText(),t.visible=t.text.length>0)}_paneText(){let e="";const t=this._studyCompare.symbolInfo();return p?e=(0,u.displayedSymbolExchange)(t):this._studyCompare.model().properties().childs().scalesProperties.childs().showSymbolLabels.value()&&(e=(0,u.displayedSymbolName)(t)),e}}var T=s(444372),E=s(844859),g=s(75618),f=s(87913),S=s(638456),C=s(529751),I=s(536794),M=s(816433);const P=S.CheckMobile.any();class k extends g.StudyValuesProvider{constructor(e,t){super(e,t),this._emptyValues[0].title=e.guiPlotName(M.TitleDisplayTarget.StatusLine,"")}getValues(e){return(0,I.isNumber)(e)||(this._showLastPriceAndChangeOnly()?e=this._study.data().lastIndex():(e=this._model.crosshairSource().appliedIndex(),(0,I.isNumber)(e)||(e=this._study.data().lastIndex()))),super.getValues(e)}_hideValues(){return!1}_showLastPriceAndChangeOnly(){return P&&(null===this._model.crosshairSource().pane||(0,C.isLineToolName)(f.tool.value())||null!==this._model.lineBeingEdited())}}class L extends E.StudyDataWindowView{constructor(e,t){super(e,t),this._studyCompare=e}_hideValues(){return!1}_createValuesProvider(e,t){return new k(e,t)}}var D=s(437642),w=s(326301);class x extends L{constructor(e,t){super(e,t),this._additional=null,this._showSeriesOHLC=t.properties().childs().paneProperties.childs().legendProperties.childs().showSeriesOHLC,this._showSeriesOHLC.subscribe(this,(()=>this.update((0,D.sourceChangeEvent)(e.id()))))}areValuesVisible(){return this._showSeriesOHLC.value()}destroy(){this._showSeriesOHLC.unsubscribeAll(this)}additional(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._additional}_updateImpl(){{const e=(0,w.getDataVendorString)(this._studyCompare.symbolInfo());this._additional=e?T.t(null,void 0,s(957131))+" "+e:null}super._updateImpl()}}var O=s(197860),V=s(191914),N=s(681240);class H extends N.StudyStatusProvider{
getSplitTitle(){return this._source.titleInParts(M.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)}text(){return this._source.isActualInterval()?this._source.isFailed()?`${this._source.title(M.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)}: ${this.sourceStatusText()}`:`${this._source.title(M.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)} ${this.sourceStatusText()}`:this._source.title(M.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)}}var A=s(616427),R=s(641208),F=s(288789);const Y=d.enabled("study_overlay_compare_legend_option"),W=d.enabled("force_exchange_as_title"),U=!d.enabled("hide_study_compare_legend_item"),X=d.enabled("hide_unresolved_symbols_in_legend");class B extends l.Study{constructor(e,t,s,i,o,r){super(e,function(e){return e.hasChild("currencyId")||e.addChild("currencyId",new h.Property(null)),e.hasChild("unitId")||e.addChild("unitId",new h.Property(null)),e.addExcludedKey("currencyId",1),e.addExcludedKey("unitId",1),e}(t),s,i,o,r),this._isActingAsSymbolSource=new n.WatchedValue(!0),this._realignToolsLastParams=null,this._lastResolvedSymbolSource="",this._symbolSourceWV=new n.WatchedValue(this),this.properties().childs().minTick.subscribe(null,(()=>this._recreatePriceFormattingDependencies())),this.properties().childs().minTick.subscribe(null,(()=>this._model.fullUpdate())),this.properties().childs().currencyId.subscribe(this,this._onCurrencyChanged),this.properties().childs().unitId.subscribe(this,this._onUnitChanged),this._symbolResolvingActive=new n.WatchedValue(!1),this._symbolHibernated=new n.WatchedValue(!1),e.mainSeries().onIntervalChanged().subscribe(this,(()=>e.realignLineTools(this))),this._symbolInfoWV=(0,F.createWVFromGetterAndSubscriptions)((()=>this.symbolInfo()),[this.symbolResolved(),this.onStatusChanged()])}destroy(){this._model.mainSeries().onIntervalChanged().unsubscribeAll(this),this._symbolInfoWV.destroy(),this._symbolSourceWV.destroy(),super.destroy()}properties(){return this._properties}isActingAsSymbolSource(){return this._isActingAsSymbolSource.readonly()}symbolParams(){return(0,A.symbolParams)(this)}compareSymbolParams(e){return(0,A.compareSymbolParams)(this,e,this._model.unitConversionEnabled())}async setSymbolParams(e){this._setSymbolCurrencyUnitInternal(e)}symbol(){return this.properties().childs().inputs.childs().symbol.value()}symbolOrAlias(){return this.symbol()}symbolChanged(){return this.properties().childs().inputs.childs().symbol}onSymbolIntervalChanged(){return this.symbolChanged()}setSymbol(e){this.setSymbolParams({symbol:e})}symbolInfo(){if(!this._resolvedSymbols)return null;const e=this.symbol();if(!e)return null;let t;return t=this._model.isSnapshot()?this._resolvedSymbols.___snapshot||null:this._resolvedSymbols[this._getSymbolForResolve(e)]||null,this._model.isSnapshot()&&null===t&&(t=(0,o.getObsoleteIdeaSymbolInfo)(this._resolvedSymbols,e,this.currency()),null!==t&&(this._resolvedSymbols.___snapshot=t)),t}symbolInfoWV(){return this._symbolInfoWV}aliasSymbolInfo(){return this.symbolInfo()}symbolResolved(){return this.symbolsResolved()}symbolResolvingActive(){
return this._symbolResolvingActive}symbolHibernated(){return this._symbolHibernated}isVisible(){const e=super.isVisible();return this._symbolHibernated.setValue(!e),e}symbolSameAsCurrent(e){return(0,A.symbolSameAsCurrent)(e,this.symbolInfo())}symbolSameAsResolved(e){return(0,R.symbolSameAsResolved)(e,this._lastResolvedSymbolSource,this.symbol())}currency(){return this.properties().childs().currencyId.value()||null}setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,u.isConvertedToOtherCurrency)(this.symbolInfo())}unit(){return this.properties().childs().unitId.value()||null}setUnit(e){this.setSymbolParams({unit:e})}isConvertedToOtherUnit(){return(0,u.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}style(){return 2}setStyle(e){}interval(){return this._model.mainSeries().interval()}setInterval(e){}symbolSource(){return this}symbolSourceWV(){return this._symbolSourceWV}valueAt(e,t){return this.data().search(e)?.value[1]??null}state(e,t){const s=super.state(e,t);this._model.unitConversionEnabled()||delete s.state.unitId;const n=this.symbol();return s.state.inputs.symbol=(0,u.symbolToSaveInState)(this.symbolInfo()??this._model.chartApi().lastSymbolResolveInfo(n),n),e&&((0,i.ensureDefined)(s.data).symbols={___snapshot:this.symbolInfo()||void 0}),s}symbolTitle(e,t,s){return this.title(e,!0,{},!1,t)}titleInParts(e,t,s,i,n){const o=this._titleInParts(e,t,s,i,n);return[[o[0],...o[1]??[]].join(", ")]}tags(){const e=this.symbol();return e?[e]:[]}statusView(){return U?super.statusView():null}guiPlotName(e,t){return this.properties().childs().inputs.childs().symbol.value()}canOverrideMinTick(){return!0}canBeHiddenByGlobalFlag(){return!1}legendValuesProvider(){return new k(this,this.model())}statusProvider(e){return new H(this)}measureUnitId(){return(0,u.measureUnitId)(this.symbolInfo())}getSymbolString(e){return void 0===e&&(e=this._getSymbolForApi(this.symbol())),(0,c.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject(e))}_createPriceAxisView(e){return new y(this,{plotIndex:"compare"})}_createViews(){this._legendView||(this._legendView=new x(this,this._model)),this._dataWindowView||(this._dataWindowView=new L(this,this._model)),this._statusView||(this._statusView=new O.StudyStatusView(this)),super._createViews()}_onUnitChanged(){"alwaysOff"!==(0,r.currencyUnitVisibilityProperty)().value()&&this._model.fullUpdate(),this._model.unitConversionEnabled()&&this.isStarted()&&this._tryChangeInputs(),this._unitChanged.fire()}_getSymbolObject(e){const t=super._getSymbolObject(e),s=this.currency();null!==s&&(t["currency-id"]=s);const i=this.unit();return this._model.unitConversionEnabled()&&null!==i&&(t["unit-id"]=i),t}_onSymbolResolvingStart(e,t){this._lastResolvedSymbolSource=t,super._onSymbolResolvingStart(e,t),this._symbolResolvingActive.setValue(!0)}_onSymbolError(){super._onSymbolError(),this._symbolResolvingActive.setValue(!1)}_onSymbolResolved(e,t,s){super._onSymbolResolved(e,t,s),this._recreatePriceFormattingDependencies()
;const i=t===this.symbol()?(0,a.extractSymbolNameFromSymbolInfo)(s,this.symbol()):null,n=(0,u.symbolCurrency)(s),o=(0,u.symbolUnit)(s,this._model.unitConversionEnabled());this._setSymbolCurrencyUnitInternal({symbol:i??void 0,currency:n,unit:o},s),this._symbolResolvingActive.setValue(!1)}async _changeInputsImpl(e,t){await super._changeInputsImpl(e,t),this._realignLineToolsIfParamsChanged()}_createStudyOnServer(){const e=super._createStudyOnServer();return this._realignLineToolsIfParamsChanged(),e}_tryCreateFormatter(){V.customFormatters?.priceFormatterFactory?.(this.symbolInfo(),this.properties().childs().minTick.value());return(0,u.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value())}_tryCreateDefaultFormatter(){return(0,u.createSeriesFormatter)(this.symbolInfo(),"default")}_titleInParts(e,t,s,i,n){const o=this.symbolInfo();return[this._getSymbolTitlePart(o),[this._getExchangeTitlePart(o,n),this._getPriceSourceTitlePart(o)].filter((e=>null!==e))]}_skipHistogramBaseOnAutoScale(){return!0}_getSymbolTitlePart(e){if(null===e)return X?"":this.properties().childs().inputs.childs().symbol.value();const t=(0,u.getSymbolListedExchange)(e);if(W&&void 0!==t)return t;if(Y)switch(this._model.mainSeries().symbolTextSourceProxyProperty().value()){case"description":return e.description;case"ticker-and-description":return`${e.name}, ${e.description}`;case"long-description":return e.long_description??e.description}return e.name}_getExchangeTitlePart(e,t){return null===e||t?null:(0,u.getSymbolListedExchange)(e)}_getPriceSourceTitlePart(e){return null}_setSymbolCurrencyUnitInternal(e,t){const{symbol:s,currency:i,unit:n}=e,o=this.properties().childs(),r=o.inputs.childs().symbol.value(),l=o.currencyId.value(),a=o.unitId.value();if(void 0!==s&&o.inputs.childs().symbol.setValueSilently(s),void 0!==i&&o.currencyId.setValueSilently(i),void 0!==n&&o.unitId.setValueSilently(n),t)this._resolvedSymbolsByInput[this.symbol()]=t,this._resolvedSymbols[this._getSymbolForResolve(this.symbol())]=t,this._realignToolsLastParams=null;else{const e=this.symbolInfo();null!==e&&(o.currencyId.setValueSilently((0,u.symbolCurrency)(e)),o.unitId.setValueSilently((0,u.symbolUnit)(e,this._model.unitConversionEnabled())))}o.inputs.childs().symbol.value()!==r&&o.inputs.childs().symbol.fireChanged(),o.currencyId.value()!==l&&o.currencyId.fireChanged(),o.unitId.value()!==a&&o.unitId.fireChanged(),this._realignLineToolsIfParamsChanged()}_realignLineToolsIfParamsChanged(){let e=null===this._realignToolsLastParams;if(null!==this._realignToolsLastParams){const t=this.compareSymbolParams(this._realignToolsLastParams);e=t.symbolChanged||t.intervalChanged||t.currencyChanged||t.unitChanged}e&&(this._model.realignLineTools(this),this._realignToolsLastParams=this.symbolParams())}}},641208:(e,t,s)=>{function i(e,t,s){return e===t||e===s}s.d(t,{symbolSameAsResolved:()=>i})}}]);