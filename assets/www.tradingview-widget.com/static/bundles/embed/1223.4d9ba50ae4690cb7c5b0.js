(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[1223],{122916:e=>{e.exports={"tablet-small-breakpoint":"(max-width: 440px)",item:"item-npzLuYLS",shortcut:"shortcut-npzLuYLS",loading:"loading-npzLuYLS",icon:"icon-npzLuYLS"}},901223:(e,t,a)=>{"use strict";a.r(t),a.d(t,{getToolSet:()=>V});var n=a(931924),o=a(50959),r=a(6295),i=a(444372),l=a(55629),s=a(604286),c=a(470316),d=a(625923);const u=(0,s.hotKeySerialize)({keys:[(0,c.humanReadableModifiers)(c.Modifiers.Alt,!1),"A"],text:"{0} + {1}"});function m(e){return o.createElement(l.ToolbarCollapsibleButton,{...e,icon:d,text:i.t(null,void 0,a(711774)),tooltip:i.t(null,void 0,a(603411)),isOpened:e.isOpened,"data-tooltip-hotkey":u})}function p(){(0,r.showGoToTradingViewReferralDialog)({feature:"alerts"})}function h(e){return o.createElement(m,{...e,onClick:p})}var g=a(286973);function w(){(0,r.showGoToTradingViewReferralDialog)({feature:"saveload"})}function b(e){return o.createElement(g.ToolWidgetSaveLoadView,{...e,isAuthenticated:!1,isProcessing:!1,wasChanges:!0,hideMenu:!0,onSaveChart:w})}var _=a(841945),f=a(497754),v=a(634993),E=a(224743),y=a(995683),S=a(554676),k=a(640027),T=a(184981),C=a(676864),M=a(125226),L=a(122916);const B=(0,y.mergeThemes)(v.DEFAULT_POPUP_MENU_ITEM_THEME,L);function P(e,t){window.parent!==window&&window.parent.postMessage({name:e,detail:t},"*")}function A(e){return Boolean(e.chartWidget.model)}const F=(0,M.isFeatureEnabled)("telegram_mini_app_share_snapshot_use_fallback");function N(e){const{serverSnapshot:t,clientSnapshot:n}=e,[r,l]=(0,o.useState)(!1),s=(0,k.useIsMounted)(),c=(0,o.useCallback)((async()=>{if(!A(window))return;const e=window.chartWidget.model().mainSeries(),t=e.quotes();if(!t)throw new Error("Quotes data missing for telegram message");P("telegram-share-last-price",{currency:t.currency_code||"",symbolName:e.getSymbolName(),lastPrice:t.last_price,lastPriceTime:t.lp_time,symbol:t["symbol-primaryname"]??e.getSymbolName(),interval:e.interval()||"1"})}),[]),d=(0,o.useCallback)((async()=>{try{const e=await new Promise((e=>{try{const t=document.createElement("canvas");if(t.width=1,t.height=1,!t.toBlob)return void e(!1);t.toBlob((t=>{e(Boolean(t&&"image/jpeg"===t.type))}),"image/jpeg")}catch{e(!1)}}));if(F||!e){return P("telegram-share-snapshot",await t()),!0}if(!A(window))return!1;const a=window.chartWidget.model().mainSeries().getSymbolName(),o=await n(),r=(0,M.isFeatureEnabled)("telegram_mini_app_reduce_snapshot_quality")?.3:.8,i=await async function(e,t=.8){return new Promise(((a,n)=>{e.toBlob((e=>{if(null===e)return void n(new Error("Failed to create Blob"));const t=new FileReader;t.onloadend=async()=>{try{const e=t.result;if("string"!=typeof e)throw new Error("Unexpected reader result");const n=e.split(",")[1];a(n)}catch(e){n(e)}},t.onerror=()=>{n(new Error("Failed to read blob as data URL"))},t.readAsDataURL(e)}),"image/jpeg",t)}))}(o.canvas,r);return P("telegram-share-snapshot-base64",{content:i,symbol:a}),!0}finally{s.current&&(l(!1),(0,E.globalCloseMenu)())}}),[t,n])
;return o.createElement(o.Fragment,null,o.createElement(C.ToolWidgetMenuSummary,null,i.t(null,void 0,a(594416))),!(0,M.isFeatureEnabled)("telegram_mini_app_disable_share_snapshot")&&o.createElement(T.AccessibleMenuItem,{role:"row","data-name":"share-chart-image",label:o.createElement(S.LabelWithLoader,{isLoading:r},i.t(null,void 0,a(218617))),onClick:()=>{l(!0),d()},dontClosePopup:!0,isDisabled:r,shortcut:void 0,className:f(r&&L.loading),theme:B}),!(0,M.isFeatureEnabled)("telegram_mini_app_disable_share_last_price")&&o.createElement(T.AccessibleMenuItem,{role:"row","data-name":"share-last-price",label:i.t(null,void 0,a(173449)),onClick:c,shortcut:void 0,theme:B}))}var R=a(721270),x=a(305014),z=a(642709),W=a(314802);const D=(0,M.isFeatureEnabled)("telegram_mini_app_share_snapshot_use_fallback");function U(e){const[t,a]=(0,o.useState)(!1),n=(0,k.useIsMounted)(),r=(0,o.useCallback)((async()=>{a(!0),D?await e.serverSnapshot():await e.clientSnapshot(),n.current&&a(!1)}),[e.serverSnapshot,e.clientSnapshot]);return o.createElement(x.ToolWidgetButton,{id:e.id,className:e.className,isDisabled:t,onClick:r,title:e.tooltip,icon:e.icon})}var I=a(356943),O=a(958362);const Y=(0,_.bindScreenshot)((function(e){return(0,W.isOnMobileAppPage)("any")?o.createElement(U,{...e,icon:O}):o.createElement(R.ToolbarMenuButton,{content:o.createElement(x.ToolWidgetButton,{tag:"div",id:e.id,className:e.className,icon:O}),drawerPosition:"Bottom",drawerBreakpoint:z.DialogBreakpoints.TabletSmall,arrow:!1,onClick:function(){(0,I.trackButtonClick)("top toolbar","telegram share")},tooltip:e.tooltip,menuRole:"grid"},o.createElement(N,{...e}))}));var j=a(794618);function V(){return{...(0,j.getRestrictedToolSet)(),AlertReferral:n.enabled("header_fake_features_buttons")?h:void 0,SaveLoadReferral:n.enabled("header_fake_features_buttons")?b:void 0,TelegramShare:n.enabled("header_telegram_share")?Y:void 0}}},958362:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" fill-rule="evenodd" d="M21 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0zm1 0a3.5 3.5 0 0 1-6.21 2.21l-4.06 2.44a3.49 3.49 0 0 1 0 2.7l4.06 2.44a3.5 3.5 0 1 1-.52.86l-4.06-2.44a3.5 3.5 0 1 1 0-4.42l4.06-2.44A3.49 3.49 0 0 1 18.5 5 3.5 3.5 0 0 1 22 8.5zm-1 12a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0zM8.5 17a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"/></svg>'}}]);