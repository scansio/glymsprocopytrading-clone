"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[66368],{526664:(t,e,o)=>{o.d(e,{leftColumnAreaLeftRight:()=>c,rightColumnAreaLeftRight:()=>m,rowTopBottom:()=>n,summaryArea2ColumnsLeftRight:()=>p,totalAreaLeftRight:()=>d,volumeFootprintCoordinateSpace:()=>f});var i,r=o(610555),a=o(660439),l=o(489724);function n(t,e,o,r,a){const l=Math.round(t.priceToCoordinate(r+o,e)*a.verticalPixelRatio),n=Math.round(t.priceToCoordinate(r,e)*a.verticalPixelRatio),s=Math.max(i.LevelsSpacing,Math.floor(i.LevelsSpacing*a.verticalPixelRatio));return{top:Math.min(l,n),bottom:Math.max(l,n)-s}}function s(t,e,o,r){const a=Math.round(t.priceToCoordinate(o,e)*r.verticalPixelRatio);return{top:a-Math.max(i.LevelsSpacing,Math.floor(i.LevelsSpacing*r.verticalPixelRatio)),bottom:a}}function u(t,e){const o=t.right-t.left;return{center:Math.round(t.center*e.horizontalPixelRatio),columnWidth:Math.round(o*i.ColumnSpace*e.horizontalPixelRatio),offset:Math.round(o*i.CandleSpace*.5*e.horizontalPixelRatio)}}function c(t,e){const o=u(t,e),i=o.center-o.columnWidth-o.offset;return{left:i,right:i+o.columnWidth}}function m(t,e){const o=u(t,e),i=o.center+o.offset+1;return{left:i,right:i+o.columnWidth}}function d(t,e){const o=u(t,e),i=o.center+o.offset+1;return{left:i,right:i+2*o.columnWidth}}function p(t,e){const o=u(t,e);return{left:o.center-o.columnWidth-o.offset,right:o.center+o.offset+1+o.columnWidth}}!function(t){t[t.ColumnSpace=.35]="ColumnSpace",t[t.CandleSpace=.2]="CandleSpace",t[t.SummaryOffset=5]="SummaryOffset",t[t.LevelsSpacing=1]="LevelsSpacing",t[t.ImbalanceLevelOffset=1]="ImbalanceLevelOffset",t[t.ImbalanceLevelWidth=3]="ImbalanceLevelWidth",t[t.ImbalanceLevelVisibilityMinBarWidth=10]="ImbalanceLevelVisibilityMinBarWidth",t[t.LevelTitlesVisibilityMinBarWidth=330]="LevelTitlesVisibilityMinBarWidth"}(i||(i={}));const h=({min:t,max:e},o)=>Math.round((e.x-t.x)*o);function f(t){const{timeScale:e,priceScale:o,volumeFootprint:f,rowSize:S,firstValue:g,bar:v,pixelRatioInfo:x,volumeFootprintType:b}=t,[w,y]=(0,a.minMax)([v[3],...(0,a.calculateMinMax)(f.levels,(t=>t.price))]);let V,M;switch(b){case l.VolumeFootprintTypeValues.BuyAndSell:case l.VolumeFootprintTypeValues.Ladder:V=c,M=m;break;default:V=d,M=d}const _=e.barBorders(f.index),C=_.right-_.left,F=t=>{const{left:e,right:i}=V(_,x),{top:a,bottom:l}=n(o,g,S,t,x);return(0,r.box)((0,r.point)(e,a),(0,r.point)(i,l))},R=t=>{const{left:e,right:i}=M(_,x),{top:a,bottom:l}=n(o,g,S,t,x);return(0,r.box)((0,r.point)(e,a),(0,r.point)(i,l))},T=(0,r.point)(5*x.horizontalPixelRatio,0);return{leftRowAreaBox:F,rightRowAreaBox:R,percentLeftRowAreaBox:(t,e)=>{const o=F(t),{min:i,max:a}=o;return(0,r.box)((0,r.point)(a.x-h(o,e),i.y),a)},percentRightRowAreaBox:(t,e,o=!1)=>{const i=o?(t=>{const{min:e,max:o}=t;return(0,r.box)(e.add(T),o)})(R(t)):R(t),{min:a,max:l}=i;return(0,r.box)(a,(0,r.point)(a.x+h(i,e),l.y))},levelBox:t=>{const e=V(_,x),i=M(_,x),{top:a,bottom:l}=s(o,g,t,x);return(0,r.box)((0,r.point)(e.left,a),(0,r.point)(i.right,l))},profileTotalLevelBox:t=>{
const e=c(_,x),i=d(_,x),{top:a,bottom:l}=s(o,g,t,x);return(0,r.box)((0,r.point)(e.right,a),(0,r.point)(i.right,l))},showLevelTitles:()=>C>=i.LevelTitlesVisibilityMinBarWidth,summaryArea2ColumnsMode:()=>{const t=n(o,g,S,w,x),e=n(o,g,S,y,x),a=Math.max(t.bottom,e.bottom),{left:l,right:s}=p(_,x);return{box:(0,r.box)((0,r.point)(l,a),(0,r.point)(s,a+(t.bottom-t.top))),marginTop:Math.round(i.SummaryOffset*x.verticalPixelRatio)}},summaryArea1ColumnMode:()=>{const t=n(o,g,S,w,x),e=n(o,g,S,y,x),a=Math.max(t.bottom,e.bottom),{left:l,right:s}=function(t,e){const o=u(t,e),i=2*o.columnWidth;return{left:o.center-o.offset,right:o.center+o.offset+1+i}}(_,x);return{box:(0,r.box)((0,r.point)(l,a),(0,r.point)(s,a+(t.bottom-t.top))),marginTop:Math.round(i.SummaryOffset*x.verticalPixelRatio)}},imbalanceBox:(t,e,a=!0)=>{if(C<i.ImbalanceLevelVisibilityMinBarWidth)return null;const l="left"===e?V(_,x):M(_,x),{top:s,bottom:u}=n(o,g,S,t,x),c=Math.max(i.ImbalanceLevelOffset,Math.floor(i.ImbalanceLevelOffset*x.horizontalPixelRatio)),m=Math.round(i.ImbalanceLevelWidth*x.horizontalPixelRatio),d="left"===e,p=(a?d:!d)?l.left-c-m:l.right+c;return(0,r.box)((0,r.point)(p,s),(0,r.point)(p+m,u))},correctImbalanceBox:t=>{const{min:e,max:o}=t;return(0,r.box)(e.add(T),o.add(T))}}}},766368:(t,e,o)=>{o.r(e),o.d(e,{VolumeFootprintStudy:()=>V,createVolumeFootprintStudy:()=>M});var i=o(650151),r=o(870855),a=o(37241),l=o(340993),n=o(87347),s=o(605071),u=o(519073),c=o(813232),m=o(790188),d=o(51196),p=o(746142),h=o(489724),f=o(526664),S=o(414986),g=o(580089);const v={positiveDeltaColor:(0,m.getHexColorByName)("color-minty-green-500"),negativeDeltaColor:(0,m.getHexColorByName)("color-ripe-red-500")};class x extends S.SummaryPaneView{constructor(t,e){super(t,e)}_cutOffLastColumn(){return!0}_getDataSourceForSummary(){return this._model.dataSourceForId(g.volumeFootpringSummaryDataSourceId)}_getSummaryColumnRendererData(t,e){const o=this._study.graphics(),i=this._model.timeScale(),r=this._study.firstValue(),a=this._study.priceScale();if(null===r||null===a)return null;const l=this._study.isFuture(),n=this._model.mainSeries().properties().childs().volFootprintStyle.childs(),s=n.type.value(),u=n.extendedSummary.childs().blockInfo.childs(),m=new d.VolumeFormatter,S=this._model.mainSeries().formatter(),g=t=>S.format(t),x=s===h.VolumeFootprintTypeValues.BuyAndSell||s===h.VolumeFootprintTypeValues.Ladder;let b;if(x){const e=i.barBorders(0),o=i.barBorders(1),r=(0,f.rightColumnAreaLeftRight)(e,t),a=(0,f.leftColumnAreaLeftRight)(o,t);b=Math.round((a.left-r.right)/2)}else b=0;const w=i.barSpacing(),y=new p.LogicalRange(e.left()-5,e.right()+5),V=[];let M;return o.footprints().forEach((e=>{e.forEach((e=>{if(!y.contains(e.index))return;const o=e.summary,r=(0,c.default)(e.levels.map((t=>t.sellVolume))),a=(0,c.default)(e.levels.map((t=>t.buyVolume))),s=a+r,d=[];if(u.volume.childs().visible.value()&&d.push({text:m.format(s)}),u.volumePercentage.childs().visible.value()&&d.push({text:void 0!==M?g((s-M)/M*100):"—"}),u.buyVolume.childs().visible.value()&&d.push({text:m.format(a)}),
u.buyVolumePercentage.childs().visible.value()&&d.push({text:g(a/s*100)}),u.sellVolume.childs().visible.value()&&d.push({text:m.format(r)}),u.sellVolumePercentage.childs().visible.value()&&d.push({text:g(r/s*100)}),u.delta.childs().visible.value()){const t=a-r;d.push({text:g(t),backgroundColor:t>=0?v.positiveDeltaColor:v.negativeDeltaColor})}if(u.deltaPercentage.childs().visible.value()){const t=(a-r)/s*100;d.push({text:g(t),backgroundColor:t>=0?v.positiveDeltaColor:v.negativeDeltaColor})}if(u.minDelta.childs().visible.value()&&(o?d.push({text:g(o.minDelta),backgroundColor:o.minDelta>=0?v.positiveDeltaColor:v.negativeDeltaColor}):d.push({text:"—"})),u.maxDelta.childs().visible.value()&&(o?d.push({text:g(o.maxDelta),backgroundColor:o.maxDelta>=0?v.positiveDeltaColor:v.negativeDeltaColor}):d.push({text:"—"})),u.sessionCVD.childs().visible.value()&&d.push({text:o?m.format(o.sessionCVD):"—"}),u.pocPrice.childs().visible.value()&&d.push({text:g(e.poc)}),u.hlRange.childs().visible.value()&&d.push({text:o?.highLowRange?g(o.highLowRange):"—"}),l){const t=n.extendedSummary.childs().futuresBlockInfo.childs();t.openInterestHigh.childs().visible.value()&&d.push({text:o?.openInterestHigh?g(o.openInterestHigh):"—"}),t.openInterestLow.childs().visible.value()&&d.push({text:o?.openInterestLow?g(o.openInterestLow):"—"})}const p=(e=>{const o=i.barBorders(e);return x?(0,f.summaryArea2ColumnsLeftRight)(o,t):{left:o.center*t.horizontalPixelRatio,right:(o.center+w)*t.horizontalPixelRatio}})(e.index);V.push({left:p.left-b,right:p.right+b,rows:d}),M=s}))})),V}}var b=o(304550),w=o(700503);class y extends b.SummaryWidgetSideAreaView{_getDataSourceForSummary(){return this._model.dataSourceForId(g.volumeFootpringSummaryDataSourceId)}_visibleTitles(){const t=[],e=(0,i.ensureNotNull)(this._getDataSourceForSummary()),o=this._model.mainSeries().properties().childs().volFootprintStyle.childs().extendedSummary.childs();return t.push(...w.baseVolumeFootprintRowTitles.filter((t=>o.blockInfo.childs()[t.propName].childs().visible.value())).map((t=>t.translatedString.translatedText()))),e.isFuture()&&t.push(...w.futureVolumeFootprintRowTitles.filter((t=>o.futuresBlockInfo.childs()[t.propName].childs().visible.value())).map((t=>t.translatedString.translatedText()))),t}}class V extends s.Study{constructor(t,e,o,i,r,a,l=!1){super(t,e,o,i,r,a),this._rowSize=.1,this._chartStyleMode=l,this._summaryPaneView=new x(this,t),this._widgetSideAreaView=new y(t)}rowSize(){return this._rowSize}isFuture(){return(0,u.isFutures)(this._model.mainSeries().symbolInfo()?.type??"")}paneViews(t){return this._chartStyleMode?t!==this._model.mainPane()?[this._summaryPaneView]:this._paneViews:super.paneViews(t)}updateAllViews(t){super.updateAllViews(t),this._summaryPaneView.update(),this._widgetSideAreaView.update()}widgetSideAreaViews(t){const e=this._model.mainSeries().priceScale();if(!e)return null;const o=this._model.mainPane();if(!o)return null;const i=o.priceScalePosition(e);return this._chartStyleMode&&t===i?[this._widgetSideAreaView]:null}priceScale(){
return this._chartStyleMode?this._model.mainSeries().priceScale():super.priceScale()}firstValue(){return this._model.mainSeries().firstValue()}stateCustomFields(){return{rowSize:this._rowSize}}restoreStateCustomFields(t){this._rowSize=t.rowSize??this._rowSize}_fillPrecalculatedAutoscaleInfo(t,e,o){const i=(0,s.emptyPrecalculatedAutoscaleInfo)(),r=this._rowSize;if(null===r)return i;const a=this.model().mainSeries().bars().minMaxOnRange(t,e,[{name:"low",offset:0},{name:"high",offset:0}]);if(!a)return i;const{min:l,max:n}=a;let u=Math.floor(l/r)*r;if(this.model().mainSeries().properties().childs().volFootprintStyle.childs().showSummary.value()){const t=this.model().timeScale().barSpacing(),e=this.model().mainSeries().priceScale().priceToCoordinate(u,this.model().mainSeries().firstValue()||0);u=this.model().mainSeries().priceScale().coordinateToPrice(e+Math.floor(.4*t),this.model().mainSeries().firstValue()||0)}return{...i,baseValueMinMax:{min:u,max:Math.ceil(n/r)*r}}}_onDataUpdated(t,e,o,i){super._onDataUpdated(t,e,o,i),e?.indexes_replace||(this._rowSize=(e?.data).rowSize??this._rowSize)}}async function M(t){const e=(0,i.ensureDefined)(r.SYMBOL_STRING_DATA[17]),o=await(0,n.studyMetaInfoRepository)().findById({type:"java",studyId:e.type}),s=(0,a.prepareStudyProperties)(o,{},null,(0,n.studyMetaInfoRepository)().studyVersioning(),[]);return(0,l.addStudyInfoToMap)("study_VolumeFootprint",{studyConstructor:V,colorRotationMode:"shift"}),new V(t,s,[],o,o,!1,!0)}},700503:(t,e,o)=>{o.d(e,{baseVolumeFootprintRowTitles:()=>b,futureVolumeFootprintRowTitles:()=>w});var i=o(378338),r=o(418450);const a=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(124608)),l=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(656990)),n=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(939323)),s=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(318071)),u=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(39449)),c=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(379600)),m=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(721223)),d=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(70858)),p=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(23710)),h=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(951885)),f=i.t(null,{context:"VolumeFootprint bar statistic row title, abbr cumulative delta"},o(597985)),S=i.t(null,{context:"VolumeFootprint bar statistic row title, abbr Point of control"},o(864817)),g=i.t(null,{context:"VolumeFootprint bar statistic row title, high-low range"},o(543160)),v=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(561227)),x=i.t(null,{context:"VolumeFootprint bar statistic row title"},o(8909)),b=[{translatedString:new r.TranslatedString("Volume",a),propName:"volume"},{translatedString:new r.TranslatedString("Volume change, %",l),propName:"volumePercentage"},{translatedString:new r.TranslatedString("Buy volume",n),propName:"buyVolume"},{
translatedString:new r.TranslatedString("Buy volume, %",s),propName:"buyVolumePercentage"},{translatedString:new r.TranslatedString("Sell volume",u),propName:"sellVolume"},{translatedString:new r.TranslatedString("Sell volume, %",c),propName:"sellVolumePercentage"},{translatedString:new r.TranslatedString("Delta",m),propName:"delta"},{translatedString:new r.TranslatedString("Delta, %",d),propName:"deltaPercentage"},{translatedString:new r.TranslatedString("Min delta",p),propName:"minDelta"},{translatedString:new r.TranslatedString("Max delta",h),propName:"maxDelta"},{translatedString:new r.TranslatedString("Session CVD",f),propName:"sessionCVD"},{translatedString:new r.TranslatedString("POC",S),propName:"pocPrice"},{translatedString:new r.TranslatedString("HL Range",g),propName:"hlRange"}],w=[{translatedString:new r.TranslatedString("Open interest high",v),propName:"openInterestHigh"},{translatedString:new r.TranslatedString("Open interest low",x),propName:"openInterestLow"}]},813232:(t,e,o)=>{o.d(e,{default:()=>a});const i=function(t,e){for(var o,i=-1,r=t.length;++i<r;){var a=e(t[i]);void 0!==a&&(o=void 0===o?a:o+a)}return o};var r=o(876402);const a=function(t){return t&&t.length?i(t,r.default):0}}}]);