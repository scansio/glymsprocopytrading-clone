"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[80234],{846778:(e,t,i)=>{i.d(t,{showPasteLineToolHint:()=>h});var r=i(444372),s=i(62802),n=i(638456),o=i(470316),l=i(931924);const a=r.t(null,void 0,i(815402)),c=5e3;function h(e,t){l.enabled("popup_hints")&&!n.CheckMobile.any()&&Promise.all([i.e(46195),i.e(50628),i.e(82321),i.e(26166)]).then(i.bind(i,410837)).then((i=>{const r=new i.ChartEventHintRenderer(e),n=a.format({shortcut:(0,o.humanReadableHash)(o.Modifiers.Mod+86)});let l=null;r.show(n,(()=>{null!==l&&(clearTimeout(l),l=null,s.setValue(t,!0,{forceFlush:!0}))})),l=setTimeout((()=>{l=null,r.hide()}),c)}))}},323348:(e,t,i)=>{i.d(t,{trackChartDrawingCreation:()=>s});var r=i(776734);function s(e,t){(0,r.getTracker)().then((i=>{i&&i.trackChartDrawingCreation(e,t)}))}},454546:(e,t,i)=>{i.d(t,{trackDrawingToolSelected:()=>c});var r=i(529751),s=i(87913),n=i(776734),o=i(584878),l=i(147582);const a="DrawingToolSelected";function c(e,t){void 0!==t&&function(e){return(0,r.isStudyLineToolName)(e)||(0,r.isLineToolName)(e)||(0,s.toolIsCursor)(e)||(0,s.toolIsEraser)(e)||(0,s.toolIsMeasure)(e)}(e)&&(0,o.shouldAffectUser)(a,l.sparseUsersTrackingCoefficient)&&(0,n.getTracker)().then((i=>{i&&(e="performance"===e?"magic":e,i.trackDrawingToolSelected(e,t))}))}},581393:(e,t,i)=>{i.d(t,{ActionDelegate:()=>s});var r=i(547465);class s extends r.Delegate{constructor(e){super(),this._onStartListening=null,this._onStopListening=null,this._onStartListening=e||null}subscribe(e,t,i){const r=0===this._listeners.length;super.subscribe(e,t,i),r&&this._listeners.length>0&&this._onStartListening&&(this._onStopListening=this._onStartListening())}unsubscribe(e,t){const i=0===this._listeners.length;super.unsubscribe(e,t),!i&&0===this._listeners.length&&this._onStopListening&&(this._onStopListening(),this._onStopListening=null)}unsubscribeAll(e){const t=0===this._listeners.length;super.unsubscribeAll(e),!t&&0===this._listeners.length&&this._onStopListening&&(this._onStopListening(),this._onStopListening=null)}destroy(){this._onStopListening&&(this._onStopListening(),this._onStopListening=null),super.destroy()}}},127504:(e,t,i)=>{i.d(t,{alignToStep:()=>n});var r=i(960521),s=i.n(r);function n(e,t){return s()(e).div(t).round(0,s().roundHalfUp).mul(t).toNumber()}},632567:(e,t,i)=>{i.d(t,{LimitedPrecisionNumericFormatter:()=>s});var r=i(808708);class s{constructor(e,t){this._precision=e??1,this._numericFormatter=new r.NumericFormatter({precision:this._precision,ignoreLocaleNumberFormat:t})}format(e,t){const i=e.toFixed(this._precision),r=Math.pow(10,-this._precision);return this._numericFormatter.format(Math.max(parseFloat(i),r),t)}parse(e,t){const i=this._numericFormatter.parse(e,t);return i.res?{res:!0,value:i.value,suggest:this.format(i.value)}:i}}},102014:(e,t,i)=>{var r;i.d(t,{CreateLineToolSyncMode:()=>r}),function(e){e[e.Default=0]="Default",e[e.ForceOn=1]="ForceOn",e[e.ForceOff=2]="ForceOff"}(r||(r={}))},91666:(e,t,i)=>{i.d(t,{LevelsProperty:()=>P});var r=i(154834),s=i(998034),n=i(536794),o=i(890390),l=i(85858)
;const a={prefixes:[""],range:[0,0],names:["coeff","color","visible","linestyle","linewidth"],typecheck:{pack:()=>Object(),unpack:()=>[]}};function c(e,t,i,r){return r.push(i[t]),r}function h(e,t,i,r){return r[t]=i[e],r}function u(){return[]}function d(){return{}}function p(e,t,i){return i.prefixes.forEach((r=>{const s=r+"level";for(let r=i.range[0];r<=i.range[1];r++)if(e[s+r]&&(0,n.isSameType)(e[s+r],t.typecheck())){let n=t.tpl();i.names.forEach(((i,o)=>{n=t.fill(""+o,i,e[s+r],n)})),e[s+r]=n}})),e}function _(e,t,i){return i(e,{tpl:d,fill:h,typecheck:t.typecheck.unpack},t)}class P extends o.DefaultProperty{constructor(e){const{levelsIterator:t=p,map:i={},...r}=e,s={...a,...i};r.state&&(r.state=_(r.state,s,t)),super(r),this._map=s,this._levelsIterator=t}state(e,t,i){const r=super.state(e,t);return i?r:(s=r,n=this._map,(0,this._levelsIterator)(s,{tpl:u,fill:c,typecheck:n.typecheck.pack},n));var s,n}preferences(){return(0,o.extractState)(this.state(this._excludedDefaultsKeys,void 0,!0),this._allDefaultsKeys)}applyTemplate(e,t){this.mergeAndFire((0,o.extractState)((0,s.default)((0,r.default)(t),_(e,this._map,this._levelsIterator)),this._allStateKeys,this._excludedTemplateKeys))}saveDefaults(){this._useUserPreferences&&(0,l.saveDefaults)(this._defaultName,this.preferences())}clone(){return new P(this._options())}merge(e,t){return super.merge(this._map?_(e,this._map,this._levelsIterator):e,t)}_options(){return{...super._options(),map:{...this._map},levelsIterator:this._levelsIterator}}}},349811:(e,t,i)=>{i.d(t,{LineToolBrushBase:()=>o});var r=i(650151),s=i(318945),n=i(820028);class o extends s.LineDataSource{constructor(){super(...arguments),this._hasEditableCoordinates=new n.WatchedValue(!1),this._finished=!1}pointsCount(){return-1}finished(){return this._finished}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}hasOnlyOnePoint(){return 1===this._points.length}addPoint(e,t,i){if(this._finished)return!0;if(this._lastPoint=null,this._points.length>0){const t=this._points[this._points.length-1],i=(0,r.ensureNotNull)(this.pointToScreenPoint(t));if((0,r.ensureNotNull)(this.pointToScreenPoint(e)).subtract(i).length()<2)return this._finished}return super.addPoint(e),this._finished}restorePoints(e,t,i){super.restorePoints(e,t,i),this._finished=!0}}},740875:(e,t,i)=>{i.d(t,{LineToolElliott:()=>p,LineToolElliottCorrection:()=>x,LineToolElliottDoubleCombo:()=>T,LineToolElliottImpulse:()=>g,LineToolElliottTriangle:()=>f,LineToolElliottTripleCombo:()=>v});var r=i(444372),s=i(418450),n=i(318945),o=i(172073),l=i(890390),a=i(702067),c=i(472354);const h=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],u=new s.TranslatedString("change Elliott degree",r.t(null,void 0,i(547977))),d=[{value:0,title:r.t(null,void 0,i(203348))},{value:1,title:r.t(null,void 0,i(487957))},{value:2,title:r.t(null,void 0,i(863375))},{value:3,title:r.t(null,void 0,i(357726))},{value:4,title:r.t(null,void 0,i(467948))},{value:5,title:r.t(null,void 0,i(787380))},{value:6,title:r.t(null,void 0,i(259189))},{value:7,
title:r.t(null,void 0,i(410268))},{value:8,title:r.t(null,{context:"wave"},i(651077))},{value:9,title:r.t(null,{context:"wave"},i(200922))},{value:10,title:r.t(null,void 0,i(214724))},{value:11,title:r.t(null,void 0,i(230585))},{value:12,title:r.t(null,void 0,i(324866))},{value:13,title:r.t(null,void 0,i(201145))},{value:14,title:r.t(null,void 0,i(78273))}];class p extends n.LineDataSource{constructor(e,t,r,s){super(e,t??p.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=4,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,84801)).then((e=>{this._setPaneViews([new e.ElliottLabelsPaneView(this,this._model)])}))}migrateVersion(e,t,i){if(i.properties.hasChild("background")&&i.properties.removeProperty("background"),i.properties.hasChild("backgroundColor")&&i.properties.removeProperty("backgroundColor"),i.properties.hasChild("showBackground")&&i.properties.removeProperty("showBackground"),1===e){const e=Object.assign({},this._timePoint[0]);if(this._timePoint.unshift(e),this._points.length>0){const e=Object.assign({},this._points[0]);this._points.unshift(e)}}}applyTemplate(e){const t=e;delete t.background,delete t.backgroundColor,delete t.showBackground,super.applyTemplate(e)}name(){return"Elliott Labels"}async additionalActions(e){return{actions:[new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",options:{label:r.t(null,void 0,i(623403)),subItems:h.map((t=>{const i=d.filter((e=>e.value===t))[0];return new o.Action({actionId:"Chart.LineTool.Elliot.ChangeDegreeProperty",options:{label:i.title,checkable:!0,checked:this.properties().childs().degree.value()===t,onExecute:()=>{e.setProperty(this.properties().childs().degree,t,u,c.lineToolsDoNotAffectChartInvalidation)}}})}))}})],placement:"CustomAction"}}label(e){const t=h.length-this.properties().childs().degree.value()-1,i=Math.floor(t/3);return{group:i,bold:!!(i%2),decoration:["","brackets","circle"][t%3],label:this.labelsGroup()[i][e]}}availableDegreesValues(){return d}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliott",state:t,theme:e});return this._configureProperties(i),i}static migrateState(e){const t={0:11,1:10,2:9,3:8,4:7,5:6,6:5,7:4,8:3},i={0:11,1:8};"LineToolElliottSubminuette"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinor"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottCircle"===e.type&&(e.type="LineToolElliottImpulse",e.state.degree=t[e.state.wavesize]),"LineToolElliottMinorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize]),"LineToolElliottMajorRetr"===e.type&&(e.type="LineToolElliottCorrection",e.state.degree=i[e.state.wavesize])}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,701977))).ElliottPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),
e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addExcludedKey("linesColors",3)}}class _ extends p{pointsCount(){return 6}}const P=[["0","1","2","3","4","5"],["0","i","ii","iii","iv","v"],["0","1","2","3","4","5"],["0","I","II","III","IV","V"],["0","1","2","3","4","5"]];class g extends _{constructor(e,t,i,r){super(e,t??g.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Elliott Impulse Wave (12345)"}labelsGroup(){return P}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliottimpulse",state:t,theme:e});return this._configureProperties(i),i}}const m=[["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"],["0","a","b","c","d","e"],["0","A","B","C","D","E"]];class f extends _{constructor(e,t,i,r){super(e,t??f.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Elliott Triangle Wave (ABCDE)"}labelsGroup(){return m}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliotttriangle",state:t,theme:e});return this._configureProperties(i),i}}const y=[["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"],["0","w","x","y","x","z"],["0","W","X","Y","X","Z"]];class v extends _{constructor(e,t,i,r){super(e,t??v.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Elliott Triple Combo Wave (WXYXZ)"}labelsGroup(){return y}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliotttriplecombo",state:t,theme:e});return this._configureProperties(i),i}}class C extends p{pointsCount(){return 4}}const w=[["0","A","B","C"],["0","a","b","c"],["0","A","B","C"],["0","a","b","c"],["0","A","B","C"]];class x extends C{constructor(e,t,i,r){super(e,t??x.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Elliott Correction Wave (ABC)"}labelsGroup(){return w}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliottcorrection",state:t,theme:e});return this._configureProperties(i),i}}const b=[["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"],["0","w","x","y"],["0","W","X","Y"]];class T extends C{constructor(e,t,i,r){super(e,t??T.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Elliott Double Combo Wave (WXY)"}labelsGroup(){return b}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolelliottdoublecombo",state:t,theme:e});return this._configureProperties(i),i}}},968786:(e,t,i)=>{i.d(t,{LineToolFibWedgeBase:()=>l});var r=i(650151),s=i(610555),n=i(225610),o=i(820028);class l extends n.InplaceTextLineDataSource{constructor(){super(...arguments),this._hasEditableCoordinates=new o.WatchedValue(!1)}pointsCount(){return 3}setPoint(e,t){if(super.setPoint(e,t),!this._recursiveGuard)try{if(this._recursiveGuard=!0,2===e){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0]));let t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));const i=(0,
r.ensureNotNull)(this.pointToScreenPoint(this._points[2])).subtract(e).length();let n=t.subtract(e);n.length()<=0&&(n=new s.Point(1,0)),t=e.add(n.normalized().scaled(i));const o=(0,r.ensureNotNull)(this.screenPointToPoint(t)),l=this._pointsProperty.childs().points[1];l.childs().price.setValue(o.price),l.childs().bar.setValue(o.index)}else{const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));const n=t.subtract(e).length();let o=i.subtract(e);o.length()<=0&&(o=new s.Point(1,0)),i=e.add(o.normalized().scaled(n));const l=(0,r.ensureNotNull)(this.screenPointToPoint(i)),a=this._pointsProperty.childs().points[2];a.childs().price.setValue(l.price),a.childs().bar.setValue(l.index)}}finally{this._recursiveGuard=!1}}addPoint(e){if(2===this._points.length){const t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let s=(0,r.ensureNotNull)(this.pointToScreenPoint(e));const n=i.subtract(t).length(),o=s.subtract(t).normalized();s=t.add(o.scaled(n));const l=(0,r.ensureNotNull)(this.ownerSource()),a=(0,r.ensureNotNull)(l.firstValue()),c=(0,r.ensureNotNull)(this.priceScale()).coordinateToPrice(s.y,a);e={index:Math.round(this._model.timeScale().coordinateToIndex(s.x)),price:c}}return super.addPoint(e)}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}}},763601:(e,t,i)=>{i.d(t,{createPropertiesObject:()=>l});var r=i(536794),s=i(91666);function n(e,t,i){for(const s of Object.keys(e.levels??{}))if(e.levels[s]&&(0,r.isSameType)(e.levels[s],t.typecheck())){let r=t.tpl();i.names.forEach(((i,n)=>{r=t.fill(""+n,i,e.levels[s],r)})),e.levels[s]=r}return e}class o extends s.LevelsProperty{constructor(e,t,i){super({defaultName:e,state:i,map:{names:["width","color","visible"]},levelsIterator:n,theme:t})}}function l(e,t,i){return new o(e,t,i)}},648024:(e,t,i)=>{i.d(t,{LineToolGannComplex:()=>u});var r=i(610555),s=i(650151),n=i(632567),o=i(318945),l=i(526951),a=i(763601),c=i(702067),h=i(910282);class u extends o.LineDataSource{constructor(e,t,r,s){super(e,t??u.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=2,this._scaleRatioFormatter=new n.LimitedPrecisionNumericFormatter(7),this.version=2,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,56644)).then((({GannComplexPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}));const o=this.properties();this._adjustScaleRatio(o),o.subscribe(this,this._adjustScaleRatio),o.childs().scaleRatio.subscribe(this,this._correctFirstPoint),this._syncStateExclusions.push("scaleRatio"),o.onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.subscribe(this,this._handleTemplateApplying),this._onTemplateApplied.subscribe(this,this._correctFirstPoint)}migrateVersion(e,t,i){
1===e&&(this._points.length>=this.pointsCount()?setTimeout((()=>this._migratePoint())):this._timePoint.length>=this.pointsCount()&&this._pointAdded.subscribe(this,this._migratePoint))}destroy(){const e=this.properties();e.unsubscribe(this,this._adjustScaleRatio),e.childs().scaleRatio.unsubscribe(this,this._correctFirstPoint),e.onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),this._onTemplateApplying.unsubscribe(this,this._handleTemplateApplying),this._onTemplateApplied.unsubscribe(this,this._correctFirstPoint),super.destroy()}pointsCount(){return 2}name(){return"Gann Square"}addPoint(e,t,i){this._points.length>1&&this._points.pop();const r=super.addPoint(e,t,i),n=this.priceScale();return!(0,s.ensureNotNull)(n).isLog()&&r&&this._correctFirstPoint(),r}setPoint(e,t,i){super.setPoint(e,t,i),void 0!==i&&i.shift()?this._correctPoint(e):this._correctScaleRatio()}setLastPoint(e,t){const i=this.priceScale();return(0,s.ensureNotNull)(i).isLog()||(this._points[1]={...e,interval:this._model.mainSeries().interval()},this._correctPoint(1)),super.setLastPoint(e,t)}isReversed(){return this.properties().childs().reverse.value()}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let r=0;r<i;r++){const i=t.levels.childs()[r].childs();e.push({index:r,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let r=0;r<i;r++){const i=t.fanlines.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let r=0;r<i;r++){const i=t.arcs.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}isLabelsVisible(){return this.properties().childs().showLabels.value()}getLabelsStyle(){const e=this.properties().childs(),{fontSize:t,bold:i,italic:r}=e.labelsStyle.childs(),s=e.levels.childCount();return{textColor:e.levels.childs()[s-1].childs().color.value(),font:h.CHART_FONT_FAMILY,fontSize:t.value(),bold:i.value(),italic:r.value()}}getScaleRatioStep(){return 1e-7}getScaleRatioFormatter(){return this._scaleRatioFormatter}getPriceDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.price-t.price}getIndexDiff(){const e=this.points();if(e.length<2)return null;const[t,i]=e;return i.index-t.index}getScaleRatio(){const e=this.getPriceDiff(),t=this.getIndexDiff();return null!==e&&null!==t&&0!==t?Math.abs(e/t):null}
static createProperties(e,t){const i=(0,a.createPropertiesObject)("linetoolganncomplex",e,t);return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,236589)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("scaleRatio",1);const t=[],i=[],r=e.childs();{const e=r.levels.childCount();for(let s=0;s<e;s++){const e=r.levels.childs()[s].childs();t.push(e.width),i.push(e.color)}}{const e=r.fanlines.childCount();for(let s=0;s<e;s++){const e=r.fanlines.childs()[s].childs();t.push(e.width),i.push(e.color)}}{const e=r.arcs.childCount();for(let s=0;s<e;s++){const e=r.arcs.childs()[s].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new c.LineToolColorsProperty(i)),e.addChild("linesWidths",new c.LineToolWidthsProperty(t))}_correctScaleRatio(){const e=this.properties().childs(),t=this.getScaleRatio();e.scaleRatio.setValue(t)}_getAdjustedScaleRatio(){const e=this.model().mainSeries().priceScale(),t=this.model().timeScale();return(0,l.scaleRatio)(t,e)}_adjustScaleRatio(e){const t=e.scaleRatio.value();""!==t&&null!==t||e.scaleRatio.setValue(this._getAdjustedScaleRatio())}_correctPoint(e){if(this._points.length<2)return;const t=this.getIndexDiff();if(null===t)return;const i=this.properties().childs().scaleRatio.value();if(null!==i){const r=this._points[e],s=0===e?this._points[1]:this._points[0],n=r.price-s.price>0,o=r.index-s.index>0;let l=n&&!o||!n&&o?-1:1;0===e&&(l=-l),r.price=s.price+l*t*i,this._pointChanged.fire(e)}this._normalizePoints()}_correctFirstPoint(){this._correctPoint(this.isReversed()?0:1)}_handleRestoringFactoryDefaults(){this.properties().childs().scaleRatio.setValue(this._getAdjustedScaleRatio())}_handleTemplateApplying(e){""===e.scaleRatio&&(e.scaleRatio=this._getAdjustedScaleRatio())}_migratePoint(){if(this.points().length<this.pointsCount())return;const e=this._getScreenPoints();if(null===e)return;const t=(0,s.ensureNotNull)(this.screenPointToPoint(e[1]));this.setPoint(1,t),this._pointAdded.unsubscribe(this,this._migratePoint)}_getScreenPoints(){const e=this._calcAngle();if(null===e)return null;let[t,i]=this.points();this.isReversed()&&([t,i]=[i,t]);const n=(0,s.ensureNotNull)(this.pointToScreenPoint(t)),o=(0,s.ensureNotNull)(this.pointToScreenPoint(i)),l=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2)),a=new r.Point(Math.cos(e),-Math.sin(e)),c=a.normalized(),h=c.x<0?-1:1,u=c.y<0?-1:1;return[n.addScaled(a,l),n.add(new r.Point(5*l*h,5*l*u))]}_calcAngle(){const[e,t]=this.points(),i=(0,s.ensureNotNull)(this.pointToScreenPoint(e));let r=(0,s.ensureNotNull)(this.pointToScreenPoint(t)).subtract(i);if(r.length()>0){r=r.normalized();let e=Math.acos(r.x);return r.y>0&&(e=-e),e}return null}}},482447:(e,t,i)=>{i.d(t,{LineToolImage:()=>L,buildAbsoluteUserImageUrl:()=>T})
;var r=i(650151),s=i(610555),n=i(735566),o=i(820028),l=i(890390),a=i(905520),c=i(318945),h=i(437642),u=i(62802),d=i(345848),p=i(454546),_=i(810978),P=i(846778),g=i(227158),m=i(87913);async function f(e,t){return async function(e){const[t]=await Promise.all([Promise.all([i.e(40907),i.e(18883),i.e(32937),i.e(98185),i.e(46195),i.e(92537),i.e(15371),i.e(25563),i.e(97540),i.e(72232),i.e(38452),i.e(87833),i.e(79487),i.e(88220),i.e(25346),i.e(77105),i.e(82321),i.e(66409),i.e(62526),i.e(77038)]).then(i.bind(i,538255))]);return t.renderImageDialog(e)}({onConfirm:e,onClose:t})}let y=null;function v(e){if("LineToolImage"!==e)return y?.then((e=>e())),void(y=null);window.is_authenticated||(0,m.resetToCursor)(!0),(0,_.runOrSigninWithFeature)((()=>{const e="LineToolImage";m.tool.setValue(e),(0,p.trackDrawingToolSelected)(e,"Left panel"),y=f(C,(()=>{y?.then((e=>e())),y=null,m.tool.value()===e&&(0,m.resetToCursor)(!0)})),(0,d.trackEvent)("Image","Open image dialog")}),{feature:"drawings",source:"Change drawing tool state"})}function C(e){const t=(0,g.chartWidgetCollectionService)();if(null===t)return;const i=!Boolean(u.getBool("hint.pasteImage")),s=t.activeChartWidget.value();s.model().pasteImageAsLineTool(e.url,e.blobUrl,(0,r.ensureNotNull)(s.model().model().paneForSource(s.model().mainSeries())),e.transparency),i&&(0,P.showPasteLineToolHint)(t.getContainer(),"hint.pasteImage")}const w=(0,n.getLogger)("Chart.LineToolImage");function x(e){return e.toLowerCase().startsWith("blob:")}const b=window.AWS_BBS3_DOMAIN;function T(e){if(x(e))return e;const t=new URL(e,b),i=new URL(t.pathname,b);if("/"===i.pathname)return null;const r=i.toString();return t.toString()!==r?null:r}function S(e){return e.toLowerCase().startsWith("data:")?e:new URL(e).pathname}class L extends c.LineDataSource{constructor(e,t,r,s){super(e,t||L.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._hasEditableCoordinates=new o.WatchedValue(!1),this._image=null,this._originPoint=4;const n=this.properties().childs().url;this._absoluteUserImageUrl=new a.Property(T(this.properties().childs().url.value())??""),this._absoluteUserImageUrl.subscribe(this,(e=>{const t=e.value();if(x(t))return;const i=T(t);null!==i&&n.setValue(S(i))})),n.subscribe(this,(()=>{const e=T(n.value());null!==e&&this._absoluteUserImageUrl.setValue(e)})),this._loadImage(),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,721826)).then((({ImagePaneView:t})=>{this._setPaneViews([new t(this,e)])})),this.properties().childs().url.subscribe(this,(()=>{this._loadImage()}))}absoluteUserImageUrl(){return this._absoluteUserImageUrl}cssWidth(){return this.properties().childs().cssWidth.value()}cssHeight(){return this.properties().childs().cssHeight.value()}angle(){return this.properties().childs().angle.value()}originPoint(){return this._originPoint}dOffsetX(){return this._dOffsetX||0}pointsCount(){return 1}name(){return"Image"}image(){return this._image}setBlobImageUrl(e){this._image||(this._createImage(e),this._blobUrl=e)}
getChangePointForSync(e){return null}pointToScreenPoint({index:e,price:t},i,n){const o=this._model.timeScale(),l=(0,r.ensureNotNull)(i?i.priceScale():this.priceScale()),a=(0,r.ensure)((i??this.ownerSource())?.firstValue()),c=o.indexToCoordinate(e)+(n??0),h=l.priceToCoordinate(t,a);return new s.Point(c,h)}setPoint(e,t,i){if(null===this._image)return;const{width:s,height:n}=this._image,o=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0],void 0,this.dOffsetX())),a=Math.max(Math.abs(l.x-o.x)/s,Math.abs(l.y-o.y)/n),c=Math.round(s*a),h=Math.round(n*a),u=this.properties().childs();u.cssWidth.setValue(c),u.cssHeight.setValue(h),this.propertiesChanged()}startChanging(e,t){super.startChanging(e,t),this._changeOriginPoint(L._oppositePoints[e])}endChanging(e,t){return this._changeOriginPoint(4),super.endChanging(e,t)}getPoint(){return null}syncLineStyleState(){const e=super.syncLineStyleState();return!e.url&&this._blobUrl&&(e.blobUrl=this._blobUrl),e}restoreExternalState(e){const{blobUrl:t,...i}=e;t&&this.setBlobImageUrl(t),super.restoreExternalState(i)}isSavedInChart(){return super.isSavedInChart()&&""!==this.absoluteUserImageUrl().value()}static createProperties(e,t){const i=new l.DefaultProperty({defaultName:"linetoolimage",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,972476))).ImageDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("url")||e.addChild("url",new a.Property("")),e.addExcludedKey("url",1),e.addExcludedKey("cssWidth",1),e.addExcludedKey("cssHeight",1),e.addExcludedKey("angle",1)}_loadImage(){const e=this.properties(),t=(0,r.ensureDefined)(e.child("url")).value();t&&this._createImage(t)}_changeOriginPoint(e){const t=this.originPoint(),i=4===t?L._correctOriginDirections[e]:L._correctOriginDirections[L._oppositePoints[t]],n=this.properties().childs().cssWidth.value()/2,o=this.properties().childs().cssHeight.value()/2,[l]=this._points,a=(0,r.ensureNotNull)(this.pointToScreenPoint(l)),c=new s.Point(a.x+n*i[0],a.y+o*i[1]),h=(0,r.ensureNotNull)(this.screenPointToPoint(c));this._dOffsetX=4===t?c.x-(0,r.ensureNotNull)(this.pointToScreenPoint(h)).x:void 0,l.index=h.index,l.price=h.price,this._originPoint=e}_createImage(e){const t=x(e),i=T(e);if(null===i)return void w.logWarn(`Invalid image URL: ${e}`);if(i===this._image?.src)return;const s=document.createElement("img");s.crossOrigin="anonymous",s.src=i,s.addEventListener("load",(()=>{this._image=s;const e=this._model,n=this.properties().childs();if(!t){const e=S(i);n.url.setValue(e),this._blobUrl=void 0}if(n.cssWidth.value()&&n.cssHeight.value())return void this._model.updateSource(this);const o=e.timeScale().width()/4,l=(0,r.ensureNotNull)(this.priceScale()).height()/4,a=s.naturalWidth,c=s.naturalHeight,u=Math.min(1,o/a),d=Math.min(1,l/c),p=Math.min(u,d),_=Math.round(p*a),P=Math.round(p*c)
;n.cssWidth.setValue(_),n.cssHeight.setValue(P),this.updateAllViews((0,h.sourceChangeEvent)(this.id())),this._model.updateSource(this)})),s.addEventListener("error",(()=>{this.model().removeSource(this)}))}}L._correctOriginDirections=[[-1,-1],[1,-1],[-1,1],[1,1],[0,0]],L._oppositePoints=[3,2,1,0,4],(0,m.runOnDrawingStateReady)((()=>{m.tool.subscribe(v)}))},193579:(e,t,i)=>{i.d(t,{asLineToolName:()=>er,ensureLineToolLoaded:()=>Ji,getLineTool:()=>rr,getLoadedLineTool:()=>ir,isAsyncGenericLineToolName:()=>ji,isAsyncStudyLineToolName:()=>Xi,isLineToolLoaded:()=>$i,loadLineTool:()=>Zi,loadMetaInfoForLinetoolIfRequired:()=>tr});var r=i(650151),s=i(444372),n=i(418450),o=i(91666),l=i(472354),a=i(702067),c=i(905520),h=i(225610);const u=new c.Property(!1);function d(e,t){return(0,r.ensureDefined)(e.child(`level${t}`))}class p extends h.InplaceTextUndoCommand{constructor(e,t,i,r,s){super(e,t,i,r),this._levelIndex=s}_textProperty(e){return d(e.properties(),this._levelIndex).childs().text}}class _ extends h.InplaceTextLineDataSource{constructor(){super(...arguments),this._inplaceEditLevelIndex=1}editableTextStyle(){return{...super.editableTextStyle(),forbidLineBreaks:!0,maxLength:50}}editableTextProperties(){const e=this.properties().childs();return{text:e.editableText,textColor:e.editableTextColor,wordWrap:u}}setInplaceEditLevelIndex(e){this._destroyEditableTextSubscriptions?.();const t=this.properties(),i=t.childs().editableText,s=t.childs().editableTextColor,n=d(t,e),o=(0,r.ensureDefined)(n).childs().text,l=(0,r.ensureDefined)(n).childs().color,a={};i.setValue(o.value()),s.setValue(l.value()),i.subscribe(a,(()=>o.setValue(i.value()))),o.subscribe(a,(()=>i.setValue(o.value()))),s.subscribe(a,(()=>l.setValue(s.value()))),l.subscribe(a,(()=>s.setValue(l.value()))),this._destroyEditableTextSubscriptions=()=>{i.unsubscribeAll(a),o.unsubscribeAll(a),s.unsubscribeAll(a),l.unsubscribeAll(a)},this._inplaceEditLevelIndex=e,this._editableText.setValue(i.value())}_changeEditableTextUndoCommand(e,t){return new p(this._model,this,e,t,this._inplaceEditLevelIndex)}static _configureProperties(e){super._configureProperties(e),e.addChild("editableText",new c.Property("")),e.addChild("editableTextColor",new c.Property("")),e.addExcludedKey("editableText",3),e.addExcludedKey("editableTextColor",3)}}const P=new n.TranslatedString("erase level line",s.t(null,void 0,i(735111)));class g extends _{constructor(e,t,r,s){super(e,t??g.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=2,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,173390)).then((e=>{this._paneView=new e.FibRetracementPaneView(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this)),this._setPaneViews([this._paneView])}))}levelsCount(){return 24}pointsCount(){return 2}name(){return"Fib Retracement"}migrateVersion(e){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,{visible:r}=this.properties().childs()[i].childs()
;e.setProperty(r,!1,P,l.lineToolsDoNotAffectChartInvalidation)}fibLevelsBasedOnLogScale(){return this.properties().childs().fibLevelsBasedOnLogScale.value()&&!!this.priceScale()?.isLog()}template(){const e=super.template();for(let t=1;t<=24;t++){const i=d(this._properties,t);e[`level${t}`].text=i.childs().text.value()}return e}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolfibretracement",state:t,map:{range:[1,24],names:["coeff","color","visible","text"]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,656518))).FibDrawingsWith24LevelsDefinitionsViewModel}_applyTemplateImpl(e){for(let t=1;t<=24;t++){const i=d(this._properties,t),r=e[`level${t}`];i.childs().text.setValue(r.text??r[3]??"")}super._applyTemplateImpl(e)}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().trendline.childs().linewidth,e.childs().levelsStyle.childs().linewidth],i=[e.childs().trendline.childs().color];for(let t=1;t<=24;t++){const r=d(e,t);i.push(r.childs().color),e.addExcludedKey(`level${t}.text`,1)}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t))}}const m=new n.TranslatedString("erase level line",s.t(null,void 0,i(735111)));class f extends h.InplaceTextLineDataSource{constructor(e,t,r,s){super(e,t??f.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=2,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,375782)).then((({FibChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 24}migrateVersion(e,t,i){i.properties.removeProperty("reverse")}pointsCount(){return 3}name(){return"Fib Channel"}processErase(e,t){const i="level"+t,s=(0,r.ensureDefined)(this.properties().child(i)).childs().visible;e.setProperty(s,!1,m,l.lineToolsDoNotAffectChartInvalidation)}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolfibchannel",state:t,map:{range:[1,24],names:["coeff","color","visible"]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,656518))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[];for(let i=1;i<=24;i++){const s=(0,r.ensureDefined)(e.child("level"+i));t.push((0,r.ensureDefined)(s.child("color")))}e.addChild("linesColors",new a.LineToolColorsProperty(t))}}var y=i(968786);class v extends y.LineToolFibWedgeBase{constructor(e,t,r,s){super(e,t??v.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,837871)).then((e=>{
this._setPaneViews([new e.ProjectionLinePaneView(this,this._model)])}))}levelsCount(){return 1}name(){return"Projection"}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolprojection",state:t,map:{range:[1,1]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,603414))).ProjectionDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().trendline.childs().color]))}}const C=new n.TranslatedString("erase level line",s.t(null,void 0,i(735111)));class w extends _{constructor(e,t,r,s){super(e,t??w.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=2,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,274969)).then((({TrendBasedFibExtensionPaneView:e})=>{this._setPaneViews([new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}))}levelsCount(){return 24}pointsCount(){return 3}name(){return"Trend-Based Fib Extension"}migrateVersion(e,t){1===e&&this.properties().childs().extendLines.setValue(!0)}processErase(e,t){const i="level"+t,r=this.properties().childs()[i].childs().visible;e.setProperty(r,!1,C,l.lineToolsDoNotAffectChartInvalidation)}fibLevelsBasedOnLogScale(){return this.properties().childs().fibLevelsBasedOnLogScale.value()&&Boolean(this.priceScale()?.isLog())}template(){const e=super.template();for(let t=1;t<=24;t++){const i=d(this._properties,t);e[`level${t}`].text=i.childs().text.value()}return e}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetooltrendbasedfibextension",state:t,map:{names:["coeff","color","visible","linestyle","linewidth","text"],range:[0,24]},theme:e});return this._configureProperties(i),i}_applyTemplateImpl(e){for(let t=1;t<=24;t++){const i=d(this._properties,t),r=e[`level${t}`];i.childs().text.setValue(r.text??r[3]??"")}super._applyTemplateImpl(e)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,656518))).FibDrawingsWith24LevelsDefinitionsViewModel}static _configureProperties(e){const t=e.childs();super._configureProperties(e);const i=[t.trendline.childs().color];for(let t=1;t<=24;t++){const r=d(e,t);i.push(r.childs().color),e.addExcludedKey(`level${t}.text`,1)}e.addChild("linesColors",new a.LineToolColorsProperty(i));const r=[t.trendline.childs().linewidth,t.levelsStyle.childs().linewidth];e.addChild("linesWidths",new a.LineToolWidthsProperty(r))}}var x=i(740875);const b=new n.TranslatedString("erase level line",s.t(null,void 0,i(735111)));class T extends h.InplaceTextLineDataSource{constructor(e,t,r,s){super(e,t??T.createProperties(e.backgroundTheme().spawnOwnership()),r,s),
Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,965228)).then((e=>{this._setPaneViews([new e.FibCirclesPaneView(this,this._model)])}))}levelsCount(){return 11}pointsCount(){return 2}name(){return"Fib Circles"}processErase(e,t){const i=`level${t}`,s=(0,r.ensureDefined)(this.properties().child(i)).childs().visible;e.setProperty(s,!1,b,l.lineToolsDoNotAffectChartInvalidation)}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}snapTo45DegreesAvailable(){return!0}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolfibcircles",state:t,map:{range:[1,11]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,902789))).FibCirclesDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs(),i=[t.trendline.childs().linewidth],s=[t.trendline.childs().color];for(let t=1;t<=11;t++)i.push((0,r.ensureDefined)(e.child("level"+t)?.child("linewidth"))),s.push((0,r.ensureDefined)(e.child("level"+t)?.child("color")));e.addChild("linesColors",new a.LineToolColorsProperty(s)),e.addChild("linesWidths",new a.LineToolWidthsProperty(i))}}var S=i(610555),L=i(890390),V=i(515779);class D extends V.LineDataSourceTimeAxisView{constructor(e){super(e,0)}_getBgColor(){return this._source.properties().linecolor.value()}_getAlwaysInViewPort(){return!1}_getIndex(){const e=this._source.points();return 0===e.length?null:e[0].index}}class B extends h.InplaceTextLineDataSource{constructor(e,t,r,s){super(e,t??B.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._verticalLinePaneViews=new WeakMap,this._timeAxisView=new D(this),this._paneViewFactory=null,this.properties().childs().extendLine.subscribe(this,(()=>e.lightUpdate())),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,921890)).then((t=>{this._paneViewFactory=i=>new t.VertLinePaneView(this,e,i,this._openTextEditor.bind(this),this._closeTextEditor.bind(this)),this._model.lightUpdate()})),this.setAdditionalCursorData(this._additionalCursorData.bind(this),this._positionToCoordinate.bind(this))}destroy(){this.properties().childs().extendLine.unsubscribeAll(this),super.destroy()}pointsCount(){return 1}name(){return"Vertical Line"}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(e){super.updateAllViews(e),this._timeAxisView.update(e)}canHasAlert(){return!0}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}isMultiPaneAvailable(){return!0}isMultiPaneEnabled(){return this.properties().childs().extendLine.value()}paneViews(e){if(e=(0,r.ensureDefined)(e),!this.isMultiPaneEnabled()&&this._model.paneForSource(this)!==e)return null;const t=this._getPaneViews(e);if((null===t||!t.length)&&null!==this._paneViewFactory){
const t=this._paneViewFactory(e);this._verticalLinePaneViews.set(e,t),this._setPaneViews([t],e,!0)}return super.paneViews(e)}priceAxisViews(){return null}priceAxisPoints(){return[]}pointToScreenPoint(e){const t=this._model.timeScale();if(t.isEmpty())return null;const i=t.indexToCoordinate(e.index);return new S.Point(i,0)}convertYCoordinateToPriceForMoving(e){return 0}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textcolor}}static createProperties(e,t){null!=t&&(void 0===t.textOrientation&&(t.textOrientation="horizontal"),void 0===t.extendLine&&(t.extendLine=!1));const i=new L.DefaultProperty({defaultName:"linetoolvertline",state:t,theme:e});return this._configureProperties(i),i}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}_getAlertPlots(){const e=this._points[0],t={index:e.index,price:e.price+1},i=this._linePointsToAlertPlot([e,t],null,!0,!0);return null===i?[]:[i]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,540229)).then((e=>e.VerticalLineDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}_additionalCursorData(){return(0,r.ensureDefined)(this._verticalLinePaneViews.get((0,r.ensureNotNull)(this._model.paneForSource(this)))).additionalCursorData()}_positionToCoordinate(e){return(0,r.ensureDefined)(this._verticalLinePaneViews.get((0,r.ensureNotNull)(this._model.paneForSource(this)))).positionToCoordinate(e)}}var k=i(597331),A=i(534328);class M extends k.PriceAxisView{constructor(e){super(),this._source=e}_updateRendererData(e,t,i){e.visible=!1;const r=this._source.points(),s=this._source.priceScale();if(0===r.length||null===s||s.isEmpty())return;const n=r[0];if(!isFinite(n.price))return;const o=this._source.ownerSource(),l=null!==o?o.firstValue():null;if(null===l)return;const a=(0,A.resetTransparency)(this._source.properties().linecolor.value());i.background=a,i.textColor=this.generateTextColor(a),i.coordinate=s.priceToCoordinate(n.price,l),e.text=s.formatPrice(n.price,l),e.visible=!0}}var N=i(318945);class I extends N.LineDataSource{constructor(e,t,r,s){super(e,t??I.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._priceAxisView=new M(this),this._timeAxisView=new D(this),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,429866)).then((({CrossLinePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Cross Line"}priceAxisViews(e,t){
return this.isSourceHidden()?null:t===this.priceScale()&&this.properties().childs().showPrice.value()&&this._model.paneForSource(this)===e?[this._priceAxisView]:null}timeAxisViews(){return this.isSourceHidden()?null:this.properties().childs().showTime.value()?[this._timeAxisView]:null}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e),this._timeAxisView.update()}canHasAlert(){return!1}lineColor(){return this.properties().childs().linecolor.value()}lineWidth(){return this.properties().childs().linewidth.value()}lineStyle(){return this.properties().childs().linestyle.value()}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolcrossline",state:t,theme:e});return this._configureProperties(i),i}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,55481)).then((e=>e.CrossLineDefinitionsViewModel))}}var R=i(536794),F=i(172073),E=i(584785),O=i(107096),z=i(437642),W=i(820028);const K=new n.TranslatedString("mirror bars pattern",s.t(null,void 0,i(920965))),H=new n.TranslatedString("flip bars pattern",s.t(null,void 0,i(182349))),U=s.t(null,void 0,i(928941)),q=s.t(null,void 0,i(563271)),Q={0:2,1:4,2:1,3:1,4:2,5:3,6:-1},G={0:3,1:4,2:4,3:1,4:2,5:3,6:-1};class j extends N.LineDataSource{constructor(e,t=j.createProperties(e.backgroundTheme().spawnOwnership()),r,s){super(e,t,r,s),this._hasEditableCoordinates=new W.WatchedValue(!1),this._pattern=[],this._scale=1,this._pointsCoordinatePricesDiff=null;const n=t.childs().mode.value();(0,R.isString)(n)&&t.childs().mode.setValue(parseInt(n)),t.childs().mirrored.subscribe(this,this._mirror),t.childs().flipped.subscribe(this,this._flip),t.childs().mode.subscribe(this,this._updateLastPoint),this.version=2,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,327706)).then((t=>{this._setPaneViews([new t.BarsPatternPaneView(this,e)])}))}pattern(){return this._pattern}isSynchronizable(){return!1}async additionalActions(e){return{actions:[new F.Action({actionId:"Chart.LineTool.BarsPattern.ToggleMirrored",options:{checked:this.properties().childs().mirrored.value(),checkable:!0,label:U,onExecute:()=>{e.setProperty(this.properties().childs().mirrored,!this.properties().childs().mirrored.value(),K,l.lineToolsDoNotAffectChartInvalidation),this.updateAllViews((0,z.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}}),new F.Action({actionId:"Chart.LineTool.BarsPattern.ToggleFlipped",options:{checked:this.properties().childs().flipped.value(),checkable:!0,label:q,onExecute:()=>{e.setProperty(this.properties().childs().flipped,!this.properties().childs().flipped.value(),H,l.lineToolsDoNotAffectChartInvalidation),this.updateAllViews((0,z.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}})],placement:"CustomAction"}}pointsCount(){return 2}state(e){return{...super.state(e),
pattern:this._pattern,scale:this._scale,diff:this._pointsCoordinatePricesDiff}}restoreData(e){const{pattern:t=this._pattern,scale:i=this._scale,diff:r=this._pointsCoordinatePricesDiff}=e;this._pattern=t,this._scale=i,this._pointsCoordinatePricesDiff=r}name(){return"Bars Pattern"}cloneData(e){this._pattern=(0,R.clone)(e._pattern),this._scale=e._scale,this._pointsCoordinatePricesDiff=e._pointsCoordinatePricesDiff}firstPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[0];return e.value()===O.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[G[e.value()]]:i[Q[e.value()]]}lastPatternPrice(){const{mode:e,flipped:t}=this.properties().childs(),i=this._pattern[this._pattern.length-1];return e.value()===O.LineToolBarsPatternMode.LineHL2?(i[2]+i[3])/2:t.value()?i[Q[e.value()]]:i[G[e.value()]]}addPoint(e,t,i){const s=super.addPoint(e,t,!0);if(s){const e=this._model.mainSeries(),[{index:t},{index:i}]=this.points(),s=(0,r.ensureDefined)(e.nearestIndex(Math.min(t,i),E.PlotRowSearchMode.NearestRight)),n=(0,r.ensureDefined)(e.nearestIndex(Math.max(t,i),E.PlotRowSearchMode.NearestLeft));this._pattern=this._createPattern(s,n),this._pattern.length>0&&(t>i&&this._points.reverse(),this._points[1].price=this._points[0].price+this._patternPriceDiff(),this._points[1].index=this._points[0].index+(n-s),this._normalizePoints(),this.createServerPoints()),this._updatePointsCoordinatePricesDiff()}return s}setPoint(e,t,i,r){1===e&&t.index<=this._points[0].index&&(t.index=this._points[0].index+1),0===e&&t.index>=this._points[1].index&&(t.index=this._points[1].index-1),super.setPoint(e,t,i),this._updatePointsCoordinatePricesDiff()}move(e,t,i,r){super.move(e,t,i,r),this._updatePointsCoordinatePricesDiff()}migrateVersion(e,t,i){if(1===e&&this._pattern.length>0){const e=this._patternPriceDiff();2===this._timePoint.length&&(this._timePoint[1].price=this._timePoint[0].price+e),2===this._points.length&&(this._points[1].price=this._points[0].price+e)}}getScale(){return this._scale=this._calculateScale()}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolbarspattern",state:t,theme:e});return this._configureProperties(i),i}_preparePoint(e,t){const i=this._alignPointToRangeOfActualData(e),s=this._model.mainSeries(),n=(0,r.ensureNotNull)(s.bars().valueAt(i.index));this.properties().childs().mode.value()===O.LineToolBarsPatternMode.Bars?i.price=(0,r.ensure)(n[2]):i.price=(0,r.ensure)(n[4]);const o=(0,r.ensureNotNull)(this.priceScale()),l=(0,r.ensure)(this.ownerSource()?.firstValue()),a=.05*o.height(),c=o.priceToCoordinate(i.price,l)-a;return i.price=o.coordinateToPrice(c,l),super._preparePoint(i,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,191497))).BarsPatternDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("mirrored",1),e.addExcludedKey("flipped",1)}_calculatePatternCoordinatePricesDiff(){
return this._pattern.length>0?this._priceCoordinateDiff([this.firstPatternPrice(),this.lastPatternPrice()])??null:null}_updatePointsCoordinatePricesDiff(){this._pointsCoordinatePricesDiff=this._calculatePointsCoordinatePricesDiff()}_calculatePointsCoordinatePricesDiff(){if(2===this._points.length){const[{price:e},{price:t}]=this.points();return this._priceCoordinateDiff([e,t])??null}return null}_createPattern(e,t){const i=this._model.mainSeries().data(),s=[];for(let n=e;n<=t;n++)s.push((0,R.clone)((0,r.ensureNotNull)(i.valueAt(n))));return s}_switchPointsPrice(){const e=this._points[0].price;this._timePoint[0].price=this._points[0].price=this._points[1].price,this._timePoint[1].price=this._points[1].price=e}_mirror(){const e=this._pattern;let t=Math.min(e[0][3],e[0][2]),i=Math.max(e[0][3],e[0][2]);for(let r=1;r<e.length;r++)t=Math.min(t,e[r][3]),i=Math.max(i,e[r][2]);if(t<i){const r=(t+i)/2,s=e=>r-(e-r);for(let t=0;t<e.length;t++)e[t][2]=s(e[t][2]),e[t][3]=s(e[t][3]),e[t][1]=s(e[t][1]),e[t][4]=s(e[t][4])}this._switchPointsPrice(),this.updateAllViews((0,z.sourceChangeEvent)(this.id()))}_flip(){const e=this._pattern,t=e.length;for(let i=0;i<t/2;i++){const r=e[i];e[i]=e[t-i-1],e[t-i-1]=r}this._switchPointsPrice(),this.updateAllViews((0,z.sourceChangeEvent)(this.id()))}_patternPriceDiff(){return this.lastPatternPrice()-this.firstPatternPrice()}_pricesToCoordinates(e){const t=this.priceScale(),i=this.ownerSource()?.firstValue()??null;if(null!==i&&null!==t&&!t.isEmpty())return e.map((e=>t.priceToCoordinate(e,i)))}_priceCoordinateDiff(e){const t=this._pricesToCoordinates(e);if(t)return t[1]-t[0]}_calculateScale(){let e=1;if(2===this._points.length){const t=this._calculatePatternCoordinatePricesDiff();if(!t)return e;const i=this._calculatePointsCoordinatePricesDiff();if(t&&null!==i&&(e=+(i/t).toFixed(8)),this._pointsCoordinatePricesDiff!==i){if(this._scale!==e)return this._updateLastPoint(),this._scale;this._updatePointsCoordinatePricesDiff()}}return e}_updateLastPoint(){if(this._points.length<2)return;const e=this.priceScale(),t=this.ownerSource()?.firstValue()??null;if(null===t||null===e||e.isEmpty())return;const i=this._calculatePatternCoordinatePricesDiff(),r=this._pricesToCoordinates([this.points()[0].price]);null!==i&&r&&(this._timePoint[1].price=this._points[1].price=e.coordinateToPrice(+(this._scale*i).toFixed(8)+r[0],t),this._updatePointsCoordinatePricesDiff())}}const X=new n.TranslatedString("erase level line",s.t(null,void 0,i(735111)));class $ extends N.LineDataSource{constructor(e,t,r,s){super(e,t??$.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=1,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,765007)).then((({TrendBasedFibTimePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}pointsCount(){return 3}name(){return"Trend-Based Fib Time"}processErase(e,t){const i="level"+t,r=this.properties().childs()[i].childs().visible;e.setProperty(r,!1,X,l.lineToolsDoNotAffectChartInvalidation)}
static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetooltrendbasedfibtime",state:t,map:{range:[1,11]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,303424))).TrendBasedFibTimeDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs(),i=[t.trendline.childs().linewidth],r=[t.trendline.childs().color];for(let e=1;e<=11;e++)i.push(t["level"+e].childs().linewidth),r.push(t["level"+e].childs().color);e.addChild("linesColors",new a.LineToolColorsProperty(r)),e.addChild("linesWidths",new a.LineToolWidthsProperty(i))}}const Y=new n.TranslatedString("erase level line",s.t(null,void 0,i(735111)));class Z extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Z.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=2,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,411659)).then((({FibTimeZonePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 11}migrateVersion(e,t,i){if(1===e){const e=i.properties.childs(),t=i.properties,r=t.baselinecolor.value(),s=t.linecolor.value(),n=t.linewidth.value(),o=t.linestyle.value();e.level1.childs().color.setValue(r);for(let t=2;t<=11;t++)e["level"+t].childs().color.setValue(s);for(let t=1;t<=11;t++)e["level"+t].childs().linewidth.setValue(n),e["level"+t].childs().linestyle.setValue(o)}}pointsCount(){return 2}name(){return"Fib Time Zone"}processErase(e,t){const i="level"+t,r=this.properties().childs()[i].childs().visible;e.setProperty(r,!1,Y,l.lineToolsDoNotAffectChartInvalidation)}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolfibtimezone",state:t,map:{range:[1,11]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,746346))).FibTimezoneDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[],i=[],r=[];for(let s=1;s<=11;s++){const n=e.childs()["level"+s].childs();t.push(n.linewidth),i.push(n.color),r.push(n.linestyle)}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t)),e.addChild("linesStyles",new a.LineToolCollectedProperty(r)),e.hasChild("baselinecolor")&&e.removeProperty("baselinecolor"),e.hasChild("linecolor")&&e.removeProperty("linecolor"),e.hasChild("linewidth")&&e.removeProperty("linewidth"),e.hasChild("linestyle")&&e.removeProperty("linestyle")}}var J=i(778336),ee=i(61499),te=i(938186),ie=i(790188),re=i(266954),se=i(898021);const ne=(0,ie.getHexColorByName)("color-tv-blue-500"),oe={linewidth:2,fontsize:12,fillLabelBackground:!0,fillBackground:!0,backgroundTransparency:60,showVolume:!0,intervalsVisibilities:{...re.intervalsVisibilitiesDefaults},customText:{visible:!1,fontsize:12,
bold:!1,italic:!1}},le=new Map([[ee.StdTheme.Light,{textcolor:(0,ie.getHexColorByName)("color-black"),labelBackgroundColor:(0,ie.getHexColorByName)("color-white"),linecolor:ne,backgroundColor:(0,A.generateColor)(ne,85),shadow:"rgba(0, 0, 0, 0.2)",customText:{color:ne}}],[ee.StdTheme.Dark,{textcolor:(0,ie.getHexColorByName)("color-white"),labelBackgroundColor:(0,ie.getHexColorByName)("color-cold-gray-800"),linecolor:ne,backgroundColor:(0,A.generateColor)(ne,85),shadow:"rgba(0, 0, 0, 0.4)",customText:{color:ne}}]]),ae=["customText.text"];function ce(e){const{showVolume:t=!0,...i}=e;return{...i,showVolume:t}}class he extends se.LineDataSourceProperty{constructor({nonThemedDefaultsKeys:e,themedDefaultsKeys:t,state:i,...s}){super({nonThemedDefaultsKeys:e,themedDefaultsKeys:t,templateKeys:[...e??[],...t??[],...ae],state:i?ce(i):void 0,...s});const n=i?.customText;this._textProperty=new c.Property(n?.text??""),this.childs().customText?.addChild("text",this._textProperty),this.addChild("textsColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(this.childs().customText?.child("color"))]))}template(){const e=super.template();return e.customText.text=this._textProperty.value(),e}}var ue=i(568100);const de={...oe,extendTop:!1,extendBottom:!1,showBarsRange:!0,showDateTimeRange:!0},pe=le,_e=(0,L.extractThemedColors)((0,r.ensureDefined)(pe.get(ee.StdTheme.Light)),(0,r.ensureDefined)(pe.get(ee.StdTheme.Dark))),Pe=(0,L.extractAllPropertiesKeys)((0,r.ensureDefined)(pe.get(ee.StdTheme.Light))),ge=(0,L.extractAllPropertiesKeys)(de),me=[...new Set([...Pe,...ge,...ue.commonLineToolPropertiesStateKeys,...ae])];class fe extends he{static create(e,t){return new this({defaultName:"linetooldaterange",factoryDefaultsSupplier:()=>(0,te.factoryDefaultsForCurrentTheme)(de,pe),nonThemedDefaultsKeys:ge,themedDefaultsKeys:Pe,allStateKeys:me,themedColors:_e,replaceThemedColorsOnThemeChange:!0,state:t,theme:e})}}class ye extends N.LineDataSource{constructor(e,t,r,s){super(e,t??ye.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._volumeCalculator=null,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,464955)).then((e=>{this._setPaneViews([new e.DateRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){return"Date Range"}template(){return this._properties.template()}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,r.assert)(null===this._volumeCalculator),this._volumeCalculator=new J.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e,t){const i=fe.create(e,t);return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,208981))).GeneralDatePriceRangeDefinitionsViewModel}}const ve={...oe,extendLeft:!1,extendRight:!1,showPriceRange:!0,showPercentPriceRange:!0,showPipsPriceRange:!0},Ce=le,we=(0,L.extractThemedColors)((0,r.ensureDefined)(Ce.get(ee.StdTheme.Light)),(0,r.ensureDefined)(Ce.get(ee.StdTheme.Dark))),xe=(0,L.extractAllPropertiesKeys)((0,r.ensureDefined)(Ce.get(ee.StdTheme.Light))),be=(0,L.extractAllPropertiesKeys)(ve),Te=[...new Set([...xe,...be,...ue.commonLineToolPropertiesStateKeys,...ae])];class Se extends he{static create(e,t){return new this({defaultName:"linetoolpricerange",factoryDefaultsSupplier:()=>(0,te.factoryDefaultsForCurrentTheme)(ve,Ce),nonThemedDefaultsKeys:be,themedDefaultsKeys:xe,allStateKeys:Te,themedColors:we,replaceThemedColorsOnThemeChange:!0,state:t,theme:e})}}class Le extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Le.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,380329)).then((e=>{this._setPaneViews([new e.PriceRangePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Price Range"}template(){return this._properties.template()}static createProperties(e,t){const i=Se.create(e,t);return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,208981))).GeneralDatePriceRangeDefinitionsViewModel}}const Ve=(0,ie.getHexColorByName)("color-tv-blue-500"),De={...oe,drawBorder:!1,borderWidth:1,showBarsRange:!0,showDateTimeRange:!0,showPriceRange:!0,showPercentPriceRange:!0,showPipsPriceRange:!0},Be=new Map([[ee.StdTheme.Light,{...le.get(ee.StdTheme.Light),borderColor:Ve}],[ee.StdTheme.Dark,{...le.get(ee.StdTheme.Dark),borderColor:Ve}]]),ke=(0,L.extractThemedColors)((0,r.ensureDefined)(Be.get(ee.StdTheme.Light)),(0,r.ensureDefined)(Be.get(ee.StdTheme.Dark))),Ae=(0,L.extractAllPropertiesKeys)((0,r.ensureDefined)(Be.get(ee.StdTheme.Light))),Me=(0,L.extractAllPropertiesKeys)(De),Ne=[...new Set([...Ae,...Me,...ue.commonLineToolPropertiesStateKeys,...ae])];class Ie extends he{static create(e,t){return new this({defaultName:"linetooldateandpricerange",factoryDefaultsSupplier:()=>(0,te.factoryDefaultsForCurrentTheme)(De,Be),nonThemedDefaultsKeys:Me,themedDefaultsKeys:Ae,allStateKeys:Ne,themedColors:ke,replaceThemedColorsOnThemeChange:!0,state:t,theme:e})}}class Re extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Re.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._volumeCalculator=null,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,841514)).then((e=>{this._setPaneViews([new e.DateAndPriceRangePaneView(this,this._model)])}))}destroy(){super.destroy(),null!==this._volumeCalculator&&this._volumeCalculator.destroy()}pointsCount(){return 2}name(){
return"Date and Price Range"}template(){return this._properties.template()}volume(){if(null===this._volumeCalculator)return NaN;const e=this.points();return this._volumeCalculator.volume(e[0].index,e[1].index)}setOwnerSource(e){e===this._model.mainSeries()&&((0,r.assert)(null===this._volumeCalculator),this._volumeCalculator=new J.SeriesTimeRangeVolumeCalculator(this._model.mainSeries())),super.setOwnerSource(e)}static createProperties(e,t){const i=Ie.create(e,t);return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,208981))).GeneralDatePriceRangeDefinitionsViewModel}}var Fe=i(923995),Ee=i(179404);class Oe extends c.Property{constructor(e){super(0),this._source=e}value(){const e=this._source.points();if(3!==e.length)return 0;const t=e[2].price-e[0].price,i=this._source.ownerSource()?.symbolSource().symbolInfo(),r=i?i.pricescale/i.minmov:100;return Math.round(t*r)/r}setValue(e){const t=this._source.points();if(3===t.length){const i={...t[2],price:t[0].price+e},s=this._source.model();s.startChangingLinetool(this._source,(0,r.ensureNotNull)(this._source.ownerSource()),{...i},6),s.changeLinePoint({...i}),s.endChangingLinetool(!1),this._listeners.fire(this,"")}}}class ze extends N.LineDataSource{constructor(e,t,r,s){super(e,t??ze.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=2,this._priceOffsetProperty=new Oe(this),this._priceAxisViews.push(this.createPriceAxisView(3)),this._coordOffsetWhileMovingOrChanging=null,this._pendingPriceOffset=null,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,696654)).then((({ParallelChannelPaneView:e})=>{this._setPaneViews([new e(this,this._model)])})),Fe.alertsAvailable&&this._normalizedPointsChanged.subscribe(this,this._updateAlertCreationAvailable)}levelsCount(){return Ee.coeffs.length}paneViews(e){return null!==this._pendingPriceOffset&&this._applyPendingPriceOffset(),super.paneViews(e)}snapTo45DegreesAvailable(){return!0}setLastPoint(e,t){this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[0]);const i=(0,R.clone)(e);return super.setLastPoint(e,t,!1),i}startMoving(e,t,i,r){super.startMoving(e,t,i,r),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endMoving(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endMoving(e,t,i)}startChanging(e,t){super.startChanging(e,t),this._coordOffsetWhileMovingOrChanging=this._findPixelsHeight()}endChanging(e,t,i){return this._coordOffsetWhileMovingOrChanging=null,super.endChanging(e,t,i)}restoreExternalPoints(e,t){if(super.restoreExternalPoints(e,t),t.pricesChanged&&this._points.length===e.points.length)for(let t=0;t<e.points.length;t++)this._points[t].price=e.points[t].price}restorePoints(e,t,i){e[2]={...e[0],price:e[2].price},super.restorePoints(e,t,i),
this._alertCreationAvailable.setValue(super.alertCreationAvailable().value()&&this._isTimePointsValid())}setPoint(e,t,i,s){if(this._points[0].index===this._points[1].index&&e>=4)return;this._snapPointBeforeChange(e,t,i);const n=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),o=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),l=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),a=(0,r.ensureNotNull)(this._coordOffsetWhileMovingOrChanging),c=(0,r.ensureNotNull)(this.priceScale()),h=(0,r.ensure)(this.ownerSource()?.firstValue()),u=this._model.mainSeries().interval();switch(e){case 0:super._setPoint(e,{...t,interval:u}),this._points[2].price=c.coordinateToPrice(l.y+a,h),this._points[2].index=t.index,this._points[2].interval=u;break;case 1:super._setPoint(e,{...t,interval:u});break;case 2:super._setPoint(e,{...t,interval:u}),this._points[0].price=c.coordinateToPrice(l.y-a,h),this._points[0].index=t.index,this._points[0].interval=u;break;case 3:this._points[1].price=c.coordinateToPrice(l.y-a,h),this._points[1].index=t.index,this._points[1].interval=u;break;case 4:{const e=o.subtract(n),t=(l.x-n.x)/e.x,i=n.addScaled(e,t),r=l.y-i.y;this._points[2].price=c.coordinateToPrice(n.y+r,h);break}case 5:{const e=o.subtract(n),t=(l.x-n.x)/e.x,i=n.addScaled(e,t),r=l.y-i.y;this._points[0].price=c.coordinateToPrice(n.y+r,h),this._points[1].price=c.coordinateToPrice(o.y+r,h);break}case 6:this._points[2].price=t.price}const d=this.linkKey().value();d&&!s&&this._syncLineStyleChanges(d,{prices:this._points.map((e=>e.price))})}state(e){const t=super.state(e);return this._pendingPriceOffset&&(t.priceOffset=this._pendingPriceOffset),t}restoreExternalState(e){const{prices:t,...i}=e;if(t&&this.isActualSymbol())for(let e=0;e<t.length;e++)this._points[e].price=this._timePoint[e].price=t[e];super.restoreExternalState(i)}restoreData(e){void 0!==e.priceOffset&&(this._pendingPriceOffset=e.priceOffset)}getPoint(e){if(e<3)return super.getPoint(e);const t=this.pointToScreenPoint(this._points[0]),i=this.pointToScreenPoint(this._points[1]),r=this.pointToScreenPoint(this._points[2]);if(!t||!i||!r)return null;switch(e){case 3:{const e=r.y-t.y,s=i.add(new S.Point(0,e));return this.screenPointToPoint(s)}case 4:{const e=r.y-t.y,s=i.add(new S.Point(0,e)),n=r.add(s).scaled(.5);return this.screenPointToPoint(n)}case 5:{const e=t.add(i).scaled(.5);return this.screenPointToPoint(e)}}return null}alignCrossHairToAnchor(e){return e<=3}pointsCount(){return 3}name(){return"Parallel Channel"}addPoint(e,t,i){return this._snapTo45DegreesApplicable(t)&&1===this._points.length&&this.snapPoint45Degree(e,this.points()[0]),2===this._points.length&&(e=this._convertLastPointTo3rdPoint((0,r.ensureNotNull)(this._lastPoint))),this._addPointIntenal(e,t,i)}timeAxisPoints(){return this._axisPoints()}priceAxisPoints(){return this._axisPoints()}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}hasStateForAlert(){return super.hasStateForAlert()&&this._isTimePointsValid()}priceOffsetProperty(){
return this._priceOffsetProperty}static createProperties(e,t){const i=Ee.LineToolParallelChannelPropertiesImpl.create(e,t);return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,450590))).ParallelChannelDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(e.labelText??"")}_getAlertPlots(){const e=this.getPoint(3);if(!e)return[];const t=[this._points[0],this._points[1],this._points[2],e],i=(e,t)=>e.index<=t.index?[e,t]:[t,e],r=i(t[0],t[1]),s=i(t[2],t[3]);let n,o,l,a;t[2].price<t[0].price?(o=s,n=r):(o=r,n=s);const c=this.properties().childs().extendLeft.value(),h=this.properties().childs().extendRight.value();return t[0].index<=t[1].index?(l=c,a=h):(l=h,a=c),[this._linePointsToAlertPlot(n,"Upper",l,a),this._linePointsToAlertPlot(o,"Lower",l,a)].filter((e=>null!==e))}_correctLastPoint(e){if(this._points.length<2||this._points[1].index===this._points[0].index)return e;const t=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),s=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=i.subtract(s),o=(t.x-s.x)/n.x,l=s.addScaled(n,o),a=t.y-l.y,c=s.add(new S.Point(0,a));return(0,r.ensureNotNull)(this.screenPointToPoint(c))}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new c.Property("")),e.addExcludedKey("labelText",1)}_isTimePointsValid(){return this._timePoint.every((e=>Number.isFinite(e.price)))}_axisPoints(){const e=this.points(),t=this._points[0]?this.pointToScreenPoint(this._points[0]):null,i=this._points[1]?this.pointToScreenPoint(this._points[1]):null,s=this._points[2]?this.pointToScreenPoint(this._points[2]):null;if(t&&i&&s){const n=i.y-t.y,o=s.add(new S.Point(0,n));e.push((0,r.ensureNotNull)(this.screenPointToPoint(o)))}return e}_convertLastPointTo3rdPoint(e){const t=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),s=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=i.subtract(s),o=(t.x-s.x)/n.x,l=s.addScaled(n,o),a=t.y-l.y,c=s.add(new S.Point(0,a));return(0,r.ensureNotNull)(this.screenPointToPoint(c))}_findPixelsHeight(){const e=this.pointToScreenPoint(this._points[2]),t=this.pointToScreenPoint(this._points[0]);return e&&t?e.y-t.y:null}_applyPendingPriceOffset(){const e=this._pendingPriceOffset;if(null===e||this._points.length<3)return;const t=this.priceScale(),i=(0,r.ensureNotNull)(this.ownerSource()).firstValue();if(!t||t.isEmpty()||null===i)return;const s=e+this._points[0].price,n=e+this._points[1].price,o=.5*(s+n)-e,l=.5*(s+n),a=t.priceToCoordinate(o,i),c=t.priceToCoordinate(l,i)-a,h=t.priceToCoordinate(this._points[0].price,i)+c,u=t.coordinateToPrice(h,i);this._points[2].price=u,this._timePoint[2].price=u,this._points[2].index=this._points[0].index,this._timePoint[2].time_t=this._timePoint[0].time_t,
this._timePoint[2].offset=this._timePoint[0].offset,this._pendingPriceOffset=null}_snapPointBeforeChange(e,t,i){if(this._snapTo45DegreesApplicable(i))switch(e){case 0:case 1:this.snapPoint45Degree(t,this._points[1-e]);break;case 2:case 3:const i=(0,r.ensureNotNull)(this.getPoint(5-e));this.snapPoint45Degree(t,i)}}}class We extends c.Property{constructor(e){super(),this._lineSource=e}value(){return Math.round(100*this._lineSource.angle()*180/Math.PI)/100}setValue(e){const t=e%360*Math.PI/180,i=this._lineSource.model().timeScale().barSpacing(),s=Math.cos(t),n=-Math.sin(t),o=this._lineSource.distance();let l;if(1!==Math.abs(n)){const e=o*s,t=e%i,r=i-e%i,n=Math.abs((e-t)/s),a=Math.abs((e+r)/s);l=Math.max(n,a)}else l=o;const a=(0,r.ensureNotNull)(this._lineSource.pointToScreenPoint(this._lineSource.points()[0])).add(new S.Point(s*l,n*l)),c=(0,r.ensureNotNull)(this._lineSource.screenPointToPoint(a));this._lineSource.setPoint(1,c);const h=this._lineSource.model();h.updateSource(this._lineSource),this._lineSource.updateAllViews((0,z.sourceChangeEvent)(this._lineSource.id())),h.updateSource(this._lineSource)}notifyChanged(){this._listeners.fire(this,"")}}class Ke extends h.InplaceTextLineDataSource{constructor(e,t,r,s){const n=t??Ke.createProperties(e.backgroundTheme().spawnOwnership());super(e,n,r,s),this._angle=0,this._distance=0,n.addChild("angle",new We(this)),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,109339)).then((({TrendAnglePaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}isSynchronizable(){return!1}pointsCount(){return 2}name(){return"Trend Angle"}angle(){return this._angle}distance(){return this._distance}addPoint(e,t){const i=super.addPoint(e,t);return i&&this._calculateAngle(),i}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this.points().length>1&&this._calculateAngle(),i}axisPoints(){if(this.points().length<2)return[];const e=[this.points()[0]],t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),i=Math.cos(this._angle)*this._distance,s=-Math.sin(this._angle)*this._distance,n=t.add(new S.Point(i,s)),o=(0,r.ensureNotNull)(this.screenPointToPoint(n));return e.push(o),e}timeAxisPoints(){return this.axisPoints()}priceAxisPoints(){return this.axisPoints()}setPoint(e,t,i){super.setPoint(e,t,i),this.points().length>1&&1===e&&this._calculateAngle()}restoreData(e){this._angle=e.angle??0,this._distance=e.distance??0}state(e){const t=super.state(e);return t.angle=this._angle,t.distance=this._distance,t}cloneData(e){this._angle=e.angle(),this._distance=e.distance()}canHasAlert(){return!0}editableTextProperties(){(0,r.assert)(!1,"unexpected method call")}snapTo45DegreesAvailable(){return!0}static createProperties(e,t){t&&void 0===t.showPercentPriceRange&&(t.showPercentPriceRange=t.showPriceRange,t.showPipsPriceRange=t.showPriceRange);const i=new L.DefaultProperty({defaultName:"linetooltrendangle",state:t,theme:e});return this._configureProperties(i),i}_getAlertPlots(){
const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}_calculateAngle(){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0]));let t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[1])).subtract(e);const i=t.length();i>0?(t=t.normalized(),this._angle=Math.acos(t.x),t.y>0&&(this._angle=-this._angle),this._distance=i):this._angle=0;this.properties().childs().angle.notifyChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,922909)).then((e=>e.TrendAngleDefinitionsViewModel))}}var He=i(721160),Ue=i(44049),qe=i(231842);class Qe extends h.InplaceTextLineDataSource{constructor(e,t,r,s){super(e,t??Qe.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._delayedStudyViewsInitialization=!1,this._viewsModule=new Ue.AsyncResourceWrapper(Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,927187))),this._viewsModule.callFunction((()=>{this._model.updateSource(this)}))}destroy(){this._viewsModule.destroy(),super.destroy()}pointsCount(){return 2}name(){return"Trend Line"}canHasAlert(){return!0}showPriceLabels(){return this._properties.childs().showPriceLabels.value()}createPriceAxisView(e){return new qe.LineToolPriceAxisView(this,{pointIndex:e,backgroundPropertyGetter:()=>this.showPriceLabels()?this._properties.childs().linecolor.value():null})}isForcedDrawPriceAxisLabel(){return this.showPriceLabels()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textcolor}}supportsTargetSignature(){return He.shareDrawingsOnIndicators}isMultiPaneAvailable(){return this.supportsTargetSignature()}isMultiPaneEnabled(){return null!==this.targetSignature().value()}snapTo45DegreesAvailable(){return!0}static createProperties(e,t,i){return Qe._createPropertiesImpl("linetooltrendline",e,t,i)}_getPaneViews(e){if(null===this.targetSignature().value()&&!this._paneViews.has(e)&&(!e||e.hasDataSource(this))){const t=this._viewsModule.get();t&&this._paneViews.set(e,[new t.TrendLinePaneView(this,this._model,e??null,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}return super._getPaneViews(e)}_getAlertPlots(){const e=this._linePointsToAlertPlot(this._points,null,this._properties.childs().extendLeft.value(),this._properties.childs().extendRight.value());return null===e?[]:[e]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,384840))).TrendLineDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}_createSignatureSourcePaneViews(e){const t=this._viewsModule.get()
;if(null===t)return this._delayedStudyViewsInitialization||(this._delayedStudyViewsInitialization=!0,this._viewsModule.callFunction((()=>{this._signaturesPaneViews.clear(),this._updateSignaturesPaneViews()}))),[];return[new t.TrendLinePaneView(this,this._model,null,this._openTextEditor.bind(this),this._closeTextEditor.bind(this),e)]}static _createPropertiesImpl(e,t,i,r){i&&void 0===i.showPercentPriceRange&&(i.showPercentPriceRange=i.showPriceRange,i.showPipsPriceRange=i.showPriceRange);const s=new L.DefaultProperty({theme:t,defaultName:e,state:i,useUserPreferences:r});return this._configureProperties(s),s}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}class Ge extends Qe{constructor(e,t,i,r){super(e,t??Ge.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}pointsCount(){return 2}name(){return"Info Line"}static createProperties(e,t){const i=Qe._createPropertiesImpl("linetoolinfoline",e,t);return Ge._configureProperties(i),i}}var je=i(560770);class Xe extends N.LineDataSource{constructor(e,t,r,s,n){super(e,t??Xe.createProperties(e.backgroundTheme().spawnOwnership(),null,r),s,n),this._textPaneView=null,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,715541)).then((({ArrowMarkPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}paneViews(e){const t=super.paneViews();return null!==t&&this._textPaneView&&t.push(this._textPaneView),t}pointsCount(){return 1}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}static createProperties(e,t,i){const r=new L.DefaultProperty({defaultName:i,state:t});return this._configureProperties(r),r}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,174163)).then((e=>e.ArrowMarkDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().arrowColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color])),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1)}}Xe.version=2;class $e extends Xe{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkleft",i,r)}direction(){return"left"}name(){return"Arrow Mark Left"}textAlignParams(){return{horzAlign:je.HorizontalAlign.Left,vertAlign:je.VerticalAlign.Middle,offsetX:22,offsetY:3}}static createProperties(e,t){return super.createProperties(e,t,"linetoolarrowmarkleft")}}class Ye extends Xe{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkup",i,r)}direction(){return"up"}name(){return"Arrow Mark Up"}textAlignParams(){return{
horzAlign:je.HorizontalAlign.Center,vertAlign:je.VerticalAlign.Top,offsetX:0,offsetY:20}}static createProperties(e,t){return super.createProperties(e,t,"linetoolarrowmarkup")}}class Ze extends Xe{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkright",i,r)}direction(){return"right"}name(){return"Arrow Mark Right"}textAlignParams(){return{horzAlign:je.HorizontalAlign.Right,vertAlign:je.VerticalAlign.Middle,offsetX:22,offsetY:3,forceTextAlign:!0}}static createProperties(e,t){return super.createProperties(e,t,"linetoolarrowmarkright")}}class Je extends Xe{constructor(e,t,i,r){super(e,t,"linetoolarrowmarkdown",i,r)}direction(){return"down"}name(){return"Arrow Mark Down"}textAlignParams(){return{horzAlign:je.HorizontalAlign.Center,vertAlign:je.VerticalAlign.Bottom,offsetX:0,offsetY:20}}static createProperties(e,t){return super.createProperties(e,t,"linetoolarrowmarkdown")}}const et=[4.5,9,11.25,18,22.5,36,45],tt=function(){const e=[],t=et.length-1;let i=1,r=0,s=0;for(;s<1e10;)s=et[r]*i,e.push(Math.round(s)),e.push(Math.ceil(-s)),r===t-1&&(i*=10),r=(r+1)%t;return e.sort(((e,t)=>e-t))}();class it extends N.LineDataSource{constructor(e,t,r,s){super(e,t??it.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,744467)).then((({GannSquarePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}hLevelsCount(){return 7}vLevelsCount(){return 7}pointsCount(){return 2}name(){return"Gann Box"}getPoint(e){if(e<2)return super.getPoint(e);let t=null;switch(e){case 2:case 3:const i=this.points();if(i.length===this.pointsCount()){let r=i[0].index,s=i[1].price;3===e&&(r=i[1].index,s=i[0].price),t={index:r,price:s}}}return t}setPoint(e,t,i,r){if(i&&i.shift()){const i=e%2==0?this._points[1]:this._points[0];this._alignPointsFixedIncrement(t,i)}const s=this._model.mainSeries().interval();switch(e){case 2:this._points[0].index=t.index,this._points[0].interval=s,this._points[1].price=t.price;break;case 3:this._points[1].index=t.index,this._points[1].interval=s,this._points[0].price=t.price;break;default:super.setPoint(e,t,i)}}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolgannsquare",state:t,map:{range:[1,7],prefixes:["h","v"],names:["coeff","color","visible"]},theme:e});return this._configureProperties(i),i}_alignPriceOnPattern(e,t){const i=Math.round(1e6*(e.price-t.price))/1e6;if(0===i)return;const r=et[0],s=et[et.length-1];let n=1;const o=Math.abs(i);for(;o<r*n||s*n<o;)o<r*n?n*=.1:s*n<o&&(n*=10);let l=s*n;for(let e=et.length-2;e>=0&&!(et[e]*n<o);--e)l=et[e]*n;e.price=t.price+(i>=0?l:-l)}_alignTimeOnPattern(e,t){const i=e.index-t.index;if(0===i)return;let r=tt.length-2;for(;r>=0&&!(tt[r]<i);--r);r+=i>0?1:0,e.index=t.index+tt[r]}_alignPointsFixedIncrement(e,t){return this._alignTimeOnPattern(e,t),this._alignPriceOnPattern(e,t),e}_preparePoint(e,t){return t&&t.shift()&&0!==this._points.length&&this._alignPointsFixedIncrement(e,this._points[0]),super._preparePoint(e,t)}
async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,162399))).GannSquareDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().color,e.childs().fans.childs().color];for(let i=1;i<=7;i++)t.push((0,r.ensureDefined)(e.child(`hlevel${i}`)?.child("color")));for(let i=1;i<=7;i++)t.push((0,r.ensureDefined)(e.child(`vlevel${i}`)?.child("color")));e.addChild("linesColors",new a.LineToolColorsProperty(t)),e.addExcludedKey("linesColors",3)}}var rt=i(648024),st=i(763601);class nt extends N.LineDataSource{constructor(e,t,r,s){super(e,t??nt.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._constructor="LineToolGannFixed",Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,983428)).then((({GannFixedPaneView:e})=>{this._setPaneViews([new e(this,this.model())])})),this.properties().childs().reverse.subscribe(this,this._reversePoints)}pointsCount(){return 2}name(){return"Gann Square Fixed"}axisPoints(){const e=this.points(),t=this.getScreenPoints();return e.length<2||t.length<2?[]:[e[0],(0,r.ensureNotNull)(this.screenPointToPoint(t[1]))]}getScreenPoints(){const e=this.points();if(e.length<2)return[];const t=this._calcAngle();if(null===t)return[];const[i,s]=e,n=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),o=(0,r.ensureNotNull)(this.pointToScreenPoint(s)),l=Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2)),a=new S.Point(Math.cos(t),-Math.sin(t)),c=a.normalized(),h=c.x<0?-1:1,u=c.y<0?-1:1;return[n.addScaled(a,l),n.add(new S.Point(5*l*h,5*l*u))]}levelsCount(){return this.properties().childs().levels.childCount()}levels(){const e=[],t=this.properties().childs(),i=t.levels.childCount();for(let r=0;r<i;r++){const i=t.levels.childs()[r].childs();e.push({index:r,visible:i.visible.value(),color:i.color.value(),width:i.width.value()})}return e}fanLinesCount(){return this.properties().childs().fanlines.childCount()}fanLines(){const e=[],t=this.properties().childs(),i=t.fanlines.childCount();for(let r=0;r<i;r++){const i=t.fanlines.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsCount(){return this.properties().childs().arcs.childCount()}arcs(){const e=[],t=this.properties().childs(),i=t.arcs.childCount();for(let r=0;r<i;r++){const i=t.arcs.childs()[r].childs();e.push({index:r,visible:i.visible.value(),x:i.x.value(),y:i.y.value(),color:i.color.value(),width:i.width.value()})}return e}arcsBackgroundTransparency(){return this.properties().childs().arcsBackground.childs().transparency.value()}isArcsBackgroundFilled(){return this.properties().childs().arcsBackground.childs().fillBackground.value()}static createProperties(e,t){const i=(0,st.createPropertiesObject)("linetoolgannfixed",e,t);return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){
return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,236589)).then((e=>e.GannComplexAndFixedDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e);const t=[],i=[],r=e.childs();{const e=r.levels.childCount();for(let s=0;s<e;s++){const e=r.levels.childs()[s].childs();t.push(e.width),i.push(e.color)}}{const e=r.fanlines.childCount();for(let s=0;s<e;s++){const e=r.fanlines.childs()[s].childs();t.push(e.width),i.push(e.color)}}{const e=r.arcs.childCount();for(let s=0;s<e;s++){const e=r.arcs.childs()[s].childs();t.push(e.width),i.push(e.color)}}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t))}_calcAngle(){const e=this.points();if(e.length<2)return null;const[t,i]=e,r=this.pointToScreenPoint(t),s=this.pointToScreenPoint(i);if(null===r||null===s)return null;let n=s.subtract(r);if(n.length()<=0)return null;n=n.normalized();let o=Math.acos(n.x);return n.y>0&&(o=-o),o}_reversePoints(){const[e,t]=this._points;this._points[0]=t,this._points[1]=e,this._normalizePoints(),this.restart()}}const ot=new n.TranslatedString("erase level line",s.t(null,void 0,i(735111)));class lt extends N.LineDataSource{constructor(e,t,r,s){super(e,t??lt.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,139639)).then((({GannFanPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}levelsCount(){return 9}pointsCount(){return 2}name(){return"Gann Fan"}processErase(e,t){const i="level"+t,s=(0,r.ensureDefined)(this.properties().child(i)).childs().visible;e.setProperty(s,!1,ot,l.lineToolsDoNotAffectChartInvalidation)}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolgannfan",state:t,map:{range:[1,9]},theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,31014))).GannFanDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[],i=[];for(let s=1;s<=9;s++){const n=(0,r.ensureDefined)(e.child("level"+s));t.push((0,r.ensureDefined)(n.child("linewidth"))),i.push((0,r.ensureDefined)(n.child("color")))}e.addChild("linesColors",new a.LineToolColorsProperty(i)),e.addChild("linesWidths",new a.LineToolWidthsProperty(t))}}var at=i(826787);class ct extends N.LineDataSource{constructor(e,t,r,s){super(e,t??ct.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=1,this._hasEditableCoordinates=new W.WatchedValue(!1),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,167110)).then((e=>{this._setPaneViews([new e.DisjointChannelPaneView(this,this._model)])}))}pointsCount(){return 3}name(){return"Disjoint Channel"}snapTo45DegreesAvailable(){return!0}addPoint(e,t,i){
return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i,r){const s=.5*(this._points[1].price+this._points[2].price);if(this._snapTo45DegreesApplicable(i)&&1===e){const e=0;this.snapPoint45Degree(t,this.points()[e])}if(e<3&&super.setPoint(e,t),0!==e&&2!==e){if(1===e){const e=this._points[1].price-s;this._points[2].price=this._points[1].price-2*e}else if(3===e){const e=t.price-this._points[2].price;this._points[0].price=this._points[1].price-e,this._points[0].index=t.index,this._points[0].interval=this._model.mainSeries().interval()}this._normalizePoints()}}getPoint(e){if(e<3)return super.getPoint(e);const t=this._points[0].price-this._points[2].price;return{index:this._points[0].index,price:this._points[1].price-t}}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetooldisjointangle",state:t,theme:e});return this._configureProperties(i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(e.labelText??"")}_getAlertPlots(){const e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));const r=this._points[2];r.time=t.time,r.index=t.index;const s={price:r.price+(t.price-e.price),time:e.time,index:e.index},n=[];let o,l,a,c;r.index<=s.index?(n.push(r),n.push(s)):(n.push(s),n.push(r)),i[0].price>n[0].price?(o=i,l=n):n[0].price>i[0].price||n[1].price>i[1].price?(o=n,l=i):(o=i,l=n);const h=this.properties().childs().extendLeft.value(),u=this.properties().childs().extendRight.value();return e.index<=t.index?(a=h,c=u):(a=u,c=h),[this._linePointsToAlertPlot(o,"Upper",a,c),this._linePointsToAlertPlot(l,"Lower",a,c)].filter(R.notNull)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,829162))).GeneralTrendFiguresDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new c.Property("")),e.addExcludedKey("labelText",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("labelTextColor"))]))}}class ht extends N.LineDataSource{constructor(e,t,r,s){super(e,t??ht.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this.version=1,this._hasEditableCoordinates=new W.WatchedValue(!1),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,769559)).then((e=>{this._setPaneViews([new e.FlatBottomPaneView(this,this._model)])}))}pointsCount(){return 3}name(){return"Flat Bottom"}snapTo45DegreesAvailable(){return!0}addPoint(e,t,i){
return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.addPoint(e)}setLastPoint(e,t){return this._snapTo45DegreesApplicable(t)&&2===this.points().length&&this.snapPoint45Degree(e,this.points()[this.points().length-2]),super.setLastPoint(e)}setPoint(e,t,i,r){if(this._snapTo45DegreesApplicable(i)&&1===e){const e=0;this.snapPoint45Degree(t,this.points()[e])}const s=this._model.mainSeries().interval();if(2===e)this._points[1].index=t.index,this._points[1].interval=s;else if(3===e)return this._points[0].index=t.index,this._points[0].interval=s,this._points[2].price=t.price,void this._normalizePoints();super.setPoint(e,t)}getPoint(e){return e<3?super.getPoint(e):3===e?{index:this._points[0].index,price:this._points[2].price}:null}canHasAlert(){return!0}template(){const e=super.template();return e.labelText=this.properties().childs().labelText.value(),e}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolflatbottom",state:t,theme:e});return this._configureProperties(i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().labelText.setValue(e.labelText??"")}_getAlertPlots(){const e=this._points[0],t=this._points[1],i=[];e.index<=t.index?(i.push(e),i.push(t)):(i.push(t),i.push(e));const r=this._points[2];r.time=t.time,r.index=t.index;const s={price:r.price,time:e.time,index:e.index},n=[];let o,l,a,c;r.index<=s.index?(n.push(r),n.push(s)):(n.push(s),n.push(r)),i[0].price>n[0].price?(o=i,l=n):n[0].price>i[0].price||n[1].price>i[1].price?(o=n,l=i):(o=i,l=n);const h=this.properties().childs().extendLeft.value(),u=this.properties().childs().extendRight.value();return e.index<=t.index?(a=h,c=u):(a=u,c=h),[this._linePointsToAlertPlot(o,"Upper",a,c),this._linePointsToAlertPlot(l,"Lower",h,c)].filter(R.notNull)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,829162))).GeneralTrendFiguresDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("labelText")||e.addChild("labelText",new c.Property("")),e.addExcludedKey("labelText",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("labelTextColor"))]))}}var ut=i(87913),dt=i(964401),pt=i(690274),_t=i(735566),Pt=i(154834),gt=i(998034),mt=i(553407);const ft={intervalsVisibilities:{...re.intervalsVisibilitiesDefaults},color:mt.colors.colorTvBlue500,size:72},yt={icon:61720,angle:.5*Math.PI},vt=(0,L.extractAllPropertiesKeys)(ft),Ct=(0,L.extractAllPropertiesKeys)(yt),wt=[...new Set([...Ct,...vt,...ue.commonLineToolPropertiesStateKeys])];class xt extends se.LineDataSourceProperty{constructor(e){super(e),this.addChild("backgroundsColors",new a.LineToolColorsProperty([this.childs().color]))}static create(e,t,i){return new this({defaultName:"linetoolicon",factoryDefaultsSupplier:()=>(0,Pt.default)(ft),nonThemedDefaultsKeys:vt,themedDefaultsKeys:[],state:(0,gt.default)({},yt,{icon:i},t??{}),
allStateKeys:wt,theme:e})}}const bt=(0,_t.getLogger)("Chart.LineToolIcon");class Tt extends pt.LineToolSvgIconBase{constructor(e,t,i,r){super(e,t??Tt.createProperties(e.backgroundTheme().spawnOwnership()),i,r),this.version=1,this._loadViews()}name(){return"Icon"}template(){return this._properties.template()}static createProperties(e,t){const i=xt.create(e,t,ut.iconTool.value());return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,420717)).then((e=>e.IconsDefinitionsViewModel))}async _loadViews(){const[{getSvgContentForCharCode:e,getSvgRenderer:t},{IconPaneView:r}]=await Promise.all([i.e(27987).then(i.bind(i,841970)),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,158288))]);if(!this._isDestroyed){const i=this._properties.childs().icon.value();this._svgContent=e(i),this._onIconChanged.fire();const s=t(dt.svgRenderer,i);null===s&&bt.logWarn(`Couldn't create svg renderer for icon ${i}`),this._setPaneViews([new r(this,this._model,s)])}}}const St={intervalsVisibilities:{...re.intervalsVisibilitiesDefaults},size:72},Lt={sticker:"bitcoin",angle:.5*Math.PI},Vt=(0,L.extractAllPropertiesKeys)(St),Dt=(0,L.extractAllPropertiesKeys)(Lt),Bt=[...new Set([...Dt,...Vt,...ue.commonLineToolPropertiesStateKeys])];class kt extends se.LineDataSourceProperty{constructor(e){super(e)}static create(e,t,i){return new this({defaultName:"linetoolsticker",factoryDefaultsSupplier:()=>(0,Pt.default)(St),nonThemedDefaultsKeys:Vt,themedDefaultsKeys:[],allStateKeys:Bt,state:(0,gt.default)({},Lt,{sticker:i},t??{}),theme:e})}}const At=(0,_t.getLogger)("Chart.LineToolSticker");class Mt extends pt.LineToolSvgIconBase{constructor(e,t,i,r){super(e,t??Mt.createProperties(e.backgroundTheme().spawnOwnership()),i,r),this.version=1,this._loadViews()}name(){return"Sticker"}static createProperties(e,t){const i=kt.create(e,t,ut.stickerTool.value());return Mt._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,235775))).LineDataSourceDefinitionsViewModel}async _loadViews(){const[{getSvgContentForSticker:e,getSvgRenderer:t},{StickerPaneView:r}]=await Promise.all([i.e(25598).then(i.bind(i,828821)),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,78580))]);if(!this._isDestroyed){const i=this._properties.childs().sticker.value();this._svgContent=e(i),this._onIconChanged.fire();const s=t(dt.svgRenderer,i);null===s&&At.logWarn(`Couldn't create svg renderer for sticker ${i}`),this._setPaneViews([new r(this,this._model,s)])}}}var Nt=i(2624);class It extends N.LineDataSource{constructor(e,t,r,s){super(e,t??It.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._hasEditableCoordinates=new W.WatchedValue(!1),this._distance=null,
Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,308496)).then((({RotatedRectanglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=this._points,t=(0,r.ensureNotNull)(this.pointToScreenPoint(e[0])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(e[1])),s=(0,r.ensureNotNull)(this.pointToScreenPoint(e[2]));this._distance=(0,Nt.distanceToLine)(t,i,s).distance}}setPoint(e,t,i,s){if(super.setPoint(e,t,i),0===e||1===e){const e=this._points,t=(0,r.ensureNotNull)(this.pointToScreenPoint(e[0])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(e[1])).subtract(t),s=new S.Point(i.y,-i.x).normalized().scaled((0,r.ensureNotNull)(this._distance)),n=t.add(s),o=(0,r.ensureNotNull)(this.screenPointToPoint(n)),l=this._model.mainSeries().interval();this._points[2]={...o,interval:l}}}endChanging(e,t,i){return this._distance=null,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Rotated Rectangle"}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,853701))).GeneralFiguresDefinitionsViewModelBase}snapTo45DegreesAvailable(){return!0}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolrotatedrectangle",state:t,theme:e});return this._configureProperties(i),i}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color]))}}class Rt extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Rt.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,521619)).then((t=>{this._setPaneViews([new t.LineToolHeadAndShouldersPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Head and Shoulders"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolheadandshoulders",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,785997)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textcolor]))}}class Ft extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Ft.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,919686)).then((({TrianglePaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 3}name(){return"Triangle"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetooltriangle",state:t,theme:e});return this._configureProperties(i),i}
async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,853701))).GeneralFiguresDefinitionsViewModelBase}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color]))}}class Et extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Et.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,194960)).then((t=>{this._setPaneViews([new t.LineToolTrianglePatternPaneView(this,e)])}))}pointsCount(){return 4}name(){return"Triangle Pattern"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetooltrianglepattern",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,785997)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textcolor])),e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().backgroundColor]))}}class Ot extends N.LineDataSource{constructor(e,t,i,r){super(e,t??Ot.createProperties(e.backgroundTheme().spawnOwnership()),i,r),this._loadPaneViews(e)}pointsCount(){return 5}name(){return"XABCD Pattern"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetool5pointspattern",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,785997)).then((e=>e.PatternWithBackgroundDefinitionViewModel))}_loadPaneViews(e){Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,327112)).then((t=>{this._setPaneViews([new t.Pattern5pointsPaneView(this,e)])}))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}class zt extends N.LineDataSource{constructor(e,t,r,s){super(e,t??zt.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,475729)).then((t=>{this._setPaneViews([new t.LineToolThreeDrivesPaneView(this,e)])}))}pointsCount(){return 7}name(){return"Three Drives Pattern"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolthreedrivers",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){
return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,512268)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textcolor])),e.addChild("linesWidths",new a.LineToolWidthsProperty([e.childs().linewidth])),e.hasChild("backgroundsColors")&&e.removeProperty("backgroundsColors")}}class Wt extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Wt.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,399418)).then((t=>{this._setPaneViews([new t.ABCDPaneView(this,e)])}))}pointsCount(){return 4}name(){return"ABCD Pattern"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolabcd",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,512268)).then((e=>e.PatternWithoutBackgroundDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("color"))])),e.addChild("textsColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}var Kt=i(65840);class Ht extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Ht.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._hasEditableCoordinates=new W.WatchedValue(!1),this._finished=!1,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,331918)).then((t=>{this._setPaneViews([new t.PolylinePaneView(this,e)])}))}pointsCount(){return-1}name(){return"Polyline"}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}addPoint(e,t,i,s){if(this._finished)return!0;const n=(0,r.ensureNotNull)(this.priceScale()),o=this._model.timeScale().indexToCoordinate(e.index),l=e.price,a=(0,r.ensure)(this.ownerSource()?.firstValue()),c=n.priceToCoordinate(l,a),h=(0,Kt.interactionTolerance)().minDistanceBetweenPoints;if(this._points.length>0){const e=this._points[this._points.length-1],i=this._model.timeScale().indexToCoordinate(e.index),r=e.price,l=n.priceToCoordinate(r,a),u=new S.Point(o,c).subtract(new S.Point(i,l)).length();if(!t?.isApiEvent()&&u<h&&!s)return this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0;const d=this._points[0],p=this._model.timeScale().indexToCoordinate(d.index),_=n.priceToCoordinate(d.price,a),P=new S.Point(o,c).subtract(new S.Point(p,_)).length();if(!t?.isApiEvent()&&P<h&&!s)return this.properties().childs().filled.setValue(!0),this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}setPoint(e,t,i){super.setPoint(e,t,i)
;const s=this.priceScale();if(!(this._model.timeScale().isEmpty()||null===s||s.isEmpty()||e!==this._points.length-1&&0!==e)){const i=(0,r.ensure)(this.ownerSource()?.firstValue()),n=this._model.timeScale().indexToCoordinate(t.index),o=s.priceToCoordinate(t.price,i),l=e===this._points.length-1?this._points[0]:this._points[this._points.length-1],a=this._model.timeScale().indexToCoordinate(l.index),c=s.priceToCoordinate(l.price,i);new S.Point(n,o).subtract(new S.Point(a,c)).length()<(0,Kt.interactionTolerance)().minDistanceBetweenPoints&&this.properties().childs().filled.setValue(!0)}}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolpolyline",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,6224)).then((e=>e.PolylinesDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("filled",1)}}class Ut extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Ut.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._hasEditableCoordinates=new W.WatchedValue(!1),this._finished=!1,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,179177)).then((t=>{this._setPaneViews([new t.PathPaneView(this,e)])}))}pointsCount(){return-1}name(){return"Path"}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}addPoint(e,t,i,s){if(this._finished)return!0;const n=(0,r.ensureNotNull)(this.priceScale()),o=this._model.timeScale().indexToCoordinate(e.index),l=e.price,a=(0,r.ensure)(this.ownerSource()?.firstValue()),c=n.priceToCoordinate(l,a);if(this._points.length>0){const e=this._points[this._points.length-1],i=this._model.timeScale().indexToCoordinate(e.index),r=e.price,l=n.priceToCoordinate(r,a),h=new S.Point(o,c).subtract(new S.Point(i,l)).length();if(!t?.isApiEvent()&&h<(0,Kt.interactionTolerance)().minDistanceBetweenPoints&&!s)return this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}return super.addPoint(e,t,i)}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolpath",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,486591)).then((e=>e.PathDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("linesWidths",new a.LineToolWidthsProperty([(0,r.ensureDefined)(e.child("lineWidth"))])),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().lineColor]))}}var qt=i(331790);class Qt extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Qt.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._predictionPaneView=null;const n=this._model.mainSeries();n.properties().childs().interval.subscribe(this,(()=>{this.setStatus(qt.AlertStatus.Waiting)})),
n.dataEvents().dataUpdated().subscribe(this,this.recalculateStateByData),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,123491)).then((t=>{this._predictionPaneView=new t.PredictionPaneView(this,e),this._setPaneViews([this._predictionPaneView])}))}destroy(){const e=this._model.mainSeries();e.properties().childs().interval.unsubscribeAll(this),e.dataEvents().dataUpdated().unsubscribeAll(this),super.destroy()}dataAndViewsReady(){return super.dataAndViewsReady()&&Boolean(this._predictionPaneView&&this._predictionPaneView.iconsReady())}cloneable(){return!1}isSynchronizable(){return!1}status(){return this._properties.childs().status.value()}setStatus(e){return this._properties.childs().status.setValue(e)}pointsCount(){return 2}name(){return"Forecast"}restorePoints(e,t,i){super.restorePoints(e,t,i),this.recalculateStateByData()}recalculateStateByData(){if(this.isSourceHidden())return;if(this._points.length<2)return;if(this._model.mainSeries().bars().isEmpty())return;const e=this._points[1];if(this.status())return void(e.index>this._model.timeScale().baseIndex()&&this.setStatus(qt.AlertStatus.Waiting));const t=this._model.mainSeries().bars().valueAt(e.index);if(null===t)return;const i=this.direction();if(i===qt.Direction.Up&&(0,r.ensure)(t[2])>=e.price)this.setStatus(qt.AlertStatus.Success);else if(i===qt.Direction.Down&&(0,r.ensure)(t[3])<=e.price)this.setStatus(qt.AlertStatus.Success);else{const t=(0,r.ensureNotNull)(this._model.mainSeries().bars().lastIndex());e.index!==t&&this.setStatus(qt.AlertStatus.Failure)}}addPoint(e,t,i){const r=super.addPoint(e,t,i);return r&&this.recalculateStateByData(),r}endChanging(e,t){const i=super.endChanging(e,t);return this.setStatus(qt.AlertStatus.Waiting),this.recalculateStateByData(),i}onData(e){super.onData(e),this.recalculateStateByData()}endMoving(e,t,i){const r=super.endMoving(e,t,i);return this.setStatus(qt.AlertStatus.Waiting),this.recalculateStateByData(),r}direction(){if(this._points.length<2)return qt.Direction.Up;const e=this._points[0];return this._points[1].price>e.price?qt.Direction.Up:qt.Direction.Down}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolprediction",state:t,theme:e});return this._configureProperties(i),i}_ignoreSourceEvent(e){return super._ignoreSourceEvent(e)&&e.sourceId!==this._model.mainSeries().id()}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,403441)).then((e=>e.PredictionDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("status")||e.addChild("status",new c.Property(qt.AlertStatus.Waiting))}}class Gt extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Gt.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,763517)).then((e=>{this._setPaneViews([new e.PriceLabelPaneView(this,this._model)])}))}
pointsCount(){return 1}name(){return"Price Label"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolpricelabel",state:t,theme:e});return this._configureProperties(i),i}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,318466))).PriceLabelDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color]))}}class jt extends N.LineDataSource{constructor(e,t,r,s){super(e,t??jt.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,671684)).then((({ArrowMarkerPaneView:e})=>{this._setPaneViews([new e(this,this.model())])}))}pointsCount(){return 2}name(){return"Arrow Marker"}snapTo45DegreesAvailable(){return!0}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolarrowmarker",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,586148)).then((e=>e.ArrowMarkerDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1)}}var Xt=i(662466);class $t extends c.Property{constructor(e){super(),this._source=e,e.pointAdded().subscribe(this,(()=>this.fireChanged())),e.pointChanged().subscribe(this,(()=>this.fireChanged()))}value(){const e=this._source.properties().childs().position.value();return parseFloat(e.toFixed(2))}setValue(e){this._source.properties().childs().position.setValue(e),this._source.model().updateSource(this._source),this.fireChanged(),this._source.syncMultichartState({pricesChanged:!1,indexesChanged:!1})}}var Yt=i(790394);class Zt extends Yt.LineDataSourcePointIndexProperty{constructor(e,t){super(e,t),this._source=e}_setPointImpl(e){this._source.setPointAndChangeIndex(this._pointIndex,e)}}class Jt extends Xt.LineToolWithRelativePriceCoordinate{constructor(e,t=Jt.createProperties(e.backgroundTheme().spawnOwnership()),r,s){super(e,t,r,s),this._textColorProperty=new c.Property("transparent"),this._setTextColorByTheme=e=>{this._textColorProperty.setValue(e?(0,ie.getHexColorByName)("color-cold-gray-200"):(0,ie.getHexColorByName)("color-cold-gray-900"))},e.dark().subscribe(this._setTextColorByTheme,{callWithLast:!0}),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,922938)).then((t=>{this._setPaneViews([new t.SignpostPaneView(this,e,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}))}destroy(){this._model.dark().unsubscribe(this._setTextColorByTheme),
super.destroy()}pointsCount(){return 1}name(){return"Signpost"}customEvent(){return{index:()=>this.points()[0]?.index??null,position:()=>this.properties().childs().position.value()}}showInObjectTree(){return!this.isPhantom()&&super.showInObjectTree()}isPhantom(){return this._model.isPhantomLine(this)}clonePositionOffset(){return{barOffset:1,xCoordOffset:0,yCoordOffset:0}}template(){const e=super.template(),t=this.properties().childs();return e.text=t.text.value(),e.position=t.position.value(),e}shouldBeRemovedOnDeselect(){const e=this._properties.childs();if(e.showImage.value())return!1;return""===e.text.value().trim()}editableTextProperties(){return{text:this.properties().childs().text,textColor:this._textColorProperty}}activateEditingOnCreation(){return!0}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolsignpost",state:t,theme:e});return this._configureProperties(i),i}_createPointProperty(e){super._createPointProperty(e);const t=this._pointsProperty.childs().points[e];t.removeProperty("price"),t.removeProperty("bar"),t.addChild("price",new $t(this)),t.addChild("bar",new Zt(this,0))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text),this.properties().childs().position.setValue(e.position)}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,795321)).then((e=>e.SignpostDefinitionsViewModel))}static _configureProperties(e){N.LineDataSource._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.hasChild("position")||e.addChild("position",new c.Property(50)),e.addExcludedKey("text",1),e.addExcludedKey("position",1),e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().plateColor]))}}Jt.supportPhantomMode=!0;var ei=i(349811);class ti extends ei.LineToolBrushBase{constructor(e,t,i,r){super(e,t??ti.createProperties(e.backgroundTheme().spawnOwnership()),i,r),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Brush"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolbrush",state:t,theme:e});return this._configureProperties(i),i}_loadPaneViews(e){Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,932038)).then((t=>{this._setPaneViews([new t.BrushPaneView(this,e)])}))}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,540706)).then((e=>e.BrushDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().backgroundColor],e.childs().fillBackground)),e.hasChild("linestyle")&&e.removeProperty("linestyle"),e.hasChild("linesStyles")&&e.removeProperty("linesStyles")}}var ii=i(479530)
;class ri extends N.LineDataSource{constructor(e,t,r,s){super(e,t??ri.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._hasEditableCoordinates=new W.WatchedValue(!1),this.version=2,this._dist=null,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,804076)).then((({ArcPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)}))}startChanging(e,t){if(super.startChanging(e,t),0===e||1===e){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),i=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[2]));this._dist=(0,Nt.distanceToLine)(e,t,i).distance;const s=t.subtract(e),n=new S.Point(-s.y,s.x),o=e.add(t).scaled(.5);i.subtract(o).dotProduct(n)<0&&(this._dist=-this._dist)}}endChanging(e,t){return this._dist=null,super.endChanging(e,t)}pointsCount(){return 3}name(){return"Arc"}setPoint(e,t){const i={...t},s=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),o=this._model.mainSeries().interval();switch(e){case 0:{const e=(0,r.ensureNotNull)(this._dist),t=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),s=n.subtract(t),l=t.add(n).scaled(.5);let a=new S.Point(-s.y,s.x);a=a.normalized();const c=l.add(a.scaled(e));this._points[0]={...i,interval:o},this._points[2]={...(0,r.ensureNotNull)(this.screenPointToPoint(c)),interval:o};break}case 1:{const e=(0,r.ensureNotNull)(this._dist),t=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),n=t.subtract(s),l=s.add(t).scaled(.5),a=new S.Point(-n.y,n.x).normalized(),c=l.add(a.scaled(e));this._points[1]={...i,interval:o},this._points[2]={...(0,r.ensureNotNull)(this.screenPointToPoint(c)),interval:o};break}case 2:{let e=(0,r.ensureNotNull)(this.pointToScreenPoint(i));const t=(0,Nt.distanceToLine)(s,n,e).distance,l=n.subtract(s),a=s.add(n).scaled(.5),c=new S.Point(-l.y,l.x).normalized(),h=a.add(c.scaled(t)),u=a.add(c.scaled(-t)),d=l.length(),p=l.x/d,_=l.y/d;let P=Math.acos(p);_<0&&(P=-P);let g=(0,ii.translationMatrix)(-a.x,-a.y);e=(0,ii.transformPoint)(g,e);let m=(0,ii.transformPoint)(g,h);g=(0,ii.rotationMatrix)(-P),e=(0,ii.transformPoint)(g,e),m=(0,ii.transformPoint)(g,m),g=(0,ii.scalingMatrix)(1,d/(2*t)),e=(0,ii.transformPoint)(g,e),m=(0,ii.transformPoint)(g,m);const f=e.y*m.y>=0?new S.Point(h.x,h.y):new S.Point(u.x,u.y);this._points[2]={...(0,r.ensureNotNull)(this.screenPointToPoint(f)),interval:o};break}}this._normalizePoints()}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=this._model.mainSeries().interval(),t=(2*this._points[0].price+3*this._points[1].price)/5;this._points.push({price:t,index:this._points[1].index,interval:e})}if(1===e&&2===this._timePoint.length){const e={price:(2*this._timePoint[0].price+3*this._timePoint[1].price)/5,offset:this._timePoint[1].offset,time_t:this._timePoint[1].time_t,interval:this._properties.childs().interval.value()};this._timePoint.push(e)}}static createProperties(e,t){
const i=new L.DefaultProperty({defaultName:"linetoolarc",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,853701))).GeneralFiguresDefinitionsViewModelBase}static _configureProperties(e){super._configureProperties(e),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color]))}}var si=i(68777),ni=i(398290),oi=i(626185);class li extends h.InplaceTextLineDataSource{constructor(e,t,r,s){super(e,t||li.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._barOffset=0,this._dragStartLeftEdgeIndex=NaN,this._timeScale=e.timeScale(),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,318281)).then((e=>{this._paneView=new e.CalloutPaneView(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this)),this._setPaneViews([this._paneView])}))}pointsCount(){return 2}name(){return"Callout"}getBarOffset(){return this._barOffset}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.color,wordWrap:e.wordWrap}}removeIfEditableTextIsEmpty(){return!0}activateEditingOnCreation(){return!0}shouldBeRemovedOnDeselect(){const e=this._properties.childs().text.value().trim();return this._points.length===this.pointsCount()&&""===e}addPoint(e){const t=super.addPoint(e);return t&&this._calculateBarOffset(),t}setLastPoint(e){const t=super.setLastPoint(e);return 2===this.points().length&&this._calculateBarOffset(),t}setPoint(e,t){switch(e){case 0:super.setPoint(e,t),this._calculateBarOffset();break;case 1:const i=this.properties().childs();if(!i.wordWrapWidth)return;const r=this._points,s=this._dragStartLeftEdgeIndex,n=Math.round((t.index-s)/2),o=this._model.mainSeries().interval();if(isFinite(s)&&isFinite(n)){r[1]={index:s+n,price:r[1].price,interval:o},this._calculateBarOffset(),this._normalizePoints();const e=this._timeScale.indexToCoordinate(s+2*n)-this._timeScale.indexToCoordinate(s)-8-2;if(!isFinite(e))return;i.wordWrapWidth.setValue(Math.max(100,e));break}r[1]={...t,interval:o},this._calculateBarOffset(),this._normalizePoints()}}setPoints(e){super.setPoints(e);const t=this.properties().childs();if(!t.wordWrapWidth)return;const i=this._dragStartLeftEdgeIndex,r=Math.round((e[1].index-i)/2);if(this._calculateBarOffset(),this._normalizePoints(),isFinite(i)&&isFinite(r)){const e=this._timeScale.indexToCoordinate(i+2*r)-this._timeScale.indexToCoordinate(i)-8-2;if(!isFinite(e))return;t.wordWrapWidth.setValue(Math.max(100,e))}}move(e,t,i){super.move(e,t,i),this._calculateBarOffset()}state(e){const t=super.state(e);return t.barOffset=this._barOffset,t}restoreData(e){e.barOffset?this._barOffset=e.barOffset:this._calculateBarOffset(),this.calculatePoint2()}setPriceScale(e){super.setPriceScale(e),e&&e.priceRange()&&this.calculatePoint2()}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}calculatePoint2(){
if(this._model.lineBeingEdited()===this||this._model.sourcesBeingMoved().includes(this))return;if(this._points.length<2)return;const[e,t]=this.points();this._points[1]={price:t.price,index:e.index+this._barOffset,interval:this._model.mainSeries().interval()}}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolcallout",state:t,theme:e});return this._configureProperties(i),i}_applyTemplateImpl(e){this.properties().childs().text.setValue(e.text),super._applyTemplateImpl(e)}_correctPoints(e,t){if(e.length<this.pointsCount()||null===this._currentMovingPoint||void 0===this._currentMovingPoint.logical||null===this._startMovingPoint||void 0===this._startMovingPoint.logical)return!1;const i=this._currentMovingPoint.logical.index-this._startMovingPoint.logical.index,r=this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price,s=e[1];return s.index=s.index+i,s.price+=r,e[1]=s,!0}_onPointsetUpdated(e){super._onPointsetUpdated(e),0!==e.length&&(1===this._points.length&&this._points.push(this._points[0]),this._dragStartLeftEdgeIndex=this.points()[1].index)}_normalizePoint(e,t){return 0===t?super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t):super._normalizePoint(e,t)}_createDataSourceBackgroundColorWV(){const e=(0,ni.generateColorCached)(),{backgroundColor:t,transparency:i}=this.properties().childs();return(0,si.combine)(((t,i)=>e(t,i)),(0,oi.convertPropertyToWatchedValue)(t).ownership(),(0,oi.convertPropertyToWatchedValue)(i).ownership()).ownership()}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,882050))).CalloutDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().color]))}_calculateBarOffset(){this.points().length>1&&(this._barOffset=this.points()[1].index-this.points()[0].index)}}var ai=i(359983);class ci extends h.InplaceTextLineDataSource{constructor(e,t,r,s){super(e,t??ci.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._priceAxisView=new M(this),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,265769)).then((({HorzLinePaneView:e})=>{this._setPaneViews([new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}))}state(e){const t=super.state(e);return t.points&&0!==t.points.length&&(t.points[0].offset=0),t}pointsCount(){return 1}name(){return"Horizontal Line"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}timeAxisViews(){return null}timeAxisPoints(){return[]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}canHasAlert(){return!0}template(){const e=super.template()
;return e.text=this.properties().childs().text.value(),e}denormalizeTimePoints(){this._points=[],this._timePoint.length>0&&this._points.push({price:this._timePoint[0].price,index:0,interval:this._model.mainSeries().interval()})}clearData(){const e=this._points;super.clearData(),this._points=e}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textcolor}}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolhorzline",state:t,theme:e});return this._configureProperties(i),i}_getAlertPlots(){return[this.points()[0].price]}_pointsForPointset(){return[]}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,66897)).then((e=>e.HorizontalLineDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}class hi extends N.LineDataSource{constructor(e,t,r,s){super(e,t??hi.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._priceAxisView=new M(this),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,276831)).then((({HorzRayPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}pointsCount(){return 1}name(){return"Horizontal Ray"}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||!this._model.selection().isSelected(this)&&!this.properties().childs().showPrice.value()||e!==this._model.paneForSource(this)?null:[this._priceAxisView]}updateAllViews(e){super.updateAllViews(e),this._priceAxisView.update(e)}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}canHasAlert(){return!0}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolhorzray",state:t,theme:e});return this._configureProperties(i),i}_getAlertPlots(){const e=this._points[0],t={index:e.index+1,price:e.price},i=this._linePointsToAlertPlot([e,t],null,!1,!0);return null!==i?[i]:[]}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,868929))).HorizontalRayDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text||"")}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addExcludedKey("text",1),e.addChild("textsColors",new a.LineToolColorsProperty([(0,r.ensureDefined)(e.child("textcolor"))]))}}var ui=i(770885),di=i(920553);const pi={intervalsVisibilities:{...re.intervalsVisibilitiesDefaults},color:mt.colors.colorGrapesPurple500,fillBackground:!0,backgroundColor:mt.colors.colorGrapesPurple500Alpha20,
linewidth:di.DEFAULT_LINE_TOOL_LINE_WIDTH,transparency:50,horzLabelsAlign:je.HorizontalAlign.Center,vertLabelsAlign:je.VerticalAlign.Middle,textColor:mt.colors.colorGrapesPurple500,fontSize:14,bold:!1,italic:!1,extendLeft:!1,extendRight:!1,middleLine:{showLine:!1,lineWidth:1,lineColor:mt.colors.colorGrapesPurple500,lineStyle:ui.LineStyle.Dashed},linestyle:ui.LineStyle.Solid},_i=new Map([[ee.StdTheme.Light,{}],[ee.StdTheme.Dark,{}]]),Pi=(0,L.extractThemedColors)((0,r.ensureDefined)(_i.get(ee.StdTheme.Light)),(0,r.ensureDefined)(_i.get(ee.StdTheme.Dark))),gi=(0,L.extractAllPropertiesKeys)((0,r.ensureDefined)(_i.get(ee.StdTheme.Light))),mi=(0,L.extractAllPropertiesKeys)(pi),fi=[...new Set([...gi,...mi,...ue.commonLineToolPropertiesStateKeys,"text"])],yi=[...new Set([...gi,...mi,"text"])];class vi extends se.LineDataSourceProperty{constructor(e){super(e),this.hasChild("text")||this.addProperty("text","")}static create(e,t,i){return new this({defaultName:"linetoolrectangle",factoryDefaultsSupplier:()=>(0,te.factoryDefaultsForCurrentTheme)(pi,_i),nonThemedDefaultsKeys:mi,themedDefaultsKeys:gi,allStateKeys:fi,themedColors:Pi,templateKeys:yi,replaceThemedColorsOnThemeChange:!0,state:t,theme:e,useUserPreferences:i})}}class Ci extends h.InplaceTextLineDataSource{constructor(e,t,r,s){super(e,t??Ci.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,323466)).then((({RectanglePaneView:t})=>{const i=[new t(this,e,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))];this._setPaneViews(i)}))}pointsCount(){return 2}name(){return"Rectangle"}setPoint(e,t,i){if(e<2)return void super.setPoint(e,t,i);if(this._snapTo45DegreesApplicable(i)){const i=this._getSnapTo45DegreesAnchorPoint(e);if(e>=4)return this._correctMiddlePoints(e,t,i),void this._normalizePoints();this.snapPoint45Degree(t,i)}const r=this._model.mainSeries().interval();switch(e){case 2:this._points[1].price=t.price,this._points[0].index=t.index,this._points[0].interval=r;break;case 3:this._points[0].price=t.price,this._points[1].index=t.index,this._points[1].interval=r;break;case 4:this._points[0].index=t.index,this._points[0].interval=r;break;case 5:this._points[1].index=t.index,this._points[1].interval=r;break;case 6:this._points[0].price=t.price;break;case 7:this._points[1].price=t.price}this._normalizePoints()}getPoint(e){return e<2?super.getPoint(e):this._getAnchorPointForIndex(e)}template(){return this._properties.template()}snapTo45DegreesAvailable(){return!0}snapPoint45Degree(e,t,i){const s=this._priceScale,n=this.ownerSource();if(null===s||null===n)return;const o=n.firstValue();if(null===o)return;const l=this._model.timeScale(),a=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),c=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),h=a.x-c.x,u=a.y-c.y,d=h<0?-1:1,p=u<0?-1:1,_=Math.max(Math.abs(h),Math.abs(u)),P=Math.round(l.coordinateToIndex(c.x+_*d)),g=Math.abs(l.indexToCoordinate(P)-c.x),m=s.coordinateToPrice(c.y+g*p,o);e.index=P,
e.price=m}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textColor}}static createProperties(e,t,i){const r=vi.create(e,t,i);return this._configureProperties(r),r}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,985034)).then((e=>e.RectangleDefinitionsViewModel))}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_createDataSourceBackgroundColorWV(){const{fillBackground:e,backgroundColor:t}=this.properties().childs();return(0,si.combine)(((e,t)=>e?t:null),(0,oi.convertPropertyToWatchedValue)(e).ownership(),(0,oi.convertPropertyToWatchedValue)(t).ownership()).ownership()}_correctMiddlePoints(e,t,i){e<6?this._correctRightLeftMiddlePoint(e,t,i):this._correctTopBottomMiddlePoint(e,t,i)}_correctRightLeftMiddlePoint(e,t,i){const s=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),n=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),o=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),l=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1]));let a=s.x-n.x;if(0===a)return;const c=o.x<l.x?1:-1,h=o.y<l.y?1:-1;switch(a*=c,e){case 4:{const e=l.y-h*a/2,t=(0,r.ensureNotNull)(this.screenPointToPoint(new S.Point(l.x,e)));this._points[1].price=t.price;const i=(0,r.ensureNotNull)(this.screenPointToPoint(new S.Point(o.x+c*a,o.y+h*a/2)));this._points[0].price=i.price,this._points[0].index=i.index;break}case 5:{const e=o.y-h*a/2,t=(0,r.ensureNotNull)(this.screenPointToPoint(new S.Point(o.x,e)));this._points[0].price=t.price;const i=(0,r.ensureNotNull)(this.screenPointToPoint(new S.Point(l.x+c*a,l.y+h*a/2)));this._points[1].price=i.price,this._points[1].index=i.index;break}}}_correctTopBottomMiddlePoint(e,t,i){const s=this._priceScale,n=this.ownerSource();if(null===s||null===n)return;const o=this._model.timeScale(),l=n.firstValue();if(null===l)return;const a=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),c=(0,r.ensureNotNull)(this.pointToScreenPoint(i)),h=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),u=(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[1])),d=a.y-c.y,p=d<0?-1:1,_=h.x<u.x?1:-1,P=h.y<u.y?1:-1;switch(e){case 6:{const e=Math.floor(u.x-_*d/2),t=(0,r.ensureNotNull)(this.screenPointToPoint(new S.Point(e,u.y))),i=Math.abs(this._points[1].index-t.index),n=_*P*p*Math.ceil(i/2);if(0===n)return;this._points[1].index=this._points[1].index-n;const a=p*Math.abs(o.indexToCoordinate(this._points[1].index)-u.x);this._points[0].price=s.coordinateToPrice(h.y+a,l),this._points[0].index=this._points[0].index+n;break}case 7:{const e=Math.floor(h.x-_*d/2),t=(0,r.ensureNotNull)(this.screenPointToPoint(new S.Point(e,h.y))),i=Math.abs(this._points[0].index-t.index),n=_*P*p*Math.ceil(i/2);if(0===n)return;this._points[0].index=this._points[0].index-n;const a=p*Math.abs(o.indexToCoordinate(this._points[0].index)-h.x);this._points[1].price=s.coordinateToPrice(u.y+a,l),this._points[1].index=this._points[1].index+n;break}}}
static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor])),e.addExcludedKey("text",1),e.addExcludedKey("linesColors",1),e.addExcludedKey("textsColors",1)}_getAnchorPointForIndex(e){const t=this.points(),i=t[0],r=t[1];let s=0,n=0;switch(e){case 0:s=i.price,n=i.index;break;case 1:s=r.price,n=r.index;break;case 2:s=r.price,n=i.index;break;case 3:s=i.price,n=r.index;break;case 4:s=(r.price+i.price)/2,n=i.index;break;case 5:s=(r.price+i.price)/2,n=r.index;break;case 6:s=i.price,n=(r.index+i.index)/2;break;case 7:s=r.price,n=(r.index+i.index)/2}return{index:n,price:s}}_getSnapTo45DegreesAnchorPoint(e){if(e>=4)return this._getAnchorPointForIndex(e);const t=this.points(),i=t[0],r=t[1];let s=0,n=0;switch(e){case 0:s=r.price,n=r.index;break;case 1:s=i.price,n=i.index;break;case 2:s=i.price,n=r.index;break;case 3:s=r.price,n=i.index}return{index:n,price:s}}}class wi extends h.InplaceTextLineDataSource{constructor(e,t,r,s){super(e,t??wi.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,350690)).then((({CirclePaneView:t})=>{const i=[new t(this,e,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))];this._setPaneViews(i)}))}pointsCount(){return 2}name(){return"Circle"}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}snapTo45DegreesAvailable(){return!0}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textColor}}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolcircle",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,92652))).EllipseCircleDefinitionsViewModel}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_createDataSourceBackgroundColorWV(){const{fillBackground:e,backgroundColor:t}=this.properties().childs();return(0,si.combine)(((e,t)=>e?t:null),(0,oi.convertPropertyToWatchedValue)(e).ownership(),(0,oi.convertPropertyToWatchedValue)(t).ownership()).ownership()}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("linesWidths",new a.LineToolWidthsProperty([e.childs().linewidth])),e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().backgroundColor])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor])),e.addExcludedKey("linesColors",3),e.addExcludedKey("linesWidths",3),e.addExcludedKey("backgroundsColors",3),e.addExcludedKey("textsColors",3),e.addExcludedKey("text",1)}}
class xi extends h.InplaceTextLineDataSource{constructor(e,t,r,s){super(e,t??xi.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._hasEditableCoordinates=new W.WatchedValue(!1),this._radius2=0,this._fakePoint=null,this.version=2,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,132004)).then((({EllipsePaneView:e})=>{this._setPaneViews([new e(this,this._model,this._openTextEditor.bind(this),this._closeTextEditor.bind(this))])}))}snapTo45DegreesAvailable(){return!0}startChanging(e,t){super.startChanging(e,t),this._radius2=(0,Nt.distanceToLine)(this._screenPoint(0),this._screenPoint(1),this._screenPoint(2)).distance}addPoint(e,t,i){let r;const s=1===this._points.length?this._preparePoint(e,t):e;return r=this._addPointIntenal(s,t,i),2===this._points.length&&this._snapTo45DegreesApplicable(t)&&(r=this._addPointIntenal(this._calcPoint2(),t,i)),r&&(this._fakePoint=null),r}setPoint(e,t,i,s){const n={...t},o=this._model.mainSeries().interval();switch(e){case 0:case 1:const t=this._snapTo45DegreesApplicable(i);t&&this.snapPoint45Degree(n,this._points[0===e?1:0]),this._setPoint(e,{...n,interval:o}),this._setPoint(2,{...this._calcPoint2(void 0,void 0,t?void 0:this._radius2),interval:o}),t&&this._points[0].index===this._points[1].index&&this._fixVerticalDiameterPoints(this._points[0===e?0:1],this._points[0===e?1:0],this._points[2]);break;case 2:case 3:const s=this._screenPoint(0),l=this._screenPoint(1),a=(0,r.ensureNotNull)(this.pointToScreenPoint(n)),c=(0,Nt.distanceToLine)(s,l,a).distance,h=l.subtract(s),u=s.add(l).scaled(.5),d=new S.Point(-h.y,h.x).normalized(),p=u.add(d.scaled(c));this._setPoint(2,{...(0,r.ensureNotNull)(this.screenPointToPoint(p)),interval:o})}this._normalizePoints()}points(){const e=super.points();return 2===e.length&&this._fakePoint&&e.push(this._fakePoint),e}pointsCount(){return 3}name(){return"Ellipse"}migrateVersion(e,t,i){if(1===e&&2===this._points.length){const e=this._model.mainSeries().interval(),t=this._points[0].price,i=.5*(this._points[0].price+this._points[1].price);this._points[0]={price:i,index:this._points[0].index,interval:e},this._points[1]={price:i,index:this._points[1].index,interval:e},this._points.push({price:t,index:this._points[0].index,interval:e})}if(1===e&&2===this._timePoint.length){const e=this._timePoint[0].price,t=.5*(this._timePoint[0].price+this._timePoint[1].price);this._timePoint[0].price=t,this._timePoint[1].price=t;const i={price:e,offset:this._timePoint[0].offset,time_t:this._timePoint[0].time_t,interval:this._properties.childs().interval.value()};this._timePoint.push(i)}}template(){const e=super.template();return e.text=this.properties().childs().text.value(),e}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.textColor}}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolellipse",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,92652))).EllipseCircleDefinitionsViewModel}_preparePoint(e,t){const i=this._preparePointInternal(e,this._points[0],t),r=this._points[1]??this._lastPoint;return this._snapTo45DegreesApplicable(t)&&this._points[0].index===r.index&&this._fixVerticalDiameterPoints(r,this._points[0],i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_createDataSourceBackgroundColorWV(){const{fillBackground:e,backgroundColor:t}=this.properties().childs();return(0,si.combine)(((e,t)=>e?t:null),(0,oi.convertPropertyToWatchedValue)(e).ownership(),(0,oi.convertPropertyToWatchedValue)(t).ownership()).ownership()}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new c.Property("")),e.addChild("linesColors",new a.LineToolColorsProperty([e.childs().color])),e.addChild("textsColors",new a.LineToolColorsProperty([e.childs().textColor])),e.addExcludedKey("text",1)}_preparePointInternal(e,t,i){const s={...e};return this._fakePoint=null,this._snapTo45DegreesApplicable(i)&&1===this._points.length&&(this.snapPoint45Degree(s,t),this._fakePoint=this._calcPoint2((0,r.ensureNotNull)(this.pointToScreenPoint(t)),(0,r.ensureNotNull)(this.pointToScreenPoint(s)))),s}_fixVerticalDiameterPoints(e,t,i){const s=(0,r.ensureNotNull)(this.pointToScreenPoint(e)),n=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),o=this._model.timeScale(),l=o.indexToCoordinate(e.index),a=o.indexToCoordinate(i.index);let c=2*Math.abs(l-a);c*=t.price>e.price?1:-1,e.price=(0,r.ensureNotNull)(this.screenPointToPoint(new S.Point(s.x,n.y+c))).price}_calcPoint2(e,t,i){e=e??this._screenPoint(0),t=t??this._screenPoint(1);const s=Math.atan2(t.y-e.y,t.x-e.x)+Math.PI/2;i=i??t.subtract(e).length()/2;const n=e.add(t).scaled(.5).add(new S.Point(Math.cos(s)*i,Math.sin(s)*i));return(0,r.ensureNotNull)(this.screenPointToPoint(n))}_screenPoint(e){return(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[e]))}}class bi extends N.LineDataSource{constructor(e,t,r,s){super(e,t??bi.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,850597)).then((e=>{this._setPaneViews([new e.TimeCyclesPaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Time Cycles"}setPoint(e,t){const i=(0,Pt.default)(t),r=this._points[0],s=this._points[1];r.price=i.price,s.price=i.price,this._points[e]={...i,interval:this._model.mainSeries().interval()},this._normalizePoints()}addPoint(e,t,i){const r=super.addPoint(e,t,!0);if(r){const e=this._points[0];this._points[1].price=e.price,i||(this._normalizePoints(),this.createServerPoints())}return r}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetooltimecycles",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){
return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,573770))).TimeCyclesPatternDefinitionsViewModel}}class Ti extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Ti.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,687876)).then((e=>{this._setPaneViews([new e.SineLinePaneView(this,this._model)])}))}pointsCount(){return 2}name(){return"Sine Line"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolsineline",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,663732))).CyclicAndSineLinesPatternDefinitionsViewModel}}class Si{constructor(e,t,i){this._source=e,this._segmentIndex=t,this._bars=i??[]}setBars(e){this._bars=e}clone(e){return new Si(e,this._segmentIndex,(0,R.clone)(this._bars))}generate(){this._bars=[];const e=this._source.points(),t=e[this._segmentIndex],i=e[this._segmentIndex+1];if(!t||!i||t.index===i.index)return;const r=this._segmentIndex?t.index+1:t.index,s=Math.sign(i.index-t.index);for(let e=r;e!==i.index;e+=s)this._bars.push(this._createBar())}bars(){return this._bars}setSize(e){if(e<this._bars.length)this._bars.splice(e,this._bars.length-e);else for(;this._bars.length<e;)this._bars.push(this._createBar())}_createBar(){const e=this._source.properties().averageHL.value(),t=this._source.properties().variance.value()/100,i=(0,r.ensureNotNull)(this._source.ownerSource()).base();let s=Math.random();const n=e*(1-2*s)*t;s=Math.random();const o=e*(1+(.5-s)*t),l=n-o/2,a=l+o;return{o:(l+Math.random()*o)/i,h:a/i,l:l/i,c:(l+Math.random()*o)/i}}}class Li extends N.LineDataSource{constructor(e,t,r,s){const n=t??Li.createProperties(e.backgroundTheme().spawnOwnership());if(super(e,n,r,s),this._segments=[],this._finished=!1,this._segmentsPixelsWhileMoving=null,!r){const e=Math.round(this._calculateATR());n.childs().averageHL.setValue(e)}n.childs().averageHL.subscribe(this,this._regenerate),n.childs().variance.subscribe(this,this._regenerate),this._currentAverageHL=n.childs().averageHL.value(),this._currentVariance=n.childs().variance.value(),this._currentInterval=e.mainSeries().interval(),this.properties().onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,384595)).then((t=>{this._setPaneViews([new t.GhostFeedPaneView(this,e)])}))}isSynchronizable(){return!1}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribe(this,this._handleRestoringFactoryDefaults),super.destroy()}propertiesChanged(){super.propertiesChanged(),this._currentAverageHL===this.properties().childs().averageHL.value()&&this._currentVariance===this.properties().childs().variance.value()||this._regenerate()}pointsCount(){return-1}name(){
return"Ghost Feed"}segmentBars(e){return this._segments[e].bars()}segments(){return this._segments}generateBars(e){this._segments.length<=e&&this._segments.push(new Si(this,e)),this._segments[e].generate()}addPoint(e,t,i){if(this._finished)return!0;if(this._points.length>0){const i=this._points[this._points.length-1];if(!t?.isApiEvent()&&i.index===e.index){this._lastPoint=null,this._normalizePoints(),this.createServerPoints();for(let e=0;e<this._points.length;e++)this._createPointProperty(e);return!0}}const r=super.addPoint(e,t,i);return this._points.length>1&&this.generateBars(this._points.length-2),r}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}setPoint(e,t,i,r){if(super.setPoint(e,t,i),e>0){const i=this.points()[e-1],r=t.index-i.index;this._segments[e-1].setSize(Math.abs(r))}if(e<this.points().length-1){const i=this.points()[e+1].index-t.index;this._segments[e].setSize(Math.abs(i))}}state(e){const t=super.state(e);return t.segments=this._segments.map((e=>({bars:[...e.bars()]}))),t}restoreData(e){e.segments&&(this._segments=e.segments.map(((e,t)=>new Si(this,t,e.bars)))),this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value()}onData(e){super.onData(e);if(!this.pointsProperty().childs().points.child("0"))for(let e=0;e<this._points.length;e++)this._createPointProperty(e);this._currentInterval!==this._model.mainSeries().interval()&&(this._regenerate(),this._currentInterval=this._model.mainSeries().interval())}cloneData(e){this._segments=e._segments.map((e=>e.clone(this)))}startMoving(e,t,i,r){super.startMoving(e,t,i,r),this._preparePixelSegments()}move(e,t,i,r){super.move(e,t,i,r),this._restoreSegmentsFromPixels()}endMoving(e,t){return this._segmentsPixelsWhileMoving=null,super.endMoving(e,t)}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolghostfeed",state:t,theme:e});return this._configureProperties(i),i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,353248))).GhostFeedDefinitionsViewModel}_handleRestoringFactoryDefaults(){const e=Math.round(this._calculateATR());this.properties().childs().averageHL.setValue(e)}_regenerate(){this._currentAverageHL=this.properties().childs().averageHL.value(),this._currentVariance=this.properties().childs().variance.value(),this._segments.forEach((e=>e.generate())),this.updateAllViews((0,z.sourceChangeEvent)(this.id())),this._model.updateSource(this)}_calculateATR(){const e=this._model.mainSeries(),t=[];e.bars().each(((e,i)=>{const r=i[2],s=i[3];return null!=r&&null!=s&&t.push(r-s),!1}));let i=0===t.length?0:t.reduce(((e,t)=>e+t),0)/t.length;return i*=e.base(),i}_preparePixelSegments(){const e=this.priceScale(),t=this.ownerSource()?.firstValue()??null;if(null===e||null===t||e.isEmpty()||!e.isLog())return;const i=this.points();this._segmentsPixelsWhileMoving=this._segments.map(((r,s)=>{
const n=i[s].price,o=i[s+1].price,l=e.priceToCoordinate(n,t),a=(e.priceToCoordinate(o,t)-l)/(r.bars().length-1);return{bars:r.bars().map(((i,r)=>{const s=l+r*a,n=e.coordinateToPrice(s,t);return{open:e.priceToCoordinate(n+i.o,t)-s,high:e.priceToCoordinate(n+i.h,t)-s,low:e.priceToCoordinate(n+i.l,t)-s,close:e.priceToCoordinate(n+i.c,t)-s}}))}}))}_restoreSegmentsFromPixels(){const e=this.priceScale(),t=this.ownerSource()?.firstValue()??null;if(null===e||null===t||null===this._segmentsPixelsWhileMoving)return;const i=this.points();this._segmentsPixelsWhileMoving.forEach(((r,s)=>{const n=this._segments[s],o=i[s].price,l=i[s+1].price,a=e.priceToCoordinate(o,t),c=(e.priceToCoordinate(l,t)-a)/(r.bars.length-1),h=n.bars().map(((i,s)=>{const n=r.bars[s],o=a+s*c,l=e.coordinateToPrice(o,t);return{...i,o:e.coordinateToPrice(n.open+o,t)-l,h:e.coordinateToPrice(n.high+o,t)-l,l:e.coordinateToPrice(n.low+o,t)-l,c:e.coordinateToPrice(n.close+o,t)-l}}));n.setBars(h)}))}}class Vi extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Vi.createProperties(e.backgroundTheme().spawnOwnership()),r,s),this._controlPoint=null,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,935773)).then((t=>{this._setPaneViews([new t.BezierQuadroPaneView(this,e)])}))}pointsCount(){return 2}name(){return"Curve"}normalizedPointsForCreating(){const e=super.normalizedPointsForCreating();return[e[0],e[e.length-1]]}setLastPoint(e,t){const i=super.setLastPoint(e,t);return this._controlPoint=this._calculateControlPoint(),i}addPoint(e,t,i){const r=super.addPoint(e,t,i);if(r){const e=this._calculateControlPoint();this._points.push({...e,interval:this._model.mainSeries().interval()}),this._controlPoint=null,i||(this._normalizePoints(),this.createServerPoints()),this._createPointProperty(2)}return r}restorePoints(e,t,i){super.restorePoints(e,t,i),this._createPointProperty(2)}controlPoint(){return this._controlPoint}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolbezierquadro",state:t,theme:e});return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,836549)).then((e=>e.GeneralBezierDefinitionsViewModel))}_calculateControlPoint(){const e=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[0])),t=(0,r.ensureNotNull)(this.pointToScreenPoint(this.points()[1])),i=t.subtract(e).scaled(.5).transposed().scaled(.3),s=e.add(t).scaled(.5).add(i);return(0,r.ensureNotNull)(this.screenPointToPoint(s))}}class Di extends Qe{constructor(e,t,i,r){super(e,t??Di.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Arrow"}static createProperties(e,t){const i=Qe._createPropertiesImpl("linetoolarrow",e,t);return Di._configureProperties(i),i}}class Bi extends Qe{constructor(e,t,i,r){super(e,t??Bi.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Ray"}static createProperties(e,t){
const i=Qe._createPropertiesImpl("linetoolray",e,t);return Bi._configureProperties(i),i}}class ki extends Qe{constructor(e,t,i,r){super(e,t??ki.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Extended Line"}static createProperties(e,t){const i=Qe._createPropertiesImpl("linetoolextended",e,t);return ki._configureProperties(i),i}}class Ai extends at.LineToolPitchfork{constructor(e,t,i,r){super(e,t??Ai.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Modified Schiff Pitchfork"}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolschiffpitchfork",state:t,map:{range:[0,8]},theme:e});return this._configureProperties(i),i}}class Mi extends at.LineToolPitchfork{constructor(e,t,i,r){super(e,t??Mi.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Schiff Pitchfork"}static createProperties(e,t){const i=new o.LevelsProperty({defaultName:"linetoolschiffpitchfork2",state:t,map:{range:[0,8]},theme:e});return this._configureProperties(i),i}}class Ni extends N.LineDataSource{constructor(e,t,r,s){super(e,t??Ni.createProperties(e.backgroundTheme().spawnOwnership()),r,s),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,151418)).then((({FlagMarkPaneView:e})=>{const t=new e(this,this.model());t.setAnchors(new S.Point(0,0)),this._setPaneViews([t])}))}pointsCount(){return 1}name(){return"Flag Mark"}static createProperties(e,t){t&&void 0===t.flagColor&&(t.flagColor="#318757");const i=new L.DefaultProperty({defaultName:"linetoolflagmark",state:t,theme:e});return this._configureProperties(i),i}_normalizePoint(e,t){return super._normalizePointWithoutOffset(e)??super._normalizePoint(e,t)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,293817)).then((e=>e.FlagMarkDefinitionsViewModel))}static _configureProperties(e){super._configureProperties(e),e.addChild("backgroundsColors",new a.LineToolColorsProperty([e.childs().flagColor])),e.addExcludedKey("backgroundsColors",3)}}Ni.version=2;class Ii extends Ot{constructor(e,t,i,r){super(e,t??Ii.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Cypher Pattern"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolcypherpattern",state:t,theme:e});return this._configureProperties(i),i}_loadPaneViews(e){Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,416316)).then((t=>{this._setPaneViews([new t.CypherPaneView(this,e)])}))}}var Ri=i(745331),Fi=i(51061),Ei=i(12259),Oi=i(368005),zi=i(482447);class Wi extends ei.LineToolBrushBase{constructor(e,t,i,r){super(e,t??Wi.createProperties(e.backgroundTheme().spawnOwnership()),i,r),this._loadPaneViews(e)}smooth(){return this.properties().childs().smooth.value()}name(){return"Highlighter"}static createProperties(e,t){const i=new L.DefaultProperty({defaultName:"linetoolhighlighter",state:t,theme:e})
;return this._configureProperties(i),i}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,376817)).then((e=>e.HighlighterDefinitionsViewModel))}_loadPaneViews(e){Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,82637)).then((t=>{this._setPaneViews([new t.HighlighterPaneView(this,e)])}))}static _configureProperties(e){super._configureProperties(e),e.addChild("widths",new a.LineToolWidthsProperty([e.childs().width])),e.addExcludedKey("widths",3)}}var Ki=i(87347),Hi=i(774440);const Ui=new Map;Ui.set("LineToolFibRetracement",g),Ui.set("LineToolFibChannel",f),Ui.set("LineToolProjection",v),Ui.set("LineToolTrendBasedFibExtension",w),Ui.set("LineToolElliott",x.LineToolElliott),Ui.set("LineToolFibCircles",T),Ui.set("LineToolVertLine",B),Ui.set("LineToolCrossLine",I),Ui.set("LineToolBarsPattern",j),Ui.set("LineToolTrendBasedFibTime",$),Ui.set("LineToolFibTimeZone",Z),Ui.set("LineToolDateRange",ye),Ui.set("LineToolPriceRange",Le),Ui.set("LineToolDateAndPriceRange",Re),Ui.set("LineToolParallelChannel",ze),Ui.set("LineToolTrendAngle",Ke),Ui.set("LineToolTrendLine",Qe),Ui.set("LineToolInfoLine",Ge),Ui.set("LineToolArrowMark",Xe),Ui.set("LineToolGannSquare",it),Ui.set("LineToolGannComplex",rt.LineToolGannComplex),Ui.set("LineToolGannFixed",nt),Ui.set("LineToolGannFan",lt),Ui.set("LineToolPitchfork",at.LineToolPitchfork),Ui.set("LineToolDisjointAngle",ct),Ui.set("LineToolFlatBottom",ht),Ui.set("LineToolIcon",Tt),Ui.set("LineToolSticker",Mt),Ui.set("LineToolRotatedRectangle",It),Ui.set("LineToolHeadAndShoulders",Rt),Ui.set("LineToolTriangle",Ft),Ui.set("LineToolTrianglePattern",Et),Ui.set("LineTool5PointsPattern",Ot),Ui.set("LineToolThreeDrivers",zt),Ui.set("LineToolABCD",Wt),Ui.set("LineToolPolyline",Ht),Ui.set("LineToolPath",Ut),Ui.set("LineToolPrediction",Qt),Ui.set("LineToolPriceLabel",Gt),Ui.set("LineToolArrowMarker",jt),Ui.set("LineToolSignpost",Jt),Ui.set("LineToolBrush",ti),Ui.set("LineToolArc",ri),Ui.set("LineToolCallout",li),Ui.set("LineToolText",ai.LineToolText),Ui.set("LineToolHorzLine",ci),Ui.set("LineToolHorzRay",hi),Ui.set("LineToolRectangle",Ci),Ui.set("LineToolCircle",wi),Ui.set("LineToolEllipse",xi),Ui.set("LineToolTimeCycles",bi),Ui.set("LineToolSineLine",Ti),Ui.set("LineToolGhostFeed",Li),Ui.set("LineToolBezierQuadro",Vi),Ui.set("LineToolArrow",Di),Ui.set("LineToolRay",Bi),Ui.set("LineToolExtended",ki),Ui.set("LineToolSchiffPitchfork",Ai),Ui.set("LineToolSchiffPitchfork2",Mi),Ui.set("LineToolTextAbsolute",ai.LineToolTextAbsolute),Ui.set("LineToolArrowMarkLeft",$e),Ui.set("LineToolArrowMarkRight",Ze),Ui.set("LineToolArrowMarkUp",Ye),Ui.set("LineToolArrowMarkDown",Je),Ui.set("LineToolFlagMark",Ni),Ui.set("LineToolCypherPattern",Ii),Ui.set("LineToolElliottImpulse",x.LineToolElliottImpulse),Ui.set("LineToolElliottTriangle",x.LineToolElliottTriangle),Ui.set("LineToolElliottTripleCombo",x.LineToolElliottTripleCombo),
Ui.set("LineToolElliottCorrection",x.LineToolElliottCorrection),Ui.set("LineToolElliottDoubleCombo",x.LineToolElliottDoubleCombo),Ui.set("LineToolRiskRewardLong",Ri.LineToolRiskRewardLong),Ui.set("LineToolRiskRewardShort",Fi.LineToolRiskRewardShort),Ui.set("LineToolPosition",Ei.LineToolPosition),Ui.set("LineToolOrder",Oi.LineToolOrder),Ui.set("LineToolHighlighter",Wi),Ui.set("LineToolImage",zi.LineToolImage)
;const qi=new Map([["LineToolPriceNote",async()=>(await Promise.all([i.e(64984),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(77940),i.e(380)]).then(i.bind(i,742550))).LineToolPriceNote],["LineToolTextNote",async()=>(await Promise.all([i.e(41601),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(77940),i.e(89123)]).then(i.bind(i,83303))).LineToolTextNote],["LineToolNote",async()=>(await Promise.all([i.e(51081),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(23248)]).then(i.bind(i,230853))).LineToolNote],["LineToolFibSpiral",async()=>(await Promise.all([i.e(90646),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(78090)]).then(i.bind(i,359549))).LineToolFibSpiral],["LineToolCircleLines",async()=>(await Promise.all([i.e(31440),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(59445)]).then(i.bind(i,641593))).LineToolCyclicLines],["LineToolNoteAbsolute",async()=>(await Promise.all([i.e(51081),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(23248)]).then(i.bind(i,230853))).LineToolNoteAbsolute],["LineToolTable",async()=>(await Promise.all([i.e(31454),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(96824),i.e(30319)]).then(i.bind(i,580464))).LineToolTable],["LineToolFibSpeedResistanceArcs",async()=>(await Promise.all([i.e(41042),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(62622),i.e(83710)]).then(i.bind(i,99232))).LineToolFibSpeedResistanceArcs],["LineToolPitchfan",async()=>(await Promise.all([i.e(71390),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(71313)]).then(i.bind(i,505491))).LineToolPitchfan],["LineToolFibSpeedResistanceFan",async()=>(await Promise.all([i.e(74254),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(90906)]).then(i.bind(i,333465))).LineToolFibSpeedResistanceFan],["LineToolFibWedge",async()=>(await Promise.all([i.e(79782),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(62622),i.e(83314)]).then(i.bind(i,776226))).LineToolFibWedge],["LineToolEmoji",async()=>(await Promise.all([i.e(78608),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(5262),i.e(25529)]).then(i.bind(i,880531))).LineToolEmoji],["LineToolBalloon",async()=>(await Promise.all([i.e(51088),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(81277)]).then(i.bind(i,572160))).LineToolBalloon],["LineToolComment",async()=>(await Promise.all([i.e(51088),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(81277),i.e(83966)]).then(i.bind(i,302497))).LineToolComment],["LineToolBezierCubic",async()=>(await Promise.all([i.e(46621),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(29014)]).then(i.bind(i,639868))).LineToolBezierCubic],["LineToolInsidePitchfork",async()=>(await i.e(88468).then(i.bind(i,857784))).LineToolInsidePitchfork]]);qi.set("LineToolTweet",(async()=>(await Promise.all([i.e(89218),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(21410),i.e(45938)]).then(i.bind(i,537070))).LineToolTweet)),
qi.set("LineToolIdea",(async()=>(await Promise.all([i.e(57450),i.e(19190),i.e(93240),i.e(54468),i.e(38110),i.e(25214),i.e(63317),i.e(35632),i.e(9263),i.e(4171),i.e(21410),i.e(32423)]).then(i.bind(i,745146))).LineToolIdea));const Qi=new Map,Gi=new Map([["LineToolAnchoredVWAP",async()=>(await Promise.all([i.e(7815),i.e(23301),i.e(55500)]).then(i.bind(i,45613))).LineToolAnchoredVWAP],["LineToolRegressionTrend",async()=>(await i.e(99748).then(i.bind(i,481770))).LineToolRegressionTrend],["LineToolVbPFixed",async()=>(await Promise.all([i.e(7815),i.e(23301),i.e(95695)]).then(i.bind(i,874180))).LineToolVbPFixed],["LineToolFixedRangeVolumeProfile",async()=>(await Promise.all([i.e(7815),i.e(23301),i.e(95695)]).then(i.bind(i,289848))).LineToolFixedRangeVolumeProfile]]);function ji(e){return qi.has(e)||Gi.has(e)||Ui.has(e)}function Xi(e){return Gi.has(e)}function $i(e){return!ji(e)||Ui.has(e)||Qi.has(e)}Gi.set("LineToolAnchoredVolumeProfile",(async()=>(await Promise.all([i.e(7815),i.e(23301),i.e(95695)]).then(i.bind(i,963784))).LineToolAnchoredVolumeProfile));let Yi=0;async function Zi(e){if($i(e))return ir(e);const t=Xi(e);Yi+=1;const i=(0,r.ensureDefined)((t?Gi:qi).get(e)),s=await i();return Yi-=1,t?(Qi.set(e,(0,r.ensureDefined)(s)),ir(e)):(Ui.set(e,(0,r.ensureDefined)(s)),ir(e))}async function Ji(e){await tr(e),ji(e)&&!$i(e)&&await Zi(e)}function er(e){return e}async function tr(e){(function(e){return!!["LineToolRiskRewardLong","LineToolRiskRewardShort"].includes(e)||(0,Hi.isStudyLineTool)(e)||Xi(e)})(e)&&await(0,Ki.studyMetaInfoRepository)().findAllJavaStudies()}function ir(e){return Xi(e)?(0,r.ensureDefined)(Qi.get(e),`Study line tool ${e}`):(0,r.ensureDefined)(Ui.get(e),`Line tool ${e}`)}async function rr(e){return $i(e)?ir(e):Zi(e)}},114134:(e,t,i)=>{i.d(t,{LineToolTradingPriceAxisView:()=>s});var r=i(231842);class s extends r.LineToolPriceAxisView{_formatPrice(e,t){return this._source.formatter().format(e)}}},397007:(e,t,i)=>{i.d(t,{lineToolsStudyIds:()=>r});const r={LineToolAnchoredVWAP:"AnchoredVWAP@tv-basicstudies",LineToolRegressionTrend:"RegressionTrend@tv-basicstudies",LineToolFixedRangeVolumeProfile:"VbPFixed@tv-basicstudies",LineToolVbPFixed:"VbPFixed@tv-volumebyprice"};{const e={LineToolAnchoredVolumeProfile:"VbPAnchored@tv-basicstudies"};for(const[t,i]of Object.entries(e))r[t]=i}},368005:(e,t,i)=>{var r=i(700931).LineToolTrading,s=i(114134).LineToolTradingPriceAxisView,n=i(395817),o=i(318945).LineDataSource,l=i(890390).DefaultProperty;const a=i(931924),c=i(437642).sourceChangeEvent;var h=i(839800).sortSourcesPreOrdered.LineToolOrder;function u(e){return null==e?e="":e+="",e}class d{constructor(e){this._line=e,this._data={bodyText:"order",quantityText:"0"},this._editable=!0,this._cancellable=!0,this._mode="",this._direction="buy",this._active=!0}setMode(e){return this._mode=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setActive(e){return this._active=e,
this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setEditable(e){return this._editable=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getEditable(){return this._editable}setCancellable(e){return this._cancellable=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getCancellable(){return this._cancellable}hasMoveCallback(){return this.isFunction(this._onMoveCallback)}hasModifyCallback(){return this.isFunction(this._onModifyCallback)}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line.setPoint(0,t),this._line.updateAllViewsAndRedraw(c(this._line.id()))}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setTooltip(e){return this._line.properties().tooltip.setValue(u(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setModifyTooltip(e){return this._line.properties().modifyTooltip.setValue(u(e)),this}getModifyTooltip(){return this._line.properties().modifyTooltip.value()}setCancelTooltip(e){return this._line.properties().cancelTooltip.setValue(u(e)),this}getCancelTooltip(){return this._line.properties().cancelTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getExtendLeft(){var e=this._line.properties().extendLeft.value();return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}setLineLength(e,t="percentage"){const i=t&&"pixel"===t?e:Math.max(0,Math.min(e,100));return this._line.properties().lineLength.setValue(i),this._line.properties().lineLengthUnit.setValue(t),this}getLineLengthUnit(){return this._line.properties().lineLengthUnit.value()}getLineColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.lineActiveBuyColor.value():e.lineInactiveBuyColor.value():this._active?e.lineActiveSellColor.value():e.lineInactiveSellColor.value()}setLineColor(e){return"buy"===this._direction?this._active?this.setLineActiveBuyColor(e):this.setLineInactiveBuyColor(e):this._active?this.setLineActiveSellColor(e):this.setLineInactiveSellColor(e),this}setLineActiveBuyColor(e){return this._line.properties().lineActiveBuyColor.setValue(e),this}setLineInactiveBuyColor(e){return this._line.properties().lineInactiveBuyColor.setValue(e),this}setLineActiveSellColor(e){return this._line.properties().lineActiveSellColor.setValue(e),this}setLineInactiveSellColor(e){return this._line.properties().lineInactiveSellColor.setValue(e),this}
getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.bodyBorderActiveBuyColor.value():e.bodyBorderInactiveBuyColor.value():this._active?e.bodyBorderActiveSellColor.value():e.bodyBorderInactiveSellColor.value()}setBodyBorderColor(e){return"buy"===this._direction?this._active?this.setBodyBorderActiveBuyColor(e):this.setBodyBorderInactiveBuyColor(e):this._active?this.setBodyBorderActiveSellColor(e):this.setBodyBorderInactiveSellColor(e),this}setBodyBorderActiveBuyColor(e){return this._line.properties().bodyBorderActiveBuyColor.setValue(e),this}setBodyBorderInactiveBuyColor(e){return this._line.properties().bodyBorderInactiveBuyColor.setValue(e),this}setBodyBorderActiveSellColor(e){return this._line.properties().bodyBorderActiveSellColor.setValue(e),this}setBodyBorderInactiveSellColor(e){return this._line.properties().bodyBorderInactiveSellColor.setValue(e),this}getBodyBackgroundColor(){return n.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return n.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return"limit"===this._mode?this._active?e.bodyTextActiveLimitColor.value():e.bodyTextInactiveLimitColor.value():"stop"===this._mode?this._active?e.bodyTextActiveStopColor.value():e.bodyTextInactiveStopColor.value():"buy"===this._direction?this._active?e.bodyTextActiveBuyColor.value():e.bodyTextInactiveBuyColor.value():this._active?e.bodyTextActiveSellColor.value():e.bodyTextInactiveSellColor.value()}setBodyTextColor(e){return"limit"===this._mode?this._active?this.setBodyTextActiveLimitColor(e):this.setBodyTextInactiveLimitColor(e):"stop"===this._mode?this._active?this.setBodyTextActiveStopColor(e):this.setBodyTextInactiveStopColor(e):"buy"===this._direction?this._active?this.setBodyTextActiveBuyColor(e):this.setBodyTextInactiveBuyColor(e):this._active?this.setBodyTextActiveSellColor(e):this.setBodyTextInactiveSellColor(e),this}setBodyTextInactiveLimitColor(e){return this._line.properties().bodyTextInactiveLimitColor.setValue(e),this}setBodyTextActiveLimitColor(e){return this._line.properties().bodyTextActiveLimitColor.setValue(e),this}setBodyTextInactiveStopColor(e){return this._line.properties().bodyTextInactiveStopColor.setValue(e),this}setBodyTextActiveStopColor(e){return this._line.properties().bodyTextActiveStopColor.setValue(e),this}setBodyTextInactiveBuyColor(e){
return this._line.properties().bodyTextInactiveBuyColor.setValue(e),this}setBodyTextActiveBuyColor(e){return this._line.properties().bodyTextActiveBuyColor.setValue(e),this}setBodyTextInactiveSellColor(e){return this._line.properties().bodyTextInactiveSellColor.setValue(e),this}setBodyTextActiveSellColor(e){return this._line.properties().bodyTextActiveSellColor.setValue(e),this}getBodyFont(){return n.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){return n.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBorderActiveBuyColor.value():e.quantityBorderInactiveBuyColor.value():this._active?e.quantityBorderActiveSellColor.value():e.quantityBorderInactiveSellColor.value()}setQuantityBorderColor(e){return"buy"===this._direction?this._active?this.setQuantityBorderActiveBuyColor(e):this.setQuantityBorderInactiveBuyColor(e):this._active?this.setQuantityBorderActiveSellColor(e):this.setQuantityBorderInactiveSellColor(e),this}setQuantityBorderActiveBuyColor(e){return this._line.properties().quantityBorderActiveBuyColor.setValue(e),this}setQuantityBorderInactiveBuyColor(e){return this._line.properties().quantityBorderInactiveBuyColor.setValue(e),this}setQuantityBorderActiveSellColor(e){return this._line.properties().quantityBorderActiveSellColor.setValue(e),this}setQuantityBorderInactiveSellColor(e){return this._line.properties().quantityBorderInactiveSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.quantityBackgroundActiveBuyColor.value():e.quantityBackgroundInactiveBuyColor.value():this._active?e.quantityBackgroundActiveSellColor.value():e.quantityBackgroundInactiveSellColor.value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this._active?this.setQuantityBackgroundActiveBuyColor(e):this.setQuantityBackgroundInactiveBuyColor(e):this._active?this.setQuantityBackgroundActiveSellColor(e):this.setQuantityBackgroundInactiveSellColor(e),this}setQuantityBackgroundActiveBuyColor(e){return this._line.properties().quantityBackgroundActiveBuyColor.setValue(e),this}setQuantityBackgroundInactiveBuyColor(e){return this._line.properties().quantityBackgroundInactiveBuyColor.setValue(e),this}setQuantityBackgroundActiveSellColor(e){return this._line.properties().quantityBackgroundActiveSellColor.setValue(e),this}setQuantityBackgroundInactiveSellColor(e){return this._line.properties().quantityBackgroundInactiveSellColor.setValue(e),this}getQuantityTextColor(){return n.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){
return n.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return n.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return n.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getCancelButtonBorderColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonBorderActiveBuyColor.value():e.cancelButtonBorderInactiveBuyColor.value():this._active?e.cancelButtonBorderActiveSellColor.value():e.cancelButtonBorderInactiveSellColor.value()}setCancelButtonBorderColor(e){return"buy"===this._direction?this._active?this.setCancelButtonBorderActiveBuyColor(e):this.setCancelButtonBorderInactiveBuyColor(e):this._active?this.setCancelButtonBorderActiveSellColor(e):this.setCancelButtonBorderInactiveSellColor(e),this}setCancelButtonBorderActiveBuyColor(e){return this._line.properties().cancelButtonBorderActiveBuyColor.setValue(e),this}setCancelButtonBorderInactiveBuyColor(e){return this._line.properties().cancelButtonBorderInactiveBuyColor.setValue(e),this}setCancelButtonBorderActiveSellColor(e){return this._line.properties().cancelButtonBorderActiveSellColor.setValue(e),this}setCancelButtonBorderInactiveSellColor(e){return this._line.properties().cancelButtonBorderInactiveSellColor.setValue(e),this}getCancelButtonBackgroundColor(){return n.getColorFromProperties(this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency)}setCancelButtonBackgroundColor(e){return n.setColorToProperties(e,this._line.properties().cancelButtonBackgroundColor,this._line.properties().cancelButtonBackgroundTransparency),this}getCancelButtonIconColor(){var e=this._line.properties();return"buy"===this._direction?this._active?e.cancelButtonIconActiveBuyColor.value():e.cancelButtonIconInactiveBuyColor.value():this._active?e.cancelButtonIconActiveSellColor.value():e.cancelButtonIconInactiveSellColor.value()}setCancelButtonIconColor(e){return"buy"===this._direction?this._active?this.setCancelButtonIconActiveBuyColor(e):this.setCancelButtonIconInactiveBuyColor(e):this._active?this.setCancelButtonIconActiveSellColor(e):this.setCancelButtonIconInactiveSellColor(e),this}setCancelButtonIconActiveBuyColor(e){return this._line.properties().cancelButtonIconActiveBuyColor.setValue(e),this}setCancelButtonIconInactiveBuyColor(e){return this._line.properties().cancelButtonIconInactiveBuyColor.setValue(e),this}setCancelButtonIconActiveSellColor(e){return this._line.properties().cancelButtonIconActiveSellColor.setValue(e),this}setCancelButtonIconInactiveSellColor(e){return this._line.properties().cancelButtonIconInactiveSellColor.setValue(e),this}block(){this._blocked=!0,
this._line.updateAllViewsAndRedraw(c(this._line.id()))}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw(c(this._line.id()))}getBlocked(){return this._blocked}isFunction(e){return"function"==typeof e}onCancel(e,t){return t?this.isFunction(t)&&(this._onCancelData=e,this._onCancelCallback=t):this.isFunction(e)&&(this._onCancelCallback=e),this}callOnCancel(){this.isFunction(this._onCancelCallback)&&this._onCancelCallback.call(this,this._onCancelData)}isOnCancelCallbackPresent(){return this.isFunction(this._onCancelCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onMove(e,t){return t?this.isFunction(t)&&(this._onMoveData=e,this._onMoveCallback=t):this.isFunction(e)&&(this._onMoveCallback=e),this}callOnMove(){this.isFunction(this._onMoveCallback)&&this._onMoveCallback.call(this,this._onMoveData)}onMoving(e,t){return t?this.isFunction(t)&&(this._onMovingData=e,this._onMovingCallback=t):this.isFunction(e)&&(this._onMovingCallback=e),this}callOnMoving(){this.isFunction(this._onMovingCallback)&&this._onMovingCallback.call(this,this._onMovingData)}onContextMenu(e,t){return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class p extends r{constructor(e,t){var r=t||p.createProperties(e.backgroundTheme().spawnOwnership());super(e,r),this._adapter=new d(this),this.setSelectionEnabled(!0),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,228697)).then((({OrderPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}zorder(){return h}isSpeciallyZOrderedSource(){return!0}setPoint(e,t){this._points[e]=t,this._normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}name(){return"Order"}move(e,t,i,r){var s=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.move(e,t,i,r),s&&this._adapter.callOnMoving()}endMoving(e){var t=this._startMovingPoint&&this._currentMovingPoint&&this._startMovingPoint.logical.price!==this._currentMovingPoint.logical.price;super.endMoving(),!e&&t&&this._adapter.callOnMove()}createPriceAxisView(e){var t={pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()};return this._priceAxisView=new s(this,t),this._priceAxisView}paneViews(){
return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showOrders.value()?o.prototype.priceAxisViews.call(this,e,t):null}adapter(){return this._adapter}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}movable(){return Boolean(this._adapter._onMoveCallback)}formatter(){return this._formatter}static createProperties(e,t){var i=new l({defaultName:"linetoolorder",state:t,useUserPreferences:!1,theme:e});return this._configureProperties(i),i}}t.LineToolOrder=p},826787:(e,t,i)=>{i.d(t,{LineToolPitchfork:()=>P});var r=i(650151),s=i(418450),n=i(444372),o=i(172073),l=i(91666),a=i(472354),c=i(318945),h=i(702067),u=i(437642),d=i(959563);const p=new s.TranslatedString("erase level line",n.t(null,void 0,i(735111))),_=new s.TranslatedString("change {title} style",n.t(null,void 0,i(598463)));class P extends c.LineDataSource{constructor(e,t,i,r){super(e,t??P.createProperties(e.backgroundTheme().spawnOwnership()),i,r),this._properties.childs().style.subscribe(this,this._recreatePaneView),this._recreatePaneView()}pointsCount(){return 3}name(){return"Pitchfork"}levelsCount(){return 8}async additionalActions(e){const t=[],r=[{title:n.t(null,void 0,i(546005)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToOriginal"},{title:n.t(null,void 0,i(170382)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToModifiedSchiff"},{title:n.t(null,void 0,i(391612)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToInside"},{title:n.t(null,void 0,i(469904)),actionId:"Chart.LineTool.Pitchfork.ChangeTypeToSchiff"}];for(let i=0;i<4;i++){const n=new o.Action({actionId:r[i].actionId,options:{checked:this.properties().childs().style.value()===i,checkable:!0,label:r[i].title,onExecute:()=>{e.setProperty(this.properties().childs().style,i,_.format({title:new s.TranslatedString(this.name(),this.translatedType())}),a.lineToolsDoNotAffectChartInvalidation),this.updateAllViews((0,u.sourceChangeEvent)(this.id())),this._model.updateSource(this)}}});t.push(n)}return{actions:[t[0],t[3],t[1],t[2]],placement:"CustomAction"}}processErase(e,t){const i="level"+t,s=(0,r.ensureDefined)(this.properties().child(i)).childs().visible;e.setProperty(s,!1,p,a.lineToolsDoNotAffectChartInvalidation)}static createProperties(e,t){const i=new l.LevelsProperty({defaultName:"linetoolpitchfork",state:t,map:{range:[0,8]},theme:e});return this._configureProperties(i),i}async _recreatePaneView(){Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,682985)).then((e=>{let t=[];const i=this._properties.childs().style.value()
;i===d.LineToolPitchforkStyle.Original?t=[new e.PitchforkLinePaneView(this,this._model)]:i===d.LineToolPitchforkStyle.Schiff?t=[new e.SchiffPitchforkLinePaneView(this,this._model)]:i===d.LineToolPitchforkStyle.Schiff2?t=[new e.SchiffPitchfork2LinePaneView(this,this._model)]:i===d.LineToolPitchforkStyle.Inside&&(t=[new e.InsidePitchforkLinePaneView(this,this._model)]),this._setPaneViews(t)}))}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,375944))).PitchForkDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=[e.childs().median.childs().linewidth],i=[e.childs().median.childs().color];for(let s=0;s<=8;s++){const n=(0,r.ensureDefined)(e.child("level"+s));t.push((0,r.ensureDefined)(n.child("linewidth"))),i.push((0,r.ensureDefined)(n.child("color")))}e.addChild("linesColors",new h.LineToolColorsProperty(i)),e.addChild("linesWidths",new h.LineToolWidthsProperty(t))}}},12259:(e,t,i)=>{var r=i(700931).LineToolTrading,s=i(318945).LineDataSource,n=i(114134).LineToolTradingPriceAxisView,o=i(395817),l=i(890390).DefaultProperty;const a=i(931924),c=i(437642).sourceChangeEvent;var h=i(839800).sortSourcesPreOrdered.LineToolPosition;function u(e){return null==e?e="":e+="",e}class d{constructor(e){this._line=e,this._data={bodyText:"position",quantityText:"0"},this._closeEnabled=!0,this._direction="buy",this._profitState="neutral"}setDirection(e){return this._direction=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setProfitState(e){return this._profitState=e,this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getPrice(){return this._line.points().length>0?this._line.points()[0].price:this._line._timePoint.length>0?this._line._timePoint[0].price:void 0}setPrice(e){if(this._line.points().length>0){var t=this._line.points()[0];t.price=e,this._line.setPoint(0,t),this._line.updateAllViewsAndRedraw(c(this._line.id()))}return this._line._timePoint.length>0&&(this._line._timePoint[0].price=e),this}getText(){return this._data.bodyText}setText(e){return this._data.bodyText=e||"",this._line.updateAllViewsAndRedraw(c(this._line.id())),this}setTooltip(e){return this._line.properties().tooltip.setValue(u(e)),this}getTooltip(){return this._line.properties().tooltip.value()}setProtectTooltip(e){return this._line.properties().protectTooltip.setValue(u(e)),this}getProtectTooltip(){return this._line.properties().protectTooltip.value()}setCloseTooltip(e){return this._line.properties().closeTooltip.setValue(u(e)),this}getCloseTooltip(){return this._line.properties().closeTooltip.value()}setReverseTooltip(e){return this._line.properties().reverseTooltip.setValue(u(e)),this}getReverseTooltip(){return this._line.properties().reverseTooltip.value()}getQuantity(){return this._data.quantityText}setQuantity(e){return this._data.quantityText=e||"",this._line.updateAllViewsAndRedraw(c(this._line.id())),this}getExtendLeft(){var e=this._line.properties().extendLeft.value()
;return"inherit"===e?this._line._model.properties().tradingProperties.extendLeft.value():e}setExtendLeft(e){return this._line.properties().extendLeft.setValue(e),this}getLineLength(){var e=this._line.properties().lineLength.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineLength.value():e}getLineLengthUnit(){return this._line.properties().lineLengthUnit.value()}setLineLength(e,t="percentage"){const i=t&&"pixel"===t?e:Math.max(0,Math.min(e,100));return this._line.properties().lineLength.setValue(i),this._line.properties().lineLengthUnit.setValue(t),this}getLineColor(){var e=this._line.properties();return("buy"===this._direction?e.lineBuyColor:e.lineSellColor).value()}setLineColor(e){return"buy"===this._direction?this.setLineBuyColor(e):this.setLineSellColor(e),this}setLineBuyColor(e){return this._line.properties().lineBuyColor.setValue(e),this}setLineSellColor(e){return this._line.properties().lineSellColor.setValue(e),this}getLineStyle(){var e=this._line.properties().lineStyle.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineStyle.value():e}setLineStyle(e){return this._line.properties().lineStyle.setValue(e),this}getLineWidth(){var e=this._line.properties().lineWidth.value();return"inherit"===e?this._line._model.properties().tradingProperties.lineWidth.value():e}setLineWidth(e){return this._line.properties().lineWidth.setValue(e),this}getBodyBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.bodyBorderBuyColor:e.bodyBorderSellColor).value()}setBodyBorderColor(e){return"buy"===this._direction?this.setBodyBorderBuyColor(e):this.setBodyBorderSellColor(e),this}setBodyBorderBuyColor(e){return this._line.properties().bodyBorderBuyColor.setValue(e),this}setBodyBorderSellColor(e){return this._line.properties().bodyBorderSellColor.setValue(e),this}getBodyBackgroundColor(){return o.getColorFromProperties(this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency)}setBodyBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().bodyBackgroundColor,this._line.properties().bodyBackgroundTransparency),this}getBodyTextColor(){var e=this._line.properties();return("positive"===this._profitState?e.bodyTextPositiveColor:"negative"===this._profitState?e.bodyTextNegativeColor:e.bodyTextNeutralColor).value()}setBodyTextColor(e){return"positive"===this._profitState?this.setBodyTextPositiveColor(e):"negative"===this._profitState?this.setBodyTextNegativeColor(e):this.setBodyTextNeutralColor(e),this}setBodyTextPositiveColor(e){return this._line.properties().bodyTextPositiveColor.setValue(e),this}setBodyTextNegativeColor(e){return this._line.properties().bodyTextNegativeColor.setValue(e),this}setBodyTextNeutralColor(e){return this._line.properties().bodyTextNeutralColor.setValue(e),this}getBodyFont(){return o.getFontFromProperties(this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic)}setBodyFont(e){
return o.setFontToProperties(e,this._line.properties().bodyFontFamily,this._line.properties().bodyFontSize,this._line.properties().bodyFontBold,this._line.properties().bodyFontItalic),this}getQuantityBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBorderBuyColor:e.quantityBorderSellColor).value()}setQuantityBorderColor(e){return"buy"===this._direction?this.setQuantityBorderBuyColor(e):this.setQuantityBorderSellColor(e),this}setQuantityBorderBuyColor(e){return this._line.properties().quantityBorderBuyColor.setValue(e),this}setQuantityBorderSellColor(e){return this._line.properties().quantityBorderSellColor.setValue(e),this}getQuantityBackgroundColor(){var e=this._line.properties();return("buy"===this._direction?e.quantityBackgroundBuyColor:e.quantityBackgroundSellColor).value()}setQuantityBackgroundColor(e){return"buy"===this._direction?this.setQuantityBackgroundBuyColor(e):this.setQuantityBackgroundSellColor(e),this}setQuantityBackgroundBuyColor(e){return this._line.properties().quantityBackgroundBuyColor.setValue(e),this}setQuantityBackgroundSellColor(e){return this._line.properties().quantityBackgroundSellColor.setValue(e),this}getQuantityTextColor(){return o.getColorFromProperties(this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency)}setQuantityTextColor(e){return o.setColorToProperties(e,this._line.properties().quantityTextColor,this._line.properties().quantityTextTransparency),this}getQuantityFont(){return o.getFontFromProperties(this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic)}setQuantityFont(e){return o.setFontToProperties(e,this._line.properties().quantityFontFamily,this._line.properties().quantityFontSize,this._line.properties().quantityFontBold,this._line.properties().quantityFontItalic),this}getReverseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonBorderBuyColor:e.reverseButtonBorderSellColor).value()}setReverseButtonBorderColor(e){return"buy"===this._direction?this.setReverseButtonBorderBuyColor(e):this.setReverseButtonBorderSellColor(e),this}setReverseButtonBorderBuyColor(e){return this._line.properties().reverseButtonBorderBuyColor.setValue(e),this}setReverseButtonBorderSellColor(e){return this._line.properties().reverseButtonBorderSellColor.setValue(e),this}getReverseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency)}setReverseButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().reverseButtonBackgroundColor,this._line.properties().reverseButtonBackgroundTransparency),this}getReverseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.reverseButtonIconBuyColor:e.reverseButtonIconSellColor).value()}setReverseButtonIconColor(e){
return"buy"===this._direction?this.setReverseButtonIconBuyColor(e):this.setReverseButtonIconSellColor(e),this}setReverseButtonIconBuyColor(e){return this._line.properties().reverseButtonIconBuyColor.setValue(e),this}setReverseButtonIconSellColor(e){return this._line.properties().reverseButtonIconSellColor.setValue(e),this}getCloseButtonBorderColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonBorderBuyColor:e.closeButtonBorderSellColor).value()}setCloseButtonBorderColor(e){return"buy"===this._direction?this.setCloseButtonBorderBuyColor(e):this.setCloseButtonBorderSellColor(e),this}setCloseButtonBorderBuyColor(e){return this._line.properties().closeButtonBorderBuyColor.setValue(e),this}setCloseButtonBorderSellColor(e){return this._line.properties().closeButtonBorderSellColor.setValue(e),this}getCloseButtonBackgroundColor(){return o.getColorFromProperties(this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency)}setCloseButtonBackgroundColor(e){return o.setColorToProperties(e,this._line.properties().closeButtonBackgroundColor,this._line.properties().closeButtonBackgroundTransparency),this}getCloseButtonIconColor(){var e=this._line.properties();return("buy"===this._direction?e.closeButtonIconBuyColor:e.closeButtonIconSellColor).value()}setCloseButtonIconColor(e){return"buy"===this._direction?this.setCloseButtonIconBuyColor(e):this.setCloseButtonIconSellColor(e),this}setCloseButtonIconBuyColor(e){return this._line.properties().closeButtonIconBuyColor.setValue(e),this}setCloseButtonIconSellColor(e){return this._line.properties().closeButtonIconSellColor.setValue(e),this}block(){this._blocked=!0,this._line.updateAllViewsAndRedraw(c(this._line.id()))}unblock(){this._blocked=!1,this._line.updateAllViewsAndRedraw(c(this._line.id()))}isFunction(e){return"function"==typeof e}onReverse(e,t){return t?this.isFunction(t)&&(this._onReverseData=e,this._onReverseCallback=t):this.isFunction(e)&&(this._onReverseCallback=e),this}callOnReverse(){this.isFunction(this._onReverseCallback)&&this._onReverseCallback.call(this,this._onReverseData)}isOnReverseCallbackPresent(){return this.isFunction(this._onReverseCallback)}onClose(e,t){return t?this.isFunction(t)&&(this._onCloseData=e,this._onCloseCallback=t):this.isFunction(e)&&(this._onCloseCallback=e),this}setCloseEnabled(e){return this._closeEnabled===e||(this._closeEnabled=e,this._onCloseCallback&&this._line.updateAllViewsAndRedraw(c(this._line.id()))),this}isCloseEnabled(){return this._closeEnabled}callOnClose(){this.isFunction(this._onCloseCallback)&&this._closeEnabled&&this._onCloseCallback.call(this,this._onCloseData)}isOnCloseCallbackPresent(){return this._closeEnabled&&this.isFunction(this._onCloseCallback)}onModify(e,t){return t?this.isFunction(t)&&(this._onModifyData=e,this._onModifyCallback=t):this.isFunction(e)&&(this._onModifyCallback=e),this}callOnModify(){this.isFunction(this._onModifyCallback)&&this._onModifyCallback.call(this,this._onModifyData)}onContextMenu(e,t){
return t?this.isFunction(t)&&(this._onContextMenuData=e,this._onContextMenuCallback=t):this.isFunction(e)&&(this._onContextMenuCallback=e),this}shouldShowContextMenu(){return this.isFunction(this._onContextMenuCallback)}callOnContextMenu(){if(this.isFunction(this._onContextMenuCallback))return this._onContextMenuCallback.call(this,this._onContextMenuData)}remove(){this._line._model.removeSource(this._line),delete this._line}}class p extends r{constructor(e,t){var r=t||p.createProperties(e.backgroundTheme().spawnOwnership());super(e,r),this._adapter=new d(this),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.t.bind(i,563250,19)).then((({PositionPaneView:e})=>{this._setPaneViews([new e(this,this._model)])}))}adapter(){return this._adapter}zorder(){return h}isSpeciallyZOrderedSource(){return!0}setPoint(e,t){this._points[e]=t,this._normalizePoints()}addPoint(e,t){return this._points.push(e),this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}name(){return"Position"}createPriceAxisView(e){return this._priceAxisView=new n(this,{pointIndex:e,backgroundPropertyGetter:()=>this._adapter.getLineColor()}),this._priceAxisView}paneViews(){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?s.prototype.paneViews.call(this):null}priceAxisViews(e,t){return TradingView.printing&&!a.enabled("snapshot_trading_drawings")?null:this._model.properties().tradingProperties.showPositions.value()?s.prototype.priceAxisViews.call(this,e,t):null}hasContextMenu(){return this._adapter.shouldShowContextMenu()}contextMenuItems(){return this._adapter.callOnContextMenu()}formatter(){return this._formatter}static createProperties(e,t){var i=new l({defaultName:"linetoolposition",state:t,useUserPreferences:!1,theme:e});return this._configureProperties(i),i}}t.LineToolPosition=p},403287:(e,t,i)=>{i.d(t,{LineToolRiskRewardBase:()=>E,registerReversibleTool:()=>I,roundValue:()=>M});var r=i(650279),s=i(650151),n=i(444372),o=i(584785),l=i(397535),a=i(901466),c=i(87347),h=i(820028);class u extends a.StudyDataSource{constructor(e,t){super(e,t,"riskReward_",u.getMetaInfo()),this._nonSeriesData=new h.WatchedValue(null),this.dataUpdated().subscribe(this,this._onDataUpdated)}nonSeriesData(){return this._nonSeriesData}static getMetaInfo(){return(0,s.ensureNotNull)((0,c.studyMetaInfoRepository)().findByIdSync({studyId:"LongShortPosition@tv-basicstudies",type:"java"}))}_onDataUpdated(e,t){t?.indexes_replace||this._nonSeriesData.setValue(t?.data)}}var d=i(951827),p=i(318945),_=i(352056),P=i(271792),g=i(597331),m=i(534328);class f extends g.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t}_updateRendererData(e,t,i){if(e.visible=!1,!this._showAxisLabel())return;const r=this._source.priceScale();if(0===this._source.points().length||null===r||r.isEmpty())return;const s=this._source.ownerSource(),n=null!==s?s.firstValue():null;if(null===n)return;const o=this._data.priceProperty.value(),l=(0,
m.resetTransparency)(this._data.colorProperty.value());i.background=l,i.textColor=this.generateTextColor(l),i.coordinate=r.priceToCoordinate(o,n),e.text=r.formatPrice(o,n),e.visible=!0}_showAxisLabel(){return this._source.properties().childs().showPriceLabels.value()||this._source.model().selection().isSelected(this._source)}}var y=i(905520);class v extends y.Property{constructor(e,t){super(),this._lineSource=e,this._pointIndex=t}value(){const e=this._lineSource.points(),t=e[this._pointIndex]?e[this._pointIndex].price:this._lineSource.normalizedPoints()[this._pointIndex].price;return this._formatAndParsePrice(t)}state(){return this.value()}merge(e,t){return this.setValue(e),t?[]:null}_formatAndParsePrice(e){const t=(0,s.ensureNotNull)(this._lineSource.ownerSource()),i=t.defaultFormatter?.()||t.formatter();if(i.parse){const t=i.format(e),r=i.parse(t);return r.res?r.value:e}return e}}class C extends v{constructor(e){super(e,0)}setValue(e){if(this._lineSource.isSourceHidden()){const t=this._lineSource.normalizedPoints();return t[this._pointIndex].price=parseFloat(e.toString()),void this._lineSource.restorePoints(t,[])}const t=this._lineSource.points()[this._pointIndex];this._lineSource.startChanging(this._pointIndex,t),t.price=parseFloat(e.toString()),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.recalculate(),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this,""),this._lineSource.endChanging(!1,!1),this._lineSource.syncPriceLevels()}}class w extends v{constructor(e){super(e,1)}value(){const e=this._lineSource.stopPrice();return this._formatAndParsePrice(e)}setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.ownerSourceBase());this._lineSource.properties().childs().stopLevel.setValue(t),this._lineSource.syncPriceLevels()}}class x extends v{constructor(e){super(e,2)}value(){const e=this._lineSource.profitPrice();return this._formatAndParsePrice(e)}setValue(e){const t=Math.round(Math.abs(e-this._lineSource.entryPrice())*this._lineSource.ownerSourceBase());this._lineSource.properties().childs().profitLevel.setValue(t),this._lineSource.syncPriceLevels()}}var b=i(536794),T=i(87913),S=i(437642),L=i(102014),V=i(172073),D=i(418450),B=i(900608),k=i(644036),A=i(816433);function M(e){return parseFloat(e.toFixed(2))}const N=new Map;function I(e,t){N.set(e,t)}const R=new D.TranslatedString("reverse {tool}",n.t(null,void 0,i(366643)));function F(e,t){(Number.isFinite(t)||Number.isFinite(e.value()))&&e.setValue(t)}class E extends p.LineDataSource{constructor(e,t,r,n){super(e,t,r,n),this._hasEditableCoordinates=new h.WatchedValue(!1),this._studySource=null,this._metaInfo=null,this._riskInChange=!1,this._syncStateExclusions.push("points","entryPrice","stopPrice","targetPrice","stopLevel","profitLevel","riskSize","qty","amountTarget","amountStop"),this._model.isSnapshot()||(this._metaInfo=u.getMetaInfo());const o=this._metaInfo?.inputs.find((e=>"account_currency"===e.id)),a=t.childs().currency.value()
;o&&!o.options.includes(a)&&t.childs().currency.setValue(o.defval),o&&t.childs().currency.subscribe(this,this._updateStudySource),this.version=2,t.hasChild("stopLevel")||t.hasChild("profitLevel")||(t.addProperty("stopLevel",0),t.addProperty("profitLevel",0),this.ownerSourceChanged().subscribe(this,(()=>{const i=(0,s.ensureNotNull)(e.timeScale().visibleBarsStrictRange()),r=i.firstBar(),n=i.lastBar(),o=(0,s.ensureNotNull)(this.ownerSource()),a=o.priceScale();if(a){let e=(0,s.ensureNotNull)(o.priceRange(r,n,{targetPriceScale:a,scaleSeriesOnly:a?.isScaleSeriesOnly()}));if(a.isLog()){const t=a.logicalToPrice(e.minValue()),i=a.logicalToPrice(e.maxValue());e=new l.PriceRange(t,i)}if(e&&!e.isEmpty()){const i=Math.round(.2*e.length()*this.ownerSourceBase());t.merge({stopLevel:i,profitLevel:i})}}}),!0)),t.hasChild("entryPointCurrencyRate")||t.addProperty("entryPointCurrencyRate",1),t.hasChild("closePointCurrencyRate")||t.addProperty("closePointCurrencyRate",1);const c=t.childs();c.stopLevel.subscribe(this,this.recalculate),c.stopLevel.subscribe(null,(()=>{this.properties().childs().stopPrice.fireChanged()})),c.profitLevel.subscribe(this,this.recalculate),c.profitLevel.subscribe(null,(()=>{this.properties().childs().targetPrice.fireChanged()})),t.addChild("entryPrice",new C(this)),t.addChild("stopPrice",new w(this)),t.addChild("targetPrice",new x(this)),t.hasChild("riskSize")||t.addProperty("riskSize",0),t.hasChild("qty")||t.addProperty("qty",0),t.hasChild("amountTarget")||t.addProperty("amountTarget",c.accountSize.value()),t.hasChild("amountStop")||t.addProperty("amountStop",c.accountSize.value()),["riskSize","qty","amountTarget","amountStop","currency","entryPointCurrencyRate","closePointCurrencyRate"].forEach((e=>{t.addExcludedKey(e,1)})),["qty","amountTarget","amountStop","currency","entryPointCurrencyRate","closePointCurrencyRate"].forEach((e=>{t.addExcludedKey(e,4)})),c.risk.subscribe(this,this._recalculateRiskSize),c.accountSize.subscribe(this,this._recalculateRiskSize),c.riskDisplayMode.subscribe(this,this._recalculateRisk),c.entryPrice.subscribe(this,this._recalculateRiskSize),c.stopPrice.subscribe(this,this._recalculateRiskSize),c.profitLevel.subscribe(this,this._recalculateRiskSize),c.profitLevel.subscribe(this,this.syncPriceLevels.bind(this)),c.stopLevel.subscribe(this,this._recalculateRiskSize),c.stopLevel.subscribe(this,this.syncPriceLevels.bind(this)),c.qty.subscribe(this,this._recalculateRiskSize),this.ownerSourceChanged().subscribe(null,((e,t)=>{e&&e.barsProvider().dataUpdated().unsubscribeAll(this),t&&t.barsProvider().dataUpdated().subscribe(this,this._onSeriesUpdated)})),this.pointAdded().subscribe(this,(e=>{switch(e){case P.RiskRewardPointIndex.Entry:case P.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}this._updateStudySource()})),this.pointChanged().subscribe(this,(e=>{switch(e){case P.RiskRewardPointIndex.Entry:case P.RiskRewardPointIndex.Close:this._recalculateRiskSize(),this._recalculateQty()}this._updateStudySource()})),
c.riskDisplayMode.value()===_.RiskDisplayMode.Percentage&&c.risk.value()>100&&c.riskDisplayMode.setValueSilently(_.RiskDisplayMode.Money),c.entryPrice.subscribe(this,this._recalculateQty),c.stopPrice.subscribe(this,this._recalculateQty),c.riskSize.subscribe(this,this._recalculateQty),c.entryPrice.subscribe(this,this._recalculateAmount),c.profitLevel.subscribe(this,this._recalculateAmount),c.stopLevel.subscribe(this,this._recalculateAmount),c.accountSize.subscribe(this,this._recalculateAmount),c.riskSize.subscribe(this,this._recalculateAmount),c.qty.subscribe(this,this._recalculateAmount),this._entryPriceAxisView=new f(this,{colorProperty:c.linecolor,priceProperty:c.entryPrice}),this._stopPriceAxisView=new f(this,{colorProperty:c.stopBackground,priceProperty:c.stopPrice}),this._profitPriceAxisView=new f(this,{colorProperty:c.profitBackground,priceProperty:c.targetPrice}),[c.entryPointCurrencyRate,c.closePointCurrencyRate].forEach((e=>{e.subscribe(this,(()=>{this._recalculateAmount(),this._recalculateRiskSize(),this._recalculateQty()}))})),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,663727)).then((({RiskRewardPaneView:t})=>{const i=[new t(this,e)];this._setPaneViews(i)})),t.onRestoreFactoryDefaults().subscribe(this,this._handleRestoringFactoryDefaults)}destroy(){this.ownerSource()?.barsProvider().dataUpdated().unsubscribeAll(this),this.ownerSourceChanged().unsubscribeAll(this),this._studySource?.destroy(),super.destroy()}availableCurrencies(){const e=(0,s.ensureDefined)(this._metaInfo?.inputs.find((e=>"account_currency"===e.id)));return(0,s.ensureDefined)(e.options)}setOwnerSource(e){super.setOwnerSource(e);const t=this.ownerSource();t&&t.symbolSource().symbolInfo()&&(this._recalculateAmount(),this._recalculateRiskSize(),this._recalculateQty())}pointsCount(){return 2}priceAxisPoints(){if(!this._points.length)return[];const e=this._points[0],t=this._properties.childs();return[{...e,price:t.stopPrice.value()},{...e,price:t.entryPrice.value()},{...e,price:t.targetPrice.value()}]}priceAxisViews(e,t){return this.isSourceHidden()||t!==this.priceScale()||this._model.paneForSource(this)!==e?null:[this._entryPriceAxisView,this._stopPriceAxisView,this._profitPriceAxisView]}updateAllViews(e){this.isActualSymbol()&&this.properties().childs().visible.value()&&((0,T.hideAllDrawings)().value()&&this.userEditEnabled()||(super.updateAllViews(e),this._entryPriceAxisView.update(e),this._stopPriceAxisView.update(e),this._profitPriceAxisView.update(e)))}migrateVersion(e,t,i){if(1===e&&this._points.length>=1){const e=[];e.push(this._points[0]);let t=this._points[0];if(t={price:t.price,index:this._getClosePointIndex(t.index),interval:this._properties.childs().interval.value()},e.push(t),this._points[1]&&e.push(this._points[1]),this._points[2]&&e.push(this._points[2]),this._points=e,this._timePoint.length>=1){const t=[],i=this._timePoint[0];t.push(i);const r={price:i.price,time_t:i.time_t,offset:this._getClosePointIndex(i.offset)};t.push(r),
this._timePoint[1]&&e.push(this._points[1]),this._timePoint[2]&&e.push(this._points[2]),this._timePoint=t}}}restoreExternalState(e){if(!(0,b.isNumber)(e.entryPrice))return void super.restoreExternalState(e);let t;if(this.isActualSymbol())t=e;else{const{entryPrice:i,...r}=e,[s]=this._timePoint;s.price=i,t=r}this.properties().merge(t)}addPoint(e,t,i){e.price=this._roundPrice(e.price),super.addPoint(e,void 0,!0);const r={price:e.price,index:this._getClosePointIndex(e.index)};super._addPointIntenal(r,void 0,!0);const s=this._calculateActualEntry(e,r);if(s){super._addPointIntenal(s,void 0,!0);const e=this._findClosePoint(s,r);e&&super._addPointIntenal(e,void 0,!0)}return this._lastPoint=null,this._normalizePoints(),this.createServerPoints(),!0}setPoint(e,t,i,r){if(this.isSourceHidden())return;const s=this.properties().childs();switch(this._muteSyncLineStyle(),e){case 0:this._changeEntryPoint({...t,interval:this._model.mainSeries().interval()});break;case 2:s.stopPrice.setValue(this.prepareStopPrice(t.price));break;case 3:s.targetPrice.setValue(this.prepareProfitPrice(t.price));break;case 1:t.price=this._points[0].price,super.setPoint(1,t),this.recalculate()}this._unmuteSyncLineStyleWithoutApplyingChanges(),r||this.syncPriceLevels()}getPoint(e){if(this.isSourceHidden())return null;switch(e){case 0:return this._points[0];case 1:return{index:this._points[1].index,price:this._points[0].price};case 2:return{index:this._points[0].index,price:this.stopPrice()};case 3:return{index:this._points[0].index,price:this.profitPrice()}}return null}setPoints(e){this.isSourceHidden()||(this._muteSyncLineStyle(),super.setPoints(e),this.recalculate(),this._unmuteSyncLineStyleWithoutApplyingChanges(),this.syncPriceLevels())}start(){super.start(),this.recalculate()}startMoving(e,t,i,r){const n=(0,s.ensureDefined)(e.logical);n.price=this._roundPrice(n.price),super.startMoving(e,t,i)}move(e,t,i,r){const n=(0,s.ensureDefined)(e.logical);n.price=this._roundPrice(n.price),super.move(e,t,i),this.recalculate(),this._entryPriceAxisView.update((0,S.sourceChangeEvent)(this.id()))}axisPoints(){if(!this._points[P.RiskRewardPointIndex.ActualEntry])return[];const e=this._points[P.RiskRewardPointIndex.ActualEntry];let t=null;if(4===this._points.length)t=this._points[P.RiskRewardPointIndex.ActualClose];else{const e=this.lastBarData();if(!e)return[];t={index:e.index,price:e.closePrice}}return[e,t]}recalculateStateByData(){this.recalculate()}recalculate(){if(0===this.points().length)return;const e=this.properties().childs(),t=e.targetPrice.value(),i=e.stopPrice.value(),r=[this._points[0],this._points[1]],s=this._calculateActualEntry(this.points()[0],this.points()[1]),n=this._model.mainSeries().interval();if(s){r.push({...s,interval:n});const e=this._findClosePoint(s,this.points()[1]);e&&r.push({...e,interval:n})}this._points=r,t!==e.targetPrice.value()&&e.targetPrice.fireChanged(),i!==e.stopPrice.value()&&e.stopPrice.fireChanged()}syncPriceLevels(){const e=this.linkKey().value();if(e){const t=this.properties().childs();this._syncLineStyleChanges(e,{
entryPrice:t.entryPrice.value(),stopLevel:t.stopLevel.value(),profitLevel:t.profitLevel.value()})}}entryPrice(){const e=this.points();return 0===e.length?this._timePoint[0].price:e[0].price}lastBarData(){const e=this.ownerSource()?.barsProvider();if(!e)return null;const t=e.bars().firstIndex(),i=e.bars().lastIndex();if(null===t||null===i||isNaN(t)||isNaN(i))return null;const r=this.points();if(4===r.length){const e=r[P.RiskRewardPointIndex.ActualClose];return e.index<t?null:{closePrice:e.price,index:Math.min(i,e.index)}}const n=r[P.RiskRewardPointIndex.Close];if(n.index<t)return null;const l=Math.min(i,n.index),a=e.bars().search(l,o.PlotRowSearchMode.NearestLeft);return null===a?null:{closePrice:(0,s.ensure)(a.value[4]),index:a.index}}ownerSourceBase(){const e=this.ownerSource()?.symbolSource().symbolInfo();return e?e.pricescale/e.minmov:100}getOrderTemplate(){const e=this.ownerSource();if(null===e)return null;const t=this.properties().childs();return{symbol:e.symbolSource().symbol(),qty:t.qty.value()/t.lotSize.value(),limitPrice:t.entryPrice.value(),stopLoss:t.stopPrice.value(),takeProfit:t.targetPrice.value(),side:this._orderSide(),type:1,seenPrice:null}}template(){const e=this.properties().childs(),t=super.template();return t.stopLevel=e.stopLevel.value(),t.profitLevel=e.profitLevel.value(),t}async additionalActions(e){return{actions:[new V.Action({actionId:"Chart.LineTool.RiskReward.Reverse",options:{checkable:!1,label:n.t(null,void 0,i(364489)),onExecute:()=>{const t=R.format({tool:(0,k.getTranslatedStringForSource)(A.TitleDisplayTarget.StatusLine,this)});e.beginUndoMacro(t);const i=function(e,t){const i=e.points(),r=e.zorder(),n=(0,s.ensureNotNull)(t.model().paneForSource(e)),o=(0,s.ensureNotNull)(e.ownerSource()),l=(0,s.ensureDefined)(N.get(e.toolname)),a=l.propertiesFactory(t.model().backgroundTheme().spawnOwnership(),e.properties().state()),c=e.linkKey().value(),h=c?L.CreateLineToolSyncMode.ForceOn:L.CreateLineToolSyncMode.ForceOff,u=t.createLineTool({pane:n,point:i[0],linkKey:c?(0,B.randomHash)():void 0,linetool:l.targetToolName,properties:a,ownerSource:o,synchronizationMode:h,sharingMode:e.sharingMode().value()});return u&&(t.startChangingLinetool(u,(0,s.ensureNotNull)(u.ownerSource()),u.points()[1],1),t.changeLinePoint(i[1]),t.endChangingLinetool(!1),t.insertBefore([u],e),u.setZorder(r)),t.removeSource(e,!1),u}(this,e);e.endUndoMacro(),i&&e.model().selectionMacro((e=>{e.addSourceToSelection(i,null)}))}}})],placement:"CustomAction"}}_entryPointCurrencyRate(){return this.properties().childs().entryPointCurrencyRate.value()}_closePointCurrencyRate(){return this.properties().childs().closePointCurrencyRate.value()}_ignoreSourceEvent(e){return super._ignoreSourceEvent(e)&&e.sourceId!==this._model.mainSeries().id()}_applyTemplateImpl(e){const{targetPrice:t,stopPrice:i,entryPrice:r,...s}=e;super._applyTemplateImpl(s);const n=this.properties().childs();void 0!==e.stopLevel&&n.stopLevel.setValue(e.stopLevel),void 0!==e.profitLevel&&n.profitLevel.setValue(e.profitLevel)}_propertiesStateExclusions(){
return[...super._propertiesStateExclusions(),"entryPrice","stopPrice","targetPrice"]}_correctPoints(e,t){if(!this.isActualSymbol())return!1;const i=super._correctPoints(e.slice(0,this.pointsCount()),t);for(let t=0;t<e.length;t++){const i=e[t];i.price=this._roundPrice(i.price)}return i}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,949868))).RiskRewardDefinitionsViewModel}_recalculateRiskSize(){if(this._riskInChange)return;const e=this.properties().childs(),t=e.risk.value(),i=e.riskDisplayMode.value(),r=e.accountSize.value();i===_.RiskDisplayMode.Percentage?e.riskSize.setValue(t/100*r):t>r?(e.risk.setValue(r),e.riskSize.setValue(r)):e.riskSize.setValue(t)}_roundPrice(e){const t=this.ownerSourceBase();return Math.round(e*t)/t}_ownerSourcePointValue(){return this.ownerSource()?.symbolSource().symbolInfo()?.pointvalue??1}_onSourceHiddenMayChange(){super._onSourceHiddenMayChange(),this._updateStudySource()}static _configureProperties(e){p.LineDataSource._configureProperties(e),e.addExcludedKey("stopLevel",1),e.addExcludedKey("profitLevel",1),e.addExcludedKey("stopPrice",1),e.addExcludedKey("targetPrice",1),e.addExcludedKey("entryPrice",1)}_handleRestoringFactoryDefaults(){this.properties().childs().risk.setValue(this.properties().factoryDefaults().risk)}_onSeriesUpdated(e,t,i){this.isSourceHidden()||this._points.length<2||null!==i&&i.index>Math.max(this._points[0].index,this._points[1].index)||this.recalculateStateByData()}_recalculateRisk(){const e=this.properties().childs(),t=e.riskDisplayMode.value(),i=e.riskSize.value(),r=e.accountSize.value();let s=e.risk.value();s=t===_.RiskDisplayMode.Percentage?M(i/r*100):M(r/100*s),this._riskInChange=!0,e.risk.setValue(parseFloat(this._riskFormatter(t).format(s,{ignoreLocaleNumberFormat:!0}))),this._riskInChange=!1}_recalculateAmount(){if(0===this.points().length)return;const e=this.properties().childs(),t=e.accountSize.value(),i=e.entryPrice.value(),r=e.qty.value(),s=e.stopPrice.value(),n=e.targetPrice.value(),o=this._ownerSourcePointValue();F(e.amountTarget,this._amountTarget(t,n,i,r,o)),F(e.amountStop,this._amountStop(t,s,i,r,o))}_recalculateQty(){if(0===this.points().length)return;const e=this.properties().childs(),t=e.entryPrice.value(),i=e.stopPrice.value(),r=e.riskSize.value(),s=this._entryPointCurrencyRate(),n=null===s?NaN:r/(Math.abs(t-i)*this._ownerSourcePointValue()*s);F(e.qty,n)}_calculateActualEntry(e,t){const i=this.ownerSource();if(!i)return null;const r=i.barsProvider().bars();if(r.isEmpty())return null;const n=(0,s.ensureNotNull)(r.firstIndex()),o=Math.max(e.index,n),l=e.price,a=(0,s.ensureNotNull)(r.lastIndex()),c=Math.min(a,t.index-1);for(const e of r.rangeIterator(o,c+1)){const t=e.value;if(null!==t&&(0,s.ensure)(t[2])>=l&&(0,s.ensure)(t[3])<=l)return{index:e.index,price:l}}return null}_riskFormatter(e){return e===_.RiskDisplayMode.Percentage?(0,d.getNumericFormatter)(2):(0,d.getNumericFormatter)()}_getClosePointIndex(e){
const t=this._model.timeScale(),i=Math.round(t.width()/t.barSpacing());return e+Math.max(3,Math.round(.15*i))}_findClosePoint(e,t){const i=this.ownerSource();if(!i)return null;const r=i.barsProvider().bars(),n=(0,s.ensureNotNull)(r.firstIndex()),o=Math.max(e.index,n),l=(0,s.ensureNotNull)(r.lastIndex()),a=Math.min(l,t.index-1);for(const e of r.rangeIterator(o,a+1)){const t=e.value;if(null===t)continue;const i=this._checkStopPrice(t);if(null!=i)return{index:e.index,price:i}}return null}_changeEntryPoint(e){const t=this.properties().childs(),i=t.stopPrice.value(),r=t.targetPrice.value(),s=1/this.ownerSourceBase(),n=Math.min(i,r)+s,o=Math.max(i,r)-s;e.price=Math.max(n,Math.min(o,this._roundPrice(e.price))),this.setPoints([e,{...this._points[1],price:e.price}]),t.stopPrice.setValue(i),t.targetPrice.setValue(r)}_updateStudySource(){if(!this._metaInfo||this._isDestroyed)return;const e=this._properties.childs().currency.value(),t=this._model.mainSeries(),i="NONE"!==e&&e!==t.currency()&&!this.isSourceHidden();if(!i&&this._studySource?(this._studySource.destroy(),this._studySource=null,this._properties.childs().entryPointCurrencyRate.setValue(1),this._properties.childs().closePointCurrencyRate.setValue(1)):i&&!this._studySource&&(this._studySource=new u(this._model.chartApi(),t.seriesSource()),this._studySource.nonSeriesData().subscribe((e=>{e&&(this._properties.childs().entryPointCurrencyRate.setValue(e.currency_ratio[0]),this._properties.childs().closePointCurrencyRate.setValue(e.currency_ratio[1]??e.currency_ratio[0]))}))),this._studySource&&this._points.length>=2){const i=this._model.timeScale(),s=t.data().bars().firstIndex(),n=t.data().bars().lastIndex();if(null===s||null===n)return;const o=Math.min(n,Math.max(s,this._points[0].index)),l=Math.min(n,Math.max(s,this._points[1].index)),a=i.indexToTimePoint(o),c=i.indexToTimePoint(l);if(null!==a&&null!==c){const t={...this._studySource.inputs(),start_time:1e3*a,end_time:1e3*c,entry_price:this.entryPrice(),target_price:this.profitPrice(),stop_price:this.stopPrice(),account_currency:e};(0,r.default)(t,this._studySource.inputs())||this._studySource.setInputs(t),this._studySource.isStarted()||this._studySource.start()}}}}},352056:(e,t,i)=>{var r;i.d(t,{RiskDisplayMode:()=>r}),function(e){e.Percentage="percents",e.Money="money"}(r||(r={}))},745331:(e,t,i)=>{i.r(t),i.d(t,{LineToolRiskRewardLong:()=>o});var r=i(650151),s=i(403287),n=i(890390);class o extends s.LineToolRiskRewardBase{constructor(e,t,i,r){super(e,t??o.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Risk/Reward long"}stopPrice(){return this.entryPrice()-this.properties().childs().stopLevel.value()/this.ownerSourceBase()}profitPrice(){return this.entryPrice()+this.properties().childs().profitLevel.value()/this.ownerSourceBase()}calculatePL(e){return e-this.entryPrice()}prepareStopPrice(e){e=this._roundPrice(e);const t=this.entryPrice()-1/this.ownerSourceBase();return Math.min(e,t)}prepareProfitPrice(e){e=this._roundPrice(e);const t=this.entryPrice()+1/this.ownerSourceBase()
;return Math.max(e,t)}static createProperties(e,t){const i=new n.DefaultProperty({defaultName:"linetoolriskrewardlong",state:t,theme:e});return this._configureProperties(i),i}_amountTarget(e,t,i,r,n){const o=this._closePointCurrencyRate();return null===o?NaN:(0,s.roundValue)(e+(t-i)*r*n/o)}_amountStop(e,t,i,r,n){const o=this._closePointCurrencyRate();return null===o?NaN:(0,s.roundValue)(e-(i-t)*r*n/o)}_checkStopPrice(e){const t=this.stopPrice(),i=this.profitPrice();return(0,r.ensure)(e[3])<=t?this.stopPrice():(0,r.ensure)(e[2])>=i?this.profitPrice():null}_orderSide(){return 1}}(0,s.registerReversibleTool)("LineToolRiskRewardShort",{targetToolName:"LineToolRiskRewardLong",propertiesFactory:(e,t)=>o.createProperties(e,t)})},51061:(e,t,i)=>{i.r(t),i.d(t,{LineToolRiskRewardShort:()=>o});var r=i(650151),s=i(403287),n=i(890390);class o extends s.LineToolRiskRewardBase{constructor(e,t,i,r){super(e,t??o.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Risk/Reward short"}stopPrice(){return this.entryPrice()+this.properties().childs().stopLevel.value()/this.ownerSourceBase()}calculatePL(e){return this.entryPrice()-e}profitPrice(){return this.entryPrice()-this.properties().childs().profitLevel.value()/this.ownerSourceBase()}prepareStopPrice(e){e=this._roundPrice(e);const t=this.entryPrice()+1/this.ownerSourceBase();return Math.max(e,t)}prepareProfitPrice(e){e=this._roundPrice(e);const t=this.entryPrice()-1/this.ownerSourceBase();return Math.min(e,t)}static createProperties(e,t){const i=new n.DefaultProperty({defaultName:"linetoolriskrewardshort",state:t,theme:e});return this._configureProperties(i),i}_amountTarget(e,t,i,r,n){const o=this._closePointCurrencyRate();return null===o?NaN:(0,s.roundValue)(e+(i-t)*r*n/o)}_amountStop(e,t,i,r,n){const o=this._closePointCurrencyRate();return null===o?NaN:(0,s.roundValue)(e-(t-i)*r*n/o)}_checkStopPrice(e){const t=this.stopPrice(),i=this.profitPrice();return(0,r.ensure)(e[2])>=t?this.stopPrice():(0,r.ensure)(e[3])<=i?this.profitPrice():null}_orderSide(){return-1}}(0,s.registerReversibleTool)("LineToolRiskRewardLong",{targetToolName:"LineToolRiskRewardShort",propertiesFactory:(e,t)=>o.createProperties(e,t)})},721160:(e,t,i)=>{i.d(t,{shareDrawingsOnIndicators:()=>r});const r=(0,i(125226).isFeatureEnabled)("share_drawings_on_indicators")},690274:(e,t,i)=>{i.d(t,{LineToolSvgIconBase:()=>h});var r=i(650151),s=i(610555),n=i(820028),o=i(822961),l=i(547465),a=i(318945);function c(e,t,i){return i>=4&&(i-=4),Math.atan2(e.y-t.y,e.x-t.x)+Math.PI/4+Math.PI/2*i+Math.PI/2}class h extends a.LineDataSource{constructor(e,t,i,r){super(e,t,i,r),this._onIconChanged=new l.Delegate,this._svgContent=null,this._iconUrl=null,this._hasEditableCoordinates=new n.WatchedValue(!1),this._changePointData=null,this._loadViews()}pointsCount(){return 1}getAdditionalPadding(){return 4*Math.max(1,this.properties().childs().size.value()/72)}getChangePointForSync(e){return null}startChanging(e,t){const i=(0,
r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=this.properties().childs(),l=n.size.value();let a;if(t)a=(0,r.ensureNotNull)(this.pointToScreenPoint(t));else{const e=l/2+this.getAdditionalPadding();a=(0,s.point)(i.y+e,i.y+e),t=(0,r.ensureNotNull)(this.screenPointToPoint(a,!0))}const h=i.subtract(a).length();this._changePointData={centerPoint:i,initialLength:h,initialSize:l,originalAngle:n.angle.value(),startChangeAngle:c(a,i,e??0),alwaysChangeAngle:(0,o.lastMouseOrTouchEventInfo)().isTouch,startPoint:t},super.startChanging(e,t)}setPoint(e,t,i){const{centerPoint:s,initialLength:n,initialSize:o,startChangeAngle:l,originalAngle:a,alwaysChangeAngle:h,startPoint:u}=(0,r.ensureNotNull)(this._changePointData),d=(0,r.ensureNotNull)(this.pointToScreenPoint(t)),p=this.properties().childs();if(e>=4||h){const t=c(d,s,e);p.angle.setValue(a+(t-l))}if(e<4){const e=s.subtract(d).length(),i=Math.max(20,o*(e/n));if(p.size.setValue(i),!h){const{index:e,price:i}=this._points[0],{index:r,price:s}=u,{index:n,price:o}=t;s<=i!=o<=i||r<=e!=n<=e?p.angle.setValue(a+Math.PI):p.angle.setValue(a)}}}getSourceIcon(){if(this._iconUrl)return{type:"url",href:this._iconUrl};const e=this.svgContent();return null===e?null:{type:"svgContent",content:e}}onSourceIconChanged(){return this._onIconChanged}svgContent(){return this._svgContent}static _configureProperties(e){super._configureProperties(e),e.addExcludedKey("angle",1)}}},359983:(e,t,i)=>{i.d(t,{LineToolText:()=>p,LineToolTextAbsolute:()=>_});var r=i(650151),s=i(610555),n=i(68777),o=i(626185),l=i(820028),a=i(905520),c=i(890390),h=i(702067),u=i(437642),d=i(225610);class p extends d.InplaceTextLineDataSource{constructor(e,t,r,s){const n=t??p.createProperties(e.backgroundTheme().spawnOwnership());super(e,n,r,s),this._hasEditableCoordinates=new l.WatchedValue(!1),this._recalculatePointsOnCenter=!1,Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(26772),i.e(62622),i.e(22762),i.e(5262),i.e(51583)]).then(i.bind(i,796509)).then((({TextPaneView:t})=>{const i=this._recalculatePointsOnCenter?(e,t)=>{this._recalculatePointsOnCenter&&this._recalculateCenterPosition(e,t)}:void 0;this._paneView=new t(this,e,void 0,void 0,void 0,void 0,void 0,i,this._openTextEditor.bind(this),this._closeTextEditor.bind(this)),this._setPaneViews([this._paneView])})),n.childs().anchored.subscribe(this,this._onAnchoredChange.bind(this))}centerPosition(){this._recalculatePointsOnCenter=!0}setPoint(e,t,i){if(1!==e)return void super.setPoint(e,t,i);const s=this.properties().childs();let n;if(s.wordWrapWidth.value()){const e=this.model().timeScale();n=this.isFixed()?(0,r.ensureDefined)(this.fixedPoint()).x:e.indexToCoordinate(this.points()[0].index);const i=e.indexToCoordinate(t.index)-n-~~(s.fontsize.value()/6);if(!isFinite(i))return;s.wordWrapWidth.setValue(Math.max(100,i))}}pointsCount(){return 1}name(){return"Text"}editableTextProperties(){const e=this.properties().childs();return{text:e.text,textColor:e.color,wordWrap:e.wordWrap}}removeIfEditableTextIsEmpty(){return!0}activateEditingOnCreation(){return!0}template(){
const e=super.template();return e.text=this.properties().childs().text.value(),e}state(e){const t=super.state(e);return e&&(t.state.barSpacing=this._model.timeScale().barSpacing()),t}shouldBeRemovedOnDeselect(){return""===this._properties.childs().text.value().trim()}isFixed(){return this._properties.childs().anchored.value()}anchorable(){return!0}static createProperties(e,t){const i=new c.DefaultProperty({defaultName:this._defaultName(),state:t,theme:e});return this._configureProperties(i),i}_applyTemplateImpl(e){super._applyTemplateImpl(e),this.properties().childs().text.setValue(e.text)}_getPropertyDefinitionsViewModelClass(){return Promise.all([i.e(89028),i.e(25214),i.e(35632),i.e(9263),i.e(96824),i.e(18537)]).then(i.bind(i,598340)).then((e=>e.TextDefinitionsViewModel))}_createDataSourceBackgroundColorWV(){const{fillBackground:e,backgroundColor:t}=this.properties().childs();return(0,n.combine)(((e,t)=>e?t:null),(0,o.convertPropertyToWatchedValue)(e).ownership(),(0,o.convertPropertyToWatchedValue)(t).ownership()).ownership()}static _defaultName(){return"linetooltext"}static _anchoredDefaultValue(){return!1}static _configureProperties(e){super._configureProperties(e),e.hasChild("text")||e.addChild("text",new a.Property("")),e.hasChild("anchored")||e.addChild("anchored",new a.Property(this._anchoredDefaultValue())),e.addChild("linesColors",new h.LineToolColorsProperty([e.childs().borderColor])),e.addChild("textsColors",new h.LineToolColorsProperty([e.childs().color])),e.addExcludedKey("text",1),e.addExcludedKey("anchored",1),e.addExcludedKey("linesColors",3),e.addExcludedKey("textsColors",3)}_recalculateCenterPosition(e,t){const i=this.isFixed()?(0,r.ensureDefined)(this.fixedPoint()):(0,r.ensureNotNull)(this.pointToScreenPoint(this._points[0])),n=new s.Point(i.x-e/2,i.y-t/2),o=(0,r.ensureNotNull)(this.screenPointToPoint(n));this.setPoints([{...o,interval:this._model.mainSeries().interval()}]),this._normalizePoints(),this.createServerPoints(),this.updateAllViewsAndRedraw((0,u.sourceChangeEvent)(this.id()))}}class _ extends p{constructor(e,t,i,r){super(e,t??_.createProperties(e.backgroundTheme().spawnOwnership()),i,r)}name(){return"Anchored Text"}static _defaultName(){return"linetooltextabsolute"}static _anchoredDefaultValue(){return!0}}},700931:(e,t,i)=>{const r=i(318945).LineDataSource,s=i(127504).alignToStep,n=(i(191914).customFormatters,i(388741).createSeriesFormatter);class o extends r{constructor(e,t){super(e,t),this.customization.forcePriceAxisLabel=!0,this.customization.disableErasing=!0,this.customization.showInObjectsTree=!1,this._createFormatter(e.mainSeries().symbolInfo()),this.setSelectionEnabled(!1)}isSynchronizable(){return!1}pointsCount(){return o.POINTS_COUNT}hasContextMenu(){return!1}state(){return null}startMoving(){super.startMoving.apply(this,arguments),this._cursorMoved=!1}endMoving(){super.endMoving.apply(this,arguments),this._cursorMoved=!1}userEditEnabled(){return!0}movable(){return!1}canBeHidden(){return!1}isUserDeletable(){return!1}showInObjectTree(){return!1}doesMovingAffectsUndo(){return!1
}isAvailableInFloatingWidget(){return!1}timeAxisViews(){return null}cloneable(){return!1}copiable(){return!1}_correctPoints(e,t){this._currentMovingPoint&&this._startMovingPoint?this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price&&(this._cursorMoved=!0):this._cursorMoved=!1;for(var i=1/this.priceScale().mainSource().base(),r=0;r<e.length;r++){var n=e[r];this._cursorMoved&&(n.price=this._currentMovingPoint.logical.price),n.price=s(n.price,i),e[r]=n}}_createFormatter(e){this._formatter=n(e,"default",!1,!0)}}o.POINTS_COUNT=1,e.exports.LineToolTrading=o},839800:(e,t,i)=>{i.d(t,{sortSources:()=>s,sortSourcesPreOrdered:()=>r});const r={KeyFactsToday:10000001,LatestUpdates:10000002,BarMarks:10000003,TimeScaleMarks:10000004,ChartEventsSource:10000005,Dividends:10000006,Splits:10000007,Earnings:10000008,RollDates:10000009,FutureContractExpiration:10000010,LineToolOrder:10000011,LineToolPosition:10000012,LineToolExecution:10000013,AlertLabelInactive:10000014,AlertLabel:10000015};function s(e,t){if(0===e.length)return[];if(!t)return[...e].sort(((e,t)=>e.zorder()-t.zorder()));if(!(t.model().mainPane()===t))return[...e].sort(((e,t)=>e.zorder()-t.zorder()));const i=t.model().panes(),r=i.indexOf(t),s=e=>i.findIndex((t=>t.hasDataSource(e)));return e.map((e=>{const i=!t.hasDataSource(e);return{source:e,isMultipane:i,aboveSeries:e.zorder()>t.model().mainSeries().zorder(),paneIndex:i?s(e):r}})).sort(((e,t)=>e.isMultipane||t.isMultipane?e.isMultipane&&!t.isMultipane?t.aboveSeries?-1:1:!e.isMultipane&&t.isMultipane?e.aboveSeries?1:-1:e.paneIndex-t.paneIndex:e.source.zorder()-t.source.zorder())).map((e=>e.source))}},397535:(e,t,i)=>{i.d(t,{PriceRange:()=>n,mergePriceRanges:()=>o});var r=i(810715);const s=(0,i(735566).getLogger)("Chart.PriceRange");class n{constructor(e,t){if(null!==e&&"object"==typeof e){const t=e;this._minValue=t.m_minValue,this._maxValue=t.m_maxValue}else{const i=e;this._minValue=i,void 0!==t&&(this._maxValue=t)}}equals(e){return this._minValue===e._minValue&&this._maxValue===e._maxValue}clone(){return new n(this._minValue,this._maxValue)}minValue(){return this._minValue}setMinValue(e){this._minValue=e}maxValue(){return this._maxValue}setMaxValue(e){this._maxValue=e}length(){return this._maxValue-this._minValue}isEmpty(){return this._maxValue===this._minValue||this._maxValue!=this._maxValue||this._minValue!=this._minValue}serialize(){return{m_maxValue:this._maxValue,m_minValue:this._minValue}}state(){return{max:this._maxValue,min:this._minValue}}merge(e){return new n(Math.min(this.minValue(),e.minValue()),Math.max(this.maxValue(),e.maxValue()))}apply(e,t){this._minValue=Math.min(this._minValue,e),this._maxValue=Math.max(this._maxValue,t)}set(e,t){this._minValue=e,this._maxValue=t}scaleAroundCenter(e){if(!(0,r.isNumber)(e))return void s.logDebug("PriceRange.scaleAroundCenter: invalid coeff");if(0===this._maxValue-this._minValue)return;const t=.5*(this._maxValue+this._minValue);let i=this._maxValue-t,n=this._minValue-t;i*=e,n*=e,this._maxValue=t+i,this._minValue=t+n}shift(e){(0,
r.isNumber)(e)?(this._maxValue+=e,this._minValue+=e):s.logDebug("PriceRange.shift: invalid coeff")}containsStrictly(e){return e.minValue()>this._minValue&&e.maxValue()<this._maxValue}containPrice(e){return e>=this._minValue&&e<=this._maxValue}intersection(e){return this.containPrice(e.minValue())||this.containPrice(e.maxValue())||e.containPrice(this._minValue)?new n(Math.max(this._minValue,e.minValue()),Math.min(this._maxValue,e.maxValue())):null}static compare(e,t){return null===e||null===t?e===t:e.equals(t)}}function o(e){return e.reduce(((e,t)=>e?t?e.merge(t):e:t),null)}},626185:(e,t,i)=>{i.d(t,{convertPropertyToWatchedValue:()=>s});var r=i(820028);function s(e){const t=new r.WatchedValue(e.value());let i=!1;e.subscribe(t,(()=>{i||(i=!0,t.setValue(e.value()),i=!1)}));const s=()=>{i||(i=!0,e.setValue(t.value()),i=!1)};return t.subscribe(s),t.spawn((()=>{e.unsubscribeAll(t),t.unsubscribe(s)}))}},526951:(e,t,i)=>{i.d(t,{barSpacingByScaleRatio:()=>l,priceRangeByScaleRatio:()=>o,scaleRatio:()=>n});var r=i(397535);const s=1e-10;function n(e,t){if(t.isLog()||e.isEmpty()||t.isEmpty())return null;const i=function(e){if(e.isEmpty())return null;const t=e.priceRange();if(null===t)return null;const i=t.length();return e.internalHeight()/i}(t);if(null===i)return null;return e.getValidBarSpacing()/Math.max(s,i)}function o(e,t,i){if(e.isLog()||null===i||e.isEmpty())return null;const s=e.priceRange();if(null===s||s.isEmpty())return null;const n=e.internalHeight()/(t/i),o=s.length();if(n===o)return s;const l=(n-o)/2;return new r.PriceRange(s.minValue()-l,s.maxValue()+l)}function l(e,t){if(e.isLog()||null===t||e.isEmpty())return null;const i=e.priceRange();if(null===i)return null;const r=i.length();return e.internalHeight()/r*t}},778336:(e,t,i)=>{i.d(t,{SeriesTimeRangeVolumeCalculator:()=>r});class r{constructor(e){this._value=null,this._series=e,this._series.dataEvents().dataUpdated().subscribe(this,this._onSeriesUpdated)}destroy(){this._series.dataEvents().dataUpdated().unsubscribeAll(this)}volume(e,t){if(null!==this._value&&this._value.from===e&&this._value.to===t)return this._value.value;let i=0;const r=this._series.data().bars(),s=r.firstIndex(),n=r.lastIndex();if(null!==s&&e<s&&t<s||null!==n&&e>n&&t>n)i=NaN;else{const r=this._series.data().bars().rangeIterator(Math.min(e,t),Math.max(e,t));for(const e of r){const t=e.value[5];if(void 0===t){i=NaN;break}i+=t}}return this._value={from:e,to:t,value:i},i}_onSeriesUpdated(e,t){if(null===this._value)return;if(t)return void(this._value=null);const i=this._series.data().bars().lastIndex();(null===i||i<=this._value.to)&&(this._value=null)}}},398290:(e,t,i)=>{i.d(t,{generateColorCached:()=>o});var r=i(259332),s=i(534328),n=i(850117);function o(e=1e3){const t=r.default.Cache;r.default.Cache=n.CircularCacheBuffer.bind(n.CircularCacheBuffer,e);const i=(0,r.default)(s.generateColor,((e,t,i)=>`${e}_${t}_${i}`));return r.default.Cache=t,i}}}]);