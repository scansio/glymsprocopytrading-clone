"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[23301],{936867:(e,t,i)=>{function s(e,t){if(null===e)return t;const i=e.firstIndex,s=t.firstIndex,n=e.clearData||t.clearData;return{firstIndex:n||void 0===i||void 0===s?void 0:Math.min(i,s),clearData:n}}i.d(t,{mergeDataInvalidation:()=>s})},12384:(e,t,i)=>{i.d(t,{StudyPlotPaneView:()=>k});var s=i(650151),n=i(724377),o=i(931924),l=i(462140),a=i(536794),r=i(534328),d=i(586563),h=i(336669),c=i(300562),u=i(708162),_=i(919383),p=i(255143),m=i(23076),y=i(123003),I=i(79428),S=i(610555),f=i(65840),v=i(731974),x=i(320994),P=i(638456);class g extends x.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=this._data,i=t.lineWidth,s=t.vertOffset||0,n=(0,f.interactionTolerance)().series+i,o=t.visibleItemsRange?.startItemIndex??0,l=t.visibleItemsRange?.endItemIndex??t.items.length;for(let a=o;a<l;a++){const o=t.items[a];if(new S.Point(o.center,o.y+s).subtract(e).length()+i<=n)return new v.HitTestResult(v.HitTarget.Regular)}return null}_drawImpl(e){const t=this._data,{horizontalPixelRatio:i,verticalPixelRatio:s,context:n}=e,o=Math.max(1,Math.floor(i)),l=o%2?.5:0,{vertOffset:r=0,lineColor:d,lineWidth:h,barSpacing:c}=t;let u="",_=!1;const p=t.visibleItemsRange?.startItemIndex??0,m=t.visibleItemsRange?.endItemIndex??t.items.length;for(let e=p;e<m;e++){const p=t.items[e],m=p.center,y=p.y+r;if((0,a.isNaN)(m)||(0,a.isNaN)(y))continue;let I,S;null!=p.style?(I=p.style.color,S=p.style.width):(I=d,S=h),(I!==u||P.isSafari)&&(u=I,_&&n.fill(),n.beginPath(),n.fillStyle=I);const f=Math.round(m*i)+l,v=Math.round(y*s)+l;let x=Math.round(2*Math.max(1.5,S)*i);o%2!=x%2&&(x+=1),c>2||S>1.5?(n.moveTo(f+x/2,v),n.arc(f,v,x/2,0,2*Math.PI,!1)):n.rect(f-x/2,v-x/2,x,x),_=!0}_&&n.fill()}}var b=i(564079),C=i(2624);class w extends x.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=(0,f.interactionTolerance)().series+this._data.lineWidth/2;let i,s,n,o;for(let l=1;l<this._data.items.length;++l){i=this._data.items[l-1],s=this._data.items[l],n=i.center,o=s.center;if((0,C.distanceToSegment)(new S.Point(n,i.y),new S.Point(o,s.y),new S.Point(e.x,e.y)).distance<=t)return new v.HitTestResult(v.HitTarget.Regular)}return null}_drawImpl(e){const{context:t,horizontalPixelRatio:i,verticalPixelRatio:s}=e;let n="",o=!1;const l=this._data.visibleItemsRange?.startItemIndex??0,r=(this._data.visibleItemsRange?.endItemIndex??this._data.items.length)-1;for(let e=l;e<=r;e++){const l=this._data.items[e];if((0,a.isNaN)(l.center)||(0,a.isNaN)(l.y))continue;const r=l.style?.color??this._data.lineColor,d=l.style?.width??this._data.lineWidth,h=Math.max(1,Math.floor(d*i)),c=Math.max(1,Math.floor(d*s));(r!==n||P.isSafari)&&(n=r,o&&t.fill(),t.beginPath(),t.fillStyle=r);let u=3*h;u%2!=h%2&&(u+=1);let _=3*c;_%2!=c%2&&(_+=1);const p=Math.round(Math.round(l.center*i)-u/2),m=Math.round(Math.round(l.y*s)-_/2),y=p+Math.floor(u/2-h/2),I=m+Math.floor(_/2-c/2);t.rect(p,I,u,c),t.rect(y,m,h,_),o=!0}o&&t.fill()}}
class L extends x.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=(0,f.interactionTolerance)().series+this._data.lineWidth/2,i=new Map;for(const n of this._data.items){const o=n.center,l=n.y;let a=t;n.style&&(i.has(n.style.width)?a=(0,s.ensureDefined)(i.get(n.style.width)):i.set(this._data.lineWidth,a));if((0,C.distanceToSegment)(new S.Point(o,l),new S.Point(o,this._data.histogramBase),new S.Point(e.x,e.y)).distance<=a)return new v.HitTestResult(v.HitTarget.Regular)}return null}_drawImpl(e){if(0===this._data.items.length)return;const{context:t,horizontalPixelRatio:i,verticalPixelRatio:s}=e;t.fillStyle=this._data.lineColor;const n=Math.max(1,Math.floor(this._data.lineWidth*i)),o=n/2,l=Math.max(1,Math.floor(i)),a=Math.round(this._data.histogramBase*s)-Math.floor(l/2),r=a+l,d=this._data.visibleItemsRange?.startItemIndex??0,h=(this._data.visibleItemsRange?.endItemIndex??this._data.items.length)-1;for(let e=d;e<=h;e++){const d=this._data.items[e];let h=n,c=o;d.style?(t.fillStyle=d.style.color,h=Math.max(1,Math.floor(d.style.width*i)),c=h/2):t.fillStyle=this._data.lineColor;const u=h%2?.5:0,_=Math.round(d.center*i)+u,p=Math.round(d.y*s);let m,y;p<=a?(m=p,y=r):(m=a,y=p-Math.floor(l/2)+l),t.fillRect(Math.floor(_-c),m,h,y-m)}}}var N=i(974145),R=i(723655),M=i(660439),T=i(342653),D=i(660603);const B=e=>{const t=(0,n.rgbToHsl)((0,n.parseRgb)(e)),i=t[0]+.05;return t[0]=i-Math.floor(i),(0,n.rgbToHexString)((0,n.hslToRgb)(t))},V=(0,h.memoize)(B),W=new Set([N.LineStudyPlotStyle.Line,N.LineStudyPlotStyle.Area,N.LineStudyPlotStyle.Circles,N.LineStudyPlotStyle.Cross,N.LineStudyPlotStyle.StepLine,N.LineStudyPlotStyle.StepLineWithDiamonds]);class k extends T.StudyPaneViewInplaceUpdatable{constructor(e,t,i,s,n=!1){super(t,i,s),this._histogramBase=null,this._lineColor="",this._lineWidth=1,this._color1="",this._color2="",this._renderer=new u.CompositeRenderer,this._isMarkersEnabled=o.enabled("source_selection_markers"),this._study=e,this._plotIndex=e.metaInfo().plots.findIndex((e=>e.id===s)),this._colorProvider=(0,R.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._extendStepLineToBarsEndings=n,this._isFundamental=(0,I.isFundamentalStudyMetaInfo)(e.metaInfo());const l=this._study.properties().styles[this._plotName].plottype.value();this._isStepLinePlot=l===N.LineStudyPlotStyle.StepLine||l===N.LineStudyPlotStyle.StepLineWithBreaks||l===N.LineStudyPlotStyle.StepLineWithDiamonds}items(){return this._items}renderer(){return this._makeSureRendererIsValid(),this._renderer}_getTranspValue(){const e=this._study.properties(),t=e.styles[this._plotName];let i=0;const s=this._study.metaInfo();return"Volume@tv-basicstudies"===s.id&&s.version<=46&&"transparency"in e?(i=e.transparency.value(),i=(0,a.isNumber)(i)?i:0,i):(t.transparency&&(i=t.transparency.value(),i=(0,a.isNumber)(i)?i:0),i)}_updateImplFull(e){if(this._renderer.clear(),this._dataInvalidated?.clearData&&(this._items=[]),!this._study.isPlotVisibleAt(this._plotName,1))return!1;const t=this._priceScale();if(!t||t.isEmpty())return!1
;if(null===this._study.firstValue(void 0,this.isForceOverlay()))return!1;this._histogramBase=null;const i=this._study.properties().styles[this._plotName],n=i.plottype.value(),o=this._isFundamental&&this._isStepLinePlot,a=this._study.plots().plottableRange(o);if(0===a.size())return!1;const h=this._study.offset(this._plotName),c=W.has(n),u=this._preallocateItems(a,((e,t)=>({y:NaN,left:NaN,center:NaN,right:NaN,origPrices:{price:t??NaN,timePointIndex:e+h},timePointIndex:e+h})));let _=NaN,p=NaN;const m=new Map,I=(e,t)=>{let i=m.get(e);void 0===i&&(i=new Map,m.set(e,i));let s=i.get(t);if(void 0===s){const n=!this._plotName||"vol"!==this._plotName;s=(0,r.generateColor)(e,t,n),i.set(t,s)}return s},S=(0,y.createEmptyStyle)(),f=(0,l.clamp)(this._getTranspValue(),0,100),v=this._model.timeScale().visibleBarsStrictRange();if(null===v)return!1;const{startBar:x,endBar:P}=this._calculateStartEnd(v);if(null===x||null===P||0===this._items.length)return!1;const g=u??(0,s.ensureNotNull)(a.firstIndex()),b=(0,s.ensureNotNull)(a.lastIndex())+1,C=a.rangeIterator(g,b);let w,L=(0,M.lowerbound)(this._items,g+h,((e,t)=>e.timePointIndex<t));for(const e of C){let t=e.index;const s=e.value;t+=h,t=Math.floor(t);let n=s[this._plotIndex+1];const o=null==n;if(n=o?NaN:n,c&&o){p=n,_=t,L++;continue}const l=this._items[L];l.valIsNotSameAsPrev=n!==p||t-1!==_;if(this._colorProvider.isColorDefined()&&(l.style={color:I(i.color.value(),100),width:i.linewidth.value(),style:i.linestyle.value()},null!=n)){const e=this._colorProvider.getPlotPointStyle(s,S),t=e.colors[0];void 0!==t&&(l.style.color=(0,r.isHexColor)(t)?I(t,f):t),l.style.width=e.lineWidth??l.style.width,l.style.style=e.lineStyle??l.style.style}!c&&!isNaN(_)&&_!==t-1&&L>0&&(this._items[L].breakBefore=!0),p=n,_=t,L++,w=l}if(w&&this._isFundamental&&this._isStepLinePlot){const e=this._model.mainSeries().data().bars().lastIndex(),t=w;if(null!==e&&e>t.timePointIndex){const i=(0,d.deepCopy)(t);i.timePointIndex=e,i.valIsNotSameAsPrev=!1,this._items.length>L?this._items[L]=i:this._items.push(i)}}return this._updateImplLight(),!0}_correctVisibleItemIndexes(e,t){const i=super._correctVisibleItemIndexes(e,t);return this._isFundamental&&this._isStepLinePlot&&i.endItemIndex===this._items.length-1&&(i.endItemIndex+=1),i}_updateRenderer(e,t){this._renderer.clear();const i=this._study.properties().styles.childs()[this._plotName].childs(),n=this._study.metaInfo().styles?.[this._plotName],o=(0,l.clamp)(this._getTranspValue(),0,100);this._lineColor=(0,r.generateColor)(i.color.value(),o),this._lineWidth=i.linewidth.value();let h=i.color.value();const u=this._colorProvider.getDefaultPlotPointStyle();u&&(h=u.colors[0]||h,this._lineWidth=u.lineWidth??this._lineWidth,this._lineColor=h?(0,r.generateColor)(h,o):this._lineColor),this._color2=(0,r.generateColor)(h,o);const y=this._study.metaInfo().isRGB?B(h):V(h);this._color1=(0,r.generateColor)(y,o);const I=this._histogramBase?this._histogramBase:(0,s.ensureNotNull)(this._priceScale()).height(),S=i.plottype.value(),f={barSpacing:this._model.timeScale().barSpacing(),
items:this._items,histogramBase:I,lineIndex:0,lineStyle:i.linestyle.value(),lineColor:this._lineColor,lineWidth:(0,a.isNumber)(this._lineWidth)?this._lineWidth:1,color1:this._color1,color2:this._color2,bottom:I,visibleItemsRange:{startItemIndex:e,endItemIndex:t},simpleMode:this._colorProvider.singleColor(),skipHoles:[N.LineStudyPlotStyle.Line,N.LineStudyPlotStyle.Area,N.LineStudyPlotStyle.Cross,N.LineStudyPlotStyle.Circles,N.LineStudyPlotStyle.StepLine,N.LineStudyPlotStyle.StepLineWithDiamonds].includes(S)},v=this._renderer,x=Boolean(n?.joinPoints);switch(S){case N.LineStudyPlotStyle.Line:case N.LineStudyPlotStyle.LineWithBreaks:v.append(new _.PaneRendererLine({...f,lineColor:{type:D.ColorType.Solid,color:this._lineColor}}));break;case N.LineStudyPlotStyle.Area:case N.LineStudyPlotStyle.AreaWithBreaks:v.append(new c.PaneRendererArea({...f,lineColor:{type:D.ColorType.Solid,color:this._lineColor}}));break;case N.LineStudyPlotStyle.Histogram:v.append(new L(f));break;case N.LineStudyPlotStyle.Columns:v.append(new b.PaneRendererColumns(f));break;case N.LineStudyPlotStyle.Cross:v.append(new w(f)),x&&v.append(new _.PaneRendererLine({...(0,d.deepCopy)(f),lineWidth:1,lineColor:{type:D.ColorType.Solid,color:this._lineColor},forceLineWidth:!0}));break;case N.LineStudyPlotStyle.Circles:v.append(new g(f)),x&&v.append(new _.PaneRendererLine({...(0,d.deepCopy)(f),lineWidth:1,lineColor:{type:D.ColorType.Solid,color:this._lineColor},ignorePaletteLineWidth:!0}));break;case N.LineStudyPlotStyle.StepLine:case N.LineStudyPlotStyle.StepLineWithBreaks:case N.LineStudyPlotStyle.StepLineWithDiamonds:{const e=new p.PaneRendererStepLine;e.setData({...f,lineColor:{type:D.ColorType.Solid,color:this._lineColor},decoration:i.plottype.value()===N.LineStudyPlotStyle.StepLineWithDiamonds?p.StepLineDecoration.Diamonds:p.StepLineDecoration.None,extendToBarsEndings:this._extendStepLineToBarsEndings}),v.append(e);break}default:v.append(new _.PaneRendererLine({...f,lineColor:{type:D.ColorType.Solid,color:this._lineColor}}))}this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&v.append(new m.SelectionRenderer(this._selectionData))}_updateAdditionalPrices(e,t){const i=this._study.metaInfo().styles?.[this._plotName];void 0!==i?.histogramBase&&(this._histogramBase=e.priceToCoordinate(i.histogramBase,t))}}},734189:(e,t,i)=>{i.d(t,{StudyForceOverlayPlotView:()=>s});class s{constructor(e,t,i){this._series=e,this._model=t,this._plotName=i}isForceOverlay(){return!!this._study.metaInfo().isPlotForceOverlay(this._plotName)}_priceScale(){return this.isForceOverlay()?this._model.mainSeries().priceScale():this._study.priceScale()}}},342653:(e,t,i)=>{i.d(t,{StudyPaneViewInplaceUpdatable:()=>u});var s=i(650151),n=i(610555),o=i(536794),l=i(936867),a=i(584785),r=i(660439),d=i(975022),h=i(731974),c=i(734189);class u extends c.StudyForceOverlayPlotView{constructor(e,t,i){super(e,t,i),this._selectionData=null,this._dataInvalidated=null,this._viewportInvalidated=!1,this._items=[],
this._selectionIndexer=new d.SelectionIndexes(t.timeScale())}update(e){if("hover-change"!==e.type){if("global-change"===e.type)return this._dataInvalidated=(0,l.mergeDataInvalidation)(this._dataInvalidated,{}),void(this._viewportInvalidated=!0);if("data-source-change"!==e.type)this._viewportInvalidated=!0;else{if((e.sourceId===this._study.id()||this._dependsOnSeriesData()&&e.sourceId===this._model.mainSeries().id())&&!e.nonSeriesOnly){const t=(0,l.mergeDataInvalidation)(this._dataInvalidated,{firstIndex:e.firstUpdatedTimePointIndex,clearData:e.clearData});this._dataInvalidated=t}}}}_dependsOnSeriesData(){return!1}_makeSureRendererIsValid(){this._dataInvalidated?this._updateImplFull(this._viewportInvalidated)&&(this._dataInvalidated=null):this._viewportInvalidated&&this._updateImplLight(),this._viewportInvalidated=!1}_preallocateItems(e,t){const i=e.size();let n=this._dataInvalidated?.firstIndex;if(0===i)return n;const o=this._study.offset(this._plotName);if(i!==this._items.length){const i=void 0!==n?n+o:void 0;if(void 0===i||0===this._items.length||i<(0,s.ensureDefined)(this._items[0].timePointIndex))return this._items=[],e.each(((e,i)=>{const s=i[this._plotIndex+1];return this._items.push(t(e,s)),!1})),this._items.length?(0,s.ensureDefined)(this._items[0].timePointIndex)-o:void 0;{const i=(0,s.ensureDefined)(n),l=o>=0?0:o,a=o>=0?o:0;let d=(0,r.lowerbound)(this._items,i+l,((e,t)=>e.timePointIndex<t));const h=(0,s.ensureNotNull)(e.lastIndex()),c=e.rangeIterator(i-a,h);for(const e of c)if(void 0!==d&&this._items[d]?.timePointIndex===e.index+o)d=this._updateItem(e,d);else{const i=e.value[this._plotIndex+1];this._items.push(t(e.index,i))}}}else if(n=n??e.firstIndex()??void 0,void 0!==n){const t=o>=0?0:o,i=o>=0?o:0;let l=(0,r.lowerbound)(this._items,n+t,((e,t)=>e.timePointIndex<t));const a=(0,s.ensureNotNull)(e.lastIndex())+1,d=e.rangeIterator(n-i,a);for(const e of d)l=this._updateItem(e,l)}return n}_updateItem(e,t){const i=this._getValueForUpdating(e);return this._items[t].origPrices.price=i??NaN,t+1}_getValueForUpdating(e){return e.value[this._plotIndex+1]}_calculateStartEnd(e){const t=this._study.offset(this._plotName);let i=e.firstBar()-Math.abs(t)-1,n=e.lastBar()+Math.abs(t)+1;const o=this._study.getMinFirstBarIndexForPlot(this._plotName)+t;if(o>n+1)return{startBar:null,endBar:null};let l=this._study.plots();l=l.range(o,(0,s.ensureNotNull)(l.lastIndex())),i=Math.max(i,o),n=Math.max(n,o);const r=l.search(i,a.PlotRowSearchMode.NearestLeft,this._plotIndex+1),d=l.search(n,a.PlotRowSearchMode.NearestRight,this._plotIndex+1);return null!==r&&(i=r.index),null!==d&&(n=d.index),i=Math.max(o,i),{startBar:i,endBar:n}}_updateImplLight(){const e=this._study.firstValue(void 0,this.isForceOverlay());if(null===e)return this._selectionData=null,void this._updateRenderer(0,-1);const t=this._priceScale();if(null===t||t.isEmpty())return this._selectionData=null,void this._updateRenderer(0,-1);const i=this._model.timeScale().visibleBarsStrictRange();if(null===i)return this._selectionData=null,void this._updateRenderer(0,-1)
;const{startBar:s,endBar:n}=this._calculateStartEnd(i);if(null===s||null===n||0===this._items.length)return this._selectionData=null,void this._updateRenderer(0,-1);const{startItemIndex:o,endItemIndex:l}=this._correctVisibleItemIndexes(Math.max(0,(0,r.lowerbound)(this._items,s,((e,t)=>e.timePointIndex<t))),Math.min(this._items.length,(0,r.upperbound)(this._items,n,((e,t)=>e<t.timePointIndex))));if(o>=l)return this._selectionData=null,void this._updateRenderer(0,-1);this._convertItemsToCoordinates(t,e,o,l),this._createSelection(e),this._updateRenderer(o,l)}_correctVisibleItemIndexes(e,t){return{startItemIndex:e,endItemIndex:t}}_convertItemsToCoordinates(e,t,i,s){this._convertItemsToCoordinatesImpl(e,t,i,s)}_convertItemsToCoordinatesImpl(e,t,i,s){for(let e=i;e<s;e++){const t=this._items[e];t.y=t.origPrices.price}e.pointsArrayToCoordinates(this._items,t,{startItemIndex:i,endItemIndex:s}),this._model.timeScale().fillBarBorders(this._items,{startItemIndex:i,endItemIndex:s},!0),this._updateAdditionalPrices(e,t)}_updateAdditionalPrices(e,t){}_createSelection(e){const t=this._priceScale();if(null!==t)if(this._model.selection().isSelected(this._study)){const i=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height();this._selectionData={points:[],bgColors:[],visible:!0,hittestResult:h.HitTarget.Regular,barSpacing:this._model.timeScale().barSpacing()};const n=this._study.offset(this._plotName);for(const s of this._selectionIndexer.indexes()){const l=this._study.plots().valueAt(s);if((0,o.isAbsent)(l))continue;const a=l[this._plotIndex+1];if((0,o.isAbsent)(a))continue;const r=this._createSelectionDataPoint(t,Math.floor(s+n),a,e);this._selectionData.points.push(r),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(r.point.y/i))}}else this._selectionIndexer.clear()}_createSelectionDataPoint(e,t,i,s){const o=this._model.timeScale().indexToCoordinate(t),l=e.priceToCoordinate(i,s);return{point:(0,n.point)(o,l)}}}},492380:(e,t,i)=>{i.d(t,{StudyPriceAxisView:()=>l});var s=i(650151),n=i(597331),o=i(534328);class l extends n.PriceAxisView{constructor(e,t){super(),this._model=e.model(),this._source=e,this._data=t,this._isForceOverlay=!!this._source.metaInfo().isPlotForceOverlay(this._data.plotIndex)}update(e){"hover-change"!==e.type&&super.update(e)}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const n=this._source.model(),l=this._isForceOverlay?n.mainSeries().priceScale():this._source.priceScale();if(null===l)return;if(!n.isPriceScaleVisible(l))return;const a=this._source.lastValueData(this._data.plotIndex,!1);if(a.noData)return;const r=n.timeScale().visibleBarsStrictRange(),d=n.mainSeries().bars().lastIndex();if(null!==r&&null!==d){if(d<=r.lastBar()){i.background=(0,o.resetTransparency)(a.color);let s=a.color;"transparent"===s&&(s=this._model.properties().childs().scalesProperties.childs().backgroundColor.value()),i.textColor=this.generateTextColor(s),i.borderColor=void 0,e.borderVisible=!1,t.borderVisible=!1}else{const l=n.backgroundColorAtYPercentFromTop(a.coordinate/(0,
s.ensureNotNull)(n.paneForSource(this._source)).height());i.background=l,i.textColor=(0,o.resetTransparency)(a.color),i.borderColor=(0,o.resetTransparency)(i.textColor),e.borderVisible=!0,t.borderVisible=!0}i.coordinate=a.coordinate,i.floatCoordinate=a.floatCoordinate,this._showAxisLabel()&&(e.text=a.text,e.visible=!0),this._updatePaneRendererData(t)}}_showPaneLabel(){const e=this._model.properties().childs().scalesProperties.childs();return(e.showStudyPlotLabels.value()||e.showFundamentalNameLabel.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_showAxisLabel(){const e=this._model.properties().childs().scalesProperties.childs();return(e.showStudyLastValue.value()||e.showFundamentalLastValue.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_updatePaneRendererData(e){e.text="",this._showPaneLabel()&&(e.text=this._source.priceLabelText(this._data.plotIndex),e.visible=!0)}}}}]);