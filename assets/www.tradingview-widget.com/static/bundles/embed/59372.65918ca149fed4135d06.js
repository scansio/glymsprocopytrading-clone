(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[59372,15483],{276536:(e,t,n)=>{"use strict";n.d(t,{DECEMBER:()=>E,FIRST_DAY_OF_WEEK:()=>v,FRIDAY:()=>h,JANUARY:()=>f,JULY:()=>g,LAST_DAY_OF_WEEK:()=>_,MARCH:()=>m,MAY:()=>p,MONDAY:()=>a,NOVEMBER:()=>b,SATURDAY:()=>d,SEPTEMBER:()=>T,SUNDAY:()=>r,THURSDAY:()=>c,TUESDAY:()=>u,WEDNESDAY:()=>l,add_date:()=>A,add_days_considering_dst:()=>O,add_minutes:()=>V,cal_to_utc:()=>G,clone:()=>U,days_per_year:()=>H,get_cal:()=>z,get_cal_from_unix_timestamp_ms:()=>X,get_cal_utc:()=>j,get_day_of_month:()=>C,get_day_of_week:()=>D,get_day_of_year:()=>k,get_days_in_month:()=>B,get_hours:()=>L,get_minutes:()=>I,get_minutes_from_midnight:()=>N,get_minutes_with_hours:()=>R,get_month:()=>y,get_timezone:()=>J,get_year:()=>M,is_leap_year:()=>W,millisecondsPerDay:()=>w,minutesPerDay:()=>P,minutesPerWeek:()=>S,set_hms:()=>x,set_seconds:()=>F,time_seconds:()=>Y,time_seconds_diff:()=>K,utc_to_cal:()=>$,utc_to_cal_ts:()=>q});var i=n(953159);const s={0:0,1:31,2:59,3:90,4:120,5:151,6:181,7:212,8:243,9:273,10:304,11:334};class o{constructor(e){this._invalid=!1,this._name=e;let t=i.tzData[e];!t&&Q&&(t=Q.instance().getTimezoneData(e)),t||(t={time:[],offset:[]},this._invalid=!0),t.time.length!==t.offset.length&&(t={time:[],offset:[]},this._invalid=!0);const n=t;if(!n.time_utc){const e=t.time,i=t.offset,s=e.length,o=new Array(s);for(let t=0;t<s;t++)e[t]*=1e3,i[t]*=1e3,o[t]=e[t]-i[t];n.time_utc=o}this.tz=n}offset_utc(e){return o.offset(this.tz.time_utc,this.tz.offset,e)}offset_loc(e){return o.offset(this.tz.time,this.tz.offset,e)}name(){return this._name}is_valid(){return!this._invalid}correction_loc(e){const t=this.tz.time,n=this.tz.offset,i=Z(t,e);if(i<1)return 0;const s=n[i]-n[i-1];if(s>0){if(e-t[i-1]<=s)return s}return 0}static offset(e,t,n){const i=Z(e,n);return-1===i?0:t[i]}}const r=1,a=2,u=3,l=4,c=5,h=6,d=7,v=r,_=d,f=0,m=2,p=4,g=6,T=8,b=10,E=11,P=1440,S=10080,w=864e5;function M(e){return e.getUTCFullYear()}function y(e){return e.getUTCMonth()}function L(e){return e.getUTCHours()}function I(e){return e.getUTCMinutes()}function C(e){return e.getUTCDate()}function D(e){return e.getUTCDay()+1}function k(e){const t=e.getUTCMonth();let n=s[t];return t>f+1&&W(e.getUTCFullYear())&&(n+=1),n+e.getUTCDate()}function N(e){return 60*L(e)+I(e)}function R(e){return N(e)}function x(e,t,n,i,s,o){e.setUTCHours(t),e.setUTCMinutes(n),e.setUTCSeconds(i),e.setUTCMilliseconds(s),void 0!==o&&function(e,t){const n=e.getTime(),i=t.correction_loc(n);e.setTime(n+i)}(e,o)}function O(e,t,n){const i=e.offset_utc(t.getTime()),s=U(t);A(s,n);const o=e.offset_utc(s.getTime());return s.setTime(s.getTime()+i-o),s}function A(e,t){e.setTime(e.getTime()+t*w)}function V(e,t){e.setTime(e.getTime()+60*t*1e3)}function F(e,t){const n=86400,i=t%n<0?-1:0,s=Math.trunc(t/n)+i,o=t-s*n,r=Math.trunc(o/3600),a=Math.trunc(o%3600/60);x(e,r,a,o-3600*r-60*a,0),A(e,s)}function U(e){return new Date(e.getTime())}function B(e,t){let n;switch(e){case 0:case 2:case 4:case 6:case 7:case 9:case 11:n=31;break;case 1:n=28,W(t)&&n++;break
;default:n=30}return n}function H(e){return W(e)?366:365}function W(e){return e%4==0&&(e%100!=0||e%400==0)}function Y(e){return 1e3*e}function K(e,t){return te(e)-te(t)}function $(e,t){return new Date(q(e,t))}function q(e,t){return t+e.offset_utc(t)}function z(e,t,n,i,s,o,r){const a=new Date(Date.UTC(t,n,i,s||0,o||0,r||0)),u=e.offset_utc(+a);return new Date(a.valueOf()-u)}function X(e,t){return new Date(t+e.offset_utc(t))}function j(e,t,n,i=0,s=0,o=0){return new Date(Date.UTC(e,t,n,i,s,o))}function G(e,t,n){let i=t.getTime();n&&(i+=e.correction_loc(i));return i-e.offset_loc(i)}function J(e){return new o(e)}let Q;function Z(e,t){const n=e.length;if(0===n)return-1;if(isNaN(t))throw Error("Key is NaN");let i=0,s=n-1,o=ee((i+s)/2);for(;;){if(e[o]>t){if(s=o-1,s<i)return o}else if(i=o+1,s<i)return o<n-1?o+1:-1;o=ee((i+s)/2)}}function ee(e){return 0|e}function te(e){return e<0?ee(e/1e3)-(e%1e3!=0?1:0):ee(e/1e3)}},754105:(e,t,n)=>{"use strict";var i;function s(e){return"scriptTitle"in e&&"modified"in e}function o(e){return"userId"in e&&"scriptAccess"in e}function r(e){return"strategy"===e.kind}function a(e){return"library"===e.kind}n.d(t,{Severity:()=>i,isPubPineInfo:()=>o,isSavedPineInfo:()=>s,isScriptLibrary:()=>a,isScriptStrategy:()=>r}),function(e){e.ERROR="error",e.WARNING="warning"}(i||(i={}))},520533:(e,t,n)=>{"use strict";n.d(t,{convertScript:()=>T,deletePine:()=>D,getLastVersion:()=>R,getPineFacadeUrl:()=>r.getPineFacadeUrl,getPineSourceCode:()=>L,getVersions:()=>N,isAuthToGetPineSourceCode:()=>y,isAuthToWritePineScript:()=>M,isPubPineInfo:()=>h.isPubPineInfo,isSavedPineInfo:()=>h.isSavedPineInfo,isScriptLibrary:()=>h.isScriptLibrary,isScriptStrategy:()=>h.isScriptStrategy,parseScriptTitleAsync:()=>w,renamePine:()=>k,renameVersion:()=>x,requestBuiltinScripts:()=>C,requestUserScripts:()=>I,saveNew:()=>P,saveNewDraft:()=>E,saveNext:()=>S,saveNextDraft:()=>b,translateScriptAsync:()=>g,translateScriptAsync2:()=>p});var i=n(735566),s=n(345848),o=n(427233),r=n(881992),a=n(971417),u=n(791488),l=n(197677),c=n(603774),h=n(754105);n(129586);const d=(0,i.getLogger)("Chart.Study.Versioning"),v=new o.RequestCache,_=new o.RequestCache,f=new o.SingleRequestCache;(0,r.applyGlobalScriptListeners)(v,_,f);const m={};function p(e,t){const n=`${e}-${t}`;let i=m[n];return i||(i=async function(e,t){(0,s.trackEvent)("Pine","ScriptLib.translateScript");const n={},i=(0,a.isCustomPineId)(e);i||(n.user_name=(0,r.getUserName)());try{const i=await(0,l.pineFacadeFetch)({urlPath:`translate/${e}/${t}`,urlParams:n}),s=(0,r.handleTranslateResult)(i);(0,c.logPineMetaInfoIssues)("Pine.translateScriptAsync2",s.metaInfo);return+t<0&&(v.delete(e),_.delete(e),f.clear(),(0,r.onLegacyScriptProceed)(s.metaInfo)),s}catch(e){throw e}}(e,t).catch((e=>{throw delete m[n],e})),m[n]=i),i}async function g(e,t,n={},i=!1){return(0,s.trackEvent)("Pine","ScriptLib.translateScript"),(0,l.pineFacadeFetch)({method:"POST",urlPath:`translate_source/${t}`,urlParams:{is_pine_ex:i},data:{user_name:(0,r.getUserName)(),source:e,inputs:JSON.stringify(n)}}).then((e=>{const t=(0,
r.handleTranslateResult)(e);return(0,c.logPineMetaInfoIssues)("Pine.translateScriptAsync",t.metaInfo),t}))}function T(e,t){return(0,l.pineFacadeFetch)({method:"POST",urlPath:"convert",data:{source:e,version_to:String(t)}}).then((e=>{if(e.reason2?.errors.length)throw e.reason2;if(e.reason)throw e.reason;return(0,r.handleResult)(e)}))}function b(e,t,n,i=!1){if((0,s.trackEvent)("Pine","ScriptLib.saveNextDraft"),!t)return Promise.reject(u.EMPTY_SOURCE_CODE);(0,r.onModifyScriptActiveChanged)(e,n,!0);const o=(0,l.pineFacadeFetch)({method:"POST",urlPath:`save/next_draft/${e}`,urlParams:{user_name:(0,r.getUserName)(),allow_create_new:i},data:{source:t}}).then((e=>{const t=(0,r.handleSaveResult)(e);return(0,c.logPineMetaInfoIssues)("Pine.saveNextDraft",t.metaInfo),t}));return o.finally((()=>(0,r.onModifyScriptActiveChanged)(e,n,!1))),o}function E(e){return(0,s.trackEvent)("Pine","ScriptLib.saveNewDraft"),e?(0,l.pineFacadeFetch)({method:"POST",urlPath:"save/new_draft",urlParams:{user_name:(0,r.getUserName)(),allow_use_existing_draft:!0},data:{source:e}}).then((e=>{const t=(0,r.handleSaveResult)(e);return(0,c.logPineMetaInfoIssues)("Pine.saveNewDraft",t.metaInfo),t})):Promise.reject(u.EMPTY_SOURCE_CODE)}function P({scriptSource:e,scriptName:t,allowOverwrite:n,currentVersion:i}){if((0,s.trackEvent)("Pine","ScriptLib.saveNew"),!e)return Promise.reject(u.EMPTY_SOURCE_CODE);const o={name:t,user_name:(0,r.getUserName)()};return n&&(o.allow_overwrite=!0),(0,l.pineFacadeFetch)({method:"POST",urlPath:"save/new",urlParams:o,data:{source:e}}).then((e=>{f.clear();const t=(0,r.handleSaveResult)(e);return(0,c.logPineMetaInfoIssues)("Pine.saveNew",t.metaInfo),(0,r.onModifyScript)(t.metaInfo,i,!t.success,t.compileErrors.errors),t}))}function S({scriptIdPart:e,scriptSource:t,currScriptVersion:n,isLegacyScript:i,scriptName:o}){if((0,s.trackEvent)("Pine","ScriptLib.saveNext"),!t)return Promise.reject(u.EMPTY_SOURCE_CODE);const a={user_name:(0,r.getUserName)(),allow_create_new:i},h={source:t};return void 0!==o&&(a.name=o),(0,r.onModifyScriptActiveChanged)(e,n,!0),(0,l.pineFacadeFetch)({method:"POST",urlPath:`save/next/${e}`,urlParams:a,data:h}).then((e=>{f.clear();const t=(0,r.handleSaveResult)(e);return(0,c.logPineMetaInfoIssues)("Pine.saveNext",t.metaInfo),(0,r.onModifyScript)(t.metaInfo,n,!t.success,t.compileErrors.errors),t})).finally((()=>(0,r.onModifyScriptActiveChanged)(e,n,!1)))}function w(e){return(0,s.trackEvent)("Pine","ScriptLib.parseScriptTitle"),e?(0,l.pineFacadeFetch)({method:"POST",urlPath:"parse_title",data:{user_name:(0,r.getUserName)(),source:e}}).then((e=>(0,r.handleResult)(e))):Promise.reject(u.EMPTY_SOURCE_CODE)}function M(e){if((0,a.isCustomPineId)(e))return Promise.resolve(!0);const t=_.get(e);if(t)return t;(0,s.trackEvent)("Pine","ScriptLib.isAuthToWritePineScript");const n=(0,l.pineFacadeFetch)({urlPath:`is_auth_to_write/${e}`});return _.set(e,n),n}function y(e,t){const n=v.get(e);if(n)return n;(0,s.trackEvent)("Pine","ScriptLib.isAuthToGetPineSourceCode");const i=(0,l.pineFacadeFetch)({urlPath:`is_auth_to_get/${e}/${t}`
});return v.set(e,i),i}function L(e,t,n){return(0,s.trackEvent)("Pine","ScriptLib.getPineSourceCode"),(0,l.pineFacadeFetch)({urlPath:`get/${e}/${t}`,urlParams:{no_4xx:n}})}function I(){if((0,s.trackEvent)("Pine","ScriptLib.requestUserScripts"),!window.is_authenticated)return Promise.resolve([]);const e=f.get();if(e)return e;const t=(0,l.pineFacadeFetch)({urlPath:"list",urlParams:{filter:"saved"}});return f.reset(t),t}async function C(){(0,s.trackEvent)("Pine","ScriptLib.requestBuiltinScripts");try{d.logNormal("Request built-in scripts");const e=await(0,l.pineFacadeFetch)({urlPath:"list",urlParams:{filter:"standard"}});return d.logNormal("Request built-in scripts finished"),e}catch(e){throw d.logWarn("Request built-in scripts finished with fail"),e}}function D(e){return(0,s.trackEvent)("Pine","ScriptLib.deletePine"),(0,l.pineFacadeFetch)({method:"POST",urlPath:`delete/${e}`,urlParams:{user_name:(0,r.getUserName)()}}).then((t=>(v.delete(e),_.delete(e),f.clear(),(0,r.onDeleteScript)(e),t)))}function k(e,t,n=!1){return(0,s.trackEvent)("Pine","ScriptLib.renamePine"),(0,l.pineFacadeFetch)({method:"POST",urlPath:`rename/${t}`,urlParams:{name:e,user_name:(0,r.getUserName)(),force:n}}).then((n=>(f.clear(),(0,r.onRenameScript)(t,e),n)))}async function N(e,t){(0,s.trackEvent)("Pine","ScriptLib.getVersions");try{d.logNormal("Request script versions");return await(0,l.pineFacadeFetch)({method:"GET",urlPath:`versions/${e}`,urlParams:{limit:t?String(t):void 0}})}catch(e){return d.logWarn("Request script versions finished with fail"),[]}}async function R(e){(0,s.trackEvent)("Pine","ScriptLib.getLastVersions");try{d.logNormal("Request the last script versions");return(await(0,l.pineFacadeFetch)({method:"GET",urlPath:`versions/${e}/last`}))[0]??null}catch(e){return d.logWarn("Request script versions finished with fail"),null}}async function x(e,t,n){try{d.logNormal(`Rename script version ${t}`);return await(0,l.pineFacadeFetch)({method:"PUT",urlPath:`name/${e}/${t}`,urlParams:{name:n??""}})}catch(e){return d.logWarn("Rename script version finished with fail"),null}}},564894:(e,t,n)=>{"use strict";n.d(t,{hasService:()=>u,registerService:()=>r,service:()=>l,unregisterService:()=>a,waitServiceRegistered:()=>c});var i=n(925049);const s={},o=new Map;function r(e,t){if(u(e))throw new Error("Service already registered");s[e.id]=t;const n=o.get(e.id);void 0!==n&&(o.delete(e.id),n.resolve(t))}function a(e){if(!u(e))throw new Error("Service not found");s[e.id]=void 0}function u(e){return void 0!==s[e.id]}function l(e){const t=s[e.id];if(void 0===t)throw new Error("ServiceLocator: Service "+e.id+" not found");return t}function c(e){if(u(e))return Promise.resolve(l(e));let t=o.get(e.id);return void 0===t&&(t=(0,i.createDeferredPromise)(),o.set(e.id,t)),t.promise}},72368:(e,t,n)=>{"use strict";n.d(t,{canShowNewSymbolSearch:()=>u,getCurrentLocaleInfoCountry:()=>l,isMobile:()=>r,isPlatformMobile:()=>a});var i=n(314802),s=n(931924),o=n(638456);function r(){const e=window.matchMedia("(min-width: 602px) and (min-height: 445px)").matches
;return o.CheckMobile.any()&&!e}function a(){return!(0,i.isOnMobileAppPage)("any")&&r()}function u(){return!s.enabled("widget")&&!(0,i.isOnMobileAppPage)("any")}function l(){return window.initData?.currentLocaleInfo?.flag.toUpperCase()}},515828:(e,t,n)=>{"use strict";n.d(t,{MINDS_GROUP_PATH_PATTERN:()=>i,createMindsPath:()=>s});const i="/minds/groups/:symbol/";function s(e,t,n){let s=i.replace(":symbol",encodeURIComponent(e));if(!t)return s;const o=new URLSearchParams;return o.set("mind",t),n&&o.set("editable","true"),s+=`?${o.toString()}`,s}},951713:(e,t,n)=>{"use strict";n.d(t,{getHideOptions:()=>c,getSavedHideMode:()=>d,toggleHideMode:()=>h});var i=n(650151),s=n(444372),o=n(62802),r=n(699576),a=n(87913),u=n(597101);let l=null;function c(){if(null!==l)return l;const e=(0,r.tradingService)();return l=new Map([["drawings",{label:s.t(null,void 0,n(703217)),dataName:"hide-drawing-tools",tooltip:{active:s.t(null,void 0,n(185891)),inactive:s.t(null,void 0,n(752563))},getBoxedValue:()=>(0,a.hideAllDrawings)(),trackLabel:"hide drawings"}],["indicators",{label:s.t(null,void 0,n(72351)),dataName:"hide-indicators",tooltip:{active:s.t(null,void 0,n(598753)),inactive:s.t(null,void 0,n(178525))},getBoxedValue:()=>(0,a.hideAllIndicators)(),trackLabel:"hide indicators"}],["positions",{label:s.t(null,void 0,n(492226)),dataName:"hide-positions-and-orders",tooltip:{active:s.t(null,void 0,n(420506)),inactive:s.t(null,void 0,n(842164))},getBoxedValue:()=>(0,i.ensureNotNull)(e).showTradedSources,inverted:!0,trackLabel:"hide positions"}],["all",{label:s.t(null,void 0,n(47074)),dataName:"hide-all",tooltip:{active:e?s.t(null,void 0,n(686738)):s.t(null,void 0,n(225881)),inactive:e?s.t(null,void 0,n(418216)):s.t(null,void 0,n(90763))},trackLabel:"hide all"}]]),e||l.delete("positions"),l}function h(e){e?o.setValue("ChartToolsHideMode",e):e=d();const t=v();let n=!t;return"all"===e?(_(((e,t,i)=>{e.setValue(i?!n:n)})),u.hideStateChange.fire({hideMode:e,isActive:n}),n):(_(((i,s,o)=>{if(s===e){const e=t?!o:!i.value();i.setValue(e),n=o?!e:e}else i.setValue(Boolean(o))})),u.hideStateChange.fire({hideMode:e,isActive:n}),n)}function d(){const e=o.getValue("ChartToolsHideMode","drawings");return c().has(e)?e:"drawings"}function v(){let e=!0;return _(((t,n,i)=>{const s=t.value();e=e&&(i?!s:s)})),e}function _(e){c().forEach(((t,n)=>{const i=t.getBoxedValue?.();i&&e(i,n,t.inverted)}))}},651231:(e,t,n)=>{"use strict";n.d(t,{getChartWidgetApiTimeConverter:()=>u});var i=n(650151),s=n(482707),o=n(931924);const r=o.enabled("end_of_period_timescale_marks"),a=o.enabled("align_dwm_bars_to_main_series")&&o.enabled("secondary_series_extend_time_scale");function u(e,t,n){return new c(function(e,t){const n={...t};a&&(n.session_holidays="");const i=function(e,t){return e+t.session+t.timezone+(t.corrections||"")+(t.session_holidays||"")}(e,n);let o=l.get(i);void 0===o&&(o=(0,s.createDwmAligner)(e,n),l.set(i,o));return o}(e,t),n)}const l=new Map;class c{constructor(e,t){this._dwmAligner=e,this._chartModel=t}convertPublicTimeToInternalTime(e){
return null!==this._dwmAligner?this._dwmAligner.timeToSessionStart(1e3*e)/1e3:e}convertInternalTimeToPublicTime(e){return null!==this._dwmAligner?this._dwmAligner.timeToExchangeTradingDay(1e3*e)/1e3:e}convertTimePointIndexToPublicTime(e){const t=this._chartModel.timeScale();if(t.isEmpty())return null;let n=r?function(e,t){const n=e.indexToUserTime(t);if(null===n)return null;return n.getTime()/1e3}(t,e):this.convertTimePointIndexToInternalTime(e);return null!==n&&(n=this.convertInternalTimeToPublicTime(n)),n}convertTimePointIndexToInternalTime(e){const t=this._chartModel.timeScale();if(t.isEmpty())return null;const n=t.points(),{firstIndex:s,lastIndex:o}=(0,i.ensureNotNull)(n.range().value());let r=null;if(s<=e&&e<=o)r=n.valueAt(e);else if(e>o){const n=this._chartModel.mainSeries().syncModel();if(null!==n){const s=(0,i.ensureNotNull)(t.indexToTimePoint(o));r=n.projectTime(s,e-o)}}return r}}},312520:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MouseEventHandler:()=>m,defaultPreventedHandler:()=>_,getClickPosition:()=>d,ignoreClickOrTapOnDblClickOrDblTapHandlers:()=>f,isTouchMouseEvent:()=>v});var i=n(481251),s=n(650151),o=n(536794),r=n(638456),a=n(196726),u=n(822961);let l=2;const c=r.isSafari?"click":"auxclick",h={treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!1,ignoreClickAndTapOnDblClickOrDblTap:!1};function d(e){if(v(e))return{x:e.clientX,y:e.clientY};if("touches"in(t=e)&&void 0!==t.touches){if(1===e.touches.length){const t=(0,s.ensureNotNull)(e.target).getBoundingClientRect(),n=e.touches[0];return{x:n.clientX-t.left,y:n.clientY-t.top}}return null}var t;return{x:e.offsetX,y:e.offsetY}}function v(e){return"isTouch"in e&&"stylus"in e}function _(e){return t=>{t.preventDefault(),e(t)}}function f(e,t){let n=!1;return{clickOrTap:(...i)=>{t?.()?e.clickOrTap(...i):(n=!1,setTimeout((()=>!n&&e.clickOrTap(...i)),501))},doubleClickOrDoubleTap:(...t)=>{n=!0,e.doubleClickOrDoubleTap?.(...t)}}}class m{constructor(e,t,n){if(this._clickCount=0,this._clickTimeoutId=null,this._clickPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._touchMoveStartPosition=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._unsubscribePinchEvents=null,this._unsubscribeTargetElementEvents=null,this._pinchInfo=null,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!r.CheckMobile.iOS(),this._onFirefoxOutsideMouseUp=e=>{this._mouseUpHandler(e)},this._onMobileSafariDoubleClick=e=>{if(this._firesTouchEvents(e)){const t=this._makeCompatEvent(e)
;if(++this._tapCount,this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:n}=this._touchMouseMoveWithDownInfo(g(e),this._tapPosition);n<30&&!this._cancelTap&&this._processTouchEvent(t,this._handlers.doubleTapEvent),this._resetTapTimeout()}}else{const t=this._makeCompatEvent(e);if(++this._clickCount,this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:n}=this._touchMouseMoveWithDownInfo(g(e),this._clickPosition);n<5&&!this._cancelClick&&this._processMouseEvent(t,this._handlers.mouseDoubleClickEvent),this._resetClickTimeout()}}},this._target=e,this._options=(0,o.merge)((0,o.clone)(h),n||{}),this._options.ignoreClickAndTapOnDblClickOrDblTap){if(t.mouseClickEvent&&t.mouseDoubleClickEvent){const e=f({clickOrTap:t.mouseClickEvent.bind(t),doubleClickOrDoubleTap:t.mouseDoubleClickEvent.bind(t)});t.mouseClickEvent=e.clickOrTap,t.mouseDoubleClickEvent=e.doubleClickOrDoubleTap}if(t.tapEvent&&t.doubleTapEvent){const e=f({clickOrTap:t.tapEvent.bind(t),doubleClickOrDoubleTap:t.doubleTapEvent.bind(t)});t.tapEvent=e.clickOrTap,t.doubleTapEvent=e.doubleClickOrDoubleTap}}this._handlers=t,this._init()}destroy(){null!==this._unsubscribeOutsideMouseEvents&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),null!==this._unsubscribeOutsideTouchEvents&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),null!==this._unsubscribeMobileSafariEvents&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),null!==this._unsubscribePinchEvents&&(this._unsubscribePinchEvents(),this._unsubscribePinchEvents=null),null!==this._unsubscribeTargetElementEvents&&(this._unsubscribeTargetElementEvents(),this._unsubscribeTargetElementEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(e){this._unsubscribeMousemove&&this._unsubscribeMousemove();const t=this._mouseMoveHandler.bind(this);if(this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",t)},this._target.addEventListener("mousemove",t),this._firesTouchEvents(e))return;const n=this._makeCompatEvent(e);this._processMouseEvent(n,this._handlers.mouseEnterEvent),this._acceptMouseLeave=!0}_resetClickTimeout(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){null!==this._tapTimeoutId&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(e){if(this._mousePressed||null!==this._touchMoveStartPosition)return;if(this._firesTouchEvents(e))return
;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.mouseMoveEvent),this._acceptMouseLeave=!0}_touchMoveHandler(e){const t=E(e.changedTouches,(0,s.ensureNotNull)(this._activeTouchId));if(null===t)return;if(this._lastTouchEventTimeStamp=b(e),null!==this._pinchInfo)return;if(this._preventTouchDragProcess)return;this._pinchPrevented=!0;const n=this._touchMouseMoveWithDownInfo(g(t),(0,s.ensureNotNull)(this._touchMoveStartPosition)),{xOffset:i,yOffset:o,manhattanDistance:r}=n;if(this._touchMoveExceededManhattanDistance||!(r<5)){if(!this._touchMoveExceededManhattanDistance){const e=.5*i,t=this._options.shouldAllowTouchDrag?.()??!1,n=o>=e&&(!this._options.treatVertTouchDragAsPageScroll||t),s=e>o&&(!this._options.treatHorzTouchDragAsPageScroll||t);n||s||(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}if(!this._preventTouchDragProcess){const n=this._makeCompatEvent(e,t);this._processTouchEvent(n,this._handlers.touchMoveEvent),(0,a.preventDefault)(e)}}}_mouseMoveWithDownHandler(e){if(0!==e.button)return;if(this._options.isMouseMoveHandlingEnabled&&!this._options.isMouseMoveHandlingEnabled?.())return;const t=this._touchMouseMoveWithDownInfo(g(e),(0,s.ensureNotNull)(this._mouseMoveStartPosition)),{manhattanDistance:n}=t;if(n>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick){const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.pressedMouseMoveEvent)}}_touchMouseMoveWithDownInfo(e,t){const n=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);return{xOffset:n,yOffset:i,manhattanDistance:n+i}}_touchEndHandler(e){let t=E(e.changedTouches,(0,s.ensureNotNull)(this._activeTouchId));if(null===t&&0===e.touches.length&&(t=e.changedTouches[0]),null===t)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=b(e),this._clearLongTapTimeout(),this._touchMoveStartPosition=null,this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const n=this._makeCompatEvent(e,t);if(this._processTouchEvent(n,this._handlers.touchEndEvent),++this._tapCount,this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:e}=this._touchMouseMoveWithDownInfo(g(t),this._tapPosition);e<30&&!this._cancelTap&&this._processTouchEvent(n,this._handlers.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processTouchEvent(n,this._handlers.tapEvent),this._handlers.tapEvent&&(0,a.preventDefault)(e));0===this._tapCount&&(0,a.preventDefault)(e),0===e.touches.length&&this._longTapActive&&(this._longTapActive=!1,(0,a.preventDefault)(e))}_touchCancelHandler(e){this._touchEndHandler(e)}_mouseUpHandler(e){if(0!==e.button)return;const t=this._makeCompatEvent(e);if(this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),r.isFF){this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp)}
if(!this._firesTouchEvents(e))if(this._processMouseEvent(t,this._handlers.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:n}=this._touchMouseMoveWithDownInfo(g(e),this._clickPosition);n<5&&!this._cancelClick&&this._processMouseEvent(t,this._handlers.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processMouseEvent(t,this._handlers.mouseClickEvent)}_clearLongTapTimeout(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(e){if(null!==this._activeTouchId)return this._clearLongTapTimeout(),void this._resetTapTimeout();const t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=b(e);const n=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartPosition=g(t),this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const t=this._touchMoveHandler.bind(this),i=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{n.removeEventListener("touchmove",t),n.removeEventListener("touchend",i)},n.addEventListener("touchmove",t,{passive:!1}),n.addEventListener("touchend",i,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),333)}const i=this._makeCompatEvent(e,t);this._processTouchEvent(i,this._handlers.touchStartEvent),this._tapTimeoutId||(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapPosition=g(t))}_wheelClickHandler(e){if(1!==e.button)return;if(this._firesTouchEvents(e))return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.wheelClickEvent)}_mouseDownHandler(e){if(0!==e.button)return;if(this._options.isMouseMoveHandlingEnabled&&!this._options.isMouseMoveHandlingEnabled?.())return;const t=this._target.ownerDocument.documentElement;r.isFF&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartPosition=g(e),this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const e=this._mouseMoveWithDownHandler.bind(this),n=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{t.removeEventListener("mousemove",e),t.removeEventListener("mouseup",n)},t.addEventListener("mousemove",e),t.addEventListener("mouseup",n)}if(this._mousePressed=!0,this._firesTouchEvents(e))return;const n=this._makeCompatEvent(e);this._processMouseEvent(n,this._handlers.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickPosition=g(e))}_init(){const e=this._mouseEnterHandler.bind(this);this._target.addEventListener("mouseenter",e);const t=this._touchCancelHandler.bind(this);this._target.addEventListener("touchcancel",t);{
const e=this._target.ownerDocument,t=e=>!e.target||!this._target.contains(e.target),n=e=>{if(!t(e))return;const n=e.changedTouches[0];this._lastTouchEventTimeStamp=b(e),this._processTouchEvent(this._makeCompatEvent(e,n),this._handlers.touchStartOutsideEvent)},i=e=>{t(e)&&!this._firesTouchEvents(e)&&this._processMouseEvent(this._makeCompatEvent(e),this._handlers.mouseDownOutsideEvent)};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",n)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",i)},e.addEventListener("mousedown",i),e.addEventListener("touchstart",n,{passive:!0})}r.CheckMobile.iOS()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick));const n=this._mouseLeaveHandler.bind(this);this._target.addEventListener("mouseleave",n);const i=this._contextMenuHandler.bind(this);this._target.addEventListener("contextmenu",i);const s=this._touchStartHandler.bind(this);let o;this._target.addEventListener("touchstart",s,{passive:!0}),r.isChrome&&(o=e=>{if(1===e.button)return e.preventDefault(),!1},this._target.addEventListener("mousedown",o));const a=this._mouseDownHandler.bind(this);this._target.addEventListener("mousedown",a);const u=this._wheelClickHandler.bind(this);this._target.addEventListener(c,u);const l=()=>{};this._target.addEventListener("touchmove",l,{passive:!1}),this._unsubscribeTargetElementEvents=()=>{this._target.removeEventListener("mouseleave",n),this._target.removeEventListener("contextmenu",i),this._target.removeEventListener("touchstart",s),o&&this._target.removeEventListener("mousedown",o),this._target.removeEventListener("mousedown",a),this._target.removeEventListener(c,u),this._target.removeEventListener("touchmove",l)},this._initPinch()}_initPinch(){if(void 0===this._handlers.pinchStartEvent&&void 0===this._handlers.pinchEvent&&void 0===this._handlers.pinchEndEvent)return;const e=e=>this._checkPinchState(e.touches);this._target.addEventListener("touchstart",e,{passive:!0});const t=e=>{if(null===this._pinchInfo)return;const t=E(e.touches,(0,s.ensureNotNull)(this._activeTouchId)),n=E(e.touches,this._pinchInfo.secondTouchId);if(t&&n&&void 0!==this._handlers.pinchEvent){const{startPinchDistance:i,startPinchMiddlePoint:s}=this._pinchInfo,o=T(t,n)/i,r=p(this._target);this._handlers.pinchEvent(s,{x:t.clientX-r.left,y:t.clientY-r.top},{x:n.clientX-r.left,y:n.clientY-r.top},o),(0,a.preventDefault)(e)}};this._target.addEventListener("touchmove",t,{passive:!1});const n=e=>this._checkPinchState(e.touches);this._target.addEventListener("touchend",n),this._unsubscribePinchEvents=()=>{this._target.removeEventListener("touchstart",e),this._target.removeEventListener("touchmove",t),this._target.addEventListener("touchend",n)}}_checkPinchState(e){1===e.length&&(this._pinchPrevented=!1),2!==e.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)}_startPinch(e){
if(void 0!==this._handlers.pinchStartEvent&&null===this._pinchInfo){const t=p(this._target);let n,i;e[0].identifier===this._activeTouchId?(n=e[0],i=e[1]):(n=e[1],i=e[0]);const s={x:n.clientX-t.left,y:n.clientY-t.top},o={x:i.clientX-t.left,y:i.clientY-t.top},r={x:(s.x+o.x)/2,y:(s.y+o.y)/2};this._handlers.pinchStartEvent(r,s,o,{bothPointsOnTargetElement:this._target.contains(i.target)})&&(this._pinchInfo={startPinchDistance:T(n,i),startPinchMiddlePoint:r,secondTouchId:i.identifier})}this._clearLongTapTimeout()}_stopPinch(){null!==this._pinchInfo&&(this._pinchInfo=null,this._handlers.pinchEndEvent?.())}_mouseLeaveHandler(e){if(this._unsubscribeMousemove&&this._unsubscribeMousemove(),this._firesTouchEvents(e))return;if(!this._acceptMouseLeave)return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.mouseLeaveEvent),this._acceptMouseLeave=!r.CheckMobile.iOS()}_longTapHandler(e){const t=E(e.touches,(0,s.ensureNotNull)(this._activeTouchId));if(null===t)return;const n=this._makeCompatEvent(e,t);this._processTouchEvent(n,this._handlers.longTapEvent),this._processTouchEvent(n,this._handlers.touchContextMenuEvent),this._cancelTap=!0,this._longTapActive=!0}_contextMenuHandler(e){if((0,a.preventDefault)(e),null!==this._touchMoveStartPosition)return;if(this._firesTouchEvents(e))return;const t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handlers.contextMenuEvent),this._cancelClick=!0}_firesTouchEvents(e){return e.sourceCapabilities&&void 0!==e.sourceCapabilities.firesTouchEvents?e.sourceCapabilities.firesTouchEvents:b(e)<this._lastTouchEventTimeStamp+500}_processTouchEvent(e,t){(0,u.setLastMouseOrTouchEventInfo)(e),t&&t.call(this._handlers,e)}_processMouseEvent(e,t){window.TVD&&("mouseenter"===e.srcType||"mousemove"===e.srcType)&&l>0?l--:("mouseleave"!==e.srcType&&(0,u.setLastMouseOrTouchEventInfo)(e),t&&t.call(this._handlers,e))}_makeCompatEvent(e,t){const n=t||e,s=(0,i.default)((()=>this._target.getBoundingClientRect()||{left:0,top:0}));return{clientX:n.clientX,clientY:n.clientY,pageX:n.pageX,pageY:n.pageY,screenX:n.screenX,screenY:n.screenY,get localX(){return n.clientX-s().left},get localY(){return n.clientY-s().top},ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,isTouch:!e.type.startsWith("mouse")&&"contextmenu"!==e.type&&"click"!==e.type,stylus:"stylus"===t?.touchType,srcType:e.type,target:n.target,view:e.view,preventDefault:()=>{"touchstart"!==e.type&&(0,a.preventDefault)(e)}}}}function p(e){return e.getBoundingClientRect()||{left:0,top:0}}function g(e){return{x:e.pageX,y:e.pageY}}function T(e,t){const n=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(n*n+i*i)}function b(e){return e.timeStamp||performance.now()}function E(e,t){for(let n=0;n<e.length;++n)if(e[n].identifier===t)return e[n];return null}},61e3:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addSymbolDialogHasOpenedKey:()=>r,showAddSymbolDialog:()=>a});var i=n(810978),s=n(305514),o=n(251954);const r="addSymbolDialogHasOpenedKey";function a(e){(0,i.runOrSigninWithFeature)((()=>{(0,
s.showWatchListsDialog)({addSymbols:e,onOpen:u})}),{feature:"watchList",source:"add symbol to watchlist"})}function u(){o.emit(r)}},482707:(e,t,n)=>{"use strict";n.d(t,{createDwmAligner:()=>r,createTimeToBarTimeAligner:()=>a});var i=n(150112),s=n(931924);function o(){return!s.enabled("disable_resolution_rebuild")}const r=i.createDwmAligner.bind(null,o()),a=i.createTimeToBarTimeAligner.bind(null,o())},87913:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SelectPointMode:()=>i,activePointSelectionMode:()=>J,alignTo45Degrees:()=>Le,barTimesUnderCursor:()=>Z,beenSetLineToolLastPoint:()=>F,cancelLineTool:()=>se,cancelledLineTool:()=>V,changeLineStyle:()=>_e,changeLineTool:()=>ce,changedLineStyle:()=>z,changedLineTool:()=>Y,continueLineTool:()=>ie,continuedLineTool:()=>A,copiedLineTool:()=>X,copyLineTool:()=>fe,createLineTool:()=>ne,createdLineTool:()=>O,crosshairLock:()=>M,cursorTool:()=>D,drawOnAllCharts:()=>Ie,drawOnAllChartsMode:()=>Ce,emojiTool:()=>I,finishChangingLineTool:()=>he,finishLineTool:()=>ve,finishMovingLineTool:()=>ue,finishedChangingLineTool:()=>K,finishedLineTool:()=>q,finishedMovingLineTool:()=>H,hideAllDrawings:()=>Se,hideAllIndicators:()=>we,hideMarksOnBars:()=>ye,iconTool:()=>L,init:()=>be,isDirectionalMovementActive:()=>x,isStudyEditingNow:()=>Q,isToolCreatingNow:()=>k,isToolEditingNow:()=>N,isToolMovingNow:()=>R,lockDrawings:()=>Me,moveLineTool:()=>ae,movedLineTool:()=>B,properties:()=>Pe,removeLineTool:()=>de,removedLineTool:()=>$,resetToCursor:()=>g,restoreLineTool:()=>me,restoreLineToolState:()=>pe,restoredLineTool:()=>j,restoredLineToolState:()=>G,runOnDrawingStateReady:()=>Ee,setLineToolLastPoint:()=>oe,startChangingLineTool:()=>le,startMovingLineTool:()=>re,startedChangingLineTool:()=>W,startedMovingLineTool:()=>U,stickerTool:()=>C,tool:()=>y,toolIsCursor:()=>_,toolIsDemonstration:()=>m,toolIsEraser:()=>f,toolIsMeasure:()=>p});var i,s=n(650151),o=n(781567),r=n(890390),a=n(820028),u=n(751094),l=n(547465),c=n(62802),h=n(251954),d=n(345848);!function(e){e[e.None=0]="None",e[e.Replay=1]="Replay",e[e.Study=2]="Study"}(i||(i={}));const v=new Set(["cursor","arrow","dot","performance","demonstration"]);function _(e){return v.has(e)}function f(e){return"eraser"===e}function m(e){return"demonstration"===e}function p(e){return"measure"===e}function g(e=!1){if(!e&&T){if(T.childs().stayInDrawingMode.value())return}y.setValue(D.value())}let T=null,b=null,E=null,P=null,S=null,w=null;const M=new u.WatchedObject(null),y=new a.WatchedValue,L=new a.WatchedValue,I=new a.WatchedValue,C=new a.WatchedValue,D=new a.WatchedValue,k=new a.WatchedValue(!1),N=new a.WatchedValue(!1),R=new a.WatchedValue(!1),x=new a.WatchedValue(!1),O=new l.Delegate,A=new l.Delegate,V=new l.Delegate,F=new l.Delegate,U=new l.Delegate,B=new l.Delegate,H=new l.Delegate,W=new l.Delegate,Y=new l.Delegate,K=new l.Delegate,$=new l.Delegate,q=new l.Delegate,z=new l.Delegate,X=new l.Delegate,j=new l.Delegate,G=new l.Delegate,J=new a.WatchedValue(i.None),Q=new a.WatchedValue(!1),Z=new Map;function ee(e,t){const n=t||{value:!1};return t=>{n.value||(n.value=!0,
e.fire(t),n.value=!1)}}const te={value:!1},ne=ee(O,te),ie=ee(A,te),se=ee(V,te),oe=ee(F,te),re=ee(U),ae=ee(B),ue=ee(H),le=ee(W),ce=ee(Y),he=ee(K),de=ee($),ve=ee(q),_e=ee(z,te),fe=ee(X,te),me=ee(j),pe=ee(G);let ge=!1,Te=[];function be(){if(ge)return;const e=c.getValue("chart.cursorPreference","cursor");y.setValue(_(e)?e:"cursor"),y.subscribe((e=>{_(e)?D.setValue(e):f(e)&&(0,d.trackEvent)("Chart cursors",e)}),{callWithLast:!0}),D.subscribe((e=>{(0,d.trackEvent)("Chart cursors",e),e&&"performance"!==e&&!m(e)&&c.setValue("chart.cursorPreference",e)})),T=new r.DefaultProperty({defaultName:"drawings"}),b=(0,o.createPrimitiveProperty)(!1),E=(0,o.createPrimitiveProperty)(!1),P=(0,o.createPrimitiveProperty)(!1),S=(0,o.createPrimitiveProperty)(!c.getBool("BarsMarksContainer.visibile",!0)),w=(0,o.createPrimitiveProperty)(!1),y.subscribe((e=>{(0,h.emit)("onSelectedLineToolChanged")})),ge=!0,Te.forEach((e=>e())),Te=[]}function Ee(e){ge?e():Te.push(e)}function Pe(){return(0,s.ensureNotNull)(T)}function Se(){return(0,s.ensureNotNull)(b)}function we(){return(0,s.ensureNotNull)(E)}function Me(){return(0,s.ensureNotNull)(P)}function ye(){return(0,s.ensureNotNull)(S)}function Le(){return(0,s.ensureNotNull)(w)}function Ie(){return Pe().childs().drawOnAllCharts}function Ce(){return Pe().childs().drawOnAllChartsMode}},702067:(e,t,n)=>{"use strict";n.d(t,{LineToolCollectedProperty:()=>l,LineToolColorsProperty:()=>h,LineToolWidthsProperty:()=>c,MultipleLineColorsProperty:()=>_,MultipleLineWidthsProperty:()=>v});var i=n(735566),s=n(862150),o=n(421566);const r=(0,i.getLogger)("Chart.LineToolCollectedProperty");class a{applyValue(e,t){e.setValue(t)}}class u extends o.PropertyBase{constructor(e,t){super(),this._properties=e,e.forEach(((e,t)=>e.subscribe(this,((e,n)=>{this._listeners.fire(this,`${t}.${n}`)})))),this._showIfProperty=t}visible(){return!this._showIfProperty||this._showIfProperty?.value()}value(){if(0===this._properties.length)return r.logError("Incorrect call, should not request value of 0 properties"),"mixed";const e=this._properties[0].value();return 1===this._properties.length||this._properties.every((t=>t.value()===e))?e:"mixed"}setValueSilently(e){"mixed"!==e&&this._properties.forEach((t=>t.setValueSilently(e)))}hasChild(e){const t=parseInt(e,10);return!isNaN(t)&&t>=0&&t<this._properties.length}childCount(){return this._properties.length}childNames(){return this._properties.map(((e,t)=>t.toString()))}child(e){const t=parseInt(e,10);return!isNaN(t)&&t>=0&&t<this._properties.length?this._properties[t]:void 0}destroy(){this._properties.forEach((e=>e.unsubscribeAll(this))),this._listeners.destroy()}storeStateIfUndefined(){return!0}weakReference(){return(0,s.weakReference)(this)}ownership(){return(0,s.ownership)(this)}}class l extends u{setValue(e,t,n){if("mixed"===e)return;const i=n??new a;this._properties.forEach((t=>i.applyValue(t,e)))}}class c extends l{}class h extends l{firstColor(){return this._properties[0].value()}}class d extends(25242==n.j?u:null){setValue(e,t,n){if("mixed"===e)return;const i=n??new a
;this._properties.forEach((t=>t.setValue(e,void 0,i)))}}class v extends(25242==n.j?d:null){}class _ extends(25242==n.j?d:null){}},545372:(e,t,n)=>{"use strict";n.d(t,{cloneLineTool:()=>F,createLineTool:()=>I,createLineToolProperties:()=>D,createStudyLineToolProperties:()=>k,ensureAllLineToolsLoadedForLayout:()=>y,initAllLineToolsFromContent:()=>L,initLineTool:()=>P,isBrushBasedLineTool:()=>R,isEditableTextLineTool:()=>A,isLineTool:()=>p.isLineTool,isTrading:()=>x,prepareLineToolPropertiesByOwnerSource:()=>C,setNewToolProperties:()=>b,supportsPhantomMode:()=>N,tryFindStudyLineToolNameByStudyId:()=>V,unsetNewToolProperties:()=>E});var i=n(182433),s=n(650151),o=n(610555),r=n(735566),a=n(816541),u=n(700931),l=n(388741),c=n(529751),h=n(397007),d=n(323348),v=n(584878),_=n(147582),f=n(349811),m=n(193579),p=n(63358);const g="DrawingCreations";let T=null;function b(e,t,n){return null!==T&&T.tool===e&&T.toolData===t||(E(!0),T={properties:D(n.backgroundTheme().spawnOwnership(),e,!n.readOnly()),tool:e,toolData:t}),T.properties}function E(e){e&&T?.properties.destroy(),T=null}async function P(e){await(0,m.loadMetaInfoForLinetoolIfRequired)(e);const t=(0,m.asLineToolName)(e);(0,m.isLineToolLoaded)(t)||(0,c.isLineToolName)(t)&&await(0,m.loadLineTool)(t)}function S(e,t){const n="charts"in e?e.charts:[e];for(const e of n){for(const n of e.panes)for(const e of n.sources)t(e.type);e.lineToolsGroups?.groups.forEach((e=>{e.tools.forEach((e=>t(e)))}))}}class w extends Error{constructor(e,t){super(`Failed to load line tool: ${e}`),this.name="LineToolLoadError",this.toolName=e,this.originalError=t}}const M=(0,r.getLogger)("LineToolsSynchronizer");async function y(e){const t=new Set,n=e=>{(0,m.isAsyncGenericLineToolName)(e)&&t.add(e)};for(const t of e)S(t,n);const i=[...t],s=(await Promise.allSettled(i.map((e=>(0,m.ensureLineToolLoaded)(e).catch((t=>{throw new w(e,t)})))))).filter((e=>"rejected"===e.status));s.length>0&&s.forEach((e=>{const t=e.reason;M.logError(`Failed to load line tool: ${t.toolName}`)}))}async function L(e){if(!e)return;const t=new Set;S(e,(e=>{(0,c.isLineToolName)(e)&&t.add(e)})),await Promise.all(Array.from(t).map((e=>P(e))))}function I(e,t,n,i,o,r,a){(0,s.assert)((0,c.isLineToolName)(e),"Unknown line tool: "+e);const u=(0,m.asLineToolName)(e);let l;if((0,s.assert)((0,m.isLineToolLoaded)(u),`Line tool ${u} is not loaded`),o||n||null===T||T.tool!==e||(n=T.properties,E(!1)),(0,m.isAsyncStudyLineToolName)(u)){l=new((0,m.getLoadedLineTool)(u))(t,n,(0,s.ensureDefined)(i),o,r)}else{l=new((0,m.getLoadedLineTool)(u))(t,n,o,r)}return l.toolname=e,E(!0),void 0!==a&&(0,v.shouldAffectUser)(g,_.sparseUsersTrackingCoefficient)&&(0,d.trackChartDrawingCreation)(e,a),l}function C(e,t){const n=(0,s.ensureNotNull)(t.symbolSource()),i=n.symbolInfo(),o=i?(0,l.extractLineToolSymbolFromSymbolInfo)(i,n.symbol()):n.symbol();e.childs().symbol.setValue(o),n.model().currencyConversionEnabled()&&n.isConvertedToOtherCurrency()&&e.childs().currencyId.setValue(n.currency()),
n.model().unitConversionEnabled()&&n.isConvertedToOtherUnit()&&e.childs().unitId.setValue(n.unit()),e.childs().symbolStateVersion.setValue(2),e.childs().zOrderVersion.setValue(2)}function D(e,t,n,i){(0,s.assert)((0,c.isLineToolName)(t),`${t} should be name of the line tool`);const o=(0,m.asLineToolName)(t);if((0,s.assert)((0,m.isLineToolLoaded)(o),`Line tool ${o} is not loaded`),(0,m.isAsyncStudyLineToolName)(o)){return(0,m.getLoadedLineTool)(o).createProperties(e,i)}return(0,m.getLoadedLineTool)(o).createProperties(e,i,n)}function k(e,t,n,i,o,r){(0,s.assert)((0,c.isStudyLineToolName)(t),`${t} should be name of the study line tool`);const a=(0,m.asLineToolName)(t);if((0,m.isAsyncStudyLineToolName)(a)){return(0,m.getLoadedLineTool)(a).createPropertiesFromStudyMetaInfoAndState(n,i,o,r,e)}throw new Error(`Property creation is not implemented for study line tool ${t}`)}function N(e){(0,s.assert)((0,c.isLineToolName)(e),`${e} should be name of the line tool`);const t=(0,m.asLineToolName)(e);(0,s.assert)((0,m.isLineToolLoaded)(t),`Line tool ${t} is not loaded`);const n=(0,m.getLoadedLineTool)(t);return void 0!==n&&Boolean(n.supportPhantomMode)}function R(e){return e instanceof f.LineToolBrushBase}function x(e){return e instanceof u.LineToolTrading}const O=["editableTextStyle","editableText","editableTextProperties"];function A(e){return(0,i.default)(e)&&O.every((t=>t in e))}function V(e){let t=null;return e===h.lineToolsStudyIds.LineToolRegressionTrend?t="LineToolRegressionTrend":e===h.lineToolsStudyIds.LineToolVbPFixed?t="LineToolVbPFixed":e===h.lineToolsStudyIds.LineToolFixedRangeVolumeProfile&&(t="LineToolFixedRangeVolumeProfile"),t}function F(e,t,n,i,r){const u=t.toolname,l=t.properties().state();l.intervalsVisibilities=(0,a.mergeIntervalVisibilitiesDefaults)(l?.intervalsVisibilities);const c=D(e.backgroundTheme().spawnOwnership(),t.toolname,!e.readOnly(),l);c.childs().visible.setValue(!0);const h=(0,s.ensureNotNull)(t.ownerSource()),d=I(u,e,c,null,void 0,void 0,r);void 0!==i&&d.setId(i),d.supportsTargetSignature()&&null!==h.signature().value()?d.setTargetSignature(h.signature().value()):d.setOwnerSource(h),d.toolname=u;const v=d.clonePositionOffset();if(t.isFixed()){const e=(0,s.ensureDefined)(t.fixedPoint()),i=n?e.add(new o.Point(v.xCoordOffset,v.yCoordOffset)):e;d.addFixedPoint(i)}const _=t.normalizedPoints(),f=n?function(e,t,n){const i=(0,s.ensureNotNull)(t.priceScale()),o=(0,s.ensureNotNull)(t.firstValue());return e.map((e=>{const t=e.price,s=i.priceToCoordinate(t,o)+n.yCoordOffset,r=i.coordinateToPrice(s,o),a=e.interval;return{time_t:e.time_t,price:r,offset:e.offset+n.barOffset,interval:a}}))}(_,h,v):_,m=t.points();return d.restorePoints(f,m),d.cloneData&&d.cloneData(t),d.recalculateStateByData&&d.recalculateStateByData(),d}},515072:(e,t,n)=>{"use strict";n.d(t,{magnetEnabled:()=>m,magnetMode:()=>p,magnetSnapsToIndicators:()=>g,setIsMagnetEnabled:()=>T,setMagnetMode:()=>b,setMagnetSnapsToIndicators:()=>E});var i=n(890390),s=n(820028),o=n(590729),r=n(87913),a=n(529751),u=n(728136)
;const l=new s.WatchedValue(!1),c=new s.WatchedValue(o.MagnetMode.WeakMagnet),h=new s.WatchedValue(!1),d=(0,u.modifierPressed)(),v=(0,u.shiftPressed)();function _(){const e=d.value();if(v.value()&&(r.isToolEditingNow.value()||r.isToolCreatingNow.value()))return void l.setValue(!1);let t,n;if(r.activePointSelectionMode.value()===r.SelectPointMode.Replay)t=n=!1;else{const i=r.tool.value(),s=r.isStudyEditingNow.value()||r.activePointSelectionMode.value()===r.SelectPointMode.Study;t=e&&((0,a.isLineToolName)(i)||r.isToolEditingNow.value()||(0,r.toolIsMeasure)(i)||s),n=(0,r.properties)().childs().magnet.value()}c.setValue(!n&&t?o.MagnetMode.StrongMagnet:(0,r.properties)().childs().magnetMode.value()),l.setValue(t?!n:n)}function f(){h.setValue((0,r.properties)().childs().magnetSnapsToIndicators.value())}function m(){return l}function p(){return c}function g(){return h}function T(e){(0,i.allowSavingDefaults)(!0),(0,r.properties)().childs().magnet.setValue(e),(0,i.allowSavingDefaults)(!1)}function b(e){(0,i.allowSavingDefaults)(!0),(0,r.properties)().childs().magnetMode.setValue(e),(0,r.properties)().childs().magnet.setValue(!0),(0,i.allowSavingDefaults)(!1)}function E(e){(0,i.allowSavingDefaults)(!0),(0,r.properties)().childs().magnetSnapsToIndicators.setValue(e),(0,i.allowSavingDefaults)(!1)}(0,r.runOnDrawingStateReady)((()=>{(0,r.properties)().childs().magnet.subscribe(null,_),(0,r.properties)().childs().magnetMode.subscribe(null,_),(0,r.properties)().childs().magnetSnapsToIndicators.subscribe(null,f),d.subscribe(_),v.subscribe(_),r.tool.subscribe(_),r.isToolEditingNow.subscribe(_),_(),f()}))},64262:(e,t,n)=>{"use strict";n.d(t,{compareResolutions:()=>v.compareResolutions,convertResolutionsFromSettings:()=>M,getApplicableIntervalForFrequency:()=>v.getApplicableIntervalForFrequency,getDefaultResolution:()=>b,getMaxResolutionValue:()=>w,getResolutionByChartStyle:()=>E,getTranslatedResolution:()=>I,getTranslatedResolutionModel:()=>C,intervalIsSupported:()=>x,isAvailable:()=>g,isIntervalEnabled:()=>R,isResolutionMultiplierValid:()=>P,isSecondsEnabled:()=>k,mergeResolutions:()=>y,normalizeIntervalString:()=>p,setLastUsedResolution:()=>T,sortResolutions:()=>L});var i=n(536794),s=n(444372),o=n(477786),r=n(388741),a=n(62802),u=n(125226),l=n(625214),c=n(999102),h=n(931924),d=n(303999),v=n(321870);const _=[1,5,10,15,30,45],f=[1,10,100,1e3],m=(0,u.isFeatureEnabled)("custom_ticks");function p(e){return o.Interval.parse(e).value()}function g(e){const t=o.Interval.parse(e);if(t.isRange())return l.linking.range.value();if(!(0,d.isTicksEnabled)()&&t.isTicks())return!1;const n=t.value(),i=l.linking.dataFrequencyResolution.value();if(void 0!==i&&(0,v.compareResolutions)(n,i)<0)return!1;const s=l.linking.supportedResolutions.value();return void 0!==s?void 0!==s.find((e=>p(e)===n)):t.isTicks()?Boolean(l.linking.ticks.value()):t.isIntraday()?Boolean(l.linking.intraday.value()):t.isDWM()}function T(e){o.Interval.isValid(e)&&(o.Interval.isRange(e)?a.setValue("chart.lastUsedRangeResolution",e):a.setValue("chart.lastUsedTimeBasedResolution",e))}
function b(e){return e?"100R":"1D"}function E(e,t,n){const i=r.isRangeStyle(e),s=o.Interval.isRange(t);return!i&&s?function(e){const t=a.getValue("chart.lastUsedTimeBasedResolution");if(void 0!==t&&o.Interval.isTimeBased(t))return t;let n="1D";for(const t of e){const e=o.Interval.parse(t);if(e.isTimeBased()){const t=e.value();if("1D"===t)return t;n=t}}return n}(n):i&&!s?function(e){const t=a.getValue("chart.lastUsedRangeResolution");if(void 0!==t&&o.Interval.isRange(t))return t;let n="100R";for(const t of e){const e=o.Interval.parse(t);if(e.isRange()){const t=e.value();if("100R"===t)return t;n=t}}return n}(n):t}function P(e){const{interval:t,guiResolutionKind:n}=o.Interval.parseExt(e);if(!t.isValid())return!1;const i=t.multiplier();if(n===o.ResolutionKind.Seconds)return _.includes(i);if((0,d.isTicksEnabled)()&&n===o.ResolutionKind.Ticks)return!!m||f.includes(i);return(n===o.SpecialResolutionKind.Hours?i/60:i)<=S(n)}function S(e){const t=v.maxResolutionValues[e];return Number.isNaN(t)?1:t}function w(e){return S(o.Interval.parseExt(e).guiResolutionKind)}function M(e){return Array.isArray(e)?e:Object.keys(e).map(o.Interval.normalize).filter(i.notNull)}function y(...e){let t=[].concat(...e);return t=(0,c.uniq)(t.filter(P).map(p)),L(t)}function L(e){return e.sort(v.compareResolutions)}function I(e){const{multiplier:t,shortKind:n}=C(e);return`${t}${n}`}function C(e,t){const n=o.Interval.parse(e);let i=n.multiplier(),s=n.kind();if(!n.isValid()){if(t)return null;throw new TypeError(`Can't translate invalid interval: ${e}`)}return n.isMinuteHours()&&(i=Math.floor(i/60),s=o.SpecialResolutionKind.Hours),{multiplier:i.toString(),shortKind:D(s),hint:`${i} ${D(s,i)}`,mayOmitMultiplier:n.isDWM()&&1===i,mayOmitShortKind:n.isMinutes()&&!n.isMinuteHours()}}function D(e,t){if(!t)return{[o.ResolutionKind.Invalid]:"",[o.ResolutionKind.Ticks]:s.t(null,{context:"interval_short"},n(882901)),[o.ResolutionKind.Seconds]:s.t(null,{context:"interval_short"},n(968823)),[o.ResolutionKind.Minutes]:s.t(null,{context:"interval_short"},n(768430)),[o.SpecialResolutionKind.Hours]:s.t(null,{context:"interval_short"},n(438048)),[o.ResolutionKind.Days]:s.t(null,{context:"interval_short"},n(38691)),[o.ResolutionKind.Weeks]:s.t(null,{context:"interval_short"},n(307408)),[o.ResolutionKind.Months]:s.t(null,{context:"interval_short"},n(977995)),[o.ResolutionKind.Range]:s.t(null,{context:"interval_short"},n(993934))}[e];switch(e){case o.ResolutionKind.Ticks:return s.t(null,{plural:"ticks",count:t},n(111913));case o.ResolutionKind.Days:return s.t(null,{plural:"days",count:t},n(641807));case o.ResolutionKind.Weeks:return s.t(null,{plural:"weeks",count:t},n(448898));case o.ResolutionKind.Months:return s.t(null,{plural:"months",count:t},n(898393));case o.ResolutionKind.Seconds:return s.t(null,{plural:"seconds",count:t},n(33232));case o.ResolutionKind.Minutes:return s.t(null,{plural:"minutes",count:t},n(378318));case o.SpecialResolutionKind.Hours:return s.t(null,{plural:"hours",count:t},n(942328));case o.ResolutionKind.Range:return s.t(null,{plural:"ranges",count:t
},n(189937));default:return e}}function k(){return!0}function N(e){return!(!(0,d.isTicksEnabled)()&&e.isTicks())}function R(e){return N(o.Interval.parse(e))}function x(e){if(h.enabled("allow_supported_resolutions_set_only")){const t=o.Interval.normalize(e);return null!==t&&g(t)}{const t=o.Interval.parse(e);if(!t.isValid()||!N(t))return!1;if(!h.enabled("custom_resolutions")){const t=o.Interval.normalize(e),n=window.ChartApiInstance.defaultResolutions().filter(R);if(!t||-1===n.indexOf(t))return!1}const n=l.linking.dataFrequencyResolution.value();if(void 0!==n&&(0,v.getApplicableIntervalForFrequency)(n,t.value())!==t.value())return!1;if(t.isRange())return l.linking.range.value();if(t.isTicks())return l.linking.ticks.value();if(t.isIntraday())return l.linking.intraday.value();{const e=l.linking.supportedResolutions.value();return!e||e.includes(t.value())}}}},960433:(e,t,n)=>{"use strict";n.d(t,{TextWidthCache:()=>o,getMinTextMetrics:()=>s});var i=n(850117);function s(e){return{width:e.width,actualBoundingBoxAscent:e.actualBoundingBoxAscent,actualBoundingBoxDescent:e.actualBoundingBoxDescent,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent}}class o{constructor(e=150){this._fontStyle="",this._cache=new i.CircularCacheBuffer(e,1.5)}reset(){this._cache.clear()}measureText(e,t){return this.getMetrics(e,t).width}yMidCorrection(e,t){const n=this.getMetrics(e,t);return void 0!==n.actualBoundingBoxAscent&&void 0!==n.actualBoundingBoxDescent?(n.actualBoundingBoxAscent-n.actualBoundingBoxDescent)/2:0}getMetrics(e,t){e.font!==this._fontStyle&&(this.reset(),this._fontStyle=e.font);const n=this._cache.get(t);if(void 0!==n)return n;const i=e.textBaseline;e.textBaseline="middle";const o=s(e.measureText(t));return e.textBaseline=i,0===o.width&&t.length||this._cache.set(t,o),o}}},374122:(e,t,n)=>{"use strict";n.d(t,{setSupportPortalProblemsHost:()=>s,supportPortalProblemsHost:()=>i});let i="";function s(e){i=e}},342042:(e,t,n)=>{"use strict";n.d(t,{isNewPineEditorUser:()=>s,shouldUseVerticalEditor:()=>o});var i=n(125226);n(62802);function s(){return!1}function o(){return(0,i.isFeatureEnabled)("vertical_editor")}},904207:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getTranslatedSymbolDescription:()=>o});var i=n(444372);function s(e){const t=`#${e}-symbol-description`,s=i.t(t,void 0,n(956316));return s===t?null:s}function o(e){if(void 0!==e.pro_name){const t=s(e.pro_name);if(null!==t)return t;if(void 0!==e.short_name){const t=s(e.short_name);if(null!==t)return t}}return"en"!==e.language&&void 0!==e.local_description&&e.language===window.language||"en"===e.language&&void 0!==e.local_description&&e.language===window.language?e.local_description:e.description||""}},201457:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><g fill="none" fill-rule="evenodd" stroke="currentColor"><path d="M13.111 18.5H10.5a1 1 0 0 1-1-1v-11a1 1 0 0 1 1-1h11a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1h-8.389z"/><path d="M18.5 20v1.5a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1v-11a1 1 0 0 1 1-1H8"/></g></svg>'}}]);