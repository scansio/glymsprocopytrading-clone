import{p as ee,ac as ie,ae as le,j as P,t as B,z as A,A as M,R as D,D as e,G as g,m as v,n as te,o as ae,c0 as de,at as Y,as as Z,f as p,b6 as ce,U as ye,h as R,k as Q,H as X,y as N,ar as be,$ as Me,a4 as Ce,a5 as ke,b2 as we,I as ve,J as Ie,K as Pe,q as pe,M as ue,b1 as Be,a0 as ge,v as Le,c1 as Ee,C as se,bB as Te,c2 as He,bK as Ae,X as De,af as oe,c3 as Fe,c4 as We,L as Se,bv as Ue,c5 as ze,c6 as re,B as Oe,c7 as Re}from"./main-BSwCATKb.js";import{C as Ge,e as Ke,M as ne,c as je,h as qe,f as Je,L as Qe,b as Xe,i as Ne,W as Ve,g as Ye,a as Ze,F as et,A as tt,B as at,k as st}from"./WidgetMessengerInput-BHudvUbV.js";var ot=B('<div class="absolute bottom-0 w-full flex items-center justify-center bg-gradient-to-t from-white/100 from-0% via-white/50 via-70% to-transparent"><!></div>'),rt=B('<div class="relative"><div class="text-sm leading-[22px] overflow-auto max-h-132px color-slate-800"><!></div> <!></div>'),nt=B('<div class="w-full flex-center py-2 overflow-clip"><div><!></div></div>'),it=B("<!> <!>",1);function lt(l,r){ee(r,!0);const[u,G]=ae(),n=()=>P(de,"$popupMessage",u),L=()=>P(pe,"$t",u),f=110,E=t=>{const i=t.find(h=>h.type===we.AttachmentType.Cards);return i||null};let d=g(()=>n()&&E(n().attachments)),F=g(()=>e(d)?e(d).items.length===1:!1),a=Y(void 0),C=Y(!1);const _=()=>{e(a)&&Z(C,e(a).scrollHeight>e(a).clientHeight&&e(a).scrollTop+e(a).clientHeight<e(a).scrollHeight-12,!0)},x=t=>{t.stopPropagation(),e(a)&&e(a).scrollBy({top:f,behavior:"smooth"})};ie(()=>{_()}),le(()=>{var t;(t=n())!=null&&t.content.text&&setTimeout(_,0)});const k=t=>(t.addEventListener("scroll",_),window.addEventListener("resize",_),{destroy(){t.removeEventListener("scroll",_),window.removeEventListener("resize",_)}});var W=it(),S=A(W);{var K=t=>{var i=rt(),h=p(i),q=p(h);{var w=s=>{ne(s,{children:($,b)=>{je($,{children:(m,H)=>{var I=N(),V=A(I);qe(V,()=>n().content.html),v(m,I)}})}})},T=(s,$)=>{{var b=m=>{ne(m,{children:(H,I)=>{Qe(H,{get text(){return n().content.text}})}})};M(s,m=>{n().content.text&&m(b)},$)}};M(q,s=>{"html"in n().content&&n().content.html?s(w):s(T,!1)})}ce(h,s=>Z(a,s),()=>e(a)),ye(h,s=>k==null?void 0:k(s));var U=D(h,2);{var c=s=>{var $=ot(),b=p($);const m=g(()=>L()("ariaLabel.scrollDown"));ve(b,{icon:Je,get iconDescription(){return e(m)},onClick:x,variant:"primary",size:"sm"}),Ie(3,$,()=>Pe,()=>({duration:200})),v(s,$)};M(U,s=>{e(C)&&s(c)})}R(()=>Q(h,"data-testid",X.popupMessage)),v(t,i)};M(S,t=>{var i;(i=n())!=null&&i.content.text&&t(K)})}var j=D(S,2);{var y=t=>{var i=N(),h=A(i);be(h,()=>e(d).items.length,q=>{var w=nt(),T=p(w),U=p(T);const c=g(()=>!ke());Ge(U,{controlsTop:"4rem",get controls(){return e(c)},children:(s,$)=>{var b=N(),m=A(b);Ke(m,17,()=>e(d).items,Ne,(H,I)=>{Xe(H,{get card(){return e(I)},isCompact:!0,get fullWidth(){return e(F)}})}),v(s,b)},$$slots:{default:!0}}),R(()=>Me(T,1,Ce(["relative w-56",e(F)&&"w-full"]))),v(q,w)}),v(t,i)};M(j,t=>{e(d)&&t(y)})}v(l,W),te(),G()}var dt=l=>l.stopPropagation(),ct=l=>l.stopPropagation(),vt=B("<div><!></div>");function pt(l){var r=vt();r.__click=[dt],r.__keydown=[ct];var u=p(r);Ve(u,{}),v(l,r)}ue(["click","keydown"]);var ut=B('<div class="flex-center flex-shrink-0"><!></div> <div class="ml-3 mr-10 font-bold truncate color-slate-800"> </div>',1);function gt(l,r){ee(r,!0);const[u,G]=ae(),n=()=>P(e(f),"$agent",u),L=()=>P(e(E),"$identity",u);let f=g(()=>Be(r.agentId??"")),E=g(()=>Ye(r.identityId||""));var d=N(),F=A(d);{var a=C=>{var _=ut(),x=A(_),k=p(x);const W=g(()=>{var y,t;return((y=L())==null?void 0:y.avatarUrl)||((t=n())==null?void 0:t.avatar)}),S=g(()=>!!r.identityId);Ze(k,{get avatar(){return e(W)},get isBot(){return e(S)}});var K=D(x,2),j=p(K);R(()=>{var y,t;return ge(j,((y=L())==null?void 0:y.name)||((t=n())==null?void 0:t.fullname))}),v(C,_)};M(F,C=>{(n()||L())&&C(a)})}v(l,d),te(),G()}var ft=(l,r)=>l.key===Se.Enter&&r(),_t=B('<!> <div role="dialog" class="relative p-4 bg-white rounded-xl cursor-pointer content-focus"><div class="flex items-center mb-2"><!></div> <!> <div class="mt-3"><!></div> <div class="absolute top-2 right-2 text-gray-500"><!></div></div>',1),ht=B("<div><!></div>");function xt(l,r){ee(r,!0);const[u,G]=ae(),n=()=>P(He,"$lastUnreadMessage",u),L=()=>P(Re,"$hasContactMessage",u),f=()=>P(de,"$popupMessage",u),E=()=>P(pe,"$t",u);let d=Y(void 0);const{popupTextareaEnabled:F,widgetBlockingOptions:a}=Le.getOptions(),C=a==null?void 0:a.disableCloseButton,_=a==null?void 0:a.disableOpenMessenger;let x=()=>e(d)&&Ee.set(e(d).getBoundingClientRect().height);ie(()=>{x(),se().addEventListener("visibilitychange",x)}),Te(()=>{se().removeEventListener("visibilitychange",x)});const k=()=>{_||(Fe(),We())},W=()=>{ze(!0)},S=()=>{re.set(!0)},K=()=>{re.set(!1)},j=async()=>{await Ae(),x()};le(()=>{n()&&j()});let y=g(()=>L()?"trigger.replyButton":"trigger.openChatButton"),t=g(()=>F&&f()&&!Ue(f()));var i=ht(),h=p(i);{var q=w=>{var T=_t(),U=A(T);et(U);var c=D(U,2);Q(c,"aria-modal",!0),Q(c,"tabindex",0),c.__click=k,c.__keydown=[ft,k];var s=p(c),$=p(s);{var b=o=>{const z=g(()=>{var O,J;return(J=(O=f())==null?void 0:O.trigger)==null?void 0:J.identityId});gt(o,{get agentId(){return f().agentId},get identityId(){return e(z)}})},m=o=>{tt(o,{})};M($,o=>{var z,O;f().agentId||(O=(z=f())==null?void 0:z.trigger)!=null&&O.identityId?o(b):o(m,!1)})}var H=D(s,2);lt(H,{});var I=D(H,2),V=p(I);{var fe=o=>{pt(o)},_e=o=>{at(o,{icon:st,isBlock:!0,get testId(){return X.popupButton},children:(z,O)=>{var J=Oe();R(xe=>ge(J,xe),[()=>E()(e(y))]),v(z,J)},$$slots:{default:!0}})};M(V,o=>{e(t)?o(fe):o(_e,!1)})}var he=D(I,2),me=p(he);const $e=g(()=>E()("tooltip.close"));ve(me,{size:"lg",icon:De,get iconDescription(){return e($e)},onClick:W,get testId(){return X.popupButtonClose},disabled:C}),ce(c,o=>Z(d,o),()=>e(d)),R(o=>Q(c,"aria-label",o),[()=>E()("ariaLabel.popup")]),oe("mouseenter",c,S),oe("mouseleave",c,K),v(w,T)};M(h,w=>{f()&&w(q)})}R(()=>Q(i,"data-testid",X.popup)),v(l,i),te(),G()}ue(["click","keydown"]);export{xt as default};
//# sourceMappingURL=WidgetPopup-CacF_RyW.js.map
